<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png"><link rel="mask-icon" href="/images/favicon/favicon.ico" color="#222"><meta name="google-site-verification" content="LMcddVW6xLBS7X1htGQ3duOIEmVp4ljku8sd3UuIcBg"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto+Sans+KR:300,300italic,400,400italic,700,700italic%7CPretendard-Bold:300,300italic,400,400italic,700,700italic%7CPretendard-Medium:300,300italic,400,400italic,700,700italic%7CJetbrains+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-loading-bar.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"kdevkr.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.13.2","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"width":240,"scrollpercent":true,"b2t":true},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script><meta name="description" content="ì•ˆë…•í•˜ì„¸ìš” Mambo ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ AWS IoT Coreì˜ MQTT í´ë¼ì´ì–¸íŠ¸ë¡œ MQTT ë¸Œë¡œì»¤ì— ì—°ê²°í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ê²Œì‹œí•˜ê³  ìˆ˜ì‹ í•´ë³´ëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ ì•Œì•„ë´…ë‹ˆë‹¤. AWS IoT Core AWS IoT CoreëŠ” í´ë¼ìš°ë“œ í™˜ê²½ì— ë””ë°”ì´ìŠ¤ë¥¼ ì—°ê²°í•˜ê³  ì—°ê²°ëœ ë””ë°”ì´ìŠ¤ê°„ í†µì‹ ì„ ì œê³µí•˜ëŠ” ê´€ë¦¬í˜• í´ë¼ìš°ë“œ í”Œë«í¼ì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  AWS IoT Coreë¥¼ ì‚¬ìš©í•˜ëŠ” ë””"><meta property="og:type" content="website"><meta property="og:title" content="AWS IoT Device SDK Javaë¡œ MQTT ì—°ê²°í•˜ê¸°"><meta property="og:url" content="https://kdevkr.github.io/archive/connecting-with-mqtt-using-aws-iot-device-sdk.html"><meta property="og:site_name" content="Mambo"><meta property="og:description" content="ì•ˆë…•í•˜ì„¸ìš” Mambo ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ AWS IoT Coreì˜ MQTT í´ë¼ì´ì–¸íŠ¸ë¡œ MQTT ë¸Œë¡œì»¤ì— ì—°ê²°í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ê²Œì‹œí•˜ê³  ìˆ˜ì‹ í•´ë³´ëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ ì•Œì•„ë´…ë‹ˆë‹¤. AWS IoT Core AWS IoT CoreëŠ” í´ë¼ìš°ë“œ í™˜ê²½ì— ë””ë°”ì´ìŠ¤ë¥¼ ì—°ê²°í•˜ê³  ì—°ê²°ëœ ë””ë°”ì´ìŠ¤ê°„ í†µì‹ ì„ ì œê³µí•˜ëŠ” ê´€ë¦¬í˜• í´ë¼ìš°ë“œ í”Œë«í¼ì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  AWS IoT Coreë¥¼ ì‚¬ìš©í•˜ëŠ” ë””"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://docs.aws.amazon.com/iot/latest/developerguide/images/what-is-aws-iot.png"><meta property="og:image" content="https://kdevkr.github.io/images/posts/aws-iot-mqtt-subscribe.png"><meta property="article:published_time" content="2021-08-06T15:00:00.000Z"><meta property="article:modified_time" content="2023-03-02T13:59:55.349Z"><meta property="article:author" content="Mambo"><meta property="article:tag" content="AWS"><meta property="article:tag" content="MQTT"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://docs.aws.amazon.com/iot/latest/developerguide/images/what-is-aws-iot.png"><link rel="canonical" href="https://kdevkr.github.io/archive/connecting-with-mqtt-using-aws-iot-device-sdk"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":false,"lang":"en","comments":true,"permalink":"https://kdevkr.github.io/archive/connecting-with-mqtt-using-aws-iot-device-sdk.html","path":"archive/connecting-with-mqtt-using-aws-iot-device-sdk.html","title":"AWS IoT Device SDK Javaë¡œ MQTT ì—°ê²°í•˜ê¸°"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>AWS IoT Device SDK Javaë¡œ MQTT ì—°ê²°í•˜ê¸° | Mambo</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-V8LF04VMBF"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-V8LF04VMBF","only_pageview":false}</script><script src="/js/third-party/analytics/google-analytics.js"></script><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><link rel="alternate" href="/atom.xml" title="Mambo" type="application/atom+xml">
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope itemtype="http://schema.org/WebPage"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Mambo</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Today I Learned ğŸ”¥</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fas fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fas fa-archive fa-fw"></i>Archives<span class="badge">81</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fas fa-user fa-fw"></i>About</a></li></ul></nav></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#AWS-IoT-Core"><span class="nav-number">1.</span> <span class="nav-text">AWS IoT Core</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MQTT-3-1-1"><span class="nav-number">1.1.</span> <span class="nav-text">MQTT 3.1.1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AWS-IoT-Device-SDK-for-Java"><span class="nav-number">1.2.</span> <span class="nav-text">AWS IoT Device SDK for Java</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MQTT-with-AWS-IoT-Core"><span class="nav-number">2.</span> <span class="nav-text">MQTT with AWS IoT Core</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Amazon-Cognito-IdP"><span class="nav-number">2.1.</span> <span class="nav-text">Amazon Cognito IdP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Connenction-using-MqttClient"><span class="nav-number">2.2.</span> <span class="nav-text">Connenction using MqttClient</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Mambo" src="https://avatars1.githubusercontent.com/u/17937604?s=460&v=4"><p class="site-author-name" itemprop="name">Mambo</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">81</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-tags"><span class="site-state-item-count">133</span> <span class="site-state-item-name">tags</span></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/kdevkr" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;kdevkr" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:kdevkr@gmail.com" title="E-Mail â†’ mailto:kdevkr@gmail.com" rel="noopener" target="_blank"><i class="fas fa-envelope fa-fw"></i>E-Mail</a></span></div><div class="cc-license site-overview-item animated" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ko" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div><div class="back-to-top animated" role="button" aria-label="Back to top"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div class="sidebar-dimmer"></div></header><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner page posts-expand"><div class="post-block" lang="en"><header class="post-header"><h1 class="post-title" itemprop="name headline">AWS IoT Device SDK Javaë¡œ MQTT ì—°ê²°í•˜ê¸°</h1><div class="post-meta-container"></div></header><div class="post-body"><p>ì•ˆë…•í•˜ì„¸ìš” Mambo ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ AWS IoT Coreì˜ MQTT í´ë¼ì´ì–¸íŠ¸ë¡œ MQTT ë¸Œë¡œì»¤ì— ì—°ê²°í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ê²Œì‹œí•˜ê³  ìˆ˜ì‹ í•´ë³´ëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ ì•Œì•„ë´…ë‹ˆë‹¤.</p><h2 id="AWS-IoT-Core"><a href="#AWS-IoT-Core" class="headerlink" title="AWS IoT Core"></a>AWS IoT Core</h2><p><img data-src="https://docs.aws.amazon.com/iot/latest/developerguide/images/what-is-aws-iot.png"></p><p>AWS IoT CoreëŠ” í´ë¼ìš°ë“œ í™˜ê²½ì— ë””ë°”ì´ìŠ¤ë¥¼ ì—°ê²°í•˜ê³  ì—°ê²°ëœ ë””ë°”ì´ìŠ¤ê°„ í†µì‹ ì„ ì œê³µí•˜ëŠ” ê´€ë¦¬í˜• í´ë¼ìš°ë“œ í”Œë«í¼ì…ë‹ˆë‹¤. ê·¸ë¦¬ê³  AWS IoT Coreë¥¼ ì‚¬ìš©í•˜ëŠ” ë””ë°”ì´ìŠ¤ë“¤ì´ ë‹¤ìŒì˜ í‘œì¤€ í†µì‹  í”„ë¡œí† ì½œì„ ì‚¬ìš©í•˜ì—¬ ì„œë¡œ ìƒí˜¸ì‘ìš©ì„ í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•©ë‹ˆë‹¤.</p><ul><li><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/iot/latest/developerguide/mqtt.html">MQTT (Message Queuing and Telemetry Transport)</a></li><li><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/iot/latest/developerguide/mqtt.html">MQTT over WSS (Websockets Secure)</a></li><li><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/iot/latest/developerguide/http.html">HTTPS (Hypertext Transfer Protocol - Secure)</a></li><li><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/iot/latest/developerguide/connect-iot-lorawan.html">LoRaWAN (Long Range Wide Area Network)</a></li></ul><p>ì´ ê¸€ì—ì„œëŠ” ë‘ë²ˆì§¸ ë°©ì‹ì¸ <strong>MQTT over WebSocket</strong> ë°©ì‹ìœ¼ë¡œ AWS IoT Core ì„œë¹„ìŠ¤ì— ì—°ê²°í•˜ëŠ” ê²ƒì„ ì•Œì•„ë´…ë‹ˆë‹¤.</p><h3 id="MQTT-3-1-1"><a href="#MQTT-3-1-1" class="headerlink" title="MQTT 3.1.1"></a>MQTT 3.1.1</h3><p>AWS IoT Coreì˜ MQTT ë©”ì‹œì§€ ë¸Œë¡œì»¤ëŠ” <a target="_blank" rel="noopener" href="http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html">MQTT v3.1.1 specification</a>ì„ ê¸°ë°˜ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ëª‡ê°€ì§€ ë¶€ë¶„ì— ëŒ€í•´ì„œ ì•½ê°„ ë‹¤ë¥´ë‹¤ê³  í•˜ëŠ”ë° ì£¼ìš” ì‚¬í•­ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ul><li>QoS(Quality of Service)ëŠ” 0 ë˜ëŠ” 1 ì§€ì›</li><li>í´ë¼ì´ì–¸íŠ¸ ID ìœ ì¼ì„±</li><li>ë³´ê´€ëœ ë©”ì‹œì§€ ë¯¸ì§€ì›</li></ul><blockquote><p>ë” ìì„¸í•œ ë‚´ìš©ì€ <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/iot/latest/developerguide/mqtt.html#mqtt-differences">AWS IoT differences from MQTT version 3.1.1 specification</a>ì„ ì°¸ê³ í•˜ì„¸ìš”.</p></blockquote><h3 id="AWS-IoT-Device-SDK-for-Java"><a href="#AWS-IoT-Device-SDK-for-Java" class="headerlink" title="AWS IoT Device SDK for Java"></a>AWS IoT Device SDK for Java</h3><p>AWS IoT ì„œë¹„ìŠ¤ì— ì—°ê²°í•˜ê¸°ìœ„í•´ì„œëŠ” AWS CLI, AWS IoT API, AWS IoT Device SDKë¥¼ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤. ì—¬ëŸ¬ ì–¸ì–´ë¡œ êµ¬í˜„ëœ AWS IoT Device SDK ì¤‘ì—ì„œ ì•ˆíƒ€ê¹ê²Œ Goë¡œ ì‘ì„±ëœ SDKëŠ” ì—†ìœ¼ë¯€ë¡œ <strong>AWS IoT Device SDK for Java</strong> ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p><p>AWS IoT Device SDKëŠ” ë²„ì „ 1ê³¼ ë²„ì „ 2ê°€ ìˆìŠµë‹ˆë‹¤. íšŒì‚¬ì—ì„œëŠ” ë²„ì „ 1ì„ ì‚¬ìš©í•˜ê³  ìˆì§€ë§Œ ì´ ê¸€ì—ì„œëŠ” <strong>AWS IoT Device SDK for Java v2</strong> ë¥¼ ì‚¬ìš©í•˜ì—¬ AWS IoT ì„œë¹„ìŠ¤ì— ì—°ê²°í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.</p><table><thead><tr><th>Version 1</th><th>Version 2</th></tr></thead><tbody><tr><td><a target="_blank" rel="noopener" href="https://github.com/aws/aws-sdk-java">AWS SDK for Java</a></td><td><a target="_blank" rel="noopener" href="https://github.com/aws/aws-sdk-java-v2">AWS SDK for Java 2.0</a></td></tr><tr><td><a target="_blank" rel="noopener" href="https://github.com/aws/aws-iot-device-sdk-java">AWS IoT Device SDK for Java</a></td><td><a target="_blank" rel="noopener" href="https://github.com/aws/aws-iot-device-sdk-java-v2">AWS IoT Device SDK for Java v2</a></td></tr></tbody></table><blockquote><p>ê¸°ì¡´ SDKë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ì‰½ë„ë¡ ìƒˆë¡œ ì‘ì„±í•œ SDKì´ê¸° ë•Œë¬¸ì— ë” í¸ë¦¬í•©ë‹ˆë‹¤.</p></blockquote><pre class="language-groovy" data-language="groovy"><div class="caption"><span>build.gradle</span></div><code class="language-groovy">dependencies &#123;
    implementation platform(&#39;software.amazon.awssdk:bom:2.17.13&#39;)
    implementation &#39;software.amazon.awssdk:cognitoidentity&#39;
    implementation &#39;software.amazon.awssdk:lambda&#39;
    implementation &#39;software.amazon.awssdk.iotdevicesdk:aws-iot-device-sdk:1.4.3&#39;
&#125;</code></pre><blockquote><p>íšŒì‚¬ì—ì„œëŠ” ëª¨ë“  ëª¨ë“ˆì„ í¬í•¨í•˜ëŠ” SDKë¥¼ ì‚¬ìš©í•˜ëŠ”ë° í•„ìš”í•œ SDK ëª¨ë“ˆë§Œ ì¶”ê°€í•´ì„œ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ì•„ë³´ì…ë‹ˆë‹¤.<br><a target="_blank" rel="noopener" href="https://search.maven.org/search?q=g:software.amazon.awssdk">SDK ëª¨ë“ˆ ëª©ë¡</a>ì„ ë³´ë©´ ì´ ê¸€ì„ ì“°ëŠ” ê¸°ì¤€ìœ¼ë¡œ ë¬´ë ¤ <strong>352ê°œ</strong>ê°€ í¬í•¨ë©ë‹ˆë‹¤.</p></blockquote><h2 id="MQTT-with-AWS-IoT-Core"><a href="#MQTT-with-AWS-IoT-Core" class="headerlink" title="MQTT with AWS IoT Core"></a>MQTT with AWS IoT Core</h2><p>AWS Iot Coreì˜ MQTT í´ë¼ì´ì–¸íŠ¸ëŠ” ì—°ê²° ë°©ì‹ì— ë”°ë¼ ë‹¤ìŒì˜ ë‘ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì§‘ë‹ˆë‹¤.</p><table><thead><tr><th>ë°©ì‹</th><th>ì„¤ëª…</th></tr></thead><tbody><tr><td>MQTT</td><td>X.509 ì¸ì¦ì„œ ê¸°ë°˜ ì¸ì¦</td></tr><tr><td>MQTT over WebSocket</td><td><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/ko_kr/general/latest/gr/signature-version-4.html">ì„œëª… ë²„ì „ 4 (SIGv4)</a> ìê²© ì¦ëª…ì„ ì‚¬ìš©í•˜ì—¬ ì¸ì¦</td></tr></tbody></table><p>íšŒì‚¬ì—ì„œëŠ” ì„œë²„ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê²½ìš° í…”ë ˆë…¸ì–´ ì»¤ë„¥ì…˜(Telenor Connexion) ì„œë¹„ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” ìê²© ì¦ëª…ì„ í†µí•´ <strong>MQTT over WebSocket</strong> ìœ¼ë¡œ ì—°ê²°í•˜ê³  ìˆìœ¼ë©° ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ë””ë°”ì´ìŠ¤ì—ì„œëŠ” ìê²© ì¦ëª…ì„ ì™¸ë¶€ë¡œ ê³µê°œí•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ <strong>X.509 ì¸ì¦ì„œ</strong> ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì—°ê²°í•©ë‹ˆë‹¤.</p><h3 id="Amazon-Cognito-IdP"><a href="#Amazon-Cognito-IdP" class="headerlink" title="Amazon Cognito IdP"></a>Amazon Cognito IdP</h3><p>ë³¸ í•™ìŠµì—ì„œëŠ” AWS IoT ì„œë¹„ìŠ¤(MQTT ë©”ì‹œì§€ ë¸Œë¡œì»¤)ì— ì—°ê²°í•˜ê¸° ìœ„í•˜ì—¬ <strong>Amazon Cognitoì˜ ìê²© ì¦ëª… ê³µê¸‰ì(IdP)</strong> ë¥¼ í†µí•´ AWS ì„œë¹„ìŠ¤ì— ëŒ€í•´ ì¸ì¦í•©ë‹ˆë‹¤. ì €ëŠ” í…”ë ˆë…¸ì–´ ì»¤ë„¥ì…˜ì—ì„œ ì§€ì›í•˜ëŠ” í”Œë«í¼ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ <strong>ì‚¬ìš©ì í’€ ì•„ì´ë””(User Pool ID)</strong> ì™€ <strong>ìê²© ì¦ëª… í’€ ì•„ì´ë””(Identity Pool ID)</strong> ë¥¼ ì œê³µë°›ê¸° ë•Œë¬¸ì— ì´ ë¶€ë¶„ì— ëŒ€í•´ì„œëŠ” ë‹¤ë£¨ì§€ ì•ŠìŠµë‹ˆë‹¤.</p><blockquote><p>ì¶”í›„ì— Amazon Cognitoë¥¼ ì§ì ‘ ë‹¤ë£¨ê²Œëœë‹¤ë©´ ì‚¬ìš©ì í’€ê³¼ ìê²© ì¦ëª… í’€ ì•„ì´ë””ë¥¼ ë°œê¸‰í•˜ëŠ” ë¶€ë¶„ì— ëŒ€í•´ì„œ ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤.</p></blockquote><p>Amazon Cognitoë¥¼ í™œìš©í•˜ì—¬ <strong>AWS ì„œë¹„ìŠ¤ì— ì¸ì¦í•˜ëŠ” ìˆœì„œ</strong>ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ol><li>ë°œê¸‰ë°›ì€ ìê²© ì¦ëª… í’€ ì•„ì´ë””ë¡œ Cogntio ìê²© ì¦ëª… í’€ì— ì¸ì¦í•˜ì—¬ ì„ì‹œ ìê²© ì¦ëª… ë°œê¸‰</li><li>ë“±ë¡ëœ ì‚¬ìš©ì í’€ ì•„ì´ë””ë¡œ Cognito ì‚¬ìš©ì í’€ì— ì¸ì¦í•˜ì—¬ JWT í† í° ë°œê¸‰</li><li>Cogntio ìê²© ì¦ëª… ê³µê¸‰ìì— ì¸ì¦ëœ ì‚¬ìš©ìì˜ JWT í† í°ì„ ë¡œê·¸ì¸ ë§µì— ì„¤ì •</li><li>ì¸ì¦ëœ ì‚¬ìš©ìì˜ ìê²© ì¦ëª… ë°œê¸‰</li><li>Cognito ì„ì‹œ ìê²© ì¦ëª…ì„ ì‚¬ìš©í•˜ì—¬ AWS IoT ì„œë¹„ìŠ¤ì— ì—°ê²°</li></ol><h4 id="Identity-Pool-Credentials"><a href="#Identity-Pool-Credentials" class="headerlink" title="Identity Pool Credentials"></a>Identity Pool Credentials</h4><p>ë¨¼ì €, CognitoIdentityClientë¡œ ìê²© ì¦ëª… í’€ ì•„ì´ë””ì™€ ë¦¬ì „ì— ëŒ€í•œ ìê²© ì¦ëª… í’€ í¬ë ˆë´ì…œì„ ë°œê¸‰í•©ë‹ˆë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java">private AwsSessionCredentials baseCredentials(String identityPoolId, Region region) &#123;
    try (CognitoIdentityClient cognitoIdentityClient &#x3D; CognitoIdentityClient.builder()
            .credentialsProvider(AnonymousCredentialsProvider.create())
            .region(region)
            .build()) &#123;

        GetIdRequest getIdRequest &#x3D; GetIdRequest.builder()
                .identityPoolId(identityPoolId)
                .build();

        String identityId &#x3D; cognitoIdentityClient.getId(getIdRequest).identityId();
        GetCredentialsForIdentityRequest getCredentialsForIdentityRequest &#x3D; GetCredentialsForIdentityRequest.builder()
                .identityId(identityId)
                .build();

        Credentials credentials &#x3D; cognitoIdentityClient.getCredentialsForIdentity(getCredentialsForIdentityRequest).credentials();
        return AwsSessionCredentials.create(credentials.accessKeyId(), credentials.secretKey(), credentials.sessionToken());
    &#125;
&#125;</code></pre><h4 id="User-Pool-JWT-Token"><a href="#User-Pool-JWT-Token" class="headerlink" title="User Pool JWT Token"></a>User Pool JWT Token</h4><p>ë°œê¸‰ëœ í¬ë ˆë´ì…œìœ¼ë¡œ ì‚¬ìš©ì í’€ì— ë“±ë¡ë˜ì–´ìˆëŠ” ì‚¬ìš©ìì˜ JWT í† í°ì„ ì¡°íšŒí•˜ê¸° ìœ„í•˜ì—¬ Lambda í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java">@SuppressWarnings(&#123;&quot;unchecked&quot;&#125;)
private String jwt(AwsSessionCredentials awsSessionCredentials, Region region) &#123;
    &#x2F;&#x2F; https:&#x2F;&#x2F;docs.aws.amazon.com&#x2F;code-samples&#x2F;latest&#x2F;catalog&#x2F;javav2-lambda-src-main-java-com-example-lambda-LambdaInvoke.java.html
    try (LambdaClient lambdaClient &#x3D; LambdaClient.builder()
            .credentialsProvider(StaticCredentialsProvider.create(awsSessionCredentials))
            .region(region)
            .build()) &#123;

        InvokeRequest invokeRequest &#x3D; InvokeRequest.builder()
                .functionName(authLambda)
                .payload(SdkBytes.fromString(gson.toJson(authLambdaPayload), StandardCharsets.UTF_8))
                .build();

        InvokeResponse invokeResponse &#x3D; lambdaClient.invoke(invokeRequest);
        Map&lt;String, Object&gt; responsePayload &#x3D; gson.fromJson(new String(invokeResponse.payload().asByteArray(), StandardCharsets.UTF_8),
                new TypeToken&lt;HashMap&lt;String, Object&gt;&gt;() &#123;
                &#125;.getType());

        return (String) ((Map&lt;String, Object&gt;) responsePayload.get(&quot;credentials&quot;)).get(&quot;token&quot;);
    &#125;
&#125;</code></pre><h4 id="Identity-Provider-with-Logins"><a href="#Identity-Provider-with-Logins" class="headerlink" title="Identity Provider with Logins"></a>Identity Provider with Logins</h4><p>ì¸ì¦ëœ ì‚¬ìš©ìì˜ JWT í† í°ì„ Cognito ìê²© ì¦ëª… ê³µê¸‰ìì˜ <strong>Logins</strong> ë§µì— ë¶€ì—¬í•˜ì—¬ í¬ë ˆë´ì…œì„ ë°œê¸‰í•©ë‹ˆë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java">private static final String COGNITO_IDENTITY_PROVIDER_URL &#x3D; &quot;cognito-idp.%s.amazonaws.com&#x2F;%s&quot;;

private Credentials loginsCredentials(String identityPoolId, Region region, String userPoolId, String accessToken) &#123;
    Map&lt;String, String&gt; logins &#x3D; new HashMap&lt;&gt;();
    logins.put(String.format(COGNITO_IDENTITY_PROVIDER_URL, region.id(), userPoolId), accessToken);

    try (CognitoIdentityClient cognitoIdentityClient &#x3D; CognitoIdentityClient.builder()
            .credentialsProvider(AnonymousCredentialsProvider.create())
            .region(region)
            .build()) &#123;

        GetIdRequest getIdRequest &#x3D; GetIdRequest.builder()
                .identityPoolId(identityPoolId)
                .logins(logins)
                .build();

        String identityId &#x3D; cognitoIdentityClient.getId(getIdRequest).identityId();
        GetCredentialsForIdentityRequest getCredentialsForIdentityRequest &#x3D; GetCredentialsForIdentityRequest.builder()
                .identityId(identityId)
                .logins(logins)
                .build();

        return cognitoIdentityClient.getCredentialsForIdentity(getCredentialsForIdentityRequest).credentials();
    &#125;
&#125;</code></pre><blockquote><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-integrating-user-pools-with-identity-pools.html#amazon-cognito-integrating-user-pools-with-identity-pools-using">Integrating a User Pool with an Identity Pool</a></p></blockquote><h3 id="Connenction-using-MqttClient"><a href="#Connenction-using-MqttClient" class="headerlink" title="Connenction using MqttClient"></a>Connenction using MqttClient</h3><p>Amazon Cognitoë¥¼ ì‚¬ìš©í•˜ì—¬ AWS ì„œë¹„ìŠ¤ì— ì¸ì¦í•  ìˆ˜ ìˆëŠ” í¬ë ˆë´ì…œì„ ë°œê¸‰í–ˆìŠµë‹ˆë‹¤. ì´ì œ ì´ í¬ë ˆë´ì…œì„ ì‚¬ìš©í•˜ì—¬ MQTT í´ë¼ì´ì–¸íŠ¸ë¡œ AWS IoTì˜ MQTT ë©”ì‹œì§€ ë¸Œë¡œì»¤ì— ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. AWS IoT Device SDKì—ì„œëŠ” AWSIotMqttClientë¡œ ì—°ê²°í•  ìˆ˜ ìˆì§€ë§Œ <strong>AWS IoT Device SDK v2</strong>ì—ì„œëŠ” MqttClientConnectionë¡œ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>SDK V2ë“¤ì€ Cë¡œ ì‘ì„±ëœ <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/sdkref/latest/guide/common-runtime.html">AWS Common Runtime</a> ê¸°ë°˜í•˜ì— ë™ì‘í•˜ê²Œ ë©ë‹ˆë‹¤.</p></blockquote><p>MqttClientConnectionëŠ” ìë°” 8ì˜ CompletableFutureì„ í†µí•´ ë¹„ë™ê¸°ë¡œ ìˆ˜í–‰ë˜ì–´ ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ë¨¼ì €, AwsIotMqttConnectionBuilderë¥¼ ì‚¬ìš©í•˜ì—¬ í¬ë ˆë´ì…œì„ ê¸°ë°˜ìœ¼ë¡œ MqttClientConnectionë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java">static MqttClientConnection build(String clientEndpoint, String clientId,
                                        String accessKeyId, String secretKey, String sessionToken, String region) throws UnsupportedEncodingException &#123;
    try (EventLoopGroup eventLoopGroup &#x3D; new EventLoopGroup(1);
            HostResolver resolver &#x3D; new HostResolver(eventLoopGroup);
            ClientBootstrap clientBootstrap &#x3D; new ClientBootstrap(eventLoopGroup, resolver);
            AwsIotMqttConnectionBuilder builder &#x3D; AwsIotMqttConnectionBuilder.newDefaultBuilder()) &#123;

        StaticCredentialsProvider credentialsProvider &#x3D;
                new StaticCredentialsProvider.StaticCredentialsProviderBuilder()
                        .withAccessKeyId(accessKeyId.getBytes(StandardCharsets.UTF_8))
                        .withSecretAccessKey(secretKey.getBytes(StandardCharsets.UTF_8))
                        .withSessionToken(sessionToken.getBytes(StandardCharsets.UTF_8))
                        .build();

        return builder
                .withEndpoint(clientEndpoint)
                .withClientId(clientId)
                .withBootstrap(clientBootstrap)
                .withSocketOptions(new SocketOptions())
                .withWebsockets(true)
                .withWebsocketCredentialsProvider(credentialsProvider)
                .withWebsocketSigningRegion(region)
                .withConnectionEventCallbacks(clientConnectionEvents())
                .build();
    &#125;
&#125;</code></pre><p>ë§Œë“¤ì–´ì§„ MqttClientConnectionëŠ” ìë°” 8ì˜ CompletableFutureë¡œ ë™ì‘í•˜ë¯€ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ë¹„ë™ê¸°ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java">@SuppressWarnings(&#123;&quot;squid:S3740&quot;, &quot;rawtypes&quot;, &quot;unchecked&quot;&#125;)
private void subscribe(Credentials credentials) &#123;
    try &#123;
        MqttClientConnection connection &#x3D; build(clientEndpoint, clientId,
                credentials.accessKeyId(), credentials.secretKey(), credentials.sessionToken(), region.id());
        CompletableFuture&lt;Boolean&gt; connectFuture &#x3D; connection.connect();
        connectFuture.get();

        ListenableFutureTask futureTask &#x3D; new ListenableFutureTask(() -&gt;
                connection.subscribe(&quot;thing-update&#x2F;#&quot;, QualityOfService.AT_MOST_ONCE, handler -&gt; &#123;
                    String payload &#x3D; new String(handler.getPayload(), StandardCharsets.UTF_8);
                    log.info(&quot;topic:&#123;&#125;, qos: &#123;&#125;&quot;, handler.getTopic(), handler.getQos());
                    log.trace(&quot;&#x3D;&#x3D;&#x3D;&gt; &#123;&#125;&quot;, payload);
                &#125;));

        futureTask.run();
    &#125; catch (UnsupportedEncodingException | ExecutionException e) &#123;
        log.error(e.getMessage());
    &#125; catch (InterruptedException e) &#123;
        log.error(e.getMessage());
        Thread.currentThread().interrupt();
    &#125;
&#125;</code></pre><blockquote><p>ListenableFutureTaskëŠ” ìŠ¤í”„ë§ì—ì„œ ì§€ì›í•˜ëŠ” í´ë˜ìŠ¤ì…ë‹ˆë‹¤.</p></blockquote><h4 id="AWS-IoT-Client-Endpoint"><a href="#AWS-IoT-Client-Endpoint" class="headerlink" title="AWS IoT Client Endpoint"></a>AWS IoT Client Endpoint</h4><p>AWS IoT ì—”ë“œí¬ì¸íŠ¸ëŠ” <a href="distrust-symantec-ca-in-jdk">ì‹œë§Œí… CA ì¸ì¦ì„œë¥¼ ì‹ ë¢°í•˜ì§€ ì•ŠìŒ</a> ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ <strong>ATS CA ì¸ì¦ì„œ</strong> ì—ì„œ ì„œëª…í•œ ì¸ì¦ì„œë¥¼ ì œê³µí•˜ëŠ” ATS ì—”ë“œí¬ì¸íŠ¸ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</p><pre class="language-properties" data-language="properties"><div class="caption"><span>application.properties</span></div><code class="language-properties">aws-iot.client.endpoint&#x3D;&#123;ACCOUNT_SPECIFIC_PREFIX&#125;-ats.iot.&#123;REGION_ID&#125;.amazonaws.com
aws-iot.client.id&#x3D;</code></pre><p>í´ë¼ì´ì–¸íŠ¸ ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì¸ì¦ëœ ì‚¬ìš©ìì˜ í¬ë ˆë´ì…œì˜ ì •ë³´ë¼ë©´ ë©”ì‹œì§€ í˜ì´ë¡œë“œê°€ êµ¬ë…ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img data-src="/images/posts/aws-iot-mqtt-subscribe.png"></p><p>ì´ìƒìœ¼ë¡œ AWS IoT Device SDK Javaë¡œ MQTT ì—°ê²°í•˜ê¸°ë¥¼ ë§ˆì¹©ë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.</p></div></div><div class="comments"><script src="https://utteranc.es/client.js" repo="kdevkr/kdevkr.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Mambo</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script src="/js/third-party/fancybox.js"></script><script src="/js/third-party/pace.js"></script><script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script><script>var options={bottom:"unset",right:"15px",left:"unset",time:"0.5s",mixColor:"transparent",backgroundColor:"transparent",buttonColorDark:"#100f2c",buttonColorLight:"#fff",saveInCookies:!0,label:"ğŸŒ—",autoMatchOsTheme:!0};const darkmode=new Darkmode(options);window.darkmode=darkmode,darkmode.showWidget()</script></body></html>