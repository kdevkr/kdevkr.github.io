<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Mambo</title>
  
  <subtitle>Today I Learned ğŸ”¥</subtitle>
  <link href="https://kdevkr.github.io/atom.xml" rel="self"/>
  
  <link href="https://kdevkr.github.io/"/>
  <updated>2024-07-13T10:21:40.902Z</updated>
  <id>https://kdevkr.github.io/</id>
  
  <author>
    <name>Mambo</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸</title>
    <link href="https://kdevkr.github.io/passkey-login/"/>
    <id>https://kdevkr.github.io/passkey-login/</id>
    <published>2024-07-13T03:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.902Z</updated>
    
    <content type="html"><![CDATA[<p>íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸ì€ ì‚¬ìš©ì ê³„ì •ì— ëŒ€í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìš”êµ¬í•˜ì§€ ì•Šê³  ì‚¬ìš©ì ê³„ì •ì— ì§€ë¬¸ì´ë‚˜ ì–¼êµ´ ì¸ì‹ ê·¸ë¦¬ê³  ë³´ì•ˆí‚¤ ë“±ì„ ì‚¬ìš©í•´ì„œ ë“±ë¡í•œ ì¸ì¦ ì •ë³´ë¥¼ í† ëŒ€ë¡œ ì‚¬ìš©ìì˜ ì¸ì¦ ê¸°ê¸°ë¥¼ í†µí•´ ë¡œê·¸ì¸ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ ë§í•œë‹¤. íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸ ë¿ë§Œ ì•„ë‹ˆë¼ <a href="https://aws.amazon.com/ko/about-aws/whats-new/2024/06/aws-identity-access-management-passkey-authentication-factor/?nc1=h_ls">ì•„ë§ˆì¡´ ì›¹ ì„œë¹„ìŠ¤</a>ì™€ <a href="https://docs.github.com/ko/authentication/authenticating-with-a-passkey/signing-in-with-a-passkey">ê¹ƒí—ˆë¸Œ</a>ì²˜ëŸ¼ 2ì°¨ ì¸ì¦ì„ ìœ„í•´ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. íŒ¨ìŠ¤í‚¤ êµ¬í˜„ì—ëŠ” ì•„ë˜ì™€ ê°™ì€ ì •ë³´ë“¤ì„ ì°¸ê³ í•  ìˆ˜ ìˆëŠ”ë° ë” ìì„¸í•œ ì •ë³´ë“¤ì„ ì›í•œë‹¤ë©´ <a href="https://github.com/yackermann/awesome-webauthn">WebAuthn Awesome</a>ì—ì„œ ì°¾ì•„ë³¼ ìˆ˜ ìˆë‹¤.</p><ul><li><a href="https://webauthn.io/">WebAuthn.io ë°ëª¨ ì‚¬ì´íŠ¸</a></li><li><a href="https://webauthn.guide/">WebAuthn ê°€ì´ë“œ</a></li><li><a href="https://passkeys.dev/device-support/">íŒ¨ìŠ¤í‚¤ ì§€ì› ë””ë°”ì´ìŠ¤ ì •ë³´</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API">WebAuthn: Web Authentication API</a></li><li><a href="https://webauthn.wtf/">What is WebAuthn?</a></li><li><a href="https://passkeys.dev/docs/intro/what-are-passkeys/">What are passkeys?</a></li><li><a href="https://fidoalliance.org/ux-guidelines-for-passkey-creation-and-sign-ins/?lang=ko">íŒ¨ìŠ¤í‚¤ ìƒì„± ë° ë¡œê·¸ì¸ì„ ìœ„í•œ FIDO ì–¼ë¼ì´ì–¸ìŠ¤ UX ê°€ì´ë“œë¼ì¸</a></li><li><a href="https://webauthn.me/passkeys">Web Authentication and Passkeys</a></li></ul><blockquote><p>íŒ¨ìŠ¤í‚¤ëŠ” ì§€ë¬¸ ë˜ëŠ” ì–¼êµ´ ì¸ì‹ê³¼ ê°™ì€ ìƒì²´ ì¸ì¦ ë¿ë§Œ ì•„ë‹ˆë¼ PIN ì´ë‚˜ ë³´ì•ˆ ê¸°ê¸° ë“± ë‹¤ì–‘í•œ ë°©ì‹ìœ¼ë¡œ ë“±ë¡í•  ìˆ˜ ìˆì–´ìš”.<br>ë”°ë¼ì„œ, ìƒì²´ ì¸ì¦ì´ ì•„ë‹Œ passkey ë˜ëŠ” webauthn ì´ë¼ëŠ” ìš©ì–´ë¡œ ìŠ¤í‚¤ë§ˆë¥¼ ì„¤ê³„í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.</p></blockquote><h4 id="íŒ¨ìŠ¤í‚¤-ë“±ë¡ì„-ìœ„í•œ-ì„œë¹„ìŠ¤-ì œê³µì"><a href="#íŒ¨ìŠ¤í‚¤-ë“±ë¡ì„-ìœ„í•œ-ì„œë¹„ìŠ¤-ì œê³µì" class="headerlink" title="íŒ¨ìŠ¤í‚¤ ë“±ë¡ì„ ìœ„í•œ ì„œë¹„ìŠ¤ ì œê³µì"></a>íŒ¨ìŠ¤í‚¤ ë“±ë¡ì„ ìœ„í•œ ì„œë¹„ìŠ¤ ì œê³µì</h4><p>íŒ¨ìŠ¤í‚¤ <a href="https://webauthn.wtf/how-it-works/relying-party">ì‹ ë¢° ë‹¹ì‚¬ì(RP)</a>ëŠ” ì¸ì¦ ì •ë³´ì— ëŒ€í•œ ì‹ ì›ì„ ê´€ë¦¬í•˜ê³  ê²€ì¦í•˜ëŠ” ì„œë¹„ìŠ¤ ì œê³µìë¥¼ ì˜ë¯¸í•œë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì›¹ ì„œë¹„ìŠ¤ì—ì„œ RPëŠ” ë„ë©”ì¸ì´ë©° í´ë¼ì´ì–¸íŠ¸ëŠ” ì‚¬ìš©ìì—ê²Œ ì¸ì¦ì„ ìš”êµ¬í•˜ê¸° ì „ì— RPë¡œë¶€í„° <strong>ì±Œë¦°ì§€</strong>ì™€ í•¨ê»˜ ì—¬ëŸ¬ê°€ì§€ ì˜µì…˜ì„ ìš”ì²­í•œë‹¤. ìš”ì²­ë°›ì€ ì •ë³´ëŠ” WebAuthn ì—ì„œ <a href="https://webauthn.guide/#registration">PublicKeyCredentialCreationOptions</a>ë¥¼ ì˜ë¯¸í•œë‹¤. ì±Œë¦°ì§€ ë¿ë§Œ ì•„ë‹ˆë¼ ì‚¬ìš©ì ì•„ì´ë””ì™€ ê°™ì€ ì¼ë¶€ í•­ëª©ë“¤ì€ ë°”ì´íŠ¸ ë°°ì—´ë¡œ êµ¬ì„±ë˜ë¯€ë¡œ Base64URLë¡œ ì¸ì½”ë”©ë˜ì–´ì•¼í•¨ì— ì£¼ì˜í•´ì•¼í•œë‹¤.</p><blockquote><p>í´ë¼ì´ì–¸íŠ¸ì—ì„œ íŒ¨ìŠ¤í‚¤ ë“±ë¡ê³¼ ì¸ì¦ ê³¼ì •ì—ì„œ ë¨¼ì € ì˜ì‚¬ ë‚œìˆ˜ë¡œ ì´ë£¨ì–´ì§„ ì±Œë¦°ì§€ë¥¼ ìš”ì²­í•˜ëŠ” ì´ìœ ëŠ” <a href="https://developer.mozilla.org/en-US/docs/Glossary/Replay_attack">Replay attack</a>ì„ ë°©ì§€í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.</p></blockquote><h5 id="RP-ì´ˆê¸°í™”"><a href="#RP-ì´ˆê¸°í™”" class="headerlink" title="RP ì´ˆê¸°í™”"></a>RP ì´ˆê¸°í™”</h5><p>Yubicoì˜ WebAuthn ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‰½ê²Œ RelyingPartyIdentityë¡œ RPì— ëŒ€í•œ ì‹ë³„ìë¥¼ êµ¬ì„±í•˜ê³  RP(Relying Party)ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤. í´ë¼ì´ì–¸íŠ¸ì˜ WebAuthn ì—ì„œëŠ” íŒ¨ìŠ¤í‚¤ ë“±ë¡ê³¼ ì¸ì¦ ê³¼ì •ì—ì„œ rpIDë¥¼ ìš”ì²­í•˜ê³  ì¸ì¦ ì •ë³´ì— í¬í•¨ì‹œí‚¤ë¯€ë¡œ í•´ë‹¹ ê³µê°œí‚¤ê°€ RPì— ëŒ€í•´ì„œ ì„œëª…ë˜ì—ˆìŒì„ í†µí•´ ê³µê°œí‚¤ê°€ ì˜¬ë°”ë¥¸ ì¶œì²˜ì— ìˆìŒì„ ê²€ì¦í•˜ëŠ”ë° ì‚¬ìš©ëœë‹¤.</p><pre class="language-groovy" data-language="groovy"><code class="language-groovy">dependencies <span class="token punctuation">&#123;</span>    implementation <span class="token string">'com.yubico:webauthn-server-core:2.5.2'</span>    implementation <span class="token string">'com.yubico:yubico-util:2.5.2'</span>    implementation <span class="token string">'com.yubico:webauthn-server-attestation:2.5.2'</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">RelyingParty</span> <span class="token function">generateRelyingParty</span><span class="token punctuation">(</span><span class="token class-name">PasskeyCredentialRepository</span> passkeyCredentialRepository<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">RelyingPartyIdentity</span> rpID <span class="token operator">=</span> <span class="token class-name">RelyingPartyIdentity</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">"kdev.ing"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"Mambo App"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">RelyingParty</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">identity</span><span class="token punctuation">(</span>rpID<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">credentialRepository</span><span class="token punctuation">(</span>passkeyCredentialRepository<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">allowOriginSubdomain</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">origins</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"https://kdev.ing"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h5 id="ë“±ë¡-ìš”ì²­ì—-ëŒ€í•œ-ê³µê°œí‚¤-ìƒì„±-ì˜µì…˜-ë°œê¸‰"><a href="#ë“±ë¡-ìš”ì²­ì—-ëŒ€í•œ-ê³µê°œí‚¤-ìƒì„±-ì˜µì…˜-ë°œê¸‰" class="headerlink" title="ë“±ë¡ ìš”ì²­ì— ëŒ€í•œ ê³µê°œí‚¤ ìƒì„± ì˜µì…˜ ë°œê¸‰"></a>ë“±ë¡ ìš”ì²­ì— ëŒ€í•œ ê³µê°œí‚¤ ìƒì„± ì˜µì…˜ ë°œê¸‰</h5><p>í´ë¼ì´ì–¸íŠ¸ê°€ íŒ¨ìŠ¤í‚¤ ë“±ë¡ì„ ìœ„í•´ ì±Œë¦°ì§€ë¥¼ ìš”ì²­í•  ë•Œ í•„ìš”í•œ ê³µê°œí‚¤ ìƒì„± ì˜µì…˜ì„ ë§Œë“¤ì–´ì„œ ì‘ë‹µí•´ë³´ì. RPì˜ <code>startRagistartion</code> í•¨ìˆ˜ì— <code>StartRegistrationOptions</code>ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬í•¨ìœ¼ë¡œì¨ RPì™€ ì±Œë¦°ì§€ê°€ í¬í•¨ëœ ê³µê°œí‚¤ ìƒì„± ì˜µì…˜ì„ ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ë˜í•œ, í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ë‹¬í•˜ê¸° ìœ„í•´ <code>toCredentialsCreateJson</code>ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì í•¸ë“¤ê³¼ ê°™ì€ ë°”ì´íŠ¸ ë°°ì—´ë¡œ ì´ë£¨ì–´ì§€ëŠ” í•­ëª©ì— ëŒ€í•´ ì•Œì•„ì„œ Base64URLì„ ì ìš©í•´ì¤€ë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">createUserHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchAlgorithmException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> userHandle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token class-name">SecureRandom</span><span class="token punctuation">.</span><span class="token function">getInstanceStrong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextBytes</span><span class="token punctuation">(</span>userHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> userHandle<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/registration/challenge"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">startRegistration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">UserIdentity</span> userIdentity <span class="token operator">=</span> <span class="token class-name">UserIdentity</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"mambo"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token string">"Mambo"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArray</span><span class="token punctuation">(</span><span class="token function">createUserHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> rp<span class="token punctuation">.</span><span class="token function">startRegistration</span><span class="token punctuation">(</span>            <span class="token class-name">StartRegistrationOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span>userIdentity<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">authenticatorSelection</span><span class="token punctuation">(</span><span class="token class-name">AuthenticatorSelectionCriteria</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token punctuation">.</span><span class="token function">residentKey</span><span class="token punctuation">(</span><span class="token class-name">ResidentKeyRequirement</span><span class="token punctuation">.</span><span class="token constant">REQUIRED</span><span class="token punctuation">)</span>                            <span class="token punctuation">.</span><span class="token function">userVerification</span><span class="token punctuation">(</span><span class="token class-name">UserVerificationRequirement</span><span class="token punctuation">.</span><span class="token constant">PREFERRED</span><span class="token punctuation">)</span>                            <span class="token punctuation">.</span><span class="token function">authenticatorAttachment</span><span class="token punctuation">(</span><span class="token class-name">AuthenticatorAttachment</span><span class="token punctuation">.</span><span class="token constant">CROSS_PLATFORM</span><span class="token punctuation">)</span>                            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">toCredentialsCreateJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>ì‚¬ìš©ì í•¸ë“¤(user.id)ì€ ì‚¬ìš©ì ê³„ì •ì— ëŒ€í•´ ìœ ì¼í•¨ì„ ë³´ì¥í•˜ë„ë¡ ì„œë²„ì— ì €ì¥í•´ë‘ì–´ì•¼ íŒ¨ìŠ¤í‚¤ ì¸ì¦ ê³¼ì •ì—ì„œ ì‚¬ìš©ì ì¸ì¦ ê¸°ê¸°ë¡œë¶€í„° ì „ë‹¬ëœ ì¸ì¦ ì •ë³´ë‚´ì— í¬í•¨ë˜ëŠ” ì‚¬ìš©ì í•¸ë“¤ë¡œ ì„œë²„ì—ì„œëŠ” ì–´ë–¤ ì‚¬ìš©ì ê³„ì •ì— ë¡œê·¸ì¸í•´ì•¼í•˜ëŠ”ì§€ êµ¬ë¶„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></blockquote><h5 id="ê³µê°œí‚¤-í¬ë ˆë´ì…œ-ê²€ì¦-ë°-ë“±ë¡-ì™„ë£Œ"><a href="#ê³µê°œí‚¤-í¬ë ˆë´ì…œ-ê²€ì¦-ë°-ë“±ë¡-ì™„ë£Œ" class="headerlink" title="ê³µê°œí‚¤ í¬ë ˆë´ì…œ ê²€ì¦ ë° ë“±ë¡ ì™„ë£Œ"></a>ê³µê°œí‚¤ í¬ë ˆë´ì…œ ê²€ì¦ ë° ë“±ë¡ ì™„ë£Œ</h5><p>í´ë¼ì´ì–¸íŠ¸ì˜ WebAuthn APIë¥¼ í†µí•´ ì „ë‹¬ë°›ì€ ê³µê°œí‚¤ í¬ë ˆë´ì…œì„ RPì˜ <code>finishRegistration</code>ë¥¼ í†µí•´ ì˜¬ë°”ë¥´ê²Œ ì„œëª…ëœ ê²ƒì¸ì§€ ê²€ì¦í•˜ê³  íŒ¨ìŠ¤í‚¤ ì •ë³´ë¡œ í‘œí˜„í•  ì¼ë¶€ í•­ëª©ì„ ì¶”ì¶œí•´ì„œ ì €ì¥í•˜ë©´ ëœë‹¤.  í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì „ë‹¬í•˜ëŠ” ì •ë³´ì—ëŠ” ì‚¬ìš©ì ê¸°ê¸°ì— ëŒ€í•œ ë””ë°”ì´ìŠ¤ ì´ë¦„ì´ë‚˜ ìƒì„±ëœ ì‹œê°„ ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ íŒ¨ìŠ¤í‚¤ê°€ ì‚¬ìš©ëœ ì‹œê°„ì— ëŒ€í•œ í•­ëª©ì€ ì—†ìœ¼ë‹ˆ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ ì‹œ ê³ ë ¤í•˜ëŠ”ê±¸ ê¶Œì¥í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ê¹ƒí—ˆë¸Œì—ì„œëŠ” íŒ¨ìŠ¤í‚¤ ë“±ë¡ ê³¼ì •ì—ì„œ íŒ¨ìŠ¤í‚¤ì— ëŒ€í•´ ì‹ë³„í•  ìˆ˜ ìˆëŠ” ì´ë¦„ì„ ì„¤ì •í•˜ëŠ” ê³¼ì •ì„ ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´í•´ì£¼ê³  ìˆë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/registration/verify"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">finishRegistration</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"request"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> request<span class="token punctuation">,</span>                                  <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"credential"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> credential<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span><span class="token punctuation">,</span> <span class="token class-name">RegistrationFailedException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">PublicKeyCredentialCreationOptions</span> publicKeyCredentialCreationOptions <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">PublicKeyCredentialCreationOptions</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">PublicKeyCredential</span> publicKeyCredential <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>credential<span class="token punctuation">,</span> <span class="token class-name">PublicKeyCredential</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">RegistrationResult</span> result <span class="token operator">=</span> rp<span class="token punctuation">.</span><span class="token function">finishRegistration</span><span class="token punctuation">(</span>            <span class="token class-name">FinishRegistrationOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>publicKeyCredentialCreationOptions<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span>publicKeyCredential<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ByteArray</span> aaguid <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getAaguid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ByteArray</span> credentialId <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getKeyId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ByteArray</span> userHandle <span class="token operator">=</span> publicKeyCredentialCreationOptions<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ByteArray</span> publicKey <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getPublicKeyCose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Instant</span> creationAt <span class="token operator">=</span> <span class="token class-name">Instant</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Instant</span> lastAccessTime <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> nickname <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token comment">// todo: save credential for user</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>íŒ¨ìŠ¤í‚¤ì— ëŒ€í•œ ê³µê°œí‚¤ì™€ í•¨ê»˜ í¬ë ˆë´ì…œ ì•„ì´ë””ì™€ ì‚¬ìš©ì í•¸ë“¤ì„ í¬í•¨í•˜ì—¬ ì„œë²„ì— ì €ì¥í•˜ëŠ” ì´ìœ ëŠ” íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸ ê³¼ì •ì—ì„œ ì¸ì¦ëœ ì •ë³´ì— ëŒ€í•´ RP ì—ì„œëŠ” ë“±ë¡ëœ íŒ¨ìŠ¤í‚¤ ì •ë³´ì™€ ê³µê°œí‚¤ë¥¼ ì°¾ì•„ì„œ ì˜¬ë°”ë¥´ê²Œ ë¹„ë°€í‚¤ë¡œ ì„œëª…ëœ ì¸ì¦ì¸ê°€ë¥¼ ê²€ì¦í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.</p></blockquote><hr><p>ì´ì œ íŒ¨ìŠ¤í‚¤ ë“±ë¡ì„ ì™„ë£Œí–ˆë‹¤ê³  ê°€ì •í•˜ê³  íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸ ì‹œ ì‚¬ìš©ë  ì±Œë¦°ì§€ì™€ ì˜µì…˜ì„ ë°œê¸‰í•˜ê³  íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸ ìš”ì²­ì— ëŒ€í•œ ê²€ì¦ì„ í•´ë³´ë„ë¡ í•˜ì.</p><h5 id="íŒ¨ìŠ¤í‚¤-ì¸ì¦-ìš”ì²­ì—-ëŒ€í•œ-ì˜µì…˜-ë°œê¸‰"><a href="#íŒ¨ìŠ¤í‚¤-ì¸ì¦-ìš”ì²­ì—-ëŒ€í•œ-ì˜µì…˜-ë°œê¸‰" class="headerlink" title="íŒ¨ìŠ¤í‚¤ ì¸ì¦ ìš”ì²­ì— ëŒ€í•œ ì˜µì…˜ ë°œê¸‰"></a>íŒ¨ìŠ¤í‚¤ ì¸ì¦ ìš”ì²­ì— ëŒ€í•œ ì˜µì…˜ ë°œê¸‰</h5><p>í´ë¼ì´ì–¸íŠ¸ì˜ íŒ¨ìŠ¤í‚¤ ì¸ì¦ì„ ìœ„í•´ ì‚¬ìš©í•  ì±Œë¦°ì§€ë¥¼ ìš”ì²­í•  ë•Œì˜ ì˜µì…˜ì€ RPì˜ <code>startAssertion</code>ìœ¼ë¡œ ìƒì„±í•  ìˆ˜ ìˆë‹¤. ì´ë•Œ, ë§¤ê°œë³€ìˆ˜ë¡œ ì „ë‹¬í•  StartAssertionOptionsì„ êµ¬ì„±í•  ë•Œ í´ë¼ì´ì–¸íŠ¸ëŠ” ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì•„ì´ë””ë¥¼ ìš”ì²­ ì‹œ ì œê³µí•œë‹¤ë©´ íŠ¹ì • ì‚¬ìš©ì ê³„ì •ì— ëŒ€í•œ ê³µê°œí‚¤ë§Œ ì¡°íšŒí•˜ì—¬ í¬í•¨ì‹œí‚¬ ìˆ˜ ìˆë‹¤. ê³µê°œí‚¤ë¥¼ ì¡°íšŒí•˜ê³  í¬í•¨ì‹œí‚¤ëŠ” ê±´ RP ì´ˆê¸°í™” ì‹œ ì‚¬ìš©ëœ CredentialRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì´ë£¨ì–´ì§€ê²Œ ëœë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/authentication/challenge"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">startAssertion</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">StartAssertionOptions<span class="token punctuation">.</span>StartAssertionOptionsBuilder</span> builder <span class="token operator">=</span> <span class="token class-name">StartAssertionOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>username<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>c        builder<span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">AssertionRequest</span> assertionRequest <span class="token operator">=</span> rp<span class="token punctuation">.</span><span class="token function">startAssertion</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> assertionRequest<span class="token punctuation">.</span><span class="token function">toCredentialsGetJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h5 id="íŒ¨ìŠ¤í‚¤-ë¡œê·¸ì¸-ìš”ì²­-ê²€ì¦-ë°-ì™„ë£Œ"><a href="#íŒ¨ìŠ¤í‚¤-ë¡œê·¸ì¸-ìš”ì²­-ê²€ì¦-ë°-ì™„ë£Œ" class="headerlink" title="íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸ ìš”ì²­ ê²€ì¦ ë° ì™„ë£Œ"></a>íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸ ìš”ì²­ ê²€ì¦ ë° ì™„ë£Œ</h5><p>í´ë¼ì´ì–¸íŠ¸ëŠ” RPê°€ ì „ë‹¬í•œ ì˜µì…˜ì„ ì‚¬ìš©í•´ ì‚¬ìš©ìì—ê²Œ ì¸ì¦ ê¸°ê¸°ë¥¼ í†µí•œ íŒ¨ìŠ¤í‚¤ë¥¼ ì„ íƒí•˜ë„ë¡ ì¸ì¦ ëŒ€í™”ìƒìë¥¼ í‘œì‹œí•˜ê³  ì„ íƒëœ íŒ¨ìŠ¤í‚¤ë¡œ ì„œëª…ëœ ì¸ì¦ ì •ë³´ë¥¼ ì„œë²„ì—ê²Œ ì „ë‹¬í•˜ì—¬ RPì— ëŒ€í•´ ë°œê¸‰ë˜ì—ˆë˜ ì¸ì¦ ì •ë³´ì¸ì§€ë¥¼ ê²€ì¦í•˜ê²Œ ëœë‹¤. ì˜¬ë°”ë¥´ê²Œ ì„œëª…ëœ ì¸ì¦ ì •ë³´ì„ì„ í™•ì¸í–ˆë‹¤ë©´ í•´ë‹¹ ì‚¬ìš©ì ê³„ì •ì— ëŒ€í•´ ì‹œìŠ¤í…œ ë°©ì‹(ì„¸ì…˜ì´ë‚˜ í† í°)ì— ë”°ë¼ ì¸ì¦ ì²˜ë¦¬ë¥¼ í•´ì£¼ë©´ ëœë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/authentication/verify"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">finishAssertion</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"request"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> request<span class="token punctuation">,</span>                              <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"response"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span><span class="token punctuation">,</span> <span class="token class-name">AssertionFailedException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">AssertionRequest</span> assertionRequest <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">AssertionRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">PublicKeyCredential</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AuthenticatorAssertionResponse</span><span class="token punctuation">,</span> <span class="token class-name">ClientAssertionExtensionOutputs</span><span class="token punctuation">></span></span> pkc <span class="token operator">=</span>            objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">AssertionResult</span> result <span class="token operator">=</span> rp<span class="token punctuation">.</span><span class="token function">finishAssertion</span><span class="token punctuation">(</span><span class="token class-name">FinishAssertionOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>assertionRequest<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span>pkc<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// todo: process authenticate</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ByteArray</span> credentialId <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getCredential</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCredentialId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ByteArray</span> userHandle <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getCredential</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUserHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><hr><h4 id="íŒ¨ìŠ¤í‚¤-ë¡œê·¸ì¸ì„-ìœ„í•œ-í´ë¼ì´ì–¸íŠ¸-êµ¬í˜„"><a href="#íŒ¨ìŠ¤í‚¤-ë¡œê·¸ì¸ì„-ìœ„í•œ-í´ë¼ì´ì–¸íŠ¸-êµ¬í˜„" class="headerlink" title="íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸ì„ ìœ„í•œ í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„"></a>íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸ì„ ìœ„í•œ í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„</h4><p>íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸ì— ëŒ€í•œ ì„œë²„ ì¸¡ êµ¬í˜„ì€ ì™„ë£Œë˜ì—ˆìœ¼ë‹ˆ ì´ì œ í´ë¼ì´ì–¸íŠ¸ì—ì„œì˜ êµ¬í˜„ì„ ì•Œì•„ë³´ë„ë¡ í•˜ì.</p><p>íŒ¨ìŠ¤í‚¤ ë“±ë¡ê³¼ ë¡œê·¸ì¸ì„ ìœ„í•´ í´ë¼ì´ì–¸íŠ¸ì˜ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API#webauthn_concepts_and_usage">Web Authentication API</a>ë¥¼ ì´ìš©í•  ìˆ˜ ìˆë‹¤. WebAuthn APIë¥¼ ì§ì ‘ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ <a href="https://simplewebauthn.dev/">SimpleWebAuthn</a> ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ë” ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ í™œìš©í•˜ëŠ” ê±¸ ì¶”ì²œí•œë‹¤. SimpleWebAuthnì€ FIDO í…ŒìŠ¤íŠ¸ë¥¼ ê±°ì¹œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë¯€ë¡œ ì•ˆì‹¬í•˜ê³  ì‚¬ìš©í•´ë„ ë  ê²ƒì´ë‹¤.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">pnpm</span> <span class="token function">add</span> @simplewebauthn/browser</code></pre><h5 id="íŒ¨ìŠ¤í‚¤-ë“±ë¡-ì‹œì‘í•˜ê¸°"><a href="#íŒ¨ìŠ¤í‚¤-ë“±ë¡-ì‹œì‘í•˜ê¸°" class="headerlink" title="íŒ¨ìŠ¤í‚¤ ë“±ë¡ ì‹œì‘í•˜ê¸°"></a>íŒ¨ìŠ¤í‚¤ ë“±ë¡ ì‹œì‘í•˜ê¸°</h5><p>í´ë¼ì´ì–¸íŠ¸ì—ì„œ íŒ¨ìŠ¤í‚¤ ë“±ë¡ì„ ìœ„í•´ ì±Œë¦°ì§€ë¥¼ ì„œë²„ë¡œ ë¶€í„° ìš”ì²­í•˜ê³  ë‚œ í›„ <code>startRegistration</code> í•¨ìˆ˜ë¥¼ í†µí•´ íŒ¨ìŠ¤í‚¤ ë“±ë¡ì„ ìœ„í•œ ì¸ì¦ ëŒ€í™”ìƒìë¥¼ ì‚¬ìš©ìì—ê²Œ ì œê³µí•  ìˆ˜ ìˆë‹¤. ì•„ë˜ì™€ ê°™ì´ ê°„ë‹¨í•˜ê²Œ íŒ¨ìŠ¤í‚¤ ë“±ë¡ì„ ì‚¬ìš©ìì—ê²Œ ìš”ì²­í•˜ê³  ì „ë‹¬ëœ ì •ë³´ë¥¼ ì„œë²„ì— ì „ë‹¬í•˜ì—¬ íŒ¨ìŠ¤í‚¤ ë“±ë¡ì„ ì™„ë£Œí•  ìˆ˜ ìˆë‹¤.</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> startRegistration <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@simplewebauthn/browser'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">registerPasskey</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> challenge  <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/passkey/registration/challenge'</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> registrationResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">startRegistration</span><span class="token punctuation">(</span>challenge<span class="token punctuation">.</span>data<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span>    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/passkey/registration/verify'</span><span class="token punctuation">,</span> registrationResponse<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></code></pre><p>í•˜ì§€ë§Œ, <a href="https://simplewebauthn.dev/docs/packages/browser#startregistration">startRegistartion</a>ì— ëŒ€í•œ ì˜ˆì œ ì½”ë“œë¥¼ ë³´ë©´ <code>InvalidStateError</code>ì™€ ê°™ì´ ì¸ì¦ ê¸°ê¸°ê°€ ì´ë¯¸ ë“±ë¡ëœ íŒ¨ìŠ¤í‚¤ì¸ ìƒí™©ì— ëŒ€í•œ ì˜ˆì™¸ ì²˜ë¦¬ê°€ í•„ìš”í•˜ë‹¤ëŠ” ê±¸ ì¸ì§€í•  ìˆ˜ ìˆë‹¤. ì‚¬ìš©ìì— ëŒ€í•œ íŒ¨ìŠ¤í‚¤ê°€ ì´ë¯¸ ì¸ì¦ ê¸°ê¸°ì— ë“±ë¡ë˜ì–´ìˆëŠ” ê²½ìš° ì¤‘ë³µ ë“±ë¡ì— ëŒ€í•œ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©ìì—ê²Œ ì œê³µí•´ë³´ê¸¸ ë°”ë€ë‹¤.</p><h5 id="íŒ¨ìŠ¤í‚¤-ì¸ì¦-ì‹œì‘í•˜ê¸°"><a href="#íŒ¨ìŠ¤í‚¤-ì¸ì¦-ì‹œì‘í•˜ê¸°" class="headerlink" title="íŒ¨ìŠ¤í‚¤ ì¸ì¦ ì‹œì‘í•˜ê¸°"></a>íŒ¨ìŠ¤í‚¤ ì¸ì¦ ì‹œì‘í•˜ê¸°</h5><p>í´ë¼ì´ì–¸íŠ¸ì—ì„œ íŒ¨ìŠ¤í‚¤ ì¸ì¦ì„ ì‹œì‘í•˜ê¸° ìœ„í•´ ì±Œë¦°ì§€ë¥¼ ì„œë²„ë¡œë¶€í„° ìš”ì²­í•˜ê³ ë‚œ í›„ <code>startAuthentication</code> í•¨ìˆ˜ë¥¼ í†µí•´ ì‚¬ìš©ìì—ê²Œ ì¸ì¦ ê¸°ê¸°ì— ë“±ë¡ëœ íŒ¨ìŠ¤í‚¤ë¥¼ ì„ íƒí•  ìˆ˜ ìˆë„ë¡ ì¸ì¦ ëŒ€í™”ìƒìë¥¼ í‘œì‹œí•  ìˆ˜ ìˆë‹¤. ì‚¬ìš©ìê°€ íŒ¨ìŠ¤í‚¤ë¥¼ ì„ íƒí–ˆë‹¤ë©´ ì „ë‹¬ë˜ëŠ” ì •ë³´ë¥¼ ì„œë²„ì— ì „ë‹¬í•˜ì—¬ íŒ¨ìŠ¤í‚¤ ì¸ì¦ì„ ì™„ë£Œí•  ìˆ˜ ìˆë‹¤.</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> startAuthentication <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@simplewebauthn/browser'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">passkeyLogin</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> challenge  <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/passkey/authentication/challenge'</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> authenticationResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">startAuthentication</span><span class="token punctuation">(</span>challenge<span class="token punctuation">.</span>data<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span>    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/passkey/authentication/verify'</span><span class="token punctuation">,</span> authenticationResponse<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>íŒ¨ìŠ¤í‚¤ ì¸ì¦ì—ì„œë„ ì‚¬ìš©ìê°€ íŒ¨ìŠ¤í‚¤ ì„ íƒì„ ì·¨ì†Œí•˜ê±°ë‚˜ ì´ë¯¸ íŒ¨ìŠ¤í‚¤ ë™ì‘ì„ ìˆ˜í–‰í•˜ê³  ìˆëŠ” ìƒí™©ì— ëŒ€í•´ ì˜ˆì™¸ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.<br>NotAllowedError: The operation either timed out or was not allowed.</p></blockquote><h5 id="ì‚¬ìš©ì-ì•„ì´ë””-í•„ë“œì—-ìë™-ì™„ì„±-UI-í‘œì‹œ"><a href="#ì‚¬ìš©ì-ì•„ì´ë””-í•„ë“œì—-ìë™-ì™„ì„±-UI-í‘œì‹œ" class="headerlink" title="ì‚¬ìš©ì ì•„ì´ë”” í•„ë“œì— ìë™ ì™„ì„± UI í‘œì‹œ"></a>ì‚¬ìš©ì ì•„ì´ë”” í•„ë“œì— ìë™ ì™„ì„± UI í‘œì‹œ</h5><p>íŒ¨ìŠ¤í‚¤ ì¸ì¦ì„ ìœ„í•´ startAuthenticationë¥¼ í˜¸ì¶œí•  ë•Œ <code>useBrowserAutofill</code> ë§¤ê°œë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ëŠ” ê²½ìš° mediation ì˜µì…˜ì´ conditionalë¡œ ì§€ì •ë˜ë©´ì„œ ì‚¬ìš©ìì—ê²Œ ë°”ë¡œ íŒ¨ìŠ¤í‚¤ ì„ íƒì„ ìš”êµ¬í•˜ëŠ” ëŒ€í™”ìƒìë¥¼ í‘œì‹œí•˜ì§€ ì•Šê³  ë¸Œë¼ìš°ì €ë§ˆë‹¤ êµ¬í˜„ëœ ë°©ì‹ìœ¼ë¡œ <code>ìë™ ì™„ì„±(ì¡°ê±´ë¶€ UI)</code>ì´ í‘œì‹œëœë‹¤. íŒ¨ìŠ¤í‚¤ ìë™ ì™„ì„±ì„ ìœ„í•´ í˜¸ì¶œí–ˆë‹¤ë©´ ì‚¬ìš©ì ê³„ì •ì„ ì…ë ¥í•˜ëŠ” í•„ë“œì˜ <code>autocomplete</code> ì†ì„±ì— <code>webauthn</code> ì„ í¬í•¨ì‹œí‚¤ë©´ ëœë‹¤.</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Login.vue</span><span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">await</span> <span class="token function">processAutofill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// passkey.js</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>    browserSupportsWebAuthnAutofill    WebAuthnAbortService<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@simplewebauthn/browser'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">processAutofill</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">browserSupportsWebAuthnAutofill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> challenge <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/passkey/authentication/challenge'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> authenticationResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">startAuthentication</span><span class="token punctuation">(</span>challenge<span class="token punctuation">.</span>data<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/passkey/authentication/verify'</span><span class="token punctuation">,</span> authenticationResponse<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">cancelAutofill</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    WebAuthnAbortService<span class="token punctuation">.</span><span class="token function">cancelCeremony</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>ì¡°ê±´ë¶€ UIì„ í†µí•´ ì‚¬ìš©ìì—ê²Œ ìë™ ì™„ì„±ì„ ì œê³µí•˜ê³  íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸ì´ë¼ëŠ” ë³„ë„ì˜ ë²„íŠ¼ì„ ì´ìš©í•˜ê²Œ í•˜ê³ ìí•œë‹¤ë©´ AbortControllerë¥¼ ì‚¬ìš©í•´ì„œ ìë™ ì™„ì„±ì„ ìœ„í•´ ëŒ€ê¸°í•˜ëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ì·¨ì†Œí•˜ë„ë¡ êµ¬í˜„í•´ì•¼í•©ë‹ˆë‹¤. SimpleWebAuthnì˜ <a href="https://github.com/MasterKale/SimpleWebAuthn/blob/master/packages/browser/src/helpers/webAuthnAbortService.ts">WebAuthnAbortService</a>ë¥¼ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></blockquote><h4 id="ê³„ì •-ì„¤ì •-ë‚´-íŒ¨ìŠ¤í‚¤-í‘œì‹œ"><a href="#ê³„ì •-ì„¤ì •-ë‚´-íŒ¨ìŠ¤í‚¤-í‘œì‹œ" class="headerlink" title="ê³„ì • ì„¤ì • ë‚´ íŒ¨ìŠ¤í‚¤ í‘œì‹œ"></a>ê³„ì • ì„¤ì • ë‚´ íŒ¨ìŠ¤í‚¤ í‘œì‹œ</h4><p>íŒ¨ìŠ¤í‚¤ ë“±ë¡ ì‹œ ì„œë²„ì— ì €ì¥ëœ ì •ë³´ì—ëŠ” ì‚¬ìš©ì ì¹œí™”ì ìœ¼ë¡œ í‘œì‹œí•  ìˆ˜ ìˆëŠ” ì •ë³´ê°€ í¬í•¨ë˜ì–´ìˆì§€ ì•Šë‹¤. <a href="https://developers.google.com/identity/passkeys/ux/communicating-passkeys?hl=ko#what_information_to_use_to_create_a_passkey">íŒ¨ìŠ¤í‚¤ë¥¼ ë§Œë“œëŠ” ë° ì‚¬ìš©í•  ì •ë³´</a>ë‚˜ <a href="https://developers.google.com/identity/passkeys/ux/user-interface-design?hl=ko">ê³„ì • ì„¤ì • ë‚´ íŒ¨ìŠ¤í‚¤ ì¹´ë“œ í‘œì‹œ</a>ì™€ ê°™ì€ ì •ë³´ë“¤ì„ ì°¸ê³ í•˜ë©° íŒ¨ìŠ¤í‚¤ì— ëŒ€í•´ ì•„ë˜ì™€ ê°™ì€ í•­ëª©ë“¤ì„ ì„¤ì •í•  ìˆ˜ ìˆê²Œ ì„¤ê³„í•˜ëŠ”ê²Œ ì¢‹ë‹¤.</p><ul><li>íŒ¨ìŠ¤í‚¤ì— ëŒ€í•´ í‘œì‹œí•  ì´ë¦„ (Nickname)</li><li>íŒ¨ìŠ¤í‚¤ê°€ ë§ˆì§€ë§‰ìœ¼ë¡œ ì‚¬ìš©ëœ ì‹œê°„ (Last Access Time)</li><li>íŒ¨ìŠ¤í‚¤ ì¸ì¦ ê¸°ê¸° ìœ í˜• (AAGUID)</li></ul><p>íŒ¨ìŠ¤í‚¤ì— ëŒ€í•´ í‘œì‹œí•  ì´ë¦„ì„ ì„¤ì •í•˜ëŠ” ê±´ í•„ìˆ˜ ì‚¬í•­ì€ ì•„ë‹ˆì§€ë§Œ ê¹ƒí—ˆë¸Œì—ì„œì˜ íŒ¨ìŠ¤í‚¤ ê´€ë¦¬ ì‹œ ì´ë¦„ì„ ì„¤ì •í•  ìˆ˜ ìˆê²Œ ì œê³µí•˜ëŠ”ë° ì‚¬ìš©ì ìŠ¤ìŠ¤ë¡œ êµ¬ë¶„í•  ìˆ˜ ìˆê²Œ ì§€ì›í•´ì¤„ ìˆ˜ ìˆëŠ” ê²ƒ ê°™ë‹¤. íŒ¨ìŠ¤í‚¤ ì¸ì¦ ê¸°ê¸° ì •ë³´ì˜ ê²½ìš° AttestedCredentialDataì— í¬í•¨ëœ AAGUIDë¥¼ í†µí•´ ì¸ì¦ ê¸°ê¸°ë¥¼ ì œê³µí•˜ëŠ” ì—…ì²´ì„ ì‹ë³„í•  ìˆ˜ ìˆë‹¤. AAGUIDëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ëŒì´ ì¸ì§€í•  ìˆ˜ ìˆëŠ” ë¬¸ìì—´ì€ ì•„ë‹ˆë¯€ë¡œ AAGUID ì €ì¥ì†Œì˜ <a href="https://github.com/passkeydeveloper/passkey-authenticator-aaguids/blob/main/aaguid.json">aaguid.json</a> ì¸ì¦ ì¥ì¹˜ì˜ ìœ í˜•ì— ëŒ€í•´ì„œ ì´ë¦„ì´ë‚˜ ì•„ì´ì½˜ì„ í‘œì‹œí•  ìˆ˜ ìˆë‹¤.</p><blockquote><p>íŒ¨ìŠ¤í‚¤ì— ëŒ€í•œ UX ê°€ì´ë“œë¼ì¸ì„ ì‚´í´ë³´ë©´ íŒ¨ìŠ¤í‚¤ ê´€ë¦¬ì— ëŒ€í•´ <a href="https://fonts.google.com/icons?icon.query=passkey">íŒ¨ìŠ¤í‚¤ ì•„ì´ì½˜</a>ì„ í‘œì‹œí•˜ëŠ”ê±¸ ê¶Œì¥í•œë‹¤ê³  í•˜ë„¤ìš”.</p></blockquote><h4 id="íŒ¨ìŠ¤í‚¤-ì‚­ì œ"><a href="#íŒ¨ìŠ¤í‚¤-ì‚­ì œ" class="headerlink" title="íŒ¨ìŠ¤í‚¤ ì‚­ì œ"></a>íŒ¨ìŠ¤í‚¤ ì‚­ì œ</h4><p>ì‚¬ìš©ì ê³„ì •ì— ë“±ë¡í•œ íŒ¨ìŠ¤í‚¤ ëª©ë¡ì—ì„œ íŒ¨ìŠ¤í‚¤ë¥¼ ì‚­ì œí•  ë•Œ ê³ ë ¤í•´ë³´ì•„ì•¼í•  ë¶€ë¶„ì´ ìˆë‹¤. íŒ¨ìŠ¤í‚¤ì— ëŒ€í•œ ê³µê°œí‚¤ í¬ë ˆë´ì…œì„ ì €ì¥í•˜ê³  ìˆëŠ” ì‹œìŠ¤í…œì—ì„œëŠ” ì‚¬ìš©ì ê¸°ê¸°ì— ë“±ë¡ëœ íŒ¨ìŠ¤í‚¤ ì •ë³´ë¥¼ ì‚­ì œí•  ë°©ë²•ì´ ì—†ë‹¤. ë˜í•œ, ì‚¬ìš©ìê°€ íŒ¨ìŠ¤í‚¤ë¥¼ ë“±ë¡í•˜ê³ ë‚˜ì„œ ë””ë°”ì´ìŠ¤ì— ë“±ë¡ëœ íŒ¨ìŠ¤í‚¤ë¥¼ ì‚­ì œí•˜ëŠ” ê²½ìš°ì—ëŠ” ì‹œìŠ¤í…œì—ëŠ” ë¶ˆí•„ìš”í•˜ê²Œ íŒ¨ìŠ¤í‚¤ ëª©ë¡ì´ ë‚¨ê²¨ì§€ëŠ” ë¬¸ì œê°€ ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ ê³ ë ¤í•´ë³´ì•„ì•¼í•œë‹¤. </p><p><img data-src="/images/posts/passkey-login/01.png"></p><p>ì˜ˆë¥¼ ë“¤ì–´, ìœ„ì™€ ê°™ì´ ê¹ƒí—ˆë¸Œì—ì„œëŠ” íŒ¨ìŠ¤í‚¤ ì‚­ì œ í›„ì— ê¸°ê¸°ì— ë‚¨ì•„ìˆëŠ” íŒ¨ìŠ¤í‚¤ ì •ë³´ë¡œ ì¸í•´ ë¡œê·¸ì¸ ì‹œë„ ì‹œ íŒ¨ìŠ¤í‚¤ ì˜µì…˜ì´ í‘œì‹œë  ìˆ˜ ìˆìŒì„ ì•ˆë‚´í•˜ê³  ìˆë‹¤. AAGUIDì™€ ë””ë°”ì´ìŠ¤ì— ë”°ë¼ íŒ¨ìŠ¤í‚¤ë¥¼ ê´€ë¦¬í•˜ê³  ì‚­ì œí•˜ëŠ” ë°©ë²•ì´ ë‹¤ë¥´ë¯€ë¡œ ìì„¸í•œ ê°€ì´ë“œëŠ” ì œê³µí•˜ì§€ ì•ŠëŠ” ê²ƒ ê°™ë‹¤. ê·¸ëŸ¼ì—ë„ ê°€ì´ë“œë¥¼ ì œê³µí•˜ê³  ì‹¶ë‹¤ë©´ ìì£¼ ì‚¬ìš©ë  ìˆ˜ ìˆëŠ” ê¸°ê¸°ì— ëŒ€í•´ì„œëŠ” ì œê³µí•´ì¤„ ìˆ˜ ìˆì–´ë³´ì¸ë‹¤.</p><ul><li>Google Passsword Manager: ë¸Œë¼ìš°ì € URLì— chrome:&#x2F;&#x2F;settings&#x2F;passkeys ì…ë ¥</li><li>iCloud Keychain: <a href="https://support.apple.com/ko-kr/guide/mac-help/mchl77e2cb66/mac">Mac ë° iCloud í‚¤ì²´ì¸ì—ì„œ íŒ¨ìŠ¤í‚¤ ë˜ëŠ” ì•”í˜¸ ì œê±°í•˜ê¸°</a></li><li>Samsung Pass: Samsung Wallet â†’ Samsung Pass â†’ ë¡œê·¸ì¸ ì •ë³´ â†’ íŒ¨ìŠ¤í‚¤ ì—ì„œ ì‚­ì œí•  ìˆ˜ ìˆë‹¤.</li><li>Chrome Profile: <a href="https://support.google.com/chrome/answer/13168025?hl=ko">Chromeì—ì„œ íŒ¨ìŠ¤í‚¤ ê´€ë¦¬í•˜ê¸°</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸ì€ ì‚¬ìš©ì ê³„ì •ì— ëŒ€í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìš”êµ¬í•˜ì§€ ì•Šê³  ì‚¬ìš©ì ê³„ì •ì— ì§€ë¬¸ì´ë‚˜ ì–¼êµ´ ì¸ì‹ ê·¸ë¦¬ê³  ë³´ì•ˆí‚¤ ë“±ì„ ì‚¬ìš©í•´ì„œ ë“±ë¡í•œ ì¸ì¦ ì •ë³´ë¥¼ í† ëŒ€ë¡œ ì‚¬ìš©ìì˜ ì¸ì¦ ê¸°ê¸°ë¥¼ í†µí•´ ë¡œê·¸ì¸ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ ë§í•œë‹¤. íŒ¨ìŠ¤í‚¤ ë¡œê·¸ì¸ ë¿ë§Œ ì•„ë‹ˆë¼ &lt;a hr</summary>
      
    
    
    
    
    <category term="Passkey" scheme="https://kdevkr.github.io/tags/Passkey/"/>
    
    <category term="WebAuthn" scheme="https://kdevkr.github.io/tags/WebAuthn/"/>
    
  </entry>
  
  <entry>
    <title>Amazon SNS - FCM ëª¨ë°”ì¼ í‘¸ì‹œ</title>
    <link href="https://kdevkr.github.io/amazon-sns-fcm-mobile-push/"/>
    <id>https://kdevkr.github.io/amazon-sns-fcm-mobile-push/</id>
    <published>2024-07-07T09:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.894Z</updated>
    
    <content type="html"><![CDATA[<p>PWA ì•±ì—ì„œ í‘¸ì‹œ ì•Œë¦¼ì„ ìœ„í•´ FCM(Firebse Cloud Messaging)ì„ ë„ì…í–ˆë‹¤ë©´ Amazon SNSì˜ ëª¨ë°”ì¼ í‘¸ì‹œ ì•Œë¦¼ìœ¼ë¡œ í†µí•©í•  ìˆ˜ ìˆë‹¤. Firebase Admin SDK ë¡œë„ ì‰½ê²Œ í‘¸ì‹œ ì•Œë¦¼ì„ ìœ„í•œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆì§€ë§Œ Amazon SNSì— ë“±ë¡ëœ í”Œë«í¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í†µí•´ ì‚¬ìš©ì ë””ë°”ì´ìŠ¤ë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ì•¤ë“œí¬ì¸íŠ¸ë¡œ ê´€ë¦¬í•˜ê³  ìš°ë¦¬ëŠ” Amazon SNSì— ë“±ë¡ëœ í”Œë«í¼ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ë””ë°”ì´ìŠ¤ë¡œ í‘¸ì‹œ ì•Œë¦¼ì„ ì „ë‹¬í•´ë³´ë„ë¡ í•˜ì.</p><h4 id="í”Œë«í¼-ì• í”Œë¦¬ì¼€ì´ì…˜-ìƒì„±-ì‹œ-FCM-ìê²©-ì¦ëª…-ë“±ë¡"><a href="#í”Œë«í¼-ì• í”Œë¦¬ì¼€ì´ì…˜-ìƒì„±-ì‹œ-FCM-ìê²©-ì¦ëª…-ë“±ë¡" class="headerlink" title="í”Œë«í¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„± ì‹œ FCM ìê²© ì¦ëª… ë“±ë¡"></a>í”Œë«í¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„± ì‹œ FCM ìê²© ì¦ëª… ë“±ë¡</h4><p><img data-src="/images/posts/amazon-sns-fcm-mobile-push/01.png"></p><p>FCM í‘¸ì‹œ ì•Œë¦¼ í”Œë«í””ì„ ì‚¬ìš©í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„± ì‹œ FCM ì½˜ì†”ì˜ ì„œë¹„ìŠ¤ ê³„ì •ì—ì„œ ë°œê¸‰ë°›ì€ Firebase ì„œë¹„ìŠ¤ ê³„ì •ì˜ ë¹„ê³µê°œ í‚¤ ì •ë³´ë¥¼ ë“±ë¡í•´ì•¼ í•œë‹¤. Firebase Admin SDK ì—ì„œ ì‚¬ìš©ì¤‘ì´ì—ˆë˜ ì„œë¹„ìŠ¤ ê³„ì •ì˜ JSON íŒŒì¼ì„ ê·¸ëŒ€ë¡œ ì„¤ì •í–ˆë‹¤.</p><h4 id="ì• í”Œë¦¬ì¼€ì´ì…˜-ì•¤ë“œí¬ì¸íŠ¸-ìƒì„±-ì‹œ-FCM-ë””ë°”ì´ìŠ¤-í† í°-ë“±ë¡"><a href="#ì• í”Œë¦¬ì¼€ì´ì…˜-ì•¤ë“œí¬ì¸íŠ¸-ìƒì„±-ì‹œ-FCM-ë””ë°”ì´ìŠ¤-í† í°-ë“±ë¡" class="headerlink" title="ì• í”Œë¦¬ì¼€ì´ì…˜ ì•¤ë“œí¬ì¸íŠ¸ ìƒì„± ì‹œ FCM ë””ë°”ì´ìŠ¤ í† í° ë“±ë¡"></a>ì• í”Œë¦¬ì¼€ì´ì…˜ ì•¤ë“œí¬ì¸íŠ¸ ìƒì„± ì‹œ FCM ë””ë°”ì´ìŠ¤ í† í° ë“±ë¡</h4><p>í”Œë«í¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•  ì—”ë“œí¬ì¸íŠ¸ëŠ” í•˜ë‚˜ì˜ ì‹ë³„í•  ìˆ˜ ìˆëŠ” ë””ë°”ì´ìŠ¤ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤. ë””ë°”ì´ìŠ¤ í† í°ì€ <a href="https://firebase.google.com/docs/cloud-messaging/js/client?hl=ko#access_the_registration_token">FCM í´ë¼ì´ì–¸íŠ¸ SDKë¡œë¶€í„° ë””ë°”ì´ìŠ¤ ë‚´ì—ì„œ ë°œê¸‰ë°›ì€ í† í°</a>ì„ ì…ë ¥í•˜ë©´ ëœë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ ì—”ë“œí¬ì¸íŠ¸ ìƒì„± í›„ ë©”ì‹œì§€ ê²Œì‹œë¥¼ í†µí•´ ìƒ˜í”Œ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•´ë³¼ ìˆ˜ ìˆë‹¤.</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"GCM"</span><span class="token operator">:</span> <span class="token string">"&#123; \"data\": &#123; \"title\": \"Hi!\", \"body\": \"Mambo?!\" &#125; &#125;"</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>Amazon SNSì˜ ëª¨ë°”ì¼ í‘¸ì‹œ ì•Œë¦¼ì—ì„œ FCMì„ ìœ„í•œ ë©”ì‹œì§€ëŠ” GCM ì´ë¼ëŠ” í‚¤ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.</p></blockquote><p><img data-src="/images/posts/amazon-sns-fcm-mobile-push/02.png"></p><h4 id="Amazon-SNS-SDK-for-Java-V2ë¡œ-ë©”ì‹œì§€-ê²Œì‹œ"><a href="#Amazon-SNS-SDK-for-Java-V2ë¡œ-ë©”ì‹œì§€-ê²Œì‹œ" class="headerlink" title="Amazon SNS SDK for Java V2ë¡œ ë©”ì‹œì§€ ê²Œì‹œ"></a>Amazon SNS SDK for Java V2ë¡œ ë©”ì‹œì§€ ê²Œì‹œ</h4><p>ì›¹ ì½˜ì†”ì„ í†µí•´ FCM ë©”ì‹œì§€ê°€ ë””ë°”ì´ìŠ¤ë¡œ í‘¸ì‹œ ì•Œë¦¼ì´ ë˜ì—ˆìŒì„ í™•ì¸í–ˆë‹¤ë©´ Amazon SDK for Java v2ë¥¼ ì‚¬ìš©í•´ì„œ í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•´ë³´ë„ë¡ í•˜ì. ë¨¼ì €, ì•„ë˜ì™€ ê°™ì´ ëª¨ë°”ì¼ í‘¸ì‹œ APIë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ Amazon SDK for Java v2 ì˜ì¡´ì„±ì„ ì¶”ê°€í•˜ë„ë¡ í•˜ì.</p><pre class="language-groovy" data-language="groovy"><code class="language-groovy">dependencies <span class="token punctuation">&#123;</span>    implementation <span class="token function">platform</span><span class="token punctuation">(</span><span class="token string">'software.amazon.awssdk:bom:2.26.16'</span><span class="token punctuation">)</span>    implementation <span class="token string">'software.amazon.awssdk:sns'</span><span class="token punctuation">&#125;</span></code></pre><p>ì˜ì¡´ì„±ì„ ì¶”ê°€í–ˆë‹¤ë©´ <a href="https://docs.aws.amazon.com/ko_kr/sns/latest/dg/mobile-push-api.html">ëª¨ë°”ì¼ í‘¸ì‹œ API</a> ì¤‘ CreatePlatformEndpointì™€ Publishë¥¼ ì‚¬ìš©í•´ì„œ ë©”ì‹œì§€ë¥¼ ê²Œì‹œí•˜ëŠ” ìƒ˜í”Œ ì½”ë“œë¥¼ ë§Œë“¤ì–´ë³¼ ìˆ˜ ìˆë‹¤. </p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SnsClient</span> snsClient <span class="token operator">=</span> <span class="token class-name">SnsClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">credentialsProvider</span><span class="token punctuation">(</span><span class="token class-name">ProfileCredentialsProvider</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">region</span><span class="token punctuation">(</span><span class="token class-name">Region</span><span class="token punctuation">.</span><span class="token constant">AP_NORTHEAST_2</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertDoesNotThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> platformApplicationArn <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> fcmDeviceToken <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> endpointArn <span class="token operator">=</span> snsClient<span class="token punctuation">.</span><span class="token function">createPlatformEndpoint</span><span class="token punctuation">(</span><span class="token class-name">CreatePlatformEndpointRequest</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">platformApplicationArn</span><span class="token punctuation">(</span>platformApplicationArn<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">token</span><span class="token punctuation">(</span>fcmDeviceToken<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endpointArn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Gson</span> gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> fcmMessage <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span> <span class="token string">"Hi!"</span><span class="token punctuation">,</span> <span class="token string">"body"</span><span class="token punctuation">,</span> <span class="token string">"Mambo?!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> messageId <span class="token operator">=</span> snsClient<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token class-name">PublishRequest</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">messageStructure</span><span class="token punctuation">(</span><span class="token string">"json"</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span>gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"GCM"</span><span class="token punctuation">,</span> fcmMessage<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">targetArn</span><span class="token punctuation">(</span>endpointArn<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">messageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"messageId: &#123;&#125;"</span><span class="token punctuation">,</span> messageId<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>messageId<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>ìœ„ ì˜ˆì œì½”ë“œì—ì„œ ë©”ì‹œì§€ì˜ GCM ì´ ì´ìŠ¤ì¼€ì´í”„ëœ JSON ë¬¸ìì—´ë¡œ êµ¬ì„±ë˜ì–´ì•¼í•¨ì„ ì£¼ì˜í•´ì•¼í•©ë‹ˆë‹¤.</p></blockquote><p><img data-src="/images/posts/amazon-sns-fcm-mobile-push/03.png" alt="PWA ì•±ì—ì„œì˜ í‘¸ì‹œ ì•Œë¦¼ ì˜ˆì‹œ"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;PWA ì•±ì—ì„œ í‘¸ì‹œ ì•Œë¦¼ì„ ìœ„í•´ FCM(Firebse Cloud Messaging)ì„ ë„ì…í–ˆë‹¤ë©´ Amazon SNSì˜ ëª¨ë°”ì¼ í‘¸ì‹œ ì•Œë¦¼ìœ¼ë¡œ í†µí•©í•  ìˆ˜ ìˆë‹¤. Firebase Admin SDK ë¡œë„ ì‰½ê²Œ í‘¸ì‹œ ì•Œë¦¼ì„ ìœ„í•œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆì§€ë§Œ</summary>
      
    
    
    
    
    <category term="FCM" scheme="https://kdevkr.github.io/tags/FCM/"/>
    
    <category term="SNS Mobile Push" scheme="https://kdevkr.github.io/tags/SNS-Mobile-Push/"/>
    
  </entry>
  
  <entry>
    <title>PWA ì™€ FCM í‘¸ì‹œ ì•Œë¦¼</title>
    <link href="https://kdevkr.github.io/pwa-fcm-web-push/"/>
    <id>https://kdevkr.github.io/pwa-fcm-web-push/</id>
    <published>2024-07-06T04:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.902Z</updated>
    
    <content type="html"><![CDATA[<h4 id="PWAì˜-ì„œë¹„ìŠ¤-ì›Œì»¤ëŠ”-HTTPSë¥¼-ìš”êµ¬"><a href="#PWAì˜-ì„œë¹„ìŠ¤-ì›Œì»¤ëŠ”-HTTPSë¥¼-ìš”êµ¬" class="headerlink" title="PWAì˜ ì„œë¹„ìŠ¤ ì›Œì»¤ëŠ” HTTPSë¥¼ ìš”êµ¬"></a>PWAì˜ ì„œë¹„ìŠ¤ ì›Œì»¤ëŠ” HTTPSë¥¼ ìš”êµ¬</h4><p>PWA ì•±ì—ì„œ í‘¸ì‹œ ì•Œë¦¼ì„ ë³´ë‚´ê¸° ìœ„í•´ì„œëŠ” ì‚¬ìš©ìê°€ ì‚¬ì´íŠ¸ ë˜ëŠ” ì•±ì— ëŒ€í•œ ì•Œë¦¼ ê¶Œí•œì„ í—ˆìš©í•´ì•¼í•˜ë©° PWA ì•±ì´ ì¢…ë£Œë˜ì–´ìˆì–´ë„ ë°±ê·¸ë¼ìš´ë“œ ìƒíƒœì—ì„œ ë™ì‘í•˜ëŠ” ì„œë¹„ìŠ¤ ì›Œì»¤ê°€ í•„ìš”í•˜ë‹¤. Vite ê¸°ë°˜ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ìˆëŠ” í”„ë¡œì íŠ¸ì—ì„œëŠ” <a href="https://vite-pwa-org.netlify.app/">PWA Plugin for Vite</a>ë¡œ ì‰½ê²Œ PWA ì„¤ì¹˜ ì§€ì›ê³¼ í•¨ê»˜ ì„œë¹„ìŠ¤ ì›Œì»¤ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆê²Œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤. ì„œë¹„ìŠ¤ ì›Œì»¤ëŠ” HTTPS ì—ì„œ ë™ì‘í•´ì•¼í•˜ë¯€ë¡œ ê°œë°œ í™˜ê²½ì—ì„œëŠ” <a href="https://github.com/liuweiGL/vite-plugin-mkcert">vite-plugin-mkcert</a>ê°€ ë„ì›€ì´ ë  ìˆ˜ ìˆë‹¤.</p><h4 id="ì„œë¹„ìŠ¤-ì›Œì»¤ì˜-ìƒíƒœ-ë³€ê²½ì„-ê³ ë ¤í•˜ê¸°"><a href="#ì„œë¹„ìŠ¤-ì›Œì»¤ì˜-ìƒíƒœ-ë³€ê²½ì„-ê³ ë ¤í•˜ê¸°" class="headerlink" title="ì„œë¹„ìŠ¤ ì›Œì»¤ì˜ ìƒíƒœ ë³€ê²½ì„ ê³ ë ¤í•˜ê¸°"></a>ì„œë¹„ìŠ¤ ì›Œì»¤ì˜ ìƒíƒœ ë³€ê²½ì„ ê³ ë ¤í•˜ê¸°</h4><p>ì„œë¹„ìŠ¤ ì›Œì»¤ì˜ ìƒëª… ì£¼ê¸°ë¥¼ ì´í•´í•˜ê³  ìƒˆë¡œ ì„¤ì¹˜ë˜ê±°ë‚˜ ì—…ë°ì´íŠ¸ë˜ëŠ” ì„œë¹„ìŠ¤ ì›Œì»¤ë¡œ ì¸í•´ ë©”ì‹œì§€ ìˆ˜ì‹ ì´ ì›í™œí•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤ëŠ” ì ì„ ì¸ì§€í•´ì•¼í•œë‹¤. <a href="https://developer.mozilla.org/ko/docs/Web/API/ServiceWorkerGlobalScope/skipWaiting">ServiceWorkerGlobalScope.skipWaiting</a> ì´ë‚˜ <a href="https://developer.mozilla.org/ko/docs/Web/API/Clients/claim">Clients::claim()</a>ì´ ë„ì›€ì´ ë  ìˆ˜ë„ ìˆë‹¤.</p><h5 id="ì„œë¹„ìŠ¤-ì›Œì»¤-íŒŒì¼ì´-firebase-messaging-sw-js-ì¼-í•„ìš”ëŠ”-ì—†ë‹¤"><a href="#ì„œë¹„ìŠ¤-ì›Œì»¤-íŒŒì¼ì´-firebase-messaging-sw-js-ì¼-í•„ìš”ëŠ”-ì—†ë‹¤" class="headerlink" title="ì„œë¹„ìŠ¤ ì›Œì»¤ íŒŒì¼ì´ firebase-messaging-sw.js ì¼ í•„ìš”ëŠ” ì—†ë‹¤"></a>ì„œë¹„ìŠ¤ ì›Œì»¤ íŒŒì¼ì´ firebase-messaging-sw.js ì¼ í•„ìš”ëŠ” ì—†ë‹¤</h5><pre class="language-javascript" data-language="javascript"><div class="caption"><span>main.js</span></div><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>        <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MODE</span> <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">?</span> <span class="token string">'/sw.js'</span> <span class="token operator">:</span> <span class="token string">'/dev-sw.js?dev-sw'</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MODE</span> <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">?</span> <span class="token string">'classic'</span> <span class="token operator">:</span> <span class="token string">'module'</span><span class="token punctuation">&#125;</span>    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">registration</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'register service worker'</span><span class="token punctuation">,</span> registration<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></code></pre><p>FCM ê´€ë ¨ ì¼ë¶€ ê¸€ì—ì„œ ì„œë¹„ìŠ¤ ì›Œì»¤ì˜ íŒŒì¼ì´ ë°˜ë“œì‹œ <code>firebase-messaing-sw.js</code> ì´ì–´ì•¼ í•œë‹¤ê³  ì–¸ê¸‰í•˜ëŠ”ë° ì˜ëª»ëœ ì •ë³´ì— í•´ë‹¹ë˜ë©° FCM ë©”ì‹œì§€ ìˆ˜ì‹ ì„ ìœ„í•´ì„œ PWA ì•±ì—ì„œ ì‚¬ìš©ì¤‘ì¸ <code>ì„œë¹„ìŠ¤ ì›Œì»¤ ë‚´ì— Firebase SDKë¥¼ ì´ˆê¸°í™”</code>í•˜ëŠ”ê²Œ ì¤‘ìš”í•œ ë¶€ë¶„ì´ë‹¤. ìœ„ ì½”ë“œì™€ ê°™ì´ ê°œë°œ í™˜ê²½ì—ì„œëŠ” <a href="https://vite-pwa-org.netlify.app/guide/development#injectmanifest-strategy">dev-sw.js</a>ë¥¼ ì„œë¹„ìŠ¤ ì›Œì»¤ë¡œ ë“±ë¡í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŒì„ ë³´ì—¬ì¤€ë‹¤.</p><h4 id="FCM-í‘¸ì‹œ-ì•Œë¦¼ì´-ì—¬ëŸ¬ë²ˆ-í‘œì‹œë˜ëŠ”-ë¬¸ì œ-ğŸ”¥"><a href="#FCM-í‘¸ì‹œ-ì•Œë¦¼ì´-ì—¬ëŸ¬ë²ˆ-í‘œì‹œë˜ëŠ”-ë¬¸ì œ-ğŸ”¥" class="headerlink" title="FCM í‘¸ì‹œ ì•Œë¦¼ì´ ì—¬ëŸ¬ë²ˆ í‘œì‹œë˜ëŠ” ë¬¸ì œ ğŸ”¥"></a>FCM í‘¸ì‹œ ì•Œë¦¼ì´ ì—¬ëŸ¬ë²ˆ í‘œì‹œë˜ëŠ” ë¬¸ì œ ğŸ”¥</h4><p><a href="https://github.com/kdevkr/mambo-box/blob/main/errors/2024-07-06.md">PWA ì•±ì˜ í‘¸ì‹œ ì•Œë¦¼ì—ì„œ FCM ë©”ì‹œì§€ê°€ ì—¬ëŸ¬ë²ˆ í‘œì‹œë˜ëŠ” ë¬¸ì œ</a>ì™€ ê°™ì´ ë°±ê·¸ë¼ìš´ë“œ ìƒíƒœì— ìˆëŠ” PWA ì•±ì—ì„œ í‘¸ì‹œ ì•Œë¦¼ì´ ì—¬ëŸ¬ë²ˆ í‘œì‹œë˜ëŠ” ì´ìœ ëŠ” <a href="https://firebase.google.com/docs/cloud-messaging/js/receive?hl=ko">ìë°”ìŠ¤í¬ë¦½íŠ¸ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë©”ì‹œì§€ ìˆ˜ì‹ </a>ì‹œ ì•Œë¦¼ ë©”ì‹œì§€ì— ì˜í•œ ê¸°ë³¸ í™”ë©´ í‘œì‹œì— ëŒ€í•´ ê³ ë ¤í•˜ì§€ ì•Šì€ ë¬¸ì œì— í•´ë‹¹ëœë‹¤. ìë°”ìŠ¤í¬ë¦½íŠ¸ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì»¤ìŠ¤í…€ ë©”ì‹œì§€ë¡œ í‘¸ì‹œ ì•Œë¦¼ì„ ì œê³µí•˜ê³  ì‹¶ë‹¤ë©´ ì„œë²„ì—ì„œëŠ” ì•Œë¦¼ ë©”ì‹œì§€ê°€ í¬í•¨ë˜ì§€ ì•Šì€ ë°ì´í„° ë©”ì‹œì§€ë¡œ êµ¬ì„±í•˜ì—¬ ì „ë‹¬í•´ì•¼í•œë‹¤.</p><h4 id="ìë°”ìŠ¤í¬ë¦½íŠ¸-í´ë¼ì´ì–¸íŠ¸-API-í‚¤ëŠ”-ì•ˆì „í•˜ë‹¤"><a href="#ìë°”ìŠ¤í¬ë¦½íŠ¸-í´ë¼ì´ì–¸íŠ¸-API-í‚¤ëŠ”-ì•ˆì „í•˜ë‹¤" class="headerlink" title="ìë°”ìŠ¤í¬ë¦½íŠ¸ í´ë¼ì´ì–¸íŠ¸ API í‚¤ëŠ” ì•ˆì „í•˜ë‹¤"></a>ìë°”ìŠ¤í¬ë¦½íŠ¸ í´ë¼ì´ì–¸íŠ¸ API í‚¤ëŠ” ì•ˆì „í•˜ë‹¤</h4><p>ì¼ë°˜ì ìœ¼ë¡œ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë™ì‘í•˜ëŠ” SDKì— ëŒ€í•œ í‚¤ëŠ” ì™¸ë¶€ì— ë…¸ì¶œë  ìˆ˜ ë°–ì— ì—†ìœ¼ë¯€ë¡œ FCM ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•  ìˆ˜ ìˆëŠ” ìµœì†Œí•œì˜ ê¶Œí•œì„ ë³´ìœ í•œë‹¤. FCM ì½˜ì†”ì—ì„œ <a href="https://developer.chrome.com/blog/web-push-interop-wins?hl=ko#introducing_vapid_for_server_identification">ì›¹ í‘¸ì‹œ ì¸ì¦ì„œ</a>ëŠ” <code>ìµœëŒ€ 2ê°œê¹Œì§€ ë°œê¸‰</code>í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ <code>VAPID</code>ë¥¼ í™˜ê²½ë³„ë¡œ ë‚˜ëˆ„ì–´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ ì¢‹ì•„ë³´ì¸ë‹¤. ë” ìì„¸í•œ ë‚´ìš©ì€ <a href="https://firebase.google.com/docs/projects/api-keys?hl=ko">Firebaseìš© API í‚¤ ì‚¬ìš© ë° ê´€ë¦¬ì— ëŒ€í•´ ì•Œì•„ë³´ê¸°</a>ë¥¼ ì°¸ê³ í•˜ì—¬ ê³ ë ¤í•´ë³´ë„ë¡ í•˜ì.</p><h4 id="ì‹œìŠ¤í…œ-ê·œëª¨ì—-ë”°ë¥¸-í† í°-ê´€ë¦¬-ì „ëµ"><a href="#ì‹œìŠ¤í…œ-ê·œëª¨ì—-ë”°ë¥¸-í† í°-ê´€ë¦¬-ì „ëµ" class="headerlink" title="ì‹œìŠ¤í…œ ê·œëª¨ì— ë”°ë¥¸ í† í° ê´€ë¦¬ ì „ëµ"></a>ì‹œìŠ¤í…œ ê·œëª¨ì— ë”°ë¥¸ í† í° ê´€ë¦¬ ì „ëµ</h4><p><a href="https://firebase.google.com/docs/cloud-messaging/manage-tokens?hl=ko">FCM ë“±ë¡ í† í° ê´€ë¦¬ë¥¼ ìœ„í•œ ê¶Œì¥ì‚¬í•­</a>ê³¼ <a href="https://firebase.google.com/docs/cloud-messaging/scale-fcm?hl=ko">FCM ë©”ì‹œì§€ë¥¼ ëŒ€ê·œëª¨ë¡œ ì „ì†¡í•  ë•Œì˜ ê¶Œì¥ì‚¬í•­</a>ë¥¼ ì°¸ê³ í•˜ì—¬ ì‹œìŠ¤í…œì— ì €ì¥ë˜ì–´ ë©”ì‹œì§€ ì „ì†¡ ì‹œ ì‚¬ìš©ë˜ëŠ” í† í°ì˜ ìˆ˜ë¥¼ ê´€ë¦¬í•˜ëŠ”ê²Œ í•„ìš”í•˜ë‹¤. ì„œë²„ì—ì„œëŠ” ì‚¬ìš©ìê°€ PWA ì•±ì„ ì‚­ì œí•˜ëŠ”ì§€ë¥¼ ê°ì§€í•˜ì—¬ ë”ì´ìƒ í† í°ì´ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ì§€ ì•Œ ìˆ˜ ì—†ë‹¤. FCM ë©”ì‹œì§€ ì „ì†¡ ì‹œ ë¬´ì œí•œìœ¼ë¡œ ë°œì†¡í•  ìˆ˜ëŠ” ì—†ìœ¼ë¯€ë¡œ ì˜¤ë«ë™ì•ˆ ì‚¬ìš©ë˜ì§€ ì•Šê±°ë‚˜ ë§Œë£Œëœ í† í°ì€ ì£¼ê¸°ì ìœ¼ë¡œ ì‚­ì œí•˜ëŠ” ì‘ì—…ì´ ìˆì–´ì•¼í•œë‹¤.</p><h4 id="iOSì˜-PWA-ì•±-ì§€ì›-ì—¬ë¶€"><a href="#iOSì˜-PWA-ì•±-ì§€ì›-ì—¬ë¶€" class="headerlink" title="iOSì˜ PWA ì•± ì§€ì› ì—¬ë¶€"></a>iOSì˜ PWA ì•± ì§€ì› ì—¬ë¶€</h4><p>ì•ˆë“œë¡œì´ë“œì™€ í¬ë¡¬ ë¸Œë¼ìš°ì €ì™€ ë‹¬ë¦¬ iOS ë˜ëŠ” ì‚¬íŒŒë¦¬ ë¸Œë¼ìš°ì €ì— ë”°ë¼ PWA ì•± ì„¤ì¹˜ ë° í‘¸ì‹œ APIë¥¼ ì§€ì›í•˜ëŠ”ì§€ì˜ ì—¬ë¶€ê°€ ë‹¤ë¦„ì„ ì¸ì§€í•´ì•¼í•œë‹¤. ë˜í•œ, í™ˆ í™”ë©´ìœ¼ë¡œ ì¶”ê°€ë˜ëŠ” ì•±ì€ ë°˜ë“œì‹œ ê¸°ë³¸ìœ¼ë¡œ ì œê³µë˜ëŠ” ì‚¬íŒŒë¦¬ ë¸Œë¼ìš°ì €ë¡œ ì‹¤í–‰ë˜ëŠ” ê²ƒë„ ì¤‘ìš”í•œ ë¶€ë¶„ì— í•´ë‹¹ëœë‹¤.</p><ul><li><a href="https://developer.apple.com/documentation/usernotifications/sending-web-push-notifications-in-web-apps-and-browsers">Safari 16.1 and macOS 16.4 iOS &amp; iPadOS ë¶€í„° Push API ì§€ì›</a></li><li><a href="https://developer.apple.com/support/dma-and-apps-in-the-eu/">ìœ ëŸ½ ì—°í•©ì˜ êµ­ê°€ì—ì„œ iOS 17.4 ì´ìƒì—ì„œ PWA ì§€ì› ì¢…ë£Œ</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;PWAì˜-ì„œë¹„ìŠ¤-ì›Œì»¤ëŠ”-HTTPSë¥¼-ìš”êµ¬&quot;&gt;&lt;a href=&quot;#PWAì˜-ì„œë¹„ìŠ¤-ì›Œì»¤ëŠ”-HTTPSë¥¼-ìš”êµ¬&quot; class=&quot;headerlink&quot; title=&quot;PWAì˜ ì„œë¹„ìŠ¤ ì›Œì»¤ëŠ” HTTPSë¥¼ ìš”êµ¬&quot;&gt;&lt;/a&gt;PWAì˜ ì„œë¹„ìŠ¤ ì›Œì»¤ëŠ” HTTPSë¥¼ </summary>
      
    
    
    
    
    <category term="FCM" scheme="https://kdevkr.github.io/tags/FCM/"/>
    
    <category term="PWA" scheme="https://kdevkr.github.io/tags/PWA/"/>
    
  </entry>
  
  <entry>
    <title>HAProxy</title>
    <link href="https://kdevkr.github.io/haproxy/"/>
    <id>https://kdevkr.github.io/haproxy/</id>
    <published>2024-06-29T06:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.898Z</updated>
    
    <content type="html"><![CDATA[<p>ì¼ë°˜ì ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì— ëŒ€í•œ HTTP í”„ë¡ì‹œëŠ” ì—”ì§„ì—‘ìŠ¤(Nginx)ë¥¼ ë§ì´ ì‚¬ìš©í•˜ê³  ìˆì§€ë§Œ L4 ë ˆë²¨ì˜ <code>TCP í”„ë¡ì‹œ</code>ê°€ í•„ìš”í•œ ê²½ìš° stream ëª¨ë“ˆì„ ë³„ë„ë¡œ ì„¤ì¹˜í•´ì•¼í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ë¯€ë¡œ <code>HAProxy</code>ê°€ ë” ì¢‹ì€ ì„ íƒì¼ ìˆ˜ ìˆë‹¤. ì‚¬ë‚´ ê°œë°œ í™˜ê²½ì—ì„œ ì—°ê²°í•  ìˆ˜ ìˆëŠ” ë°°ìŠ¤ì²œ í˜¸ìŠ¤íŠ¸ì— HAProxyë¥¼ êµ¬ì„±í•˜ê³  í”„ë¼ì´ë¹— ë„¤íŠ¸ì›Œí¬ í™˜ê²½ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ìˆëŠ” í…ŒìŠ¤íŠ¸ í™˜ê²½ì˜ TCP í†µì‹ ì´ í•„ìš”í•œ ì¸ìŠ¤í„´ìŠ¤ì— ì—°ê²°í•  ìˆ˜ ìˆë„ë¡ <code>í¬íŠ¸ í¬ì›Œë”©</code>ì„ êµ¬ì„±í•´ë³´ë„ë¡ í•˜ì.</p><h4 id="TCP-í”„ë¡ì‹œ"><a href="#TCP-í”„ë¡ì‹œ" class="headerlink" title="TCP í”„ë¡ì‹œ"></a>TCP í”„ë¡ì‹œ</h4><p><a href="https://www.haproxy.com/documentation/haproxy-configuration-tutorials/load-balancing/tcp/">TCP í”„ë¡ì‹œ</a>ëŠ” TCP ì—°ê²°ì— ëŒ€í•œ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œì— í•´ë‹¹ëœë‹¤. ì¼ë°˜ì ìœ¼ë¡œ TCP ì—°ê²°ì„ ìˆ˜í–‰í•´ì•¼í•˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ì—ëŠ” Redis ë˜ëŠ” PostgreSQLì´ ìˆëŠ”ë° í˜„ì¬ ì¡°ì§ì—ì„œ í™œìš©í•˜ê³  ìˆëŠ” ì‹œê³„ì—´ ë°ì´í„°ë² ì´ìŠ¤ì¸ <a href="https://kx.com/products/kdb/">KDB+</a>ì— ëŒ€í•´ í”„ë¡ì‹œë¥¼ êµ¬ì„±í•´ë³´ë ¤ê³  í•œë‹¤. ë‹¤ìŒì€ KDBì—ì„œ ì‚¬ìš©í•´ì•¼í•˜ëŠ” í¬íŠ¸ ë²”ìœ„ë¥¼ ìˆ˜ì‹ í•˜ë„ë¡ ì„¤ì •í•œ ì˜ˆì‹œì´ë‹¤.</p><pre class="language-cfg" data-language="cfg"><div class="caption"><span>haproxy.cfg</span></div><code class="language-cfg">listen kdb_proxy_for_dev    mode tcp    bind *:5010-5013    server kdb_dev 192.168.149.88</code></pre><h4 id="HAProxy-êµ¬ì„±-í…ŒìŠ¤íŠ¸"><a href="#HAProxy-êµ¬ì„±-í…ŒìŠ¤íŠ¸" class="headerlink" title="HAProxy êµ¬ì„± í…ŒìŠ¤íŠ¸"></a>HAProxy êµ¬ì„± í…ŒìŠ¤íŠ¸</h4><p>í˜„ì¬ ì„¤ì • íŒŒì¼ì— ë¬¸ë²•ì ì¸ ë¬¸ì œê°€ ì—†ëŠ”ì§€ <code>check mode(-c)</code> ì˜µì…˜ì„ ì‚¬ìš©í•´ì„œ í˜„ì¬ ì„¤ì •ì— ëŒ€í•´ ê²€ì¦ì„ ìˆ˜í–‰í•´ë³¼ ìˆ˜ ìˆë‹¤.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>ec2-user@ip-192-169-14-62 ~<span class="token punctuation">]</span>$ haproxy <span class="token parameter variable">-c</span> <span class="token parameter variable">-f</span> /etc/haproxy/haproxy.cfgConfiguration <span class="token function">file</span> is valid</code></pre><h4 id="TCP-í”„ë¡ì‹œ-í…ŒìŠ¤íŠ¸"><a href="#TCP-í”„ë¡ì‹œ-í…ŒìŠ¤íŠ¸" class="headerlink" title="TCP í”„ë¡ì‹œ í…ŒìŠ¤íŠ¸"></a>TCP í”„ë¡ì‹œ í…ŒìŠ¤íŠ¸</h4><p>NetCat(nc) ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì„œ HAProxyì—ì„œ ìˆ˜ì‹ í•˜ê³  ìˆëŠ” í¬íŠ¸ë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ í™˜ê²½ì— ì‹¤í–‰ëœ ì¸ìŠ¤í„´ìŠ¤ì— ì—°ê²°í•  ìˆ˜ ìˆëŠ”ì§€ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>ec2-user@ip-192-169-14-62 ~<span class="token punctuation">]</span>$ <span class="token function">nc</span> <span class="token parameter variable">-znv</span> <span class="token number">127.0</span>.0.1 <span class="token number">5013</span>Ncat: Version <span class="token number">7.50</span> <span class="token punctuation">(</span> https://nmap.org/ncat <span class="token punctuation">)</span>Ncat: Connected to <span class="token number">127.0</span>.0.1:5013.Ncat: <span class="token number">0</span> bytes sent, <span class="token number">0</span> bytes received <span class="token keyword">in</span> <span class="token number">0.01</span> seconds.</code></pre><blockquote><p>ë°°ìŠ¤ì²œ í˜¸ìŠ¤íŠ¸ì— TCP í”„ë¡ì‹œë¥¼ êµ¬ì„±í•˜ê¸° ì „ê¹Œì§€ëŠ” ë°°ìŠ¤ì²œ í˜¸ìŠ¤íŠ¸ì— ëŒ€í•œ SSH í„°ë„ë§ì„ í•„ìš”í• ë•Œë§ˆë‹¤ ìˆ˜í–‰í•´ì•¼ í–ˆìŠµë‹ˆë‹¤.<br>ê¸°ë³¸ì ìœ¼ë¡œ SSH í„°ë„ë§ì„ êµ¬ì„±í•˜ëŠ”ê²Œ ì¼ë°˜ì ì´ì§€ë§Œ ë³´ì•ˆ ìˆ˜ì¤€ì„ ê²€í† í•˜ê³  TCP í”„ë¡ì‹œë¥¼ êµ¬ì„±í•´ë³´ë„ë¡ í•˜ì„¸ìš”.</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ì¼ë°˜ì ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì— ëŒ€í•œ HTTP í”„ë¡ì‹œëŠ” ì—”ì§„ì—‘ìŠ¤(Nginx)ë¥¼ ë§ì´ ì‚¬ìš©í•˜ê³  ìˆì§€ë§Œ L4 ë ˆë²¨ì˜ &lt;code&gt;TCP í”„ë¡ì‹œ&lt;/code&gt;ê°€ í•„ìš”í•œ ê²½ìš° stream ëª¨ë“ˆì„ ë³„ë„ë¡œ ì„¤ì¹˜í•´ì•¼í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ë¯€ë¡œ &lt;code&gt;HAProxy&lt;</summary>
      
    
    
    
    
    <category term="HAProxy" scheme="https://kdevkr.github.io/tags/HAProxy/"/>
    
    <category term="TCP Proxy" scheme="https://kdevkr.github.io/tags/TCP-Proxy/"/>
    
  </entry>
  
  <entry>
    <title>Spring AI + Ollama</title>
    <link href="https://kdevkr.github.io/spring-ai-with-ollama/"/>
    <id>https://kdevkr.github.io/spring-ai-with-ollama/</id>
    <published>2024-06-28T14:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.902Z</updated>
    
    <content type="html"><![CDATA[<p>Spring AI í”„ë¡œì íŠ¸ì—ì„œ OpenAIì˜ ChatGPT ë˜ëŠ” Anthropicì˜ Claudeë¥¼ ì§€ì›í•˜ì§€ë§Œ ë¡œì»¬ ë¨¸ì‹ ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” Ollamaë„ ì§€ì›í•˜ê³  ìˆë‹¤.<br>ë‚´ ì»´í“¨í„°ì— Ollamaë¥¼ ì„¤ì¹˜í•˜ê³  íŒŒë¼ë¯¸í„°ê°€ ì‘ì€ ëª¨ë¸ì„ ì„ íƒí•´ì„œ ê°„ë‹¨í•˜ê²Œ AI ì—”ì§€ë‹ˆì–´ë§ì„ í•´ë³´ë„ë¡ í•˜ë ¤ê³  í•œë‹¤. </p><h4 id="ìœˆë„ìš°-Ollama-ì„¤ì¹˜"><a href="#ìœˆë„ìš°-Ollama-ì„¤ì¹˜" class="headerlink" title="ìœˆë„ìš° Ollama ì„¤ì¹˜"></a>ìœˆë„ìš° Ollama ì„¤ì¹˜</h4><p><a href="https://ollama.com/download/windows">Download for Windows (Preview)</a>ë¥¼ í†µí•´ ìœˆë„ìš° ì»´í“¨í„°ì— Ollamaë¥¼ ì„¤ì¹˜í•˜ê³  ì‚¬ìš©ê°€ëŠ¥í•œ <a href="https://ollama.com/library">ëª¨ë¸</a> ì¤‘ì—ì„œ íŒŒë¼ë¯¸í„°ê°€ ì‘ì€ ëª¨ë¸ ì¤‘ í•˜ë‚˜ì¸ <a href="https://ollama.com/library/phi3">phi3</a>ë¥¼ ì„ íƒí•´ë³´ì.<br>ì¼ë°˜ì ì¸ ì˜ˆì‹œì—ì„œëŠ” <a href="https://ollama.com/library/mistral">mistral</a>ë¥¼ ì„¤ì¹˜í•´ì„œ ì‚¬ìš©í•´ë³´ëŠ” ê²ƒ ê°™ë‹¤. ì•„ë¬´íŠ¼, <code>ollama run phi3</code> ëª…ë ¹ì–´ë¡œ ëª¨ë¸ì„ ì„¤ì¹˜í•  ìˆ˜ ìˆë‹¤.</p><pre class="language-ps" data-language="ps"><code class="language-ps">PS C:\Users\Mambo\ollama&gt; ollama run phi3pulling manifestpulling b26e6713dc74... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– 2.4 GBpulling fa8235e5b48f... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– 1.1 KBpulling 542b217f179c... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  148 Bpulling 8dde1baf1db0... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   78 Bpulling f91db7a2deb9... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  485 Bverifying sha256 digestwriting manifestremoving any unused layerssuccess</code></pre><h4 id="Open-WebUI-ì„¤ì¹˜"><a href="#Open-WebUI-ì„¤ì¹˜" class="headerlink" title="Open WebUI ì„¤ì¹˜"></a>Open WebUI ì„¤ì¹˜</h4><p>Spring AIì™€ëŠ” ìƒê´€ì—†ì§€ë§Œ ChatGPTì™€ ê°™ì€ AI ì„œë¹„ìŠ¤ì²˜ëŸ¼ Ollamaì™€ ì—°ë™ì´ ê°€ëŠ¥í•œ <a href="https://openwebui.com/">Open WebUI</a>ë¥¼ ì„¤ì¹˜í•´ë³´ì•˜ë‹¤. </p><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">open-webui</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> ghcr.io/open<span class="token punctuation">-</span>webui/open<span class="token punctuation">-</span>webui<span class="token punctuation">:</span>main    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> open<span class="token punctuation">-</span>webui    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"3000:8080"</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">OLLAMA_BASE_URL</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//host.docker.internal<span class="token punctuation">:</span><span class="token number">11434</span>      <span class="token key atrule">WEBUI_AUTH</span><span class="token punctuation">:</span> <span class="token boolean important">False</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> open<span class="token punctuation">-</span>webui<span class="token punctuation">:</span>/app/backend/data    <span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> host.docker.internal<span class="token punctuation">:</span>host<span class="token punctuation">-</span>gateway    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped<span class="token key atrule">volumes</span><span class="token punctuation">:</span>  <span class="token key atrule">open-webui</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>ì €ëŠ” ì»´í“¨í„° í˜¸ìŠ¤íŠ¸ì— Ollamaë¥¼ ì„¤ì¹˜í•˜ê³  ì‹¤í–‰í•˜ì˜€ê¸°ì— host.docker.internalë¡œ ì ‘ê·¼í–ˆìŠµë‹ˆë‹¤.<br>Ollamaë¥¼ ë„ì»¤ ì»´í¬ì¦ˆë¡œ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì„¤ì •ì€ <a href="https://github.com/open-webui/open-webui/blob/main/docker-compose.yaml">docker-compose.yaml</a>ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.</p></blockquote><h4 id="Spring-AI-Ollama-Chat"><a href="#Spring-AI-Ollama-Chat" class="headerlink" title="Spring AI Ollama Chat"></a>Spring AI Ollama Chat</h4><p><a href="https://docs.spring.io/spring-ai/reference/api/chat/ollama-chat.html">OllamaChatModel</a></p><pre class="language-groovy" data-language="groovy"><div class="caption"><span>build.gradle</span></div><code class="language-groovy">repositories <span class="token punctuation">&#123;</span>    maven <span class="token punctuation">&#123;</span> url <span class="token string">'https://repo.spring.io/milestone'</span> <span class="token punctuation">&#125;</span>    maven <span class="token punctuation">&#123;</span> url <span class="token string">'https://repo.spring.io/snapshot'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>dependencies <span class="token punctuation">&#123;</span>    implementation <span class="token string">'org.springframework.ai:spring-ai-ollama-spring-boot-starter'</span><span class="token punctuation">&#125;</span>dependencyManagement <span class="token punctuation">&#123;</span>    imports <span class="token punctuation">&#123;</span>        mavenBom <span class="token interpolation-string"><span class="token string">"de.codecentric:spring-boot-admin-dependencies:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">springBootAdminVersion</span></span><span class="token string">"</span></span>        mavenBom <span class="token interpolation-string"><span class="token string">"org.springframework.ai:spring-ai-bom:1.0.0-M1"</span></span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-yaml" data-language="yaml"><div class="caption"><span>application.yml</span></div><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">ai</span><span class="token punctuation">:</span>    <span class="token key atrule">ollama</span><span class="token punctuation">:</span>      <span class="token key atrule">base-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">11434</span>      <span class="token key atrule">chat</span><span class="token punctuation">:</span>        <span class="token key atrule">options</span><span class="token punctuation">:</span>          <span class="token key atrule">model</span><span class="token punctuation">:</span> phi3          <span class="token key atrule">temperature</span><span class="token punctuation">:</span> <span class="token number">0.9</span>    <span class="token key atrule">retry</span><span class="token punctuation">:</span>      <span class="token key atrule">max-attempts</span><span class="token punctuation">:</span> <span class="token number">1</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequiredArgsConstructor</span><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatApi</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TEMPLATE</span> <span class="token operator">=</span> <span class="token triple-quoted-string string">"""            Hello ai, How many hours does &#123;timezone&#125; differ by UTC?.            """</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">OllamaChatModel</span> chatModel<span class="token punctuation">;</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/ai/generate"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">String</span> timezone<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">PromptTemplate</span> promptTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PromptTemplate</span><span class="token punctuation">(</span><span class="token constant">TEMPLATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        promptTemplate<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"timezone"</span><span class="token punctuation">,</span> timezone<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> chatModel<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>promptTemplate<span class="token punctuation">.</span><span class="token function">createMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-txt" data-language="txt"><div class="caption"><span>AI Response</span></div><code class="language-txt">Seoul, South Korea operates on Korea Standard Time (KST), which is 9 hours ahead of Coordinated Universal Time (UTC+9). Therefore, the difference between UTC and KST in Seoul is 9 hours.To calculate this for any specific time:- If you're looking to convert a time from UTC to KST, add 9 hours.- If you're converting a time from KST back to UTC, subtract 9 hours.</code></pre><p>ê²°ì œê°€ í•„ìš”í•œ ChatGPTì™€ Claude API ëŒ€ì‹ ì— ë¡œì»¬ ë¨¸ì‹ ì— Ollamaë¥¼ ì„¤ì¹˜í•˜ê³  Spring AIë¥¼ ê°„ë‹¨í•˜ê²Œ ë‹¤ë£¨ì–´ë³´ì•˜ë‹¤.<br>ê°œì¸ì ìœ¼ë¡œ AIì— ëŒ€í•œ ì¸ì‹ì€ ì•„ì§ <strong>ì„¤ë ˆë°œ</strong>ì´ë¼ê³  ìƒê°ì´ ë˜ì§€ë§Œ AIê°€ ì„±ì¥í• ìˆ˜ë¡ <a href="https://www.promptingguide.ai/kr">í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§</a>ë„ ê°œë°œìì—ê²Œ í•„ìš”í•œ ì—­ëŸ‰ì´ ë˜ì–´ê°ˆ ìˆ˜ ìˆì–´ì„œ ì¤€ë¹„ê°€ í•„ìš”í•˜ë‹¤.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Spring AI í”„ë¡œì íŠ¸ì—ì„œ OpenAIì˜ ChatGPT ë˜ëŠ” Anthropicì˜ Claudeë¥¼ ì§€ì›í•˜ì§€ë§Œ ë¡œì»¬ ë¨¸ì‹ ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” Ollamaë„ ì§€ì›í•˜ê³  ìˆë‹¤.&lt;br&gt;ë‚´ ì»´í“¨í„°ì— Ollamaë¥¼ ì„¤ì¹˜í•˜ê³  íŒŒë¼ë¯¸í„°ê°€ ì‘ì€ ëª¨ë¸ì„ ì„ íƒí•´ì„œ ê°„</summary>
      
    
    
    
    
    <category term="spring ai" scheme="https://kdevkr.github.io/tags/spring-ai/"/>
    
    <category term="ollama" scheme="https://kdevkr.github.io/tags/ollama/"/>
    
  </entry>
  
  <entry>
    <title>AWS EC2 ì¸ìŠ¤í„´ìŠ¤ ë©”íƒ€ë°ì´í„°</title>
    <link href="https://kdevkr.github.io/aws-ec2-instance-metadata/"/>
    <id>https://kdevkr.github.io/aws-ec2-instance-metadata/</id>
    <published>2024-06-25T13:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.894Z</updated>
    
    <content type="html"><![CDATA[<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># IMDSv1</span><span class="token function">curl</span> http://169.254.169.254/latest/dynamic/instance-identity/document<span class="token comment"># IMDSv2</span><span class="token assign-left variable">TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">curl</span> <span class="token parameter variable">-H</span> <span class="token string">"X-aws-ec2-metadata-token-ttl-seconds: 21600"</span><span class="token variable">`</span></span> <span class="token parameter variable">-X</span> PUT <span class="token string">"http://169.254.169.254/latest/api/token"</span> <span class="token function">curl</span> <span class="token parameter variable">-H</span> <span class="token string">"X-aws-ec2-metadata-token: <span class="token variable">$TOKEN</span>"</span> http://169.254.169.254/latest/dynamic/instance-identity/document<span class="token punctuation">&#123;</span>    <span class="token string">"accountId"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,    <span class="token string">"architecture"</span><span class="token builtin class-name">:</span> <span class="token string">"arm64"</span>,    <span class="token string">"availabilityZone"</span><span class="token builtin class-name">:</span> <span class="token string">"ap-northeast-2c"</span>,    <span class="token string">"billingProducts"</span><span class="token builtin class-name">:</span> null,    <span class="token string">"devpayProductCodes"</span><span class="token builtin class-name">:</span> null,    <span class="token string">"marketplaceProductCodes"</span><span class="token builtin class-name">:</span> null,    <span class="token string">"imageId"</span><span class="token builtin class-name">:</span> <span class="token string">"ami-0331a5c9d849893dc"</span>,    <span class="token string">"instanceId"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,    <span class="token string">"instanceType"</span><span class="token builtin class-name">:</span> <span class="token string">"c6g.xlarge"</span>,    <span class="token string">"kernelId"</span><span class="token builtin class-name">:</span> null,    <span class="token string">"pendingTime"</span><span class="token builtin class-name">:</span> <span class="token string">"2024-06-23T01:01:23Z"</span>,    <span class="token string">"privateIp"</span><span class="token builtin class-name">:</span> <span class="token string">"192.169.44.196"</span>,    <span class="token string">"ramdiskId"</span><span class="token builtin class-name">:</span> null,    <span class="token string">"region"</span><span class="token builtin class-name">:</span> <span class="token string">"ap-northeast-2"</span>,    <span class="token string">"version"</span><span class="token builtin class-name">:</span> <span class="token string">"2017-09-30"</span><span class="token punctuation">&#125;</span></code></pre><p><a href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/instancedata-data-retrieval.html">ì¸ìŠ¤í„´ìŠ¤ ë©”íƒ€ë°ì´í„° ê²€ìƒ‰</a>ì„ í™œìš©í•´ì„œ ë™ì  ë°ì´í„°ì˜ <a href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/instance-identity-documents.html">ì¸ìŠ¤í„´ìŠ¤ ìê²© ì¦ëª… ë¬¸ì„œ(instance-identity&#x2F;document)</a>ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì˜ˆì‹œì´ë‹¤. ì´ë²ˆ ê¸€ì—ì„œëŠ” <code>AWS SDK for Java</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì œê³µí•˜ëŠ” <code>EC2 ë©”íƒ€ë°ì´í„° ìœ í‹¸ë¦¬í‹°</code>ë¥¼ í†µí•´ AWS EC2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì‹¤í–‰ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì—ì„œ EC2 ì¸ìŠ¤í„´ìŠ¤ ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë„ë¡ ì‘ì„±í•´ë³´ë ¤ê³  í•œë‹¤. ìŠ¤í”„ë§ ë¶€íŠ¸ ê¸°ë°˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë¼ë©´ ìŠ¤í”„ë§ ë¶€íŠ¸ ì•¡ì¶”ì—ì´í„°ì˜ <a href="https://docs.spring.io/spring-boot/reference/actuator/endpoints.html#actuator.endpoints.info">InfoContributor</a> ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ <code>EC2MetadataInfoContributor</code>ë¥¼ ë§Œë“¤ì–´ë³´ì.</p><h4 id="EC2MetadataInfoContributor-with-SDK-for-Java-1-x"><a href="#EC2MetadataInfoContributor-with-SDK-for-Java-1-x" class="headerlink" title="EC2MetadataInfoContributor with SDK for Java 1.x"></a>EC2MetadataInfoContributor with SDK for Java 1.x</h4><pre class="language-groovy" data-language="groovy"><div class="caption"><span>build.gradle</span></div><code class="language-groovy">dependencies <span class="token punctuation">&#123;</span>    <span class="token comment">// the AWS SDK for Java v1.x will enter maintenance mode on July 31, 2024, and reach end-of-support on December 31, 2025.</span>    implementation <span class="token function">platform</span><span class="token punctuation">(</span><span class="token string">'com.amazonaws:aws-java-sdk-bom:1.12.748'</span><span class="token punctuation">)</span>    implementation <span class="token string">'com.amazonaws:aws-java-sdk-ec2'</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><div class="caption"><span>EC2MetadataInfoContributor.java</span></div><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">EC2MetadataUtils</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>info<span class="token punctuation">.</span></span><span class="token class-name">Info</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>info<span class="token punctuation">.</span></span><span class="token class-name">InfoContributor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EC2MetadataInfoContributor</span> <span class="token keyword">implements</span> <span class="token class-name">InfoContributor</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> isRunningAwsEC2<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">EC2MetadataInfoContributor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        isRunningAwsEC2 <span class="token operator">=</span> <span class="token class-name">EC2MetadataUtils</span><span class="token punctuation">.</span><span class="token function">getInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contribute</span><span class="token punctuation">(</span><span class="token class-name">Info<span class="token punctuation">.</span>Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>isRunningAwsEC2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">EC2MetadataUtils<span class="token punctuation">.</span>InstanceInfo</span> instanceInfo <span class="token operator">=</span> <span class="token class-name">EC2MetadataUtils</span><span class="token punctuation">.</span><span class="token function">getInstanceInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            builder<span class="token punctuation">.</span><span class="token function">withDetail</span><span class="token punctuation">(</span><span class="token string">"ec2"</span><span class="token punctuation">,</span> instanceInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="EC2MetadataInfoContributor-with-SDK-for-Java-2-x"><a href="#EC2MetadataInfoContributor-with-SDK-for-Java-2-x" class="headerlink" title="EC2MetadataInfoContributor with SDK for Java 2.x"></a>EC2MetadataInfoContributor with SDK for Java 2.x</h4><pre class="language-groovy" data-language="groovy"><div class="caption"><span>build.gradle</span></div><code class="language-groovy">dependencies <span class="token punctuation">&#123;</span>    implementation <span class="token function">platform</span><span class="token punctuation">(</span><span class="token string">'software.amazon.awssdk:bom:2.21.4'</span><span class="token punctuation">)</span>    implementation <span class="token string">'software.amazon.awssdk:imds'</span>    implementation <span class="token string">'software.amazon.awssdk:url-connection-client'</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><div class="caption"><span>EC2MetadataInfoContributorV2.java</span></div><code class="language-java">mport <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>info<span class="token punctuation">.</span></span>Info</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>info<span class="token punctuation">.</span></span><span class="token class-name">InfoContributor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">software<span class="token punctuation">.</span>amazon<span class="token punctuation">.</span>awssdk<span class="token punctuation">.</span>core<span class="token punctuation">.</span>document<span class="token punctuation">.</span></span><span class="token class-name">Document</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">software<span class="token punctuation">.</span>amazon<span class="token punctuation">.</span>awssdk<span class="token punctuation">.</span>imds<span class="token punctuation">.</span></span><span class="token class-name">Ec2MetadataClient</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">software<span class="token punctuation">.</span>amazon<span class="token punctuation">.</span>awssdk<span class="token punctuation">.</span>imds<span class="token punctuation">.</span></span><span class="token class-name">Ec2MetadataResponse</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EC2MetadataInfoContributorV2</span> <span class="token keyword">implements</span> <span class="token class-name">InfoContributor</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isRunningAwsEC2<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">EC2MetadataInfoContributorV2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Ec2MetadataClient</span> client <span class="token operator">=</span> <span class="token class-name">Ec2MetadataClient</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            isRunningAwsEC2 <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/latest/meta-data/instance-id"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ignored<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// ignored</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contribute</span><span class="token punctuation">(</span><span class="token class-name">Info<span class="token punctuation">.</span>Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>isRunningAwsEC2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Ec2MetadataClient</span> client <span class="token operator">=</span> <span class="token class-name">Ec2MetadataClient</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Ec2MetadataResponse</span> metadataResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/latest/dynamic/instance-identity/document"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Document</span> document <span class="token operator">=</span> metadataResponse<span class="token punctuation">.</span><span class="token function">asDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                builder<span class="token punctuation">.</span><span class="token function">withDetail</span><span class="token punctuation">(</span><span class="token string">"ec2"</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">asMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ignored<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// ignored</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="ì¸ìŠ¤í„´ìŠ¤-ë©”íƒ€ë°ì´í„°-ê²€ìƒ‰"><a href="#ì¸ìŠ¤í„´ìŠ¤-ë©”íƒ€ë°ì´í„°-ê²€ìƒ‰" class="headerlink" title="ì¸ìŠ¤í„´ìŠ¤ ë©”íƒ€ë°ì´í„° ê²€ìƒ‰"></a>ì¸ìŠ¤í„´ìŠ¤ ë©”íƒ€ë°ì´í„° ê²€ìƒ‰</h4><ol><li>SDK ë²„ì „ì— ë”°ë¼ <a href="https://docs.aws.amazon.com/ko_kr/sdk-for-java/latest/developer-guide/migration-imds.html#migration-imds-behavior-endpoint-res">SDKê°€ ì—”ë“œí¬ì¸íŠ¸ë¥¼ IMDSë¡œ í™•ì¸í•˜ê¸° ìœ„í•´ í™•ì¸í•˜ëŠ” ìœ„ì¹˜</a>ê°€ ë‹¤ë¥´ë‹¤.</li><li><a href="https://docs.aws.amazon.com/ko_kr/sdk-for-java/latest/developer-guide/migration-imds.html#migration-imds-behavior-imdsv2">Java 2.xëŠ” IMDSv2ë§Œ ì§€ì›</a>í•˜ì§€ë§Œ Java 1.xëŠ” IMDSv2 ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì„ë•Œ IMDSv1 ìœ¼ë¡œë„ ì¡°íšŒí•œë‹¤.</li><li>Java 2.xëŠ” <a href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/instancedata-data-categories.html">ì¸ìŠ¤í„´ìŠ¤ ë©”íƒ€ë°ì´í„° ì¹´í…Œê³ ë¦¬</a>ë¥¼ ì§ì ‘ ëª…ì‹œí•´ì•¼í•œë‹¤.</li><li>Java 1.xëŠ” 2025ë…„ 12ì›” 31ì¼ <a href="https://aws.amazon.com/ko/blogs/developer/announcing-end-of-support-for-aws-sdk-for-java-v1-x-on-december-31-2025/">ì§€ì› ì¢…ë£Œ(End of support)</a>ëœë‹¤.</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;pre class=&quot;language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# IMDSv1&lt;/span&gt;
&lt;span class=&quot;token f</summary>
      
    
    
    
    
    <category term="IMDSv1" scheme="https://kdevkr.github.io/tags/IMDSv1/"/>
    
    <category term="IMDSv2" scheme="https://kdevkr.github.io/tags/IMDSv2/"/>
    
  </entry>
  
  <entry>
    <title>ìŠ¤í”„ë§ ë¶€íŠ¸ ë©”ì¼ í—¬ìŠ¤ì²´í¬ ìºì‹œí•˜ê¸°</title>
    <link href="https://kdevkr.github.io/spring-boot-mail-health-check/"/>
    <id>https://kdevkr.github.io/spring-boot-mail-health-check/</id>
    <published>2024-06-23T02:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.902Z</updated>
    
    <content type="html"><![CDATA[<p>í† ìŠ¤ì˜ <a href="https://toss.tech/article/how-to-work-health-check-in-spring-boot-actuator">Spring Boot Actuatorì˜ í—¬ìŠ¤ì²´í¬ ì‚´í´ë³´ê¸°</a>ë¼ëŠ” ê¸€ì„ ë³´ê³  ìŠ¤í”„ë§ ë¶€íŠ¸ ì•¡ì¶”ì—ì´í„°ì—ì„œ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ëŠ” MailHealthIndiatorì˜ í—¬ìŠ¤ ì²´í¬ ê²°ê³¼ë¥¼ ë³„ë„ë¡œ ìš”ì²­í•˜ëŠ” ê²½ìš° <code>management.endpoint.health.cache-time-to-live</code> ì†ì„±ìœ¼ë¡œ ìºì‹œë˜ì§€ ì•ŠìŒì„ í™•ì¸í–ˆë‹¤. í•´ë‹¹ ì†ì„±ì€ ì „ì²´ í—¬ìŠ¤ ì²´í¬ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ëŠ” í—¬ìŠ¤ ì—”ë“œí¬ì¸íŠ¸(&#x2F;actuator&#x2F;health)ì— í•´ë‹¹í•˜ëŠ” ìºì‹œ ì˜µì…˜ìœ¼ë¡œ ë©”ì¼ì— ëŒ€í•œ í—¬ìŠ¤ ì—”ë“œí¬ì¸íŠ¸(&#x2F;actuator&#x2F;health&#x2F;mail)ì— ëŒ€í•´ì„œëŠ” ì ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.</p><p>ìŠ¤í”„ë§ ë¶€íŠ¸ ì•¡ì¶”ì—ì´í„°ì˜ <a href="https://github.com/spring-projects/spring-boot/blob/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mail/MailHealthIndicator.java">MailHealthIndicator</a> ëŠ” JavaMailSenderImplì˜ testConnection í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ í—¬ìŠ¤ ì²´í¬ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ë„ë¡ ì‘ì„±ë˜ì–´ìˆë‹¤. MailHealthIndicatorë¼ëŠ” ì´ë¦„ìœ¼ë¡œ HealthIIndicatorë¥¼ êµ¬í˜„í•˜ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” MailHealthIndicator ëŒ€ì‹ ì— ë“±ë¡ë˜ë¯€ë¡œ SMTP ì„œë²„ë¡œì˜ ì—°ê²° ìˆ˜í–‰ ê²°ê³¼ë¥¼ ìºì‹œí•˜ì—¬ ì‘ë‹µí•˜ë„ë¡ ì‘ì„±í•´ë³¼ ìˆ˜ ìˆë‹¤.</p><h4 id="CachableMailHealthIndicator"><a href="#CachableMailHealthIndicator" class="headerlink" title="CachableMailHealthIndicator"></a>CachableMailHealthIndicator</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">Cache</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">CacheBuilder</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token class-name">InitializingBean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>health<span class="token punctuation">.</span></span><span class="token class-name">Health</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>mail<span class="token punctuation">.</span></span><span class="token class-name">MailHealthIndicator</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>mail<span class="token punctuation">.</span>javamail<span class="token punctuation">.</span></span><span class="token class-name">JavaMailSenderImpl</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Instant</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"mailHealthIndicator"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CachableMailHealthIndicator</span> <span class="token keyword">extends</span> <span class="token class-name">MailHealthIndicator</span> <span class="token keyword">implements</span> <span class="token class-name">InitializingBean</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Cache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Health</span><span class="token punctuation">></span></span> cache<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">CachableMailHealthIndicator</span><span class="token punctuation">(</span><span class="token class-name">JavaMailSenderImpl</span> javaMailSender<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>javaMailSender<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doHealthCheck</span><span class="token punctuation">(</span><span class="token class-name">Health<span class="token punctuation">.</span>Builder</span> builder<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Health</span> cached <span class="token operator">=</span> cache <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> cache<span class="token punctuation">.</span><span class="token function">getIfPresent</span><span class="token punctuation">(</span><span class="token string">"mail"</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cached <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            builder<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>cached<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withDetails</span><span class="token punctuation">(</span>cached<span class="token punctuation">.</span><span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">doHealthCheck</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            builder<span class="token punctuation">.</span><span class="token function">down</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cache <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Health</span> health <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">withDetail</span><span class="token punctuation">(</span><span class="token string">"datetime"</span><span class="token punctuation">,</span> <span class="token class-name">Instant</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"mail"</span><span class="token punctuation">,</span> health<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        cache <span class="token operator">=</span> <span class="token class-name">CacheBuilder</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">maximumSize</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">expireAfterWrite</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><img data-src="/images/posts/spring-boot-mail-health-check/01.png" alt="268ms â†’ 4ms"></p><blockquote><p>CacheableMailHealthIndicatorëŠ” í˜¸ìŠ¤íŠ¸ ì •ë³´ ë¿ë§Œ ì•„ë‹ˆë¼ <strong>ìºì‹œëœ ì‹œê°„</strong>ì„ í¬í•¨í•˜ì—¬ ì–¸ì œ ì¸¡ì •ëœ ê²°ê³¼ì¸ì§€ë„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;í† ìŠ¤ì˜ &lt;a href=&quot;https://toss.tech/article/how-to-work-health-check-in-spring-boot-actuator&quot;&gt;Spring Boot Actuatorì˜ í—¬ìŠ¤ì²´í¬ ì‚´í´ë³´ê¸°&lt;/a&gt;ë¼ëŠ” ê¸€ì„ ë³´ê³  ìŠ¤í”„ë§ </summary>
      
    
    
    
    
    <category term="Spring Boot Actuator" scheme="https://kdevkr.github.io/tags/Spring-Boot-Actuator/"/>
    
    <category term="MailHealthIndicator" scheme="https://kdevkr.github.io/tags/MailHealthIndicator/"/>
    
  </entry>
  
  <entry>
    <title>Redis Stream</title>
    <link href="https://kdevkr.github.io/spring-boot-data-redis-stream/"/>
    <id>https://kdevkr.github.io/spring-boot-data-redis-stream/</id>
    <published>2024-06-22T03:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.902Z</updated>
    
    <content type="html"><![CDATA[<p>ì†Œê·œëª¨ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì—ì„œ ë ˆë””ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì„ë•Œ RabbitMQ ë˜ëŠ” Apache Kafkaì™€ ê°™ì€ ë©”ì‹œì§€ íë¥¼ í†µí•´ ë¹„ë™ê¸° ì´ë²¤íŠ¸ì— ëŒ€í•œ ìš”êµ¬ê°€ í•„ìš”í•œ ê²½ìš° ë³„ë„ì˜ ë©”ì‹œì§€ í ì†”ë£¨ì…˜ì„ ë„ì…í•˜ëŠ” ê²ƒì€ ì¸í”„ë¼ ìƒ ê³¼ë„í•  ìˆ˜ë„ ìˆë‹¤. ì´ëŸ¬í•œ ê²½ìš° ë ˆë””ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” ìŠ¤íŠ¸ë¦¼ì„ ì‚¬ìš©í•˜ì—¬ ë©”ì‹œì§€ ê¸°ë°˜ì˜ í”„ë¡œê·¸ë˜ë°ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ”ë° ìŠ¤í”„ë§ ë¶€íŠ¸ ê¸°ë°˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì¸ ê²½ìš° <a href="https://spring.io/projects/spring-data-redis">Spring Data Redis</a>ì— <a href="https://docs.spring.io/spring-data/redis/reference/redis/redis-streams.html">ë ˆë””ìŠ¤ ìŠ¤íŠ¸ë¦¼ì— ëŒ€í•œ ê¸°ëŠ¥</a>ì„ í¬í•¨í•˜ê³  ìˆìœ¼ë¯€ë¡œ ì‰½ê²Œ ìŠ¤íŠ¸ë¦¼ì— ë©”ì‹œì§€ë¥¼ ë“±ë¡í•˜ê³  ì»¨ìŠˆë¨¸ë¥¼ ì¶”ê°€í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•˜ë„ë¡ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.</p><h4 id="ë©”ì‹œì§€-ì—†ëŠ”-ë¹ˆ-ìŠ¤íŠ¸ë¦¼-ìƒì„±í•˜ê¸°"><a href="#ë©”ì‹œì§€-ì—†ëŠ”-ë¹ˆ-ìŠ¤íŠ¸ë¦¼-ìƒì„±í•˜ê¸°" class="headerlink" title="ë©”ì‹œì§€ ì—†ëŠ” ë¹ˆ ìŠ¤íŠ¸ë¦¼ ìƒì„±í•˜ê¸°"></a>ë©”ì‹œì§€ ì—†ëŠ” ë¹ˆ ìŠ¤íŠ¸ë¦¼ ìƒì„±í•˜ê¸°</h4><pre class="language-bash" data-language="bash"><code class="language-bash">XGROUP CREATE stream_key group_name $ MKSTREAM</code></pre><p>ê¸°ë³¸ì ì¸ ë ˆë””ìŠ¤ ëª…ë ¹ì–´ë¡œëŠ” ìœ„ì™€ ê°™ì´ ì»¨ìŠˆë¨¸ ê·¸ë£¹ì„ ìƒì„±í•  ë•Œ MKSTREAM ì˜µì…˜ì„ ì§€ì •í•˜ì—¬ ìŠ¤íŠ¸ë¦¼ì´ ì¡´ì¬í•˜ì§€ ì•Šì€ ê²½ìš°ì— ìŠ¤íŠ¸ë¦¼ì´ ìë™ìœ¼ë¡œ ìƒì„±ë˜ë„ë¡ í•  ìˆ˜ ìˆë‹¤. Spring Data Redis ì—ì„œëŠ” RedisConnection ê³¼ RedisStreamCommands ì¸í„°í˜ì´ìŠ¤ì— xGroupCreate ë¼ëŠ” í•¨ìˆ˜ë¡œ ì •ì˜ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì•„ë˜ì™€ ê°™ì´ êµ¬í˜„í•˜ë©´ ëœë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> streamKey <span class="token operator">=</span> <span class="token string">"stream-1"</span><span class="token punctuation">;</span><span class="token class-name">String</span> groupName <span class="token operator">=</span> <span class="token string">"group-1"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span>streamKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    redisTemplate<span class="token punctuation">.</span><span class="token function">opsForStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createGroup</span><span class="token punctuation">(</span>streamKey<span class="token punctuation">,</span> <span class="token class-name">ReadOffset</span><span class="token punctuation">.</span><span class="token function">lastConsumed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> groupName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">RedisConnection</span> connection <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">getConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">RedisStreamCommands</span> streamCommands <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">streamCommands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    streamCommands<span class="token punctuation">.</span><span class="token function">xGroupCreate</span><span class="token punctuation">(</span>streamKey<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> groupName<span class="token punctuation">,</span> <span class="token class-name">ReadOffset</span><span class="token punctuation">.</span><span class="token function">latest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="StreamMessageListenerContainer"><a href="#StreamMessageListenerContainer" class="headerlink" title="StreamMessageListenerContainer"></a>StreamMessageListenerContainer</h4><p>StreamMessageListenerContainer ì™€ StreamListener ë¥¼ í™œìš©í•˜ë©´ RedisTemplate ìœ¼ë¡œ ìŠ¤íŠ¸ë¦¼ì„ ì§ì ‘ ì½ì§€ ì•Šì•„ë„ ë‹¤ì¤‘ ìŠ¤ë ˆë“œë¥¼ í†µí•´ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•˜ì—¬ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤. </p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">StreamMessageListenerContainer</span> messageListenerContainer <span class="token operator">=</span> <span class="token class-name">StreamMessageListenerContainer</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">getConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">StreamMessageListenerContainer<span class="token punctuation">.</span>StreamMessageListenerContainerOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">hashKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">hashValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Consumer</span> consumer <span class="token operator">=</span> <span class="token class-name">Consumer</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>groupName<span class="token punctuation">,</span> consumerName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">StreamOffset</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> streamOffset <span class="token operator">=</span> <span class="token class-name">StreamOffset</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>streamKey<span class="token punctuation">,</span> <span class="token class-name">ReadOffset</span><span class="token punctuation">.</span><span class="token function">lastConsumed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Subscription</span> subscription <span class="token operator">=</span> messageListenerContainer<span class="token punctuation">.</span><span class="token function">receiveAutoAck</span><span class="token punctuation">(</span>consumer<span class="token punctuation">,</span> streamOffset<span class="token punctuation">,</span> record <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>subscription<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>messageListenerContainer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ì†Œê·œëª¨ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì—ì„œ ë ˆë””ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì„ë•Œ RabbitMQ ë˜ëŠ” Apache Kafkaì™€ ê°™ì€ ë©”ì‹œì§€ íë¥¼ í†µí•´ ë¹„ë™ê¸° ì´ë²¤íŠ¸ì— ëŒ€í•œ ìš”êµ¬ê°€ í•„ìš”í•œ ê²½ìš° ë³„ë„ì˜ ë©”ì‹œì§€ í ì†”ë£¨ì…˜ì„ ë„ì…í•˜ëŠ” ê²ƒì€ ì¸í”„ë¼ ìƒ ê³¼ë„í•  ìˆ˜ë„ ìˆë‹¤. ì´ëŸ¬í•œ ê²½</summary>
      
    
    
    
    
    <category term="Redis Stream" scheme="https://kdevkr.github.io/tags/Redis-Stream/"/>
    
  </entry>
  
  <entry>
    <title>AWS RDS ìŠ¬ë¡œìš° ì¿¼ë¦¬ ë¡œê·¸ì˜ ì»¤ì„œ ì´ë¦„ ì´ìŠˆ</title>
    <link href="https://kdevkr.github.io/aws-rds-slow-query-with-cursor-name./"/>
    <id>https://kdevkr.github.io/aws-rds-slow-query-with-cursor-name./</id>
    <published>2024-06-20T13:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.894Z</updated>
    
    <content type="html"><![CDATA[<p><img data-src="/images/posts/aws-rds-slow-query-with-cursor-name/01.png"></p><p>ìœ„ ìŠ¤í¬ë¦°ìƒ·ì˜ 14ì‹œì™€ 15ì‹œ ì‚¬ì´ì— RDS ì˜ DB ì¸ìŠ¤í„´ìŠ¤ì˜ CPU ë¶€í•˜ê°€ 90% ì´ìƒì„ ì´ˆê³¼í–ˆë‹¤. ì´ëŸ¬í•œ ìƒí™©ì˜ ê²½ìš° ì–´ë–¤ í˜¸ìŠ¤íŠ¸ì—ì„œ ìˆ˜í–‰í•œ ì¿¼ë¦¬ê°€ ë¬¸ì œê°€ ë˜ê³  ìˆëŠ”ì§€ ì•Œê¸° ìœ„í•´ì„œ AWS Aurora PostgreSQLì˜ í´ëŸ¬ìŠ¤í„° ë˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ íŒŒë¼ë¯¸í„°ë¥¼ ë³€ê²½í•˜ì—¬ <a href="https://docs.aws.amazon.com/ko_kr/AmazonRDS/latest/AuroraUserGuide/USER_LogAccess.Concepts.PostgreSQL.html#USER_LogAccess.Concepts.PostgreSQL.Query_Logging">ì¿¼ë¦¬ ë¡œê¹…ì„ í™œì„±í™”</a>í•˜ê³  <a href="https://docs.aws.amazon.com/ko_kr/prescriptive-guidance/latest/tuning-postgresql-parameters/log-min-duration-statement.html">log_min_duration_statement</a>ì— ëŒ€í•œ ê°’ì„ ì§€ì •í•˜ë©´ í•´ë‹¹ ë°€ë¦¬ì´ˆë¥¼ ì´ˆê³¼í•˜ì—¬ ìˆ˜í–‰í•œ ì¿¼ë¦¬ì— ëŒ€í•œ duration ë¡œê·¸ë¥¼ ê¸°ë¡í•˜ê³  CloudWatchì˜ ë¡œê·¸ ì¸ì‚¬ì´íŠ¸ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p><h4 id="FETCH-ALL-IN-rcursor-ğŸ¤”"><a href="#FETCH-ALL-IN-rcursor-ğŸ¤”" class="headerlink" title="FETCH ALL IN &quot;rcursor&quot; ğŸ¤”"></a>FETCH ALL IN &quot;rcursor&quot; ğŸ¤”</h4><p><img data-src="/images/posts/aws-rds-slow-query-with-cursor-name/02.png"></p><p>RDS ì½˜ì†”ì˜ ì„±ëŠ¥ ê°œì„  ë„ìš°ë¯¸ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ë¡œë“œì™€ ìƒìœ„ SQL ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ”ë° ìœ„ì™€ ê°™ì´ FETCH ALL IN &quot;rcursor&quot; ê°€ ëŒ€ë¶€ë¶„ì˜ ë¡œë“œë¡œ ê¸°ë¡ë˜ì–´ìˆëŠ” ê±¸ ë³¼ ìˆ˜ ìˆë‹¤. ì‹¤ì œ SQLë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” ê²ƒë“¤ ì´ì™¸ì— <code>rcursor</code> ë€ ê²ƒì€ ë„ëŒ€ì²´ ë¬´ì—‡ì„ ì˜ë¯¸í•˜ëŠ” ê²ƒì¸ì§€ ì•Œì•„ì•¼í•  ê²ƒ ê°™ë‹¤. PL&#x2F;pgSQL í•¨ìˆ˜ë¥¼ ì‘ì„±í•  ë•Œ <a href="https://www.postgresql.org/docs/current/plpgsql-cursors.html">Cursor</a>ë¥¼ ì„ ì–¸í•˜ê³  ì¡°íšŒí•œ ê²°ê³¼ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì´ì•¼ê¸°í•˜ëŠ” í”„ë¡œì‹œì € í•¨ìˆ˜ë¥¼ ì˜ë¯¸í•˜ë©° ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©ì¤‘ì¸ ëŒ€ë¶€ë¶„ì˜ í•¨ìˆ˜ì˜ ì»¤ì„œ ì´ë¦„ì„ ë™ì¼í•˜ê²Œ ì§€ì •í•˜ì—¬ ì„ ì–¸í–ˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.</p><p>ê¸°ë³¸ì ìœ¼ë¡œ ì»¤ì„œ ì´ë¦„ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ìë™ìœ¼ë¡œ <code>&lt;unnamed cursor 1&gt;</code>ì™€ ê°™ì€ ëœë¤í•œ ì»¤ì„œê°€ ë§Œë“¤ì–´ì§€ê³  JDBC ì—ì„œ SQL í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ ê²°ê³¼ì—ì„œ ì»¤ì„œ ì´ë¦„ì„ êµ³ì´ ë™ì¼í•˜ê²Œ ì§€ì •í•  í•„ìš”ëŠ” ì—†ë‹¤. ë”°ë¼ì„œ, ì• í”Œë¦¬ì¼€ì´ì…˜ì€ í•¨ìˆ˜ ì •ì˜ ì‹œ ì–´ë–¤ ì´ë¦„ì˜ ì»¤ì„œë¥¼ ì‚¬ìš©í•˜ëŠ”ì§€ì— ëŒ€í•´ì„œëŠ” ìƒê´€í•˜ì§€ ì•Šìœ¼ë©° SQL í•¨ìˆ˜ë¥¼ ê´€ë¦¬í•˜ëŠ” ê°œë°œì í˜¹ì€ DBAê°€ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ì´ë¦„ì¼ ë¿ì´ë‹¤. ê·¸ë˜ì„œ ì‰½ê²Œ ê´€ë¦¬í•˜ì—¬ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í†µì¼í–ˆë˜ ê²ƒìœ¼ë¡œ ìƒê°ëœë‹¤.</p><h4 id="RDS-ëª¨ë‹ˆí„°ë§ì„-ìœ„í•œ-ì»¤ì„œ-ì´ë¦„ì„-ì‚¬ìš©í•˜ì„¸ìš”"><a href="#RDS-ëª¨ë‹ˆí„°ë§ì„-ìœ„í•œ-ì»¤ì„œ-ì´ë¦„ì„-ì‚¬ìš©í•˜ì„¸ìš”" class="headerlink" title="RDS ëª¨ë‹ˆí„°ë§ì„ ìœ„í•œ ì»¤ì„œ ì´ë¦„ì„ ì‚¬ìš©í•˜ì„¸ìš”."></a>RDS ëª¨ë‹ˆí„°ë§ì„ ìœ„í•œ ì»¤ì„œ ì´ë¦„ì„ ì‚¬ìš©í•˜ì„¸ìš”.</h4><p><img data-src="/images/posts/aws-rds-slow-query-with-cursor-name/03.png"></p><p>RDS ëª¨ë‹ˆí„°ë§ ë° ìŠ¬ë¡œìš° ì¿¼ë¦¬ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ ë™ì¼í•œ ì»¤ì„œ ì´ë¦„ì´ ì•„ë‹Œ SQL í•¨ìˆ˜ë³„ ë³„ë„ì˜ ì»¤ì„œ ì´ë¦„ì„ ì •ì˜í•˜ì—¬ êµ¬ë¶„í•˜ëŠ”ê²Œ í•„ìš”í•˜ë‹¤. SQL í•¨ìˆ˜ ì‘ì„± ì‹œ ì»¤ì„œ ì´ë¦„ì€ í•¨ìˆ˜ ì´ë¦„ê³¼ ë™ì¼í•˜ê²Œ í•˜ì—¬ ëª…í™•íˆ êµ¬ë¶„í•˜ê¸°ë¡œ í˜‘ì˜í–ˆê³  ìœ„ì™€ ê°™ì´ ì˜¤ë˜ ìˆ˜í–‰ë˜ëŠ” ìŠ¬ë¡œìš° ì¿¼ë¦¬ë¥¼ ì‰½ê²Œ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ê¸°ì¡´ì—ëŠ” ê°œë°œìê°€ ìŠ¬ë¡œìš° ì¿¼ë¦¬ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì— ë¡œê·¸ê°€ ì¶œë ¥ë˜ë„ë¡ í–ˆì§€ë§Œ ì´ì œëŠ” ê°œë°œì ë¿ë§Œ ì•„ë‹ˆë¼ DB í˜¹ì€ ì¸í”„ë¼ ì—”ì§€ë‹ˆì–´ë„ RDS ëª¨ë‹ˆí„°ë§ìœ¼ë¡œ ìŠ¬ë¡œìš° ì¿¼ë¦¬ êµ¬ë¶„ì´ ê°€ëŠ¥í•˜ë„ë¡ ë³€ê²½í•˜ê³  ìˆë‹¤.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ì—¬ëŸ¬ë¶„ì€ ì–´ë–¤ ì¿¼ë¦¬ê°€ 2ì´ˆë‚˜ ì†Œìš”ë¬ëŠ”ì§€ íŒŒì•…í•  ìˆ˜ ìˆë‚˜ìš”?</span>LOG:  duration: <span class="token number">2217.321</span> ms  execute <span class="token operator">&lt;</span>unnamed<span class="token operator">></span>: FETCH ALL IN <span class="token string">"rcursor"</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img data-src=&quot;/images/posts/aws-rds-slow-query-with-cursor-name/01.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;ìœ„ ìŠ¤í¬ë¦°ìƒ·ì˜ 14ì‹œì™€ 15ì‹œ ì‚¬ì´ì— RDS ì˜ DB ì¸ìŠ¤í„´ìŠ¤ì˜ CPU ë¶€í•˜ê°€ 90% ì´ìƒì„ ì´ˆê³¼í–ˆë‹¤</summary>
      
    
    
    
    
    <category term="AWS RDS" scheme="https://kdevkr.github.io/tags/AWS-RDS/"/>
    
    <category term="PostgreSQL" scheme="https://kdevkr.github.io/tags/PostgreSQL/"/>
    
    <category term="Cursor" scheme="https://kdevkr.github.io/tags/Cursor/"/>
    
  </entry>
  
  <entry>
    <title>ìë°” ë©”ì¼ ë°œì†¡ ì‹œ ì¥ì•  ì²˜ë¦¬</title>
    <link href="https://kdevkr.github.io/java-mail-sender-limits/"/>
    <id>https://kdevkr.github.io/java-mail-sender-limits/</id>
    <published>2024-06-16T11:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.898Z</updated>
    
    <content type="html"><![CDATA[<p>ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ ê¸°ë°˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì—ì„œëŠ” <code>JavaMailSenderImpl</code>ì„ ì‚¬ìš©í•˜ì—¬ ì‰½ê²Œ <a href="https://docs.spring.io/spring-framework/reference/integration/email.html">ì´ë©”ì¼</a>ì„ ë³´ë‚´ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë‚˜, ì´ë©”ì¼ ë°œì†¡ì— ëŒ€í•œ ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ì„ ì œê³µí•˜ë¯€ë¡œ ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ì— ë”°ë¥¸ ì¥ì•  ì²˜ë¦¬ì— ëŒ€í•´ì„œëŠ” ë³„ë„ë¡œ ê³ ë ¤í•´ì•¼í•  í•„ìš”ê°€ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìˆ˜ì˜ ìŠ¤ë ˆë“œë¡œ ì´ë©”ì¼ ëŒ€ê¸°ì—´ íë¥¼ ë¹ ë¥´ê²Œ ì†Œì§„í•œë‹¤ë©´ <a href="https://docs.aws.amazon.com/ko_kr/ses/latest/dg/manage-sending-quotas-errors.html">Amazon SES ê³„ì •ì˜ ë°œì‹  í• ë‹¹ëŸ‰ê³¼ ê´€ë ¨ëœ ì˜¤ë¥˜</a> ì¤‘ ì´ˆë‹¹ ì´ë©”ì¼ ìˆ˜ì— ëŒ€í•œ ì œí•œëŸ‰ì„ ë„˜ì–´ì„œëŠ” ê²½ìš° 454 Throttling failure: Maximum sending rate exceeded ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.</p><h4 id="ThreadPoolExecutorë¥¼-í†µí•œ-ë©”ì¼-ëŒ€ê¸°ì—´-í-ë³‘ë ¬-ì²˜ë¦¬"><a href="#ThreadPoolExecutorë¥¼-í†µí•œ-ë©”ì¼-ëŒ€ê¸°ì—´-í-ë³‘ë ¬-ì²˜ë¦¬" class="headerlink" title="ThreadPoolExecutorë¥¼ í†µí•œ ë©”ì¼ ëŒ€ê¸°ì—´ í ë³‘ë ¬ ì²˜ë¦¬"></a>ThreadPoolExecutorë¥¼ í†µí•œ ë©”ì¼ ëŒ€ê¸°ì—´ í ë³‘ë ¬ ì²˜ë¦¬</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MimeMessage</span><span class="token punctuation">></span></span> waitingQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">MimeMessage</span> message <span class="token operator">=</span> waitingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            javaMailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Mail-Thread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ìœ„ ì½”ë“œëŠ” ê°„ë‹¨í•˜ê²Œ ë©”ì¼ ëŒ€ê¸°ì—´ íë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì†Œì§„í•˜ëŠ” ë‹¨ì¼ ìŠ¤ë ˆë“œë¡œ ì´ë©”ì¼ì„ ë°œì†¡í•˜ëŠ” ì½”ë“œë¡œ ëŒ€ê¸°ì—´ íì— ìŒ“ì´ëŠ” ë©”ì¼ì˜ ìˆ˜ê°€ ë§ì•„ì§„ë‹¤ë©´ ThreadPoolExecutorë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì¼ ë°œì†¡ì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ ë³‘ë ¬ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤. ë©”ì¼ ë°œì†¡ ì²˜ë¦¬ë¥¼ ë³‘ë ¬ë¡œ ìˆ˜í–‰í•œë‹¤ë©´ SMTP ì„œë²„ì˜ ë°œì‹  í•œë„ì— ëŒ€í•´ì„œ ê³ ë ¤í•´ì•¼í•œë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> coreSize <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">ThreadFactory</span> threadFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setNameFormat</span><span class="token punctuation">(</span><span class="token string">"Mail-Thread-%d"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">ThreadPoolExecutor</span> executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>coreSize<span class="token punctuation">,</span> coreSize<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> threadFactory<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MimeMessage</span><span class="token punctuation">></span></span> waitingQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>waitingQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">MimeMessage</span> message <span class="token operator">=</span> waitingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                javaMailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Mail-Thread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="Spring-Retryë¥¼-í†µí•œ-ë©”ì¼-ë°œì†¡-ì‹¤íŒ¨-ì‹œ-ì¬ì‹œë„-ì „ëµ-Guide-to-Spring-Retry"><a href="#Spring-Retryë¥¼-í†µí•œ-ë©”ì¼-ë°œì†¡-ì‹¤íŒ¨-ì‹œ-ì¬ì‹œë„-ì „ëµ-Guide-to-Spring-Retry" class="headerlink" title="Spring Retryë¥¼ í†µí•œ ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ì „ëµ - Guide to Spring Retry"></a>Spring Retryë¥¼ í†µí•œ ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ì „ëµ - <a href="https://www.baeldung.com/spring-retry">Guide to Spring Retry</a></h4><p>ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ ê±´ì— ëŒ€í•´ì„œ Spring Retryë¥¼ í†µí•´ ì¬ì‹œë„ ë¡œì§ì„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. ë©”ì¼ ë°œì†¡ì„ ìœ„í•œ RetryTemplate êµ¬ì„± ì‹œ ì¬ì‹œë„ ì „ëµì„ êµ¬ì„±í•˜ê³  ë©”ì¼ì„ ë°œì†¡í•˜ëŠ” í•¨ìˆ˜ë¥¼ RetryTemplateë¡œ ê°ì‹¸ë©´ ëœë‹¤. context.getRetryCount() í•¨ìˆ˜ë¥¼ í†µí•´ ì¬ì‹œë„ íšŸìˆ˜ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">RetryTemplate</span> retryTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RetryTemplateBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">maxAttempts</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">exponentialBackoff</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10L</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">retryOn</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">MessagingException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">MailException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MimeMessage</span><span class="token punctuation">></span></span> waitingQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>waitingQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        retryTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>context <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">MimeMessage</span> message <span class="token operator">=</span> waitingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                javaMailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Mail-Thread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="Guava-RateLimiterë¥¼-í†µí•œ-ì´ˆë‹¹-ì´ë©”ì¼-ë°œì†¡-ì‹œë„-ì œí•œ-Quick-Guide-to-the-Guava-RateLimiter"><a href="#Guava-RateLimiterë¥¼-í†µí•œ-ì´ˆë‹¹-ì´ë©”ì¼-ë°œì†¡-ì‹œë„-ì œí•œ-Quick-Guide-to-the-Guava-RateLimiter" class="headerlink" title="Guava RateLimiterë¥¼ í†µí•œ ì´ˆë‹¹ ì´ë©”ì¼ ë°œì†¡ ì‹œë„ ì œí•œ - Quick Guide to the Guava RateLimiter"></a>Guava RateLimiterë¥¼ í†µí•œ ì´ˆë‹¹ ì´ë©”ì¼ ë°œì†¡ ì‹œë„ ì œí•œ - <a href="https://www.baeldung.com/guava-rate-limiter">Quick Guide to the Guava RateLimiter</a></h4><p>AWS SESì˜ ë°œì‹  í•œë„ ì¤‘ì—ëŠ” ì´ˆë‹¹ ë³´ë‚¼ ìˆ˜ ìˆëŠ” ì´ë©”ì¼ ìˆ˜ì— ëŒ€í•œ ì œí•œëŸ‰ì´ ìˆìœ¼ë¯€ë¡œ Guava RateLimiterë¥¼ í†µí•´ ì´ˆë‹¹ ì´ë©”ì¼ ë°œì†¡ ìˆ˜ë¥¼ ë„˜ì–´ì„œì§€ ì•Šë„ë¡ ë°©ì–´í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤. ë¬¼ë¡ , SMTP ì„œë²„ë¥¼ ë‹¤ìˆ˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì—ì„œë„ ì—°ê²°í•  ê°€ëŠ¥ì„±ì´ ìˆìœ¼ë¯€ë¡œ ë°œì‹  í• ë‹¹ëŸ‰ì— ëŒ€í•œ ëª¨ë‹ˆí„°ë§ ë° ë°œì‹  í•œë„ë¥¼ ë³„ë„ë¡œ ê´€ë¦¬í•  í•„ìš”ëŠ” ìˆë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">RateLimiter</span> rateLimiter <span class="token operator">=</span> <span class="token class-name">RateLimiter</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>waitingQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">boolean</span> acquire <span class="token operator">=</span> rateLimiter<span class="token punctuation">.</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>acquire<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">MimeMessage</span> message <span class="token operator">=</span> waitingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    javaMailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Mail-Thread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>Guava RateLimiterëŠ” ì´ˆë‹¹ í˜¸ì¶œì— ëŒ€í•œ ì œí•œë§Œ ê°€ëŠ¥í•˜ë¯€ë¡œ ë¶„ë‹¹ ì´ë©”ì¼ ë°œì†¡ì„ ì œí•œí•˜ê³  ì‹¶ë‹¤ë©´ Resilience4jì˜ RateLimiterë¥¼ ë„ì…í•´ì•¼í•©ë‹ˆë‹¤.</p></blockquote><h4 id="Resilience4j-CircuitBreakerë¥¼-í†µí•œ-ë©”ì¼-ë°œì†¡-ì¤‘ë‹¨-Guide-to-Resilience4j"><a href="#Resilience4j-CircuitBreakerë¥¼-í†µí•œ-ë©”ì¼-ë°œì†¡-ì¤‘ë‹¨-Guide-to-Resilience4j" class="headerlink" title="Resilience4j CircuitBreakerë¥¼ í†µí•œ ë©”ì¼ ë°œì†¡ ì¤‘ë‹¨ - Guide to Resilience4j"></a>Resilience4j CircuitBreakerë¥¼ í†µí•œ ë©”ì¼ ë°œì†¡ ì¤‘ë‹¨ - <a href="https://www.baeldung.com/resilience4j">Guide to Resilience4j</a></h4><p>SMTP ì„œë²„ì˜ ë°œì‹  í•œë„ ì œí•œì„ ë„˜ì–´ì„œëŠ” ê²½ìš°ì— ëŒ€í•œ ì¥ì•  ì²˜ë¦¬ë¥¼ ìœ„í•´ <a href="https://github.com/resilience4j/resilience4j">Resilience4j</a>ë¥¼ ë„ì…í•  ìˆ˜ ìˆë‹¤. í•˜ë£¨ë™ì•ˆ ë©”ì¼ì„ ë³´ë‚¼ ìˆ˜ ìˆëŠ” í• ë‹¹ëŸ‰ì„ ì´ˆê³¼í•˜ê±°ë‚˜ ì´ˆë‹¹ ë³´ë‚¼ ìˆ˜ ìˆëŠ” ì´ë©”ì¼ ìˆ˜ì— ì œí•œì´ ë˜ì—ˆë‹¤ë©´ ì¼ì • ì‹œê°„ë™ì•ˆ ì´ë©”ì¼ ë°œì†¡ì„ ì‹œë„í•˜ì§€ ì•Šë„ë¡ <code>CircuitBreaker</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¥ì•  ì „íŒŒ ë°©ì§€ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. AWS SESì˜ ë°œì‹  í•œë„ì¸ ì•„ë˜ì˜ ë‘ê°œ í•­ëª©ì— ëŒ€í•´ì„œ ì²˜ë¦¬ë¥¼ ê³ ë ¤í•˜ë„ë¡ í•˜ì.</p><ul><li>454 Throttling failure: Maximum sending rate exceeded (1ì´ˆë‹¹ ì´ë©”ì¼ ë°œì†¡ ìˆ˜ ì œí•œëŸ‰)</li><li>454 Throttling failure: Daily message quota exceeded (24ì‹œê°„ ë‹¹ ì´ë©”ì¼ ë°œì†¡ í• ë‹¹ëŸ‰)</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">CircuitBreaker</span> circuitBreaker <span class="token operator">=</span> <span class="token class-name">CircuitBreaker</span><span class="token punctuation">.</span><span class="token function">ofDefaults</span><span class="token punctuation">(</span><span class="token string">"MailSendingLimitExceeded"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">RateLimiter</span> rateLimiter <span class="token operator">=</span> <span class="token class-name">RateLimiter</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>waitingQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">boolean</span> permission <span class="token operator">=</span> circuitBreaker<span class="token punctuation">.</span><span class="token function">tryAcquirePermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        permission <span class="token operator">&amp;=</span> rateLimiter<span class="token punctuation">.</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>permission<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">MimeMessage</span> message <span class="token operator">=</span> waitingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    javaMailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">String</span> failReason <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>failReason <span class="token operator">!=</span> <span class="token keyword">null</span>                            <span class="token operator">&amp;&amp;</span> failReason<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"454 Throttling failure"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        circuitBreaker<span class="token punctuation">.</span><span class="token function">transitionToClosedState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>failReason<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Mail-Thread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="JavaMailSenderImplì€-ë§¤ë²ˆ-ì—°ê²°í•œë‹¤"><a href="#JavaMailSenderImplì€-ë§¤ë²ˆ-ì—°ê²°í•œë‹¤" class="headerlink" title="JavaMailSenderImplì€ ë§¤ë²ˆ ì—°ê²°í•œë‹¤?!"></a>JavaMailSenderImplì€ ë§¤ë²ˆ ì—°ê²°í•œë‹¤?!</h4><p>ì¼ë¶€ ì‹œìŠ¤í…œ í™˜ê²½ì—ì„œ AWS SESì˜ SMTP ì„œë²„ë¥¼ ë™ì¼í•œ ë¦¬ì „ì´ ì•„ë‹Œ ìƒë‹¹íˆ ë©€ë¦¬ ë–¨ì–´ì ¸ìˆëŠ” ë¦¬ì „ì— êµ¬ì„±ëœ SMTPë¥¼ í†µí•´ ë©”ì¼ ë°œì†¡ì„ ì‹œë„í•˜ëŠ” ê²½ìš° ì»¤ë„¥ì…˜ì— ëŒ€í•œ ì†Œìš” ì‹œê°„ì´ í¬ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, US East (Ohio) ë¦¬ì „ì˜ SMTP ì—”ë“œí¬ì¸íŠ¸ë¥¼ Asia Pacific (Seoul) ë¦¬ì „ì—ì„œ ì—°ê²°í•˜ëŠ” ê²½ìš° ì•½ 2ì´ˆ ì •ë„ì˜ ì‹œê°„ì´ ì†Œìš”ë˜ëŠ”ë° ë™ì¼í•œ ë¦¬ì „ì—ì„œ ì—°ê²°í•˜ë©´ ì•½ 100ms ê°€ ê±¸ë¦°ë‹¤. </p><p>JavaMailSenderImplì˜ connectTransport í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ testConnection ë˜ëŠ” doSend í•¨ìˆ˜ì—ì„œ ì—°ê²°ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆëŠ”ë° MimeMessage ëª©ë¡ì„ send í•¨ìˆ˜ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•  ë•Œ ì—°ê²°ì„ ìˆ˜í–‰í•˜ê³  í•´ì œí•˜ë¯€ë¡œ ì´ë©”ì¼ì„ í•˜ë‚˜ì”© ë³´ë‚´ë„ë¡ êµ¬í˜„í–ˆë‹¤ë©´ ì´ë©”ì¼ì„ ë³´ë‚¼ë•Œë§ˆë‹¤ ì—°ê²°ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ë‹¤.</p><pre class="language-java" data-language="java"><div class="caption"><span>JavaMailSenderImpl</span></div><code class="language-java"><span class="token keyword">protected</span> <span class="token class-name">Transport</span> <span class="token function">connectTransport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MessagingException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        username <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            password <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Transport</span> transport <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTransport</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    transport<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> transport<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><a href="https://www.simplejavamail.org/configuration.html#section-reusing-connections">SimpleJavaMailì˜ Batch Module</a>ì€ Transport ì—°ê²°ì— ëŒ€í•œ ì»¤ë„¥ì…˜ í’€ì„ ì‚¬ìš©í•œë‹¤ê³  ë˜ì–´ìˆìœ¼ë¯€ë¡œ SMTP ì„œë²„ë¡œì˜ ì—°ê²° ìˆ˜í–‰ì‹œê°„ì´ ì˜¤ë˜ê±¸ë¦°ë‹¤ë©´ Transport ì— ëŒ€í•œ ì»¤ë„¥ì…˜ í’€ì„ ì´ìš©í•´ë³´ëŠ” ê²ƒë„ ì¢‹ì€ ë°©ë²•ìœ¼ë¡œ ìƒê°ëœë‹¤.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ ê¸°ë°˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì—ì„œëŠ” &lt;code&gt;JavaMailSenderImpl&lt;/code&gt;ì„ ì‚¬ìš©í•˜ì—¬ ì‰½ê²Œ &lt;a href=&quot;https://docs.spring.io/spring-framework/reference/integratio</summary>
      
    
    
    
    
    <category term="JavaMailSenderImpl" scheme="https://kdevkr.github.io/tags/JavaMailSenderImpl/"/>
    
    <category term="Simple Email Service" scheme="https://kdevkr.github.io/tags/Simple-Email-Service/"/>
    
    <category term="Sending Limits" scheme="https://kdevkr.github.io/tags/Sending-Limits/"/>
    
  </entry>
  
  <entry>
    <title>AWS NLB ECDSA TLS ì˜¤í”„ë¡œë“œ</title>
    <link href="https://kdevkr.github.io/aws-nlb-tls-ecdsa/"/>
    <id>https://kdevkr.github.io/aws-nlb-tls-ecdsa/</id>
    <published>2024-05-25T14:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.894Z</updated>
    
    <content type="html"><![CDATA[<h4 id="AWS-ì¸ì¦ì„œ-ê´€ë ¨-íˆìŠ¤í† ë¦¬"><a href="#AWS-ì¸ì¦ì„œ-ê´€ë ¨-íˆìŠ¤í† ë¦¬" class="headerlink" title="AWS ì¸ì¦ì„œ ê´€ë ¨ íˆìŠ¤í† ë¦¬"></a>AWS ì¸ì¦ì„œ ê´€ë ¨ íˆìŠ¤í† ë¦¬</h4><ul><li><a href="https://aws.amazon.com/ko/about-aws/whats-new/2021/07/aws-certificate-manager-provides-expanded-usage-imported-ecdsa-rsa-certificates/">AWS Certificate Manager, ê°€ì ¸ì˜¨ ECDSA ë° RSA ì¸ì¦ì„œì˜ í™•ì¥ëœ ì‚¬ìš© ì œê³µ</a></li><li><a href="https://aws.amazon.com/ko/about-aws/whats-new/2022/11/aws-certificate-manager-elliptic-curve-digital-signature-algorithm-tls-certificates/">AWS Certificate Manager, ì´ì œ Elliptic Curve Digital Signature Algorithm TLS ì¸ì¦ì„œ ì§€ì›</a></li><li><a href="https://aws.amazon.com/ko/about-aws/whats-new/2024/01/network-load-balancer-rsa-3072-bit-ecdsa-256-384-521-bit-certificates/">Network Load Balancer, ì´ì œ AWS Certificate Managerë¥¼ í†µí•œ RSA 3072-ë¹„íŠ¸, ECDSA 256&#x2F;384&#x2F;521-ë¹„íŠ¸ ì¸ì¦ì„œ ì§€ì›</a></li></ul><p>ìœ„ ê¸°ë¡ì²˜ëŸ¼ 2021ë…„ 7ì›” ë¶€í„° AWS Certificate Managerì—ì„œ ì™¸ë¶€ì—ì„œ ë°œê¸‰ëœ ECDSA ì¸ì¦ì„œë¥¼ ê°€ì ¸ì™€ì„œ ë“±ë¡í•  ìˆ˜ ìˆê²Œ ì§€ì›í•˜ì˜€ê³  2022ë…„ 11ì›” ë¶€í„°ëŠ” ACM ìì²´ì ìœ¼ë¡œ ECDSA ì¸ì¦ì„œ ë°œê¸‰ì„ ì§€ì›í•œë‹¤. ê·¸ë¦¬ê³  ì‹œê°„ì´ í˜ëŸ¬ 2024ë…„ 1ì›”ë¶€í„°ëŠ” <a href="https://aws.amazon.com/ko/about-aws/whats-new/2024/01/network-load-balancer-rsa-3072-bit-ecdsa-256-384-521-bit-certificates/">Network Load Balancer ì—ì„œë„ ECDSA ì¸ì¦ì„œ ë“±ë¡ì„ ì§€ì›</a>í•œë‹¤.</p><p><img data-src="/images/posts/aws-nlb-tls-ecdsa/01.png"></p><blockquote><p>ìœ„ í™”ë©´ì€ ACM ì™¸ë¶€ì—ì„œ ë°œê¸‰ëœ ECDSA ì¸ì¦ì„œë¥¼ ê°€ì ¸ì˜¨ ì˜ˆì‹œë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.</p></blockquote><h4 id="Network-Load-Balancer-TLS-ë¦¬ìŠ¤ë„ˆ-êµ¬ì„±"><a href="#Network-Load-Balancer-TLS-ë¦¬ìŠ¤ë„ˆ-êµ¬ì„±" class="headerlink" title="Network Load Balancer TLS ë¦¬ìŠ¤ë„ˆ êµ¬ì„±"></a>Network Load Balancer TLS ë¦¬ìŠ¤ë„ˆ êµ¬ì„±</h4><p>ê·¸ë™ì•ˆ ELB ì—ì„œ ECDSA ì¸ì¦ì„œë¡œ TLS ì˜¤í”„ë¡œë“œë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œëŠ” ì˜¤ì§ ALB(Application Load Balancer)ë¥¼ êµ¬ì„±í•´ì•¼í–ˆë‹¤. ì´ì œëŠ” <code>NLB(Network Load Balancer)</code>ë¡œ êµ¬ì„±í•˜ê³  <a href="https://docs.aws.amazon.com/ko_kr/elasticloadbalancing/latest/network/create-tls-listener.html">TLS ë¦¬ìŠ¤ë„ˆ</a>ì—ì„œ ACMì— ì¶”ê°€ë˜ì–´ìˆëŠ” <code>ECDSA ì¸ì¦ì„œ</code>ë¥¼ ì„ íƒí•˜ì—¬ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.</p><p><img data-src="/images/posts/aws-nlb-tls-ecdsa/02.png"></p><blockquote><p>í•˜ì§€ë§Œ, NLBê°€ TLS ë¦¬ìŠ¤ë„ˆë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° mTLSëŠ” ì§€ì›í•˜ì§€ ëª»í•˜ëŠ” êµ¬ì„±ì´ ë˜ëŠ” ê²ƒì€ ì¼ë¶€ ì‹œìŠ¤í…œì—ì„œ ì¤‘ìš”í•œ ë¶€ë¶„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></blockquote><h4 id="ëŒ€ìƒ-ê·¸ë£¹-í”„ë¡ì‹œ-í”„ë¡œí† ì½œ-v2"><a href="#ëŒ€ìƒ-ê·¸ë£¹-í”„ë¡ì‹œ-í”„ë¡œí† ì½œ-v2" class="headerlink" title="ëŒ€ìƒ ê·¸ë£¹ - í”„ë¡ì‹œ í”„ë¡œí† ì½œ v2"></a>ëŒ€ìƒ ê·¸ë£¹ - í”„ë¡ì‹œ í”„ë¡œí† ì½œ v2</h4><p>NLB ëŠ” ALBì™€ëŠ” ë‹¤ë¥´ê²Œ L4 ë ˆë²¨ë¡œ ë™ì‘í•˜ë¯€ë¡œ HTTP íŠ¸ë˜í”½ì„ HTTPSë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ëŠ” ê²ƒì„ ì§€ì›í•˜ì§€ ëª»í•œë‹¤. ChatGPTì—ê²Œ ë¬¼ì–´ë³´ë”ë¼ë„ TCP ë¦¬ìŠ¤ë„ˆë¡œ êµ¬ì„±í•˜ê³  Nginxì™€ ê°™ì€ ë³„ë„ì˜ ë¡œë“œë°¸ëŸ°ì„œì—ì„œ TLS ì˜¤í”„ë¡œë“œë¥¼ ì²˜ë¦¬í•¨ê³¼ ë™ì‹œì— <code>Forward http to https</code> ë¥¼ ì ìš©í•˜ëŠ” ì˜ˆì‹œë¥¼ ì„¤ëª…í•œë‹¤.</p><p>ì‚¬ë‚´ ì—”ì§€ë‹ˆì–´ì™€ ì‚½ì§ˆì„ í•´ë³¸ê²°ê³¼ ë¡œë“œ ë°¸ëŸ°ì„œì— ì—°ê²°ë˜ëŠ” ëŒ€ìƒ ê·¸ë£¹ì—ì„œ <code>í”„ë¡ì‹œ í”„ë¡œí† ì½œ v2</code>ë¥¼ í™œì„±í™”í•˜ë©´ Elastic Beanstalkì˜ Nginx í”Œë«í¼ì—ì„œ <a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/using-proxy-protocol/">PROXY Protocol</a>ì„ í†µí•´ <code>$proxy_protocol_server_port</code> ì†ì„±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒì„ í™•ì¸í–ˆë‹¤. ë” ë‚˜ì•„ê°€ì„œëŠ” <code>$proxy_protocol_addr</code> ì†ì„±ìœ¼ë¡œ ì‹¤ì œë¡œ íŠ¸ë˜í”½ì„ ì „ë‹¬í•œ <code>í´ë¼ì´ì–¸íŠ¸ IP</code>ë¥¼ ì•¡ì„¸ìŠ¤ ë¡œê·¸ì— ì¶œë ¥í•˜ê±°ë‚˜ <code>X-Forwarded-For</code> í—¤ë”ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ê¹Œì§€ ì „ë‹¬í•  ìˆ˜ ìˆì–´ë³´ì¸ë‹¤.</p><p><img data-src="/images/posts/aws-nlb-tls-ecdsa/03.png"></p><pre class="language-conf" data-language="conf"><code class="language-conf">http &#123;    server &#123;        listen 80 proxy_protocol;        if ($proxy_protocol_server_port &#x3D; 80) &#123;            return 301 https:&#x2F;&#x2F;$host$request_uri;        &#125;    &#125;&#125;</code></pre><blockquote><p>NLB ì—ì„œ Nginxë¡œ ì „ë‹¬í•  ë•Œ ì‚¬ìš©í•œ í¬íŠ¸ê°€ 80 ì´ë¼ë©´ HTTP ìš”ì²­ìœ¼ë¡œ ê°„ì£¼í•˜ê³  HTTPS ìš”ì²­ìœ¼ë¡œ ì „ë‹¬ë  ìˆ˜ ìˆë„ë¡ 301 ì‘ë‹µì„ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;AWS-ì¸ì¦ì„œ-ê´€ë ¨-íˆìŠ¤í† ë¦¬&quot;&gt;&lt;a href=&quot;#AWS-ì¸ì¦ì„œ-ê´€ë ¨-íˆìŠ¤í† ë¦¬&quot; class=&quot;headerlink&quot; title=&quot;AWS ì¸ì¦ì„œ ê´€ë ¨ íˆìŠ¤í† ë¦¬&quot;&gt;&lt;/a&gt;AWS ì¸ì¦ì„œ ê´€ë ¨ íˆìŠ¤í† ë¦¬&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;htt</summary>
      
    
    
    
    
    <category term="AWS NLB" scheme="https://kdevkr.github.io/tags/AWS-NLB/"/>
    
    <category term="ECDSA" scheme="https://kdevkr.github.io/tags/ECDSA/"/>
    
  </entry>
  
  <entry>
    <title>ì  í‚¨ìŠ¤ ë„ì»¤ ë©€í‹° í”Œë«í¼ ë¹Œë“œ</title>
    <link href="https://kdevkr.github.io/jenkins-docker-buildx/"/>
    <id>https://kdevkr.github.io/jenkins-docker-buildx/</id>
    <published>2024-05-24T11:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.898Z</updated>
    
    <content type="html"><![CDATA[<p>ì  í‚¨ìŠ¤ì—ì„œ Docker Plugin ì„ ì‚¬ìš©í•´ì„œ Dockerfileì„ í†µí•´ ì‰½ê²Œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•  ìˆ˜ ìˆë‹¤. ì•„ë§ˆì¡´ ì›¹ ì„œë¹„ìŠ¤ì™€ ê°™ì€ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ì—ì„œëŠ” x86_64(AMD64) ì•„í‚¤í…ì²˜ ë¿ë§Œ ì•„ë‹ˆë¼ ARM64 ì•„í‚¤í…ì²˜ ê¸°ë°˜ì˜ ë” ì €ë ´í•˜ê³  ì„±ëŠ¥ì´ ì¢‹ì€ ì„œë²„ë¥¼ í™œìš©í•  ìˆ˜ ìˆë‹¤. ê¸°ë³¸ì ì¸ ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ ëª…ë ¹ì–´ëŠ” ë¹Œë“œë¥¼ ì‹œë„í•˜ëŠ” ì„œë²„ì™€ ë™ì¼í•œ ì•„í‚¤í…ì²˜ì— ëŒ€í•œ ì´ë¯¸ì§€ë§Œ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë¯€ë¡œ <a href="https://docs.docker.com/build/building/multi-platform/">ë©€í‹° í”Œë«í¼ ì´ë¯¸ì§€</a>ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” <a href="https://docs.docker.com/reference/cli/docker/buildx/">Buildkit</a>ì„ ì´ìš©í•´ì•¼í•œë‹¤.</p><h4 id="Jenkins-ì‚¬ìš©ì-ë„ì»¤-ê·¸ë£¹ì—-ì¶”ê°€"><a href="#Jenkins-ì‚¬ìš©ì-ë„ì»¤-ê·¸ë£¹ì—-ì¶”ê°€" class="headerlink" title="Jenkins ì‚¬ìš©ì ë„ì»¤ ê·¸ë£¹ì— ì¶”ê°€"></a>Jenkins ì‚¬ìš©ì ë„ì»¤ ê·¸ë£¹ì— ì¶”ê°€</h4><p>ì  í‚¨ìŠ¤ê°€ ì„¤ì¹˜ëœ ì„œë²„ì— ì‹¤í–‰ë˜ì–´ìˆëŠ” ë„ì»¤ ì—”ì§„ìœ¼ë¡œ ë¹Œë“œí•  ìˆ˜ ìˆë„ë¡ ë„ì»¤ ê·¸ë£¹ì— ì  í‚¨ìŠ¤ ì‚¬ìš©ìë¥¼ í¬í•¨ì‹œì¼œì•¼í•œë‹¤. ì  í‚¨ìŠ¤ ì‚¬ìš©ìë¥¼ ë„ì»¤ ê·¸ë£¹ì— ì¶”ê°€í•˜ê³ ë‚˜ì„œëŠ” ë„ì»¤ì™€ ì  í‚¨ìŠ¤ ëª¨ë‘ ì¬ì‹¤í–‰ì„ ìˆ˜í–‰í•˜ì—¬ì•¼ í•œë‹¤.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">usermod</span> <span class="token parameter variable">-aG</span> <span class="token function">docker</span> jenkins<span class="token function">sudo</span> systemctl restart jenkins<span class="token function">sudo</span> systemctl restart <span class="token function">docker</span></code></pre><h4 id="QEMU-ì„¤ì¹˜"><a href="#QEMU-ì„¤ì¹˜" class="headerlink" title="QEMU ì„¤ì¹˜"></a>QEMU ì„¤ì¹˜</h4><p>ìœˆë„ìš°ì™€ ë§¥ í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë„ì»¤ ë°ìŠ¤í¬íƒ‘ì—ëŠ” QEMU ì„ í¬í•¨í•˜ê³  ìˆì–´ ì‰½ê²Œ ë©€í‹° í”Œë«í¼ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œ ì  í‚¨ìŠ¤ë¥¼ ì„¤ì¹˜í•˜ëŠ” ë¦¬ëˆ…ìŠ¤ ì„œë²„ì—ì„œëŠ” <a href="https://docs.docker.com/build/building/multi-platform/#qemu-without-docker-desktop">QEMU</a>ì˜ ë„ì›€ì„ ë°›ê¸° ìœ„í•´ì„œ ì§ì ‘ ì„¤ì¹˜í•´ì•¼í•œë‹¤.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--privileged</span> <span class="token parameter variable">--rm</span> tonistiigi/binfmt <span class="token parameter variable">--install</span> all</code></pre><h4 id="Docker-Build-Cloud-ë¥¼-ë¹Œë”ë¡œ-ì´ìš©í•˜ê¸°"><a href="#Docker-Build-Cloud-ë¥¼-ë¹Œë”ë¡œ-ì´ìš©í•˜ê¸°" class="headerlink" title="Docker Build Cloud ë¥¼ ë¹Œë”ë¡œ ì´ìš©í•˜ê¸°"></a>Docker Build Cloud ë¥¼ ë¹Œë”ë¡œ ì´ìš©í•˜ê¸°</h4><p><a href="https://docs.docker.com/build/cloud/">Docker Build Cloud</a>ë¥¼ ì´ìš©í•˜ì—¬ ë¹Œë“œí•˜ê¸° ìœ„í•´ì„œëŠ” cloud ë“œë¼ì´ë²„ë¥¼ ì§€ì›í•˜ëŠ” buildx ë²„ì „ì„ ì„¤ì¹˜í•´ì•¼í•œë‹¤. <a href="https://github.com/docker/buildx-desktop">buildx-desktop</a> ì—ì„œ ë¦¬ëˆ…ìŠ¤ ì„œë²„ì— ë§ëŠ” ë°”ì´ë„ˆë¦¬ íŒŒì¼ì„ ë‹¤ìš´ë°›ì•„ì„œ ì  í‚¨ìŠ¤ ê³„ì •ì—ì„œ ë°”ë¼ë³´ëŠ” ë„ì»¤ ê²½ë¡œì— docker-buildx í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ ì¶”ê°€í•˜ì.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ì  í‚¨ìŠ¤ ì‚¬ìš©ìë¡œ ì „í™˜</span><span class="token function">sudo</span> <span class="token function">su</span> jenkins <span class="token parameter variable">-s</span> /bin/bash<span class="token comment"># cloud ë“œë¼ì´ë²„ë¥¼ ì§€ì›í•˜ëŠ” Buildx ì„¤ì¹˜</span><span class="token function">wget</span> https://github.com/docker/buildx-desktop/releases/download/v0.14.0-desktop.1/buildx-v0.14.0-desktop.1.linux-amd64<span class="token function">mv</span> buildx-v0.14.0-desktop.1.linux-amd64 ~/docker/cli-plugins/docker-buildx<span class="token function">chmod</span> a+x ~/.docker/cli-plugins/docker-buildx<span class="token comment"># Buildx ë²„ì „ í™•ì¸</span><span class="token function">docker</span> buildx versiongithub.com/docker/buildx v0.14.0-desktop.1 7b0470cffd54ccbf42976d2f75febc4532c85073<span class="token comment"># Docker Build Cloud ë¹Œë” ì¶”ê°€</span><span class="token function">docker</span> buildx create <span class="token parameter variable">--driver</span> xxxinc/builder <span class="token parameter variable">--use</span><span class="token function">docker</span> buildx <span class="token function">ls</span>NAME/NODE               DRIVER/ENDPOINT                          STATUS    BUILDKIT       PLATFORMScloud-eipgridinc-ddd*   cloud <span class="token punctuation">\</span>_ linux-amd64          <span class="token punctuation">\</span>_ cloud://xxxinc/builder_linux-amd64   running   v0.13.1        linux/amd64*, linux/amd64/v2, linux/amd64/v3, linux/amd64/v4, linux/386 <span class="token punctuation">\</span>_ linux-arm64          <span class="token punctuation">\</span>_ cloud://xxxinc/builder_linux-arm64   running   v0.13.1        linux/arm64*, linux/arm64/v6, linux/arm64/v7default                 <span class="token function">docker</span> <span class="token punctuation">\</span>_ default              <span class="token punctuation">\</span>_ default                              running   v0.8+unknown   linux/amd64, linux/arm64, linux/riscv64, linux/ppc64le, linux/s390x, linux/386, linux/arm/v7, linux/arm/v6</code></pre><blockquote><p>Docker Build Cloud í™˜ê²½ì—ì„œ ë¹Œë“œí•˜ë¯€ë¡œ â€“bootstrap ì˜µì…˜ìœ¼ë¡œ ë¹Œë” ì´ˆê¸°í™”ë¥¼ ìˆ˜í–‰í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.</p></blockquote><h4 id="Jenkins-ì—ì„œ-ë¹Œë“œí•˜ê¸°"><a href="#Jenkins-ì—ì„œ-ë¹Œë“œí•˜ê¸°" class="headerlink" title="Jenkins ì—ì„œ ë¹Œë“œí•˜ê¸°"></a>Jenkins ì—ì„œ ë¹Œë“œí•˜ê¸°</h4><p>Docker Plugin ì—ì„œëŠ” buildx ëª…ë ¹ì–´ë¥¼ ì„ íƒí•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— Execute Shell ì„ ì„ íƒí•´ì„œ ì§ì ‘ buildx ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•´ì•¼í•œë‹¤. ì•„ë˜ì˜ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë„ì»¤ ê³„ì •ì— ë¡œê·¸ì¸í•˜ê¸° ìœ„í•´ì„œ ì  í‚¨ìŠ¤ ì‚¬ìš©ìì˜ config.json ì„ ì´ìš©í•˜ê²Œ í–ˆë‹¤.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Log in to Docker Hub</span><span class="token builtin class-name">echo</span> <span class="token string">"Logging into Docker Hub..."</span><span class="token function">docker</span> login<span class="token assign-left variable">BUILDER_NAME</span><span class="token operator">=</span><span class="token string">"cloud-xxxinc-builder"</span><span class="token comment"># Check if the builder already exists</span><span class="token assign-left variable">BUILDER_EXISTS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> buildx <span class="token function">ls</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"<span class="token variable">$BUILDER_NAME</span>"</span> <span class="token operator">||</span> <span class="token boolean">true</span><span class="token variable">)</span></span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$BUILDER_EXISTS</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token builtin class-name">echo</span> <span class="token string">"Creating new builder instance..."</span>  <span class="token function">docker</span> buildx create <span class="token parameter variable">--name</span> <span class="token string">"<span class="token variable">$BUILDER_NAME</span>"</span> <span class="token parameter variable">--driver</span> cloud xxxinc/builder <span class="token parameter variable">--use</span><span class="token keyword">else</span>  <span class="token builtin class-name">echo</span> <span class="token string">"Using existing builder instance..."</span>  <span class="token function">docker</span> buildx use <span class="token string">"<span class="token variable">$BUILDER_NAME</span>"</span><span class="token keyword">fi</span><span class="token comment"># List the builder instances</span><span class="token function">docker</span> buildx <span class="token function">ls</span><span class="token comment"># Install QEMU emulators for building multi-architecture images</span><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> <span class="token parameter variable">--privileged</span> tonistiigi/binfmt <span class="token parameter variable">--install</span> all<span class="token comment"># build</span><span class="token builtin class-name">echo</span> <span class="token string">"Building Docker image using Buildx with Docker Build Cloud..."</span><span class="token function">docker</span> buildx build <span class="token parameter variable">--platform</span> linux/amd64,linux/arm64 <span class="token parameter variable">-t</span> xxxinc/testapp:<span class="token variable">$&#123;version&#125;</span>-buildx <span class="token parameter variable">--push</span> <span class="token builtin class-name">.</span></code></pre><h4 id="Optional-HDF5-for-ARM64"><a href="#Optional-HDF5-for-ARM64" class="headerlink" title="(Optional) HDF5 for ARM64"></a>(Optional) HDF5 for ARM64</h4><p>ARM64 ì•„í‚¤í…ì²˜ë¡œ ë¹Œë“œí•˜ëŠ” ê²½ìš°ì—ë§Œ <code>ValueError: did not find HDF5 headers</code> ê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ ê²½í—˜í–ˆë‹¤. ê²€ìƒ‰ ê²°ê³¼ ì•„ë˜ì˜ ì„¸ê°œì˜ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ëŠ” ê²ƒìœ¼ë¡œ í•´ê²°ì´ ë˜ì—ˆë‹¤.</p><ul><li>libhdf5-serial-dev</li><li>netcdf-bin</li><li>libnetcdf-dev</li></ul><pre class="language-docker" data-language="docker"><div class="caption"><span>Dockerfile</span></div><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> python:3.8-slim-buster</span><span class="token instruction"><span class="token keyword">RUN</span> apt-get update &amp;&amp; apt-get install -y <span class="token operator">\</span>    gcc  <span class="token operator">\</span>    libpq-dev <span class="token operator">\</span>    libhdf5-serial-dev <span class="token operator">\</span>    netcdf-bin \ </span>    libnetcdf-dev</code></pre><h4 id="ë¬¸ì œ-í•´ê²°ì—-ë„ì›€ì´-ëœ-ê¸€"><a href="#ë¬¸ì œ-í•´ê²°ì—-ë„ì›€ì´-ëœ-ê¸€" class="headerlink" title="ë¬¸ì œ í•´ê²°ì— ë„ì›€ì´ ëœ ê¸€"></a>ë¬¸ì œ í•´ê²°ì— ë„ì›€ì´ ëœ ê¸€</h4><ul><li><a href="https://hotfoxy.tistory.com/114">jenkins(image) ì—ì„œ docker buildxë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ì–´ìš”!</a></li><li><a href="https://forums.docker.com/t/docker-buildx-failed-to-find-driver-cloud/141238/4">Docker buildx â€œfailed to find driverâ€</a></li><li><a href="https://stackoverflow.com/a/36165209">https://stackoverflow.com/a/36165209</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ì  í‚¨ìŠ¤ì—ì„œ Docker Plugin ì„ ì‚¬ìš©í•´ì„œ Dockerfileì„ í†µí•´ ì‰½ê²Œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•  ìˆ˜ ìˆë‹¤. ì•„ë§ˆì¡´ ì›¹ ì„œë¹„ìŠ¤ì™€ ê°™ì€ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ì—ì„œëŠ” x86_64(AMD64) ì•„í‚¤í…ì²˜ ë¿ë§Œ ì•„ë‹ˆë¼ ARM64 ì•„í‚¤í…ì²˜ ê¸°ë°˜ì˜ ë” ì €ë ´í•˜ê³  </summary>
      
    
    
    
    
    <category term="Jenkins" scheme="https://kdevkr.github.io/tags/Jenkins/"/>
    
    <category term="Docker" scheme="https://kdevkr.github.io/tags/Docker/"/>
    
    <category term="Buildx" scheme="https://kdevkr.github.io/tags/Buildx/"/>
    
  </entry>
  
  <entry>
    <title>ìŠ¤í”„ë§ ì‹œíë¦¬í‹° JWT ì‚¬ìš©ì í…ŒìŠ¤íŠ¸</title>
    <link href="https://kdevkr.github.io/spring-security-jwt-user-test/"/>
    <id>https://kdevkr.github.io/spring-security-jwt-user-test/</id>
    <published>2024-03-27T12:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.902Z</updated>
    
    <content type="html"><![CDATA[<p>JWT ê¸°ë°˜ì˜ ì¸ì¦ì„ êµ¬ì„±í•œ í”„ë¡œì íŠ¸ì—ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œì— ëŒ€í•œ ì‚¬ìš©ìë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„œ <code>WithSecurityContext</code> ì™€ <code>WithSecurityContextFactory</code> ë¥¼ ì‚¬ìš©í•´ì„œ ê°€ìƒì˜ ì‚¬ìš©ìì™€ í† í°ì„ ë°œê¸‰í•˜ëŠ” ì½”ë“œë¥¼ êµ¬í˜„í•˜ë©´ ë˜ëŠ” ê²ƒìœ¼ë¡œ ì•Œë ¤ì ¸ ìˆë‹¤. í•˜ì§€ë§Œ, ì‹ ê·œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ë‹¨ì¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì•„ë‹Œ ì¸ì¦ì˜ ê¸°ë°˜ì´ ë˜ëŠ” ì™¸ë¶€ í”Œë«í¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ìš”ì²­í•˜ì—¬ ì¸ì¦ì„ ìˆ˜í–‰í•˜ê³  ê¶Œí•œì„ ì²˜ë¦¬í•˜ë„ë¡ ë¡œì§ì„ êµ¬ì„±í•˜ì—¬ ë‹¨ìˆœíˆ <strong>ê°€ìƒì˜ ì‚¬ìš©ìê°€ ì•„ë‹Œ ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìë¡œ ì¸ì¦í•  ìˆ˜ ìˆëŠ” ì»¨í…ìŠ¤íŠ¸</strong>ë¥¼ ë§Œë“¤ì–´ì•¼ í–ˆë‹¤. ì‚¬ìš©ì í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì ìš©í•˜ê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í–ˆë‹¤.</p><pre class="language-java" data-language="java"><div class="caption"><span>WithMockUser</span></div><code class="language-java"><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span><span class="token annotation punctuation">@WithSecurityContext</span><span class="token punctuation">(</span>factory <span class="token operator">=</span> <span class="token class-name">WithMockUserSecurityContextFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">WithMockUser</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"kdevkr@gmail.com"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><div class="caption"><span>WithMockUserSecurityContextFactory</span></div><code class="language-java"><span class="token annotation punctuation">@RequiredArgsConstructor</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WithMockUserSecurityContextFactory</span> <span class="token keyword">implements</span> <span class="token class-name">WithSecurityContextFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WithMockUser</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JwtTokenProvider</span> jwtTokenProvider<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">SecurityContext</span> <span class="token function">createSecurityContext</span><span class="token punctuation">(</span><span class="token class-name">WithMockUser</span> mockUser<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SecurityContext</span> context <span class="token operator">=</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">createEmptyContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> optionalUser <span class="token operator">=</span> <span class="token function">getUserById</span><span class="token punctuation">(</span>mockUser<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>optionalUser<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">User</span> user <span class="token operator">=</span> optionalUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JwtToken</span><span class="token punctuation">></span></span> token <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">String</span> accessToken <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Authentication</span> authentication <span class="token operator">=</span> jwtTokenProvider<span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span>accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>                context<span class="token punctuation">.</span><span class="token function">setAuthentication</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> context<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="No-thread-bound-request-found"><a href="#No-thread-bound-request-found" class="headerlink" title="No thread-bound request found"></a>No thread-bound request found</h4><blockquote><p>java.lang.IllegalStateException: No thread-bound request found: Are you referring to request attributes outside of an actual web request, or processing a request outside of the originally receiving thread? If you are actually operating within a web request and still receive this message, your code is probably running outside of DispatcherServlet: In this case, use RequestContextListener or RequestContextFilter to expose the current request.</p></blockquote><p>ì„œë¹„ìŠ¤ ë ˆì´ì–´ì˜ í´ë˜ìŠ¤ì—ì„œ ìš”ì²­ ìŠ¤ë ˆë“œì—ì„œ í† í° ì •ë³´ë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•´ <code>RequestContextHolder</code> ë¥¼ ì‚¬ìš©í•˜ì—¬ í˜„ì¬ ìš”ì²­ì— ëŒ€í•œ <code>Authorization</code> í—¤ë”ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¡œì§ìœ¼ë¡œ ì¸í•´ ë°œìƒí•œ ë¬¸ì œë¼ê³  í•  ìˆ˜ ìˆë‹¤. ì„œë¹„ìŠ¤ ë ˆë²¨ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í†µí•œ ë¡œì§ì„ ìˆ˜í–‰í•œ ìŠ¤ë ˆë“œê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ê¸°ë³¸ì ìœ¼ë¡œëŠ” ì¡°íšŒí•  ìˆ˜ ì—†ë‹¤. ì˜¤ë¥˜ ë©”ì‹œì§€ì— í¬í•¨ëœ <code>RequestContextListener</code> ê°€ í•´ê²°ë°©ì•ˆì´ ë  ìˆ˜ ìˆë‹¤. <a href="https://github.com/spring-projects/spring-framework/blob/main/spring-web/src/test/java/org/springframework/web/context/request/RequestContextListenerTests.java">RequestContextListenerTests.java</a> ë¥¼ ì°¸ê³ í•˜ì—¬ RequestContextListener í´ë˜ìŠ¤ë¥¼ í†µí•´ ìš”ì²­ì— ëŒ€í•œ ìŠ¤ë ˆë“œë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŒì„ í™•ì¸í–ˆìœ¼ë©° MockHttpServletRequestë¥¼ í†µí•´ ServletRequestAttributesë¥¼ RequestContextHolderì˜ ìŠ¤ë ˆë“œ ë¡œì»¬ì— ë°˜ì˜ë˜ê²Œ í•˜ì—¬ ì»¨íŠ¸ë¡¤ëŸ¬ ë ˆë²¨ì´ ì•„ë‹Œ ì„œë¹„ìŠ¤ ë ˆë²¨ì—ì„œë„ ì¸ì¦ëœ ì‚¬ìš©ì ê¸°ë°˜ì˜ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆê²Œ í•˜ì˜€ë‹¤. </p><pre class="language-java" data-language="java"><div class="caption"><span>WithMockUserSecurityContextFactory</span></div><code class="language-java"><span class="token annotation punctuation">@RequiredArgsConstructor</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WithMockUserSecurityContextFactory</span> <span class="token keyword">implements</span> <span class="token class-name">WithSecurityContextFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WithMockUser</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JwtTokenProvider</span> jwtTokenProvider<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">SecurityContext</span> <span class="token function">createSecurityContext</span><span class="token punctuation">(</span><span class="token class-name">WithMockUser</span> mockUser<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SecurityContext</span> context <span class="token operator">=</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">createEmptyContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">RequestContextListener</span> listener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RequestContextListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">MockServletContext</span> servletContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MockServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">MockHttpServletRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MockHttpServletRequest</span><span class="token punctuation">(</span>servletContext<span class="token punctuation">)</span><span class="token punctuation">;</span>        listener<span class="token punctuation">.</span><span class="token function">requestInitialized</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServletRequestEvent</span><span class="token punctuation">(</span>servletContext<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> optionalUser <span class="token operator">=</span> <span class="token function">getUserById</span><span class="token punctuation">(</span>mockUser<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>optionalUser<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">User</span> user <span class="token operator">=</span> optionalUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JwtToken</span><span class="token punctuation">></span></span> token <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">String</span> accessToken <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Authentication</span> authentication <span class="token operator">=</span> jwtTokenProvider<span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span>accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>                context<span class="token punctuation">.</span><span class="token function">setAuthentication</span><span class="token punctuation">(</span>authentication<span class="token punctuation">)</span><span class="token punctuation">;</span>                request<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaders</span><span class="token punctuation">.</span><span class="token constant">AUTHORIZATION</span><span class="token punctuation">,</span> <span class="token string">"Bearer %s"</span><span class="token punctuation">.</span><span class="token function">formatted</span><span class="token punctuation">(</span>accessToken<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">ServletRequestAttributes</span> requestAttributes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletRequestAttributes</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">setRequestAttributes</span><span class="token punctuation">(</span>requestAttributes<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> context<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="ì°¸ê³ -ë§í¬"><a href="#ì°¸ê³ -ë§í¬" class="headerlink" title="ì°¸ê³  ë§í¬"></a>ì°¸ê³  ë§í¬</h4><ul><li><a href="https://tecoble.techcourse.co.kr/post/2020-09-30-spring-security-test/">Spring Securityê°€ ì ìš©ëœ ê³³ì„ íš¨ìœ¨ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ì.</a></li><li><a href="https://stackoverflow.com/a/9430545">https://stackoverflow.com/a/9430545</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;JWT ê¸°ë°˜ì˜ ì¸ì¦ì„ êµ¬ì„±í•œ í”„ë¡œì íŠ¸ì—ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œì— ëŒ€í•œ ì‚¬ìš©ìë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„œ &lt;code&gt;WithSecurityContext&lt;/code&gt; ì™€ &lt;code&gt;WithSecurityContextFactory&lt;/code&gt; ë¥¼ ì‚¬ìš©í•´ì„œ ê°€ìƒì˜ ì‚¬ìš©ìì™€</summary>
      
    
    
    
    
    <category term="WithSecurityContext" scheme="https://kdevkr.github.io/tags/WithSecurityContext/"/>
    
    <category term="WithSecurityContextFactory" scheme="https://kdevkr.github.io/tags/WithSecurityContextFactory/"/>
    
    <category term="RequestContextListener" scheme="https://kdevkr.github.io/tags/RequestContextListener/"/>
    
  </entry>
  
  <entry>
    <title>Request Header Is Too Large</title>
    <link href="https://kdevkr.github.io/request-header-is-too-large/"/>
    <id>https://kdevkr.github.io/request-header-is-too-large/</id>
    <published>2024-03-26T14:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.902Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>java.lang.IllegalArgumentException: Request header is too large</p></blockquote><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/by-ids"</span><span class="token punctuation">)</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"ids"</span><span class="token punctuation">)</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ids<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>ìœ„ì™€ ê°™ì€ GET APIëŠ” ids íŒŒë¼ë¯¸í„°ì— ëŒ€í•œ ê¸¸ì´ ì œí•œì„ ë‘ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ Request header is too large ì— ëŒ€í•œ ì·¨ì•½ì ì´ ë‚´ì¬ë˜ì–´ìˆëŠ” ìƒíƒœë¡œ ë³¼ ìˆ˜ ìˆë‹¤. ê·¸ë ‡ë‹¤ë©´ ì´ì— ëŒ€í•œ ë¬¸ì œëŠ” ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ì„ê¹Œ?</p><h4 id="ì²«ë²ˆì§¸-ì„œë²„ì—ì„œ-ì²˜ë¦¬í•˜ëŠ”-í—¤ë”-í¬ê¸°-ì‚¬ì´ì¦ˆë¥¼-ëŠ˜ë¦¬ì"><a href="#ì²«ë²ˆì§¸-ì„œë²„ì—ì„œ-ì²˜ë¦¬í•˜ëŠ”-í—¤ë”-í¬ê¸°-ì‚¬ì´ì¦ˆë¥¼-ëŠ˜ë¦¬ì" class="headerlink" title="ì²«ë²ˆì§¸, ì„œë²„ì—ì„œ ì²˜ë¦¬í•˜ëŠ” í—¤ë” í¬ê¸° ì‚¬ì´ì¦ˆë¥¼ ëŠ˜ë¦¬ì"></a>ì²«ë²ˆì§¸, ì„œë²„ì—ì„œ ì²˜ë¦¬í•˜ëŠ” í—¤ë” í¬ê¸° ì‚¬ì´ì¦ˆë¥¼ ëŠ˜ë¦¬ì</h4><p>ê¸°ë³¸ì ì¸ í•´ê²°ë°©ë²•ì€ ìƒê°ë³´ë‹¤ ì‘ê²Œ ì„¤ì •ë˜ì–´ìˆëŠ” í—¤ë” í¬ê¸°ë¥¼ ì–´ëŠì •ë„ ëŠ˜ë¦¬ëŠ” ê²ƒì´ë‹¤. ë‹¤ë§Œ, ì—¬ì „íˆ ì˜ˆìƒí•  ìˆ˜ ì—†ëŠ” í—¤ë” í¬ê¸°ë¥¼ ì»¤ë²„í•  ìˆ˜ ì—†ìœ¼ë©° ì´ì— ëŒ€í•œ ëŒ€ì‘ìœ¼ë¡œëŠ” GET ìš”ì²­ì´ ì•„ë‹Œ POST ìš”ì²­ì„ í™œìš©í•´ì•¼í•œë‹¤. ìš”ì²­ í—¤ë” í¬ê¸°ì— ëŒ€í•œ ì œí•œì„ ëŠ˜ë¦¬ëŠ” ë°©ì•ˆì€ ì„ì‹œ ì¡°ì¹˜ì„ì„ ìŠì§€ ë§ì.</p><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server.max-http-request-header-size</span><span class="token punctuation">:</span> 10MB</code></pre><h4 id="ë‘ë²ˆì§¸-URL-ì¸ì½”ë”©-ë°©ì‹ì˜-í¼-ë°ì´í„°ë¥¼-ì „ë‹¬í•˜ì"><a href="#ë‘ë²ˆì§¸-URL-ì¸ì½”ë”©-ë°©ì‹ì˜-í¼-ë°ì´í„°ë¥¼-ì „ë‹¬í•˜ì" class="headerlink" title="ë‘ë²ˆì§¸, URL ì¸ì½”ë”© ë°©ì‹ì˜ í¼ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ì"></a>ë‘ë²ˆì§¸, URL ì¸ì½”ë”© ë°©ì‹ì˜ í¼ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ì</h4><p>GET ìš”ì²­ ì‹œ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ê°€ ë„ˆë¬´ ê¸¸ì–´ì§ˆ ìˆ˜ ìˆë‹¤ë©´ í¼ ë°ì´í„° í˜•ì‹ìœ¼ë¡œ ë³´ë‚¼ ìˆ˜ ìˆë„ë¡ <strong>POST ìš”ì²­ì— ëŒ€í•´ì„œë„ ì§€ì›</strong>í•˜ë©´ ëœë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">"/by-ids"</span><span class="token punctuation">)</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"ids"</span><span class="token punctuation">)</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ids<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">"/by-ids"</span><span class="token punctuation">,</span> consumes <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_FORM_URLENCODED_VALUE</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token function">getUsersUsingFormData</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"ids"</span><span class="token punctuation">)</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ids<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">getUsers</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="ì°¸ê³ í• ë§Œí•œ-ë§í¬"><a href="#ì°¸ê³ í• ë§Œí•œ-ë§í¬" class="headerlink" title="ì°¸ê³ í• ë§Œí•œ ë§í¬"></a>ì°¸ê³ í• ë§Œí•œ ë§í¬</h4><ul><li><a href="https://www.baeldung.com/spring-boot-max-http-header-size">Max-Http-Request-Header-Size in Spring Boot</a></li><li><a href="https://www.baeldung.com/postman-form-data-raw-x-www-form-urlencoded">Difference Between form-data, x-www-form-urlencoded and raw in Postman</a></li><li><a href="https://www.baeldung.com/spring-url-encoded-form-data">Handling URL Encoded Form Data in Spring REST</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;java.lang.IllegalArgumentException: Request header is too large&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre class=&quot;language-java&quot; data-language=&quot;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì ˆì°¨</title>
    <link href="https://kdevkr.github.io/reset-password-flow/"/>
    <id>https://kdevkr.github.io/reset-password-flow/</id>
    <published>2024-03-22T13:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.902Z</updated>
    
    <content type="html"><![CDATA[<p>ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°ëŠ” ëŒ€ë¶€ë¶„ì˜ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©ìì—ê²Œ ë°˜ë“œì‹œ ìš”êµ¬ë˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. ì˜¤ë˜ëœ ë ˆê±°ì‹œ ì‹œìŠ¤í…œì´ ì•„ë‹Œ ì´ìƒ ì‚¬ìš©ì ê³„ì •ì— ëŒ€í•œ ë¹„ë°€ë²ˆí˜¸ëŠ” ë³µí˜¸í™”ê°€ ë¶ˆê°€ëŠ¥í•˜ë„ë¡ ë‹¨ë°©í–¥ ì•”í˜¸í™”ëœ ê°’ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœë‹¤. ê·¸ë˜ì„œ ì‹¤ì§ˆì ìœ¼ë¡œ <strong>ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ìì²´ì˜ ìš”êµ¬ì‚¬í•­ì€ êµ¬í˜„í•  ìˆ˜ ì—†ë‹¤.</strong> íšŒì›ê°€ì… ì‹œ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì°¾ì„ ìˆ˜ëŠ” ì—†ìœ¼ë¯€ë¡œ ëŒ€ë¶€ë¶„ ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ë³¸ì¸ ì¸ì¦ì„ í†µí•´ ë¡œê·¸ì¸í•  ìˆ˜ ìˆê²Œ í•˜ê±°ë‚˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¬ì„¤ì •í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•œë‹¤.</p><ul><li><a href="https://github.com/password_reset">https://github.com/password_reset</a></li><li><a href="https://account.samsung.com/accounts/odchb/resetPasswordGate">https://account.samsung.com/accounts/odchb/resetPasswordGate</a></li><li><a href="https://sslmember2.gmarket.co.kr/FindPW/FindPW">https://sslmember2.gmarket.co.kr/FindPW/FindPW</a></li><li><a href="https://www.jobplanet.co.kr/users/password/new">https://www.jobplanet.co.kr/users/password/new</a></li></ul><h4 id="ë¹„ë°€ë²ˆí˜¸-ì¬ì„¤ì •-ë˜ëŠ”-ì´ˆê¸°í™”"><a href="#ë¹„ë°€ë²ˆí˜¸-ì¬ì„¤ì •-ë˜ëŠ”-ì´ˆê¸°í™”" class="headerlink" title="ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë˜ëŠ” ì´ˆê¸°í™”"></a>ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë˜ëŠ” ì´ˆê¸°í™”</h4><p>ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì ˆì°¨ì— ëŒ€í•´ì„œ ë” ìì„¸í•˜ê²Œ ì•Œì•„ë³´ë„ë¡ í•˜ì.</p><ol><li>ë¹„ë°€ë²ˆí˜¸ë¥¼ ì°¾ê³ ìí•˜ëŠ” ì‚¬ìš©ìì—ê²Œ ì•„ì´ë”” ë˜ëŠ” ì´ë©”ì¼ ì…ë ¥ì„ ìš”êµ¬</li><li>(Optional) ë¬´ë¶„ë³„í•œ ìš”êµ¬ë¥¼ ì œí•œí•˜ê¸° ìœ„í•´ì„œ ìº¡ì°¨ ë˜ëŠ” <a href="https://www.baeldung.com/spring-bucket4j">ìš”ì²­ ì œí•œëŸ‰</a>ì„ êµ¬í˜„</li><li>ì‚¬ìš©ìì—ê²Œ <strong>ì¸ì¦</strong>í•  ìˆ˜ ìˆëŠ” <strong><a href="https://cheatsheetseries.owasp.org/cheatsheets/Forgot_Password_Cheat_Sheet.html#url-tokens">URL í† í°</a></strong> ë§í¬ë¥¼ ì œê³µ</li><li>(Optional) URL í† í°ê³¼ í•¨ê»˜ ì¸ì¦ ì½”ë“œ ì…ë ¥ì„ ìš”êµ¬</li><li>ì‚¬ìš©ìê°€ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì„ <strong>ì™„ë£Œ</strong>í–ˆë‹¤ë©´ URL í† í°ì€ ì¦‰ì‹œ <strong>ë§Œë£Œ</strong></li><li>ì‚¬ìš©ìì— ì˜í•´ ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŒì„ ë³„ë„ <strong>ì•Œë¦¼</strong> ì œê³µ</li></ol><blockquote><p>URL ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì— í¬í•¨ë˜ëŠ” ì¸ì¦ ì •ë³´ëŠ” JWT í† í°ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ê²Œ ì¼ë°˜ì ì…ë‹ˆë‹¤.</p></blockquote><p>ìœ íŠœë¸Œ <a href="https://www.youtube.com/watch?v=b5xWS8MYl0Q">ì œë¯¸ë‹ˆì˜ ê°œë°œì‹¤ë¬´</a>ì—ì„œ ê°œë°œ ìš”êµ¬ì‚¬í•­ì— ëŒ€í•´ ê·¸ëŒ€ë¡œ êµ¬í˜„í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ê°œë°œì ì…ì¥ì—ì„œ í•„ìš”í•˜ê±°ë‚˜ ê³ ë ¤ë˜ì–´ì•¼í•  ë¶€ë¶„ì— ëŒ€í•´ì„œ ì²´í¬í•˜ëŠ” ê²ƒë„ ê°œë°œìì˜ ì—­ëŸ‰ì´ë¼ëŠ” ë¶€ë¶„ì„ ì´ì•¼ê¸°í•˜ëŠ” ê²ƒì„ ë³´ê³  ëŒ€ë¶€ë¶„ì˜ ì‹œìŠ¤í…œì—ì„œ ìš”êµ¬í•˜ëŠ” <strong>ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</strong>ì— ëŒ€í•´ì„œ ì‚´í´ë³´ì•˜ë‹¤.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°ëŠ” ëŒ€ë¶€ë¶„ì˜ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©ìì—ê²Œ ë°˜ë“œì‹œ ìš”êµ¬ë˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. ì˜¤ë˜ëœ ë ˆê±°ì‹œ ì‹œìŠ¤í…œì´ ì•„ë‹Œ ì´ìƒ ì‚¬ìš©ì ê³„ì •ì— ëŒ€í•œ ë¹„ë°€ë²ˆí˜¸ëŠ” ë³µí˜¸í™”ê°€ ë¶ˆê°€ëŠ¥í•˜ë„ë¡ ë‹¨ë°©í–¥ ì•”í˜¸í™”ëœ ê°’ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœë‹¤. ê·¸ë˜ì„œ ì‹¤ì§ˆì ìœ¼ë¡œ &lt;strong&gt;ë¹„ë°€ë²ˆ</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ë ˆë””ìŠ¤ ì›¹ì†Œì¼“ ì•ŒëŒ ë™ê¸°í™”</title>
    <link href="https://kdevkr.github.io/spring-boot-redis-websocket-sync/"/>
    <id>https://kdevkr.github.io/spring-boot-redis-websocket-sync/</id>
    <published>2024-03-14T14:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.902Z</updated>
    
    <content type="html"><![CDATA[<h4 id="ì›¹ì†Œì¼“-ì•ŒëŒ-ê°±ì‹ -ë™ê¸°í™”"><a href="#ì›¹ì†Œì¼“-ì•ŒëŒ-ê°±ì‹ -ë™ê¸°í™”" class="headerlink" title="ì›¹ì†Œì¼“ ì•ŒëŒ ê°±ì‹  ë™ê¸°í™”"></a>ì›¹ì†Œì¼“ ì•ŒëŒ ê°±ì‹  ë™ê¸°í™”</h4><p>ëŒ€ë¶€ë¶„ì˜ ì˜ˆì œëŠ” ì±„íŒ…ìœ¼ë¡œ ê³µìœ ë˜ê³  ìˆì§€ë§Œ ì¼ë°˜ì ì¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œì˜ ì›¹ì†Œì¼“ ê¸°ëŠ¥ì€ ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œì˜ ì•ŒëŒê³¼ ì´ë²¤íŠ¸ë¥¼ ì¦‰ì‹œ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©í•˜ê³  ìˆì„ ê²ƒì´ë‹¤. ë‹¨ì¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ê³ ë ¤í•˜ì§€ ì•Šì•„ë„ ë  ë¶€ë¶„ì´ì§€ë§Œ ìŠ¤ì¼€ì¼ ì•„ì›ƒë˜ì–´ ë¶„ì‚° ì²˜ë¦¬ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì— ê°ê° ì—°ê²°ëœ ì›¹ì†Œì¼“ìœ¼ë¡œ íŠ¹ì • ì„œë²„ì—ì„œ ë°œìƒí•˜ì—¬ ë§Œë“¤ì–´ì§€ëŠ” ì•ŒëŒ ì •ë³´ë¥¼ ì¦‰ì‹œ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œëŠ” ì „íŒŒí•˜ê³  ë™ê¸°í™”í•˜ëŠ” ë°©ì•ˆì´ í•„ìš”í•˜ë‹¤. <a href="https://pompitzz.github.io/blog/Redis/LocalCacheSyncWithRedisPubSub.html">Redis(Pub&#x2F;Sub)ë¡œ ë¡œì»¬ ìºì‹œ ë™ê¸°í™”í•˜ê¸°</a>ì™€ ë¹„ìŠ·í•˜ë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token keyword">implements</span> <span class="token class-name">MessageListener</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ChannelTopic</span> topic <span class="token operator">=</span> <span class="token class-name">ChannelTopic</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"NOTIFICATIONS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">public</span> <span class="token class-name">StringRedisTemplate</span> redisTemplate<span class="token punctuation">;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">CommandLineRunner</span> <span class="token function">commandLineRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> args <span class="token operator">-></span> redisTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span>topic<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"REQUIRE.SYNC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">RedisMessageListenerContainer</span> <span class="token function">redisMessageListenerContainer</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">RedisMessageListenerContainer</span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisMessageListenerContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        container<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>        container<span class="token punctuation">.</span><span class="token function">addMessageListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> topic<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> container<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">MessageListenerAdapter</span> <span class="token function">listenerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MessageListenerAdapter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pattern<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"receive: &#123;&#125;"</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="í™œìš©-í´ë˜ìŠ¤-ëª©ë¡"><a href="#í™œìš©-í´ë˜ìŠ¤-ëª©ë¡" class="headerlink" title="í™œìš© í´ë˜ìŠ¤ ëª©ë¡"></a>í™œìš© í´ë˜ìŠ¤ ëª©ë¡</h4><p>ë ˆë””ìŠ¤ì— ì˜í•œ Pub&#x2F;Subì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©ë˜ëŠ” ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ í´ë˜ìŠ¤ë“¤ì€ ì•„ë˜ì™€ ê°™ë‹¤.</p><ul><li>RedisMessageListenerContainer</li><li>RedisConnectionFactory</li><li>MessageListenerAdapter</li><li>MessageListener</li><li>StringRedisTemplate</li><li>ChannelTopic</li></ul><h4 id="ì°¸ê³ -ë§í¬"><a href="#ì°¸ê³ -ë§í¬" class="headerlink" title="ì°¸ê³  ë§í¬"></a>ì°¸ê³  ë§í¬</h4><ul><li><a href="https://redis.io/docs/interact/pubsub/">How to use pub&#x2F;sub channels in Redis</a></li><li><a href="https://docs.spring.io/spring-data/redis/reference/redis/pubsub.html">Pub&#x2F;Sub Messaging</a></li><li><a href="https://www.baeldung.com/spring-data-redis-pub-sub">PubSub Messaging with Spring Data Redis</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;ì›¹ì†Œì¼“-ì•ŒëŒ-ê°±ì‹ -ë™ê¸°í™”&quot;&gt;&lt;a href=&quot;#ì›¹ì†Œì¼“-ì•ŒëŒ-ê°±ì‹ -ë™ê¸°í™”&quot; class=&quot;headerlink&quot; title=&quot;ì›¹ì†Œì¼“ ì•ŒëŒ ê°±ì‹  ë™ê¸°í™”&quot;&gt;&lt;/a&gt;ì›¹ì†Œì¼“ ì•ŒëŒ ê°±ì‹  ë™ê¸°í™”&lt;/h4&gt;&lt;p&gt;ëŒ€ë¶€ë¶„ì˜ ì˜ˆì œëŠ” ì±„íŒ…ìœ¼ë¡œ ê³µìœ ë˜ê³  ìˆì§€ë§Œ ì¼ë°˜ì </summary>
      
    
    
    
    
    <category term="Redis" scheme="https://kdevkr.github.io/tags/Redis/"/>
    
    <category term="Websocket" scheme="https://kdevkr.github.io/tags/Websocket/"/>
    
  </entry>
  
  <entry>
    <title>êµ¬ê¸€ ì£¼ì†Œ ê²€ìƒ‰ìœ¼ë¡œ ìœ„ ê²½ë„ ì¡°íšŒ</title>
    <link href="https://kdevkr.github.io/google-address-search/"/>
    <id>https://kdevkr.github.io/google-address-search/</id>
    <published>2024-03-10T14:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.898Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://mapsplatform.google.com/">Google Maps Platform</a>ì„ í†µí•´ ì£¼ì†Œ ë˜ëŠ” ìœ„ â€¢ ê²½ë„ ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤. Places ë˜ëŠ” Geocoding API ëª¨ë‘ì—ì„œ í•œêµ­ì–´ë¥¼ í¬í•¨í•œ ë‹¤ì–‘í•œ ì–¸ì–´ì— ëŒ€í•´ ê²€ìƒ‰ì„ ì§€ì›í•œë‹¤. ë¹„ë¡ êµ­ë‚´ ëŒ€ìƒìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” <a href="https://postcode.map.daum.net/guide">ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤</a>ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ ìì„¸í•œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê¸°ëŠ” í˜ë“¤ì§€ë§Œ êµ­ë‚´ ì£¼ì†Œ ë¿ë§Œ ì•„ë‹ˆë¼ í•´ì™¸ ì£¼ì†Œë‚˜ ìœ„ì¹˜ì— ëŒ€í•œ ê²€ìƒ‰ì„ ì»¤ë²„í•˜ê¸° ìœ„í•´ì„œëŠ” ê±°ì˜ ëŒ€ì•ˆì´ ì—†ë‹¤ê³  ìƒê°ëœë‹¤. ë˜í•œ, HTTP ìš”ì²­ì„ ì§ì ‘ ì‚¬ìš©í•´ì„œ êµ¬í˜„í•˜ì§€ ì•Šì•„ë„ ì‰½ê²Œ ì ìš©í•  ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìˆë‹¤.</p><ul><li><a href="https://github.com/googlemaps/react-wrapper">Google Maps JavaScript API React Wrapper</a></li><li><a href="https://vue-map.netlify.app/">Vue 3 Google maps</a></li><li><a href="https://github.com/googlemaps/google-maps-services-java">Java Client for Google Maps Services</a></li></ul><h4 id="FE-Vue-3-Google-maps"><a href="#FE-Vue-3-Google-maps" class="headerlink" title="[FE] Vue 3 Google maps"></a>[FE] Vue 3 Google maps</h4><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createApp <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token keyword">import</span> <span class="token string">'./style.css'</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span><span class="token keyword">import</span> VueGoogleMaps <span class="token keyword">from</span> <span class="token string">'@fawmi/vue-google-maps'</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueGoogleMaps<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">load</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_GOOGLE_MAP_API_KEY</span><span class="token punctuation">,</span>        <span class="token literal-property property">libraries</span><span class="token operator">:</span> <span class="token string">"places"</span><span class="token punctuation">,</span>        <span class="token literal-property property">language</span><span class="token operator">:</span> <span class="token string">'ja'</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span></code></pre><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GMapAutocomplete</span>    <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Please input address<span class="token punctuation">"</span></span>    <span class="token attr-name">@place_changed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(result) => console.log(result)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>GMapAutocomplete</span><span class="token punctuation">></span></span></code></pre><h4 id="BE-Java-Client-for-Google-Maps-Services"><a href="#BE-Java-Client-for-Google-Maps-Services" class="headerlink" title="[BE] Java Client for Google Maps Services"></a>[BE] Java Client for Google Maps Services</h4><pre class="language-groovy" data-language="groovy"><div class="caption"><span>build.gradle</span></div><code class="language-groovy">dependencies <span class="token punctuation">&#123;</span>    implementation <span class="token string">'com.google.maps:google-maps-services:2.2.0'</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootTest</span><span class="token keyword">class</span> <span class="token class-name">GoogleMapTests</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> apiKey <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Gson</span> gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPrettyPrinting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">void</span> <span class="token class-name">Test_Places</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertDoesNotThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token class-name">GeoApiContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeoApiContext<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">apiKey</span><span class="token punctuation">(</span>apiKey<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">queryRateLimit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">PlaceAutocompleteRequest<span class="token punctuation">.</span>SessionToken</span> session <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PlaceAutocompleteRequest<span class="token punctuation">.</span>SessionToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> input <span class="token operator">=</span> <span class="token string">"ê°•ë‚¨ì—­"</span><span class="token punctuation">;</span>            <span class="token class-name">AutocompletePrediction</span><span class="token punctuation">[</span><span class="token punctuation">]</span> predictions <span class="token operator">=</span> <span class="token class-name">PlacesApi</span><span class="token punctuation">.</span><span class="token function">placeAutocomplete</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> input<span class="token punctuation">,</span> session<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>predictions<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            context<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="Place-Autocomplete-ìµœì í™”"><a href="#Place-Autocomplete-ìµœì í™”" class="headerlink" title="Place Autocomplete ìµœì í™”"></a>Place Autocomplete ìµœì í™”</h4><p>Places API ì™€ Geocoding API ëª¨ë‘ <a href="https://developers.google.com/maps/documentation/geocoding/usage-and-billing">ì‚¬ìš©í•œ ë§Œí¼ ì§€ë¶ˆí•˜ëŠ” ê°€ê²© ëª¨ë¸</a>ì„ ê°€ì§€ë¯€ë¡œ <a href="https://developers.google.com/maps/documentation/places/web-service/autocomplete">Place Autocomplete ìµœì í™”</a> ì™€ <a href="https://developers.google.com/maps/documentation/geocoding/best-practices">ì£¼ì†Œ ì§€ì˜¤ì½”ë”© ê¶Œì¥ì‚¬í•­</a> ê°™ì€ ì •ë³´ê°€ ë„ì›€ì´ ë  ìˆ˜ ìˆë‹¤. ì£¼ì†Œì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ê°€ í•„ìš”í•œ ê²ƒì´ ì•„ë‹Œ ì£¼ì†Œ ë° ìœ„ì¹˜ ì •ë³´ë§Œ í•„ìš”ë¡œ í•˜ëŠ” ê²½ìš°ì—ëŠ” ì•„ë˜ì˜ í•­ëª©ì„ ì²´í¬í•´ë³´ë„ë¡ í•˜ì.</p><ul><li>ì£¼ì†Œì™€ ìœ„ì¹˜ ì •ë³´ë§Œì„ í•„ìš”ë¡œ í•œë‹¤ë©´ Place Autocomplete ë³´ë‹¤ëŠ” Geocoding APIê°€ íš¨ìœ¨ì ì´ë‹¤.</li><li>ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ì£¼ì†Œë¥¼ ëª…í™•í•˜ê²Œ ì•Œê³  ìˆë‹¤ë©´ Geocoding APIë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ì¢‹ë‹¤.</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootTest</span><span class="token keyword">class</span> <span class="token class-name">GoogleMapTests</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> apiKey <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Gson</span> gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPrettyPrinting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token class-name">GeoApiContext</span> context<span class="token punctuation">;</span>    <span class="token annotation punctuation">@BeforeAll</span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeoApiContext<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">apiKey</span><span class="token punctuation">(</span>apiKey<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">queryRateLimit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Test</span>    <span class="token keyword">void</span> <span class="token class-name">Test_Geocoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertDoesNotThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> address <span class="token operator">=</span> <span class="token string">"ê°•ë‚¨ì—­"</span><span class="token punctuation">;</span>            <span class="token class-name">GeocodingResult</span><span class="token punctuation">[</span><span class="token punctuation">]</span> results <span class="token operator">=</span>  <span class="token class-name">GeocodingApi</span><span class="token punctuation">.</span><span class="token function">geocode</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> address<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">language</span><span class="token punctuation">(</span><span class="token string">"ko"</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">locationType</span><span class="token punctuation">(</span><span class="token class-name">LocationType</span><span class="token punctuation">.</span><span class="token constant">ROOFTOP</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">resultType</span><span class="token punctuation">(</span><span class="token class-name">AddressType</span><span class="token punctuation">.</span><span class="token constant">STREET_ADDRESS</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            context<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="Samples"><a href="#Samples" class="headerlink" title="Samples"></a>Samples</h4><ul><li><a href="https://developers.google.com/maps/documentation/javascript/examples/geocoding-simple">Geocoding Service</a></li><li><a href="https://developers.google.com/maps/documentation/javascript/examples/geocoding-reverse">Reverse Geocoding</a></li><li><a href="https://developers.google.com/maps/documentation/javascript/examples/geocoding-place-id">Get the Address for a Place ID</a></li><li><a href="https://developers.google.com/maps/documentation/javascript/examples/places-autocomplete">Place Autocomplete</a></li><li><a href="https://developers.google.com/maps/documentation/javascript/examples/place-details">Place Details</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://mapsplatform.google.com/&quot;&gt;Google Maps Platform&lt;/a&gt;ì„ í†µí•´ ì£¼ì†Œ ë˜ëŠ” ìœ„ â€¢ ê²½ë„ ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤. Places ë˜ëŠ” Geocoding API ëª¨ë‘ì—ì„œ í•œêµ­ì–´ë¥¼ í¬í•¨í•œ </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ì—”ì§„ì—‘ìŠ¤ íŠ¸ë˜í”½ ë¯¸ëŸ¬ë§</title>
    <link href="https://kdevkr.github.io/nginx-mirror/"/>
    <id>https://kdevkr.github.io/nginx-mirror/</id>
    <published>2024-03-02T03:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.898Z</updated>
    
    <content type="html"><![CDATA[<p>ì—”ì§„ì—‘ìŠ¤(Nginx)ì˜ <code>ngx_http_mirror_module</code> ëª¨ë“ˆì„ ì‚¬ìš©í•˜ë©´ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì „ë‹¬í•˜ëŠ” <a href="https://medium.com/gaurav-shukla/testing-your-code-against-production-using-nginx-mirroring-567b3c2f4921">ì¼ë¶€ íŠ¸ë˜í”½ì„ ë³µì œí•˜ì—¬ ë‹¤ë¥¸ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ì „ë‹¬</a>í•  ìˆ˜ ìˆë‹¤. ìš°ë¦¬ëŠ” ì´ê²ƒì„ í™œìš©í•´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì „ë‹¬í•˜ëŠ” íŠ¸ë˜í”½ì„ ì•Œ ìˆ˜ ì—†ëŠ” ìƒí™©ì´ì§€ë§Œ ì–´ë– í•œ ë¬¸ì œê°€ ë°œìƒí•˜ê³  ìˆì„ë•Œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì–´ì„œ êµ¬ë™í•˜ê³  ë””ë²„ê·¸í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤.</p><h4 id="íŠ¸ë˜í”½-ë¯¸ëŸ¬ë§-ì„¤ì •"><a href="#íŠ¸ë˜í”½-ë¯¸ëŸ¬ë§-ì„¤ì •" class="headerlink" title="íŠ¸ë˜í”½ ë¯¸ëŸ¬ë§ ì„¤ì •"></a>íŠ¸ë˜í”½ ë¯¸ëŸ¬ë§ ì„¤ì •</h4><pre class="language-conf" data-language="conf"><div class="caption"><span>nginx.conf</span></div><code class="language-conf">http &#123;    upstream backend_for_test &#123;        server app:8081;        keepalive 128;    &#125;    server &#123;        proxy_set_header Host $host;        proxy_set_header X-Real-IP $remote_addr;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;        # hop-by-hop        proxy_http_version 1.1;        location &#x2F;mtls&#x2F; &#123;            proxy_pass http:&#x2F;&#x2F;backend;            mirror &#x2F;mirror;            mirror_request_body on;        &#125;        location &#x2F;mtls_mirror &#123;            internal;            proxy_pass http:&#x2F;&#x2F;backend_for_test$request_uri;        &#125;    &#125;&#125;</code></pre><blockquote><p>ë¬¸ì œì— ëŒ€í•œ ì›ì¸ì„ íŒŒì•…í•˜ê¸° ìœ„í•œ ìš”ì²­ì— ë°”ë”” ì •ë³´ê°€ í•„ìš”í•˜ì§€ ì•Šì€ ê²½ìš° mirror_request_body ì˜µì…˜ì„ ë¹„í™œì„±í™”(off) í•˜ì„¸ìš”.</p></blockquote><h4 id="íŠ¸ë˜í”½-ë¯¸ëŸ¬ë§-ì¶œë ¥"><a href="#íŠ¸ë˜í”½-ë¯¸ëŸ¬ë§-ì¶œë ¥" class="headerlink" title="íŠ¸ë˜í”½ ë¯¸ëŸ¬ë§ ì¶œë ¥"></a>íŠ¸ë˜í”½ ë¯¸ëŸ¬ë§ ì¶œë ¥</h4><p>ì¼ë°˜ì ìœ¼ë¡œ ì„œë²„ í¬íŠ¸ ì˜¤í”ˆì„ í™•ì¸í•˜ëŠ”ë° ì‚¬ìš©í•˜ëŠ” Netcat ëª…ë ¹ì–´ë¥¼ í†µí•´ ê°„ë‹¨í•œ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ê³  ë³µì œëœ íŠ¸ë˜í”½ì— ëŒ€í•œ ì •ë³´ë¥¼ ì¶œë ¥í•´ë³¼ ìˆ˜ ìˆë‹¤.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">nc</span> <span class="token parameter variable">-lp</span> localhost <span class="token number">8081</span></code></pre><blockquote><p>AWS í™˜ê²½ì—ì„œ ìš´ì˜í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ íŠ¸ë˜í”½ ë¯¸ëŸ¬ë§ì€ <a href="https://aws.amazon.com/ko/blogs/tech/mirror-production-traffic-to-test-environment-with-vpc-traffic-mirroring/">VPC íŠ¸ë˜í”½ ë¯¸ëŸ¬ë§</a>ì„ êµ¬ì„±í•˜ëŠ” ê²ƒì´ ì í•©í•©ë‹ˆë‹¤.</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ì—”ì§„ì—‘ìŠ¤(Nginx)ì˜ &lt;code&gt;ngx_http_mirror_module&lt;/code&gt; ëª¨ë“ˆì„ ì‚¬ìš©í•˜ë©´ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì „ë‹¬í•˜ëŠ” &lt;a href=&quot;https://medium.com/gaurav-shukla/testing-your-co</summary>
      
    
    
    
    
    <category term="nginx" scheme="https://kdevkr.github.io/tags/nginx/"/>
    
    <category term="mirror" scheme="https://kdevkr.github.io/tags/mirror/"/>
    
  </entry>
  
  <entry>
    <title>AWS Elastic Beanstalk ë¡œê·¸ ì•Œì•„ë³´ê¸°</title>
    <link href="https://kdevkr.github.io/beanstalk-logs/"/>
    <id>https://kdevkr.github.io/beanstalk-logs/</id>
    <published>2024-03-01T14:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.894Z</updated>
    
    <content type="html"><![CDATA[<p><img data-src="/images/posts/beanstalk-logs/01.png"></p><p>AWS Elastic Beanstalk í™˜ê²½ ì½˜ì†”ì˜ ë¡œê·¸ ë©”ë‰´ì—ì„œ ë¡œê·¸ ìš”ì²­ì„ í†µí•´ ì „ì²´(ë²ˆë“¤) ë˜ëŠ” ë§ˆì§€ë§‰ 100ì¤„(í…Œì¼) ë¡œê·¸ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤. ì´ëŸ¬í•œ ìš”ì²­ì— ëŒ€í•œ ë¡œê·¸ëŠ” ì•„ë˜ì˜ íŒŒì¼ë“¤ì„ ì‚¬ìš©í•˜ì—¬ ê°€ì ¸ì˜¤ë©° ì‚¬ìš©ì ê¶Œí•œì„ í†µí•´ S3 ë²„í‚·ì— ì €ì¥í•œ í›„ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆê²Œ ì œê³µí•œë‹¤. ë”°ë¼ì„œ, ì¸ìŠ¤í„´ìŠ¤ í”„ë¡œíŒŒì¼ì— S3ì— ëŒ€í•œ ê¶Œí•œ ì •ì±…ì´ í¬í•¨ë˜ì–´ìˆì–´ì•¼ í•œë‹¤.</p><ul><li>í…Œì¼ ë¡œê·¸ - &#x2F;opt&#x2F;elasticbeanstalk&#x2F;tasks&#x2F;taillogs.d&#x2F;</li><li>ë²ˆë“¤ ë¡œê·¸ - &#x2F;opt&#x2F;elasticbeanstalk&#x2F;tasks&#x2F;bundlelogs.d&#x2F;</li><li>íšŒì „ëœ ë¡œê·¸ - &#x2F;opt&#x2F;elasticbeanstalk&#x2F;tasks&#x2F;publishlogs.d&#x2F;</li></ul><blockquote><p>S3ì— ì €ì¥ë˜ëŠ” ë¡œê·¸ ìœ„ì¹˜ëŠ” elasticbeanstalk-{region}-{account-id}&#x2F;resources&#x2F;environments&#x2F;logs ì…ë‹ˆë‹¤.<br>Elastic BeanstalkëŠ” ìš”ì²­í•œ ë²ˆë“¤ ë˜ëŠ” í…Œì¼ ë¡œê·¸ì— ëŒ€í•´ì„œ 15ë¶„ì´ ê²½ê³¼ëœ ì´í›„ì— íŒŒì¼ì„ S3ì—ì„œ ì‚­ì œí•©ë‹ˆë‹¤.</p></blockquote><h4 id="í…Œì¼-ë¡œê·¸"><a href="#í…Œì¼-ë¡œê·¸" class="headerlink" title="í…Œì¼ ë¡œê·¸"></a>í…Œì¼ ë¡œê·¸</h4><p>í…Œì¼(ë§ˆì§€ë§‰ 100ì¤„) ë¡œê·¸ëŠ” EB ì—”ì§„ ë° Nginx ê·¸ë¦¬ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ ë¡œê·¸ì˜ ë§ˆì§€ë§‰ 100ì¤„ì„ ëª¨ì•„ ë‹¨ì¼ í…ìŠ¤íŠ¸ íŒŒì¼ì„ ìƒì„±í•˜ê³  S3ì— ì—…ë¡œë“œí•œë‹¤. Amazon Linux 2 ë¦¬ëˆ…ìŠ¤ í”Œë«í¼ì—ì„œ í¬í•¨ë˜ëŠ” ë¡œê·¸ í•­ëª©ì€ ì•„ë˜ì™€ ê°™ë‹¤.</p><ul><li>&#x2F;var&#x2F;log&#x2F;web.stdout.log</li><li>&#x2F;var&#x2F;log&#x2F;eb-engine.log</li><li>&#x2F;var&#x2F;log&#x2F;eb-hooks.log</li><li>&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</li><li>&#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log</li></ul><h4 id="ë²ˆë“¤-ë¡œê·¸"><a href="#ë²ˆë“¤-ë¡œê·¸" class="headerlink" title="ë²ˆë“¤ ë¡œê·¸"></a>ë²ˆë“¤ ë¡œê·¸</h4><p>ë²ˆë“¤(ì „ì²´) ë¡œê·¸ëŠ” ì‹œìŠ¤í…œ ì „ì²´ ë©”ì‹œì§€ ë¿ë§Œ ì•„ë‹ˆë¼ yum ë° cron ë¡œê·¸ì™€ ê°™ì€ ë‹¤ì–‘í•œ ë¡œê·¸ë¥¼ í¬í•¨í•˜ì—¬ Zip íŒŒì¼ë¡œ ì••ì¶•í•œ í›„ S3ì— ì—…ë¡œë“œí•œë‹¤. ë‹¤ìš´ë¡œë“œí•œ ë²ˆë“¤ ë¡œê·¸ì—ëŠ” ì•„ë˜ì™€ ê°™ì€ ë¡œê·¸ í•­ëª©ì´ í¬í•¨ë˜ì–´ìˆë‹¤.</p><ul><li>&#x2F;var&#x2F;log&#x2F;healthd&#x2F;</li><li>&#x2F;var&#x2F;log&#x2F;nginx&#x2F;</li><li>&#x2F;var&#x2F;log&#x2F;rotate&#x2F;</li><li>&#x2F;var&#x2F;log&#x2F;cfn-hup.log</li><li>&#x2F;var&#x2F;log&#x2F;cfn-init.log</li><li>&#x2F;var&#x2F;log&#x2F;cfn-init-cmd.log</li><li>&#x2F;var&#x2F;log&#x2F;cfn-wire.log</li><li>&#x2F;var&#x2F;log&#x2F;cloud-init.log</li><li>&#x2F;var&#x2F;log&#x2F;cloud-init-output.log</li><li>&#x2F;var&#x2F;log&#x2F;cron</li><li>&#x2F;var&#x2F;log&#x2F;eb-cfn-init.log</li><li>&#x2F;var&#x2F;log&#x2F;eb-cfn-init-call.log</li><li>&#x2F;var&#x2F;log&#x2F;eb-engine.log</li><li>&#x2F;var&#x2F;log&#x2F;eb-publish.log</li><li>&#x2F;var&#x2F;log&#x2F;eb-tools.log</li><li>&#x2F;var&#x2F;log&#x2F;messages</li><li>&#x2F;var&#x2F;log&#x2F;web.stdout.log</li><li>&#x2F;var&#x2F;log&#x2F;yum.log</li></ul><blockquote><p>ë²ˆë“¤ ë¡œê·¸ì—ëŠ” ì‹œìŠ¤í…œ ì „ë°˜ì ì¸ ë©”ì‹œì§€ë¥¼ í¬í•¨í•˜ëŠ” &#x2F;var&#x2F;log&#x2F;messages ê°€ í¬í•¨ë˜ì–´ìˆì–´ ë” ìì„¸í•˜ê²Œ ì›ì¸ì„ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></blockquote><h4 id="ë¡œê·¸-ë¡œí…Œì´ì…˜"><a href="#ë¡œê·¸-ë¡œí…Œì´ì…˜" class="headerlink" title="ë¡œê·¸ ë¡œí…Œì´ì…˜"></a>ë¡œê·¸ ë¡œí…Œì´ì…˜</h4><p>AWS Elastic Beanstalk ì˜ ë¦¬ëˆ…ìŠ¤ í”Œë«í¼ì—ì„œëŠ” logrotate ë¥¼ ì‚¬ìš©í•´ì„œ ë¡œê·¸ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ íšŒì „í•˜ê³  Amazon S3ì— ì—…ë¡œë“œí•œë‹¤. í™˜ê²½ ì½˜ì†”ì—ì„œ ìš”ì²­í•˜ëŠ” ë²ˆë“¤ ë˜ëŠ” ë§ˆì§€ë§‰ 100ì¤„ ë¡œê·¸ ìš”ì²­ì—ëŠ” íšŒì „ë˜ëŠ” ë¡œê·¸ëŠ” í¬í•¨ë˜ì§€ ì•ŠëŠ”ë‹¤. ë¡œê·¸ íšŒì „ì— ëŒ€í•œ êµ¬ì„± íŒŒì¼ì€ &#x2F;etc&#x2F;logrotate.elasticbeanstalk.hourly&#x2F; ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìœ¼ë©° &#x2F;etc&#x2F;cron.hourly&#x2F; ì—ì„œ í¬ë¡  ì‘ì—…ìœ¼ë¡œ í˜¸ì¶œëœë‹¤.</p><hr><p>ì„œë²„ ì—”ì§€ë‹ˆì–´ ë˜ëŠ” ë°ë¸Œì˜µìŠ¤ ì—”ì§€ë‹ˆì–´ì—ê²Œ ì „ë‹¬ë°›ì€ ë¡œê·¸ë“¤ì´ ì–´ë– í•œ ì •ë³´ë¥¼ í¬í•¨í•˜ê³  ìˆëŠ”ì§€ë¥¼ ì•Œê³  ë¹ ë¥´ê³  ìì„¸í•˜ê²Œ ë¬¸ì œì— ëŒ€í•œ ì›ì¸ì„ ë¶„ì„í•˜ëŠ”ë°ì— ì‚¬ìš©í•˜ëŠ” ê²ƒì— ëŒ€í•œ ì—­ëŸ‰ì€ ë°±ì—”ë“œ ì—”ì§€ë‹ˆì–´ì—ê²Œ í•„ìš”í•œ ë¶€ë¶„ì´ë‹¤.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img data-src=&quot;/images/posts/beanstalk-logs/01.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;AWS Elastic Beanstalk í™˜ê²½ ì½˜ì†”ì˜ ë¡œê·¸ ë©”ë‰´ì—ì„œ ë¡œê·¸ ìš”ì²­ì„ í†µí•´ ì „ì²´(ë²ˆë“¤) ë˜ëŠ” ë§ˆì§€ë§‰ 100ì¤„(í…Œì¼) ë¡œê·¸ë¥¼ ì¡°íšŒí• </summary>
      
    
    
    
    
    <category term="Beanstalk" scheme="https://kdevkr.github.io/tags/Beanstalk/"/>
    
    <category term="TailLogs" scheme="https://kdevkr.github.io/tags/TailLogs/"/>
    
    <category term="Bundlelogs" scheme="https://kdevkr.github.io/tags/Bundlelogs/"/>
    
  </entry>
  
  <entry>
    <title>ë¬¸ìì—´ì—ì„œ ë¡œì¼€ì¼ë¡œ ë³€í™˜í•˜ëŠ” ë°©ë²•</title>
    <link href="https://kdevkr.github.io/java-locale-from-language/"/>
    <id>https://kdevkr.github.io/java-locale-from-language/</id>
    <published>2024-02-21T14:00:00.000Z</published>
    <updated>2024-07-13T10:21:40.898Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Locale-forLanguageTag"><a href="#Locale-forLanguageTag" class="headerlink" title="Locale.forLanguageTag"></a>Locale.forLanguageTag</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">forLanguageTag</span><span class="token punctuation">(</span><span class="token string">"ko_KR"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// â†’ ""</span><span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">forLanguageTag</span><span class="token punctuation">(</span><span class="token string">"ko_KR"</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// â†’ ko_KR</span></code></pre><p>Locale.forLanguageTag í•¨ìˆ˜ì—ì„œ <code>ko-KR</code> ì´ ì•„ë‹Œ <code>ko_KR</code> ê³¼ ê°™ì´ ì–¸ì–´(Langauge)ì™€ êµ­ê°€(Country)ì— ëŒ€í•œ ì •ë³´ë¥¼ ì–¸ë”ìŠ¤ì½”ì–´ í˜•íƒœì˜ ë¬¸ìì—´ì„ íŒŒë¼ë¯¸í„°ì— ë„£ëŠ” ê²½ìš° ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•Šê³  <strong>ë¹„ì–´ìˆëŠ” Locale</strong>ì´ ë§Œë“¤ì–´ì§„ë‹¤. ë”°ë¼ì„œ, <code>Locale.forLanguageTag</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ë¡œì¼€ì¼ë¡œ ë³€í™˜í•˜ë ¤ëŠ” ê²½ìš°ì—ëŠ” <strong>ì–¸ë”ìŠ¤ì½”ì–´(_)ë¥¼ í•˜ì´í”ˆ(-)ìœ¼ë¡œ ë³€í™˜</strong>í•´ì•¼í•œë‹¤.</p><h4 id="LocaleUtils-ì™€-StringUtils"><a href="#LocaleUtils-ì™€-StringUtils" class="headerlink" title="LocaleUtils ì™€ StringUtils"></a>LocaleUtils ì™€ StringUtils</h4><p>String í´ë˜ìŠ¤ì— í¬í•¨ë˜ì–´ìˆëŠ” replace í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ <code>IETF BCP 47 ì–¸ì–´ íƒœê·¸</code> í˜•ì‹ìœ¼ë¡œ ë³€ê²½í•´ë„ ë˜ì§€ë§Œ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ ë˜ëŠ” í”„ë¡œì íŠ¸ì—ì„œ ë§ì´ ì‚¬ìš©ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì— í¬í•¨ë˜ì–´ìˆëŠ” ì•„ë˜ì™€ ê°™ì€ ìœ í‹¸ í•¨ìˆ˜ë“¤ì„ ì´ìš©í•´ë„ ë¬¸ìì—´ì„ Localeë¡œ ì˜¬ë°”ë¥´ê²Œ ë³€í™˜í•  ìˆ˜ ìˆë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span></span>LocaleUtils</span><span class="token punctuation">.</span><span class="token function">toLocale</span><span class="token punctuation">(</span><span class="token string">"ko_KR"</span><span class="token punctuation">)</span>l<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>StringUtils</span><span class="token punctuation">.</span><span class="token function">parseLocale</span><span class="token punctuation">(</span><span class="token string">"ko_KR"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;Locale-forLanguageTag&quot;&gt;&lt;a href=&quot;#Locale-forLanguageTag&quot; class=&quot;headerlink&quot; title=&quot;Locale.forLanguageTag&quot;&gt;&lt;/a&gt;Locale.forLanguageTag&lt;/</summary>
      
    
    
    
    
    <category term="Locale" scheme="https://kdevkr.github.io/tags/Locale/"/>
    
    <category term="LocaleUtils" scheme="https://kdevkr.github.io/tags/LocaleUtils/"/>
    
    <category term="StringUtils" scheme="https://kdevkr.github.io/tags/StringUtils/"/>
    
  </entry>
  
</feed>
