<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Mambo</title>
  
  <subtitle>Today I Learned π”¥</subtitle>
  <link href="https://kdevkr.github.io/atom.xml" rel="self"/>
  
  <link href="https://kdevkr.github.io/"/>
  <updated>2024-08-18T03:32:21.427Z</updated>
  <id>https://kdevkr.github.io/</id>
  
  <author>
    <name>Mambo</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Spring Security - Rejected Request</title>
    <link href="https://kdevkr.github.io/spring-security-rejected-request/"/>
    <id>https://kdevkr.github.io/spring-security-rejected-request/</id>
    <published>2024-08-18T02:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.427Z</updated>
    
    <content type="html"><![CDATA[<pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span>firewall<span class="token punctuation">.</span></span>RequestRejectedException</span><span class="token operator">:</span> <span class="token class-name">The</span> request was rejected because the <span class="token constant">URL</span> contained a potentially malicious <span class="token class-name">String</span> <span class="token string">"//"</span></code></pre><ul><li><a href="https://www.baeldung.com/spring-security-request-rejected-exception">Spring Security β€“ Request Rejected Exception</a></li></ul><h4 id="μ”μ²­μ΄-κ±°λ¶€λλ”-μ΄μ "><a href="#μ”μ²­μ΄-κ±°λ¶€λλ”-μ΄μ " class="headerlink" title="μ”μ²­μ΄ κ±°λ¶€λλ” μ΄μ "></a>μ”μ²­μ΄ κ±°λ¶€λλ” μ΄μ </h4><p>μΌλ°μ μΌλ΅ μ¤ν”„λ§ λ¶€νΈ κΈ°λ°μ μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ <strong>μ¤ν”„λ§ μ‹νλ¦¬ν‹°λ¥Ό μ‚¬μ©ν–λ‹¤λ©΄</strong> κΈ°λ³Έμ μΌλ΅ μ μ©λλ” HttpFirewall κµ¬ν„μ²΄μ— μν•΄ μ—°μ†λλ” μ¬λμ‹ λ¬Έμλ¥Ό ν—μ©ν•μ§€ μ•λ„λ΅ λμ–΄μλ‹¤. REST APIλ΅ λ””μμΈν•λ” κ²½μ° <strong>PathVariable</strong> λ΅ κ²½λ΅ μƒμ λ¦¬μ†μ¤ μ•„μ΄λ””λ¥Ό κ²€μ¦ν•λ” κ²½μ°κ°€ λ€λ¶€λ¶„μ΄λ‹¤. λ”°λΌμ„, λ€λ¶€λ¶„μ κ²½μ° <strong>URL κ²½λ΅ μƒ μ—°μ†λ μ¬λμ‹ λ¬Έμλ” μ„λ²„ μ…μ¥μ—μ„ μλ»λ μ”μ²­</strong>μ— ν•΄λ‹Ήλλ‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">WebSecurityCustomizer</span> <span class="token function">webSecurityCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> webSecurity <span class="token operator">-></span> webSecurity<span class="token punctuation">.</span><span class="token function">httpFirewall</span><span class="token punctuation">(</span><span class="token function">httpFirewall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">ignoring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestMatchers</span><span class="token punctuation">(</span><span class="token string">"/error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">HttpFirewall</span> <span class="token function">httpFirewall</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// NOTE: Spring Security provides DefaultHttpFirewall and StrictHttpFirewall.</span>    <span class="token class-name">StrictHttpFirewall</span> httpFirewall <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StrictHttpFirewall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    httpFirewall<span class="token punctuation">.</span><span class="token function">setAllowSemicolon</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    httpFirewall<span class="token punctuation">.</span><span class="token function">setAllowNull</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    httpFirewall<span class="token punctuation">.</span><span class="token function">setAllowBackSlash</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    httpFirewall<span class="token punctuation">.</span><span class="token function">setAllowUrlEncodedDoubleSlash</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> allowedHttpMethods <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>                    <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span>                    <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">,</span>                    <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">PUT</span><span class="token punctuation">,</span>                    <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">DELETE</span><span class="token punctuation">,</span>                    <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">OPTIONS</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">HttpMethod</span><span class="token operator">::</span><span class="token function">name</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    httpFirewall<span class="token punctuation">.</span><span class="token function">setAllowedHttpMethods</span><span class="token punctuation">(</span>allowedHttpMethods<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> httpFirewall<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="κ±°λ¶€λ-μ”μ²­μ„-λ¬΄μ‹ν•μ§€-λ§κ³ -μ¶”μ ν•μ„Έμ”"><a href="#κ±°λ¶€λ-μ”μ²­μ„-λ¬΄μ‹ν•μ§€-λ§κ³ -μ¶”μ ν•μ„Έμ”" class="headerlink" title="κ±°λ¶€λ μ”μ²­μ„ λ¬΄μ‹ν•μ§€ λ§κ³  μ¶”μ ν•μ„Έμ”"></a>κ±°λ¶€λ μ”μ²­μ„ λ¬΄μ‹ν•μ§€ λ§κ³  μ¶”μ ν•μ„Έμ”</h4><p>μ¬λ°”λ¥Έ ν΄λΌμ΄μ–ΈνΈκ°€ μ•„λ‹ λ΄‡μ— μν• μλ»λ μ”μ²­μΌ μ μμΌλ‚ <strong>ν”„λ΅ νΈμ—”λ“ κ°λ°μκ°€ μ„λ²„μ—μ„ μ”κµ¬ν•λ” REST API μ„¤κ³„λ€λ΅ μ”μ²­ν•μ§€ μ•μ•μ„ κ°€λ¥μ„±</strong>μ„ κ°„κ³Όν•΄μ„λ” μ•λλ‹¤. μ„λ²„μ—μ„λ” μµμ†ν• μ΄λ¬ν• μ”μ²­μ— λ€ν•΄μ„ <strong>μ¤λ¥ λ©”μ‹μ§€ λλ” <a href="https://engineering.linecorp.com/ko/blog/log-collection-system-sentry-on-premise">Sentry</a>μ™€ κ°™μ€ μ¤λ¥ μ¶”μ  μ†”λ£¨μ…μΌλ΅ λ¶„μ„ν•  μ μλ„λ΅ λ‚¨κ²¨μ•Ό</strong>ν•λ‹¤.</p><blockquote><p>λ§μ•½, <a href="https://docs.aws.amazon.com/waf/latest/developerguide/classic-web-acl-string-conditions.html">AWS WAF</a>λ¥Ό μ‚¬μ©ν•λ‹¤λ©΄ μ„¤μ •κ³Ό κ·μΉ™μ— λ”°λΌ λ”λΈ” μ¬λμ‹κ°€ ν¬ν•¨λ μ”μ²­μ΄ μ„λ²„ μ• ν”λ¦¬μΌ€μ΄μ…κΉμ§€ λ„λ‹¬ν•μ§€ μ•μ„ μ μμμ„ λ°±μ—”λ“ κ°λ°μλ” μ•κ³  μμ–΄μ•Ό ν•©λ‹λ‹¤.</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;pre class=&quot;language-java&quot; data-language=&quot;java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org</summary>
      
    
    
    
    
    <category term="Spring Security" scheme="https://kdevkr.github.io/tags/Spring-Security/"/>
    
    <category term="Firewall" scheme="https://kdevkr.github.io/tags/Firewall/"/>
    
  </entry>
  
  <entry>
    <title>λ””λ²„κ·Έ</title>
    <link href="https://kdevkr.github.io/debugging/"/>
    <id>https://kdevkr.github.io/debugging/</id>
    <published>2024-08-17T03:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.419Z</updated>
    
    <content type="html"><![CDATA[<p><strong>κ°λ°μ λλ” μ—”μ§€λ‹μ–΄</strong>κ°€ μ‹μ¤ν… μ¤λ¥μ— λ€ν• μ›μΈμ„ μ°ΎκΈ° μ„ν• <strong>κ°€μ¥ κ°„λ‹¨ν• λ°©λ²•μ€ System.out.println λλ” console.logμ™€ κ°™μ€ λ©”μ‹μ§€λ¥Ό λ‚¨κ²¨λ³΄λ”</strong> κ±Έ κ±°μ—μ”. κ·Έλ ‡μ§€λ§ κ°λ° μƒμ‚°μ„±μ„ μ„ν•΄μ„λ” μΈν…”λ¦¬μ μ΄ λλ” VSCode λΏλ§ μ•„λ‹λΌ ν¬λ΅¬ κ°λ°μ λ„κµ¬μ—μ„ μ κ³µν•λ” <strong>λ””λ²„κ±°λ¥Ό ν†µν•΄ μ›ν•λ” μ½”λ“ λΌμΈμ— μ¤‘λ‹¨μ (Breakpoint)λ¥Ό κ±Έμ–΄</strong> μ „ν›„ μƒν™©μ— λ€ν• λ°μ΄ν„°λ¥Ό ν™•μΈν•λ” κ²ƒλ„ μ¤‘μ”ν•©λ‹λ‹¤. μ†ν”„νΈμ›¨μ–΄ κ°λ°μκ°€ μ—¬λ¬κ°€μ§€ μƒν™©μ— λ”°λΌ μ–΄λ–»κ² μ›μΈμ„ μ°Ύμ•„κ° μ μλ”μ§€ μ•μ•„λ΄…λ‹λ‹¤.</p><h4 id="ν¬λ΅¬-κ°λ°μ-λ„κµ¬μ-λ„¤νΈμ›ν¬-μ”μ²­μ€-ν™•μΈν• -μ¤„-μ•μ•„μ•Ό"><a href="#ν¬λ΅¬-κ°λ°μ-λ„κµ¬μ-λ„¤νΈμ›ν¬-μ”μ²­μ€-ν™•μΈν• -μ¤„-μ•μ•„μ•Ό" class="headerlink" title="ν¬λ΅¬ κ°λ°μ λ„κµ¬μ λ„¤νΈμ›ν¬ μ”μ²­μ€ ν™•μΈν•  μ¤„ μ•μ•„μ•Ό"></a>ν¬λ΅¬ κ°λ°μ λ„κµ¬μ λ„¤νΈμ›ν¬ μ”μ²­μ€ ν™•μΈν•  μ¤„ μ•μ•„μ•Ό</h4><p>λ°±μ—”λ“ κ°λ°μλΌλ©΄ μ„λ²„μ— λ‚¨μ€ μ¤λ¥ λ©”μ‹μ§€λ¥Ό ν†µν•΄ λμ— λ³΄μ΄μ§€ μ•λ” λ°±κ·ΈλΌμ΄λ“μ—μ„ μ›μΈμ„ νΉμ •ν•  μλ„ μμ§€λ§ κ°€μ¥ κΈ°λ³Έμ μΌλ΅λ” ν¬λ΅¬ λΈλΌμ°μ €μ λ„¤νΈμ›ν¬ νƒ­μ„ ν†µν•΄ λ¬Έμ μ— λ€ν• μƒν™©μ—μ„ μ–΄λ–»κ² λ„¤νΈμ›ν¬ μ”μ²­μ΄ μ΄λ£¨μ–΄μ§€λ”μ§€ ν™•μΈν•λ” κ²ƒμ΄ ν•„μ”ν•λ‹¤. λ¬Έμ μ— λ€ν• μƒν™©μ— λ€ν•΄μ„ ν…μ¤νΈ μ—”μ§€λ‹μ–΄κ°€ μ¬ν„ μƒν™©μ— λ€ν•΄ μƒμ„Έν•κ² λ²„κ·Έ λ¦¬ν¬νΈλ¥Ό λ“±λ΅ν•΄μ¤„ μλ„ μμ§€λ§ μ΅°μ§ λ‚΄μ— ν…μ¤νΈ μ—”μ§€λ‹μ–΄κ°€ μ—†κ±°λ‚ λ°”μλ‹¤λ©΄ κ°λ°μκ°€ μ§μ ‘ μν–‰ν•΄λ³΄κ³  μ›μΈμ„ μ°Ύμ•„μ•Όλ§ ν•λ‹¤.</p><p><a href="https://www.youtube.com/watch?v=e1gAyQuIFQo">Inspect Network Activity - Chrome DevTools 101</a></p><ul><li>λ„¤νΈμ›ν¬ μ”μ²­μ— λΉ¨κ°„μƒ‰μΌλ΅ ν‘μ‹λλ” κ²ƒμ΄ μλ”μ§€ ν™•μΈν•κΈ°</li><li>νΉμ • λ™μ‘ μ‹ λ°μƒν•λ” λ„¤νΈμ›ν¬ μ”μ²­ μ²΄ν¬ν•κΈ°</li><li>μ”μ²­ νλΌλ―Έν„° λλ” λ³Έλ¬Έκ³Ό μ¤λ¥ μ‘λ‹µ ν™•μΈν•κΈ°</li></ul><h4 id="μ¤λ¥κ°€-λ°μƒν•λ”-APIμ™€-λΉ„μ¦λ‹μ¤-λ΅μ§-μ²΄ν¬"><a href="#μ¤λ¥κ°€-λ°μƒν•λ”-APIμ™€-λΉ„μ¦λ‹μ¤-λ΅μ§-μ²΄ν¬" class="headerlink" title="μ¤λ¥κ°€ λ°μƒν•λ” APIμ™€ λΉ„μ¦λ‹μ¤ λ΅μ§ μ²΄ν¬"></a>μ¤λ¥κ°€ λ°μƒν•λ” APIμ™€ λΉ„μ¦λ‹μ¤ λ΅μ§ μ²΄ν¬</h4><p>ν¬λ΅¬ κ°λ°μ λ„κµ¬λ¥Ό ν†µν•΄ λ„¤νΈμ›ν¬ μ”μ²­μ— λ€ν•΄ λ¶„μ„ν–λ‹¤λ©΄ λ°±μ—”λ“ κ°λ°μλ” μ„λ²„ μ• ν”λ¦¬μΌ€μ΄μ…μ— κµ¬ν„ν• APIμ™€ μ„λΉ„μ¤ λ μ΄μ–΄μ λΉ„μ¦λ‹μ¤ λ΅μ§μ„ κ²€ν† ν•΄μ•Όν•λ‹¤. μ΄λ• μ½”λ“μ— λ΅κ·Έ λ©”μ‹μ§€λ¥Ό λ‚¨κ²¨ μ¶λ ¥ν•λ” κ²ƒλ³΄λ‹¤λ” μΈν…”λ¦¬μ μ΄μ—μ„ μ κ³µν•λ” λ””λ²„κ±°λ΅ μ¤‘λ‹¨μ μ„ κ±°λ” κ²ƒμ΄ λ” ν¨μ¨μ μ΄λ‹¤. λ§μ•½, νμ‚¬μ—μ„ μΈν…”λ¦¬μ μ΄λ¥Ό μ‚¬μ©ν•κ³  μλ‹¤λ©΄ μ•„λμ μ •λ³΄λ“¤μ΄ λ„μ›€μ΄ λ  κ²ƒμ΄λ‹¤.</p><ul><li><a href="https://blog.jetbrains.com/idea/2023/02/debugger-upskill-stepping/">Debugger Upskill: Basic and Advanced Stepping</a></li><li><a href="https://www.youtube.com/watch?v=ZbAVoypAIbE">IntelliJ IDEA: Debugger Upskill</a></li></ul><hr><p>μΌλ°μ μΌλ΅ λ€λ¶€λ¶„μ μ¤λ¥λ” μ¬λ°”λ¥΄κ² μ”μ²­λμ§€ μ•μ•κ±°λ‚ μ ν¨μ„± κ²€μ‚¬μ λ¶€μ΅±μΌλ΅μΈν•΄ μλ„λ λ°μ΄ν„°κ°€ μƒλµλμ–΄μκ±°λ‚ ν…μ¤νΈ μ½”λ“μ λ¶€μ¬ λλ” λ¶€μ‹¤ν• μ½”λ“λ΅ μΈν•΄ μΌλ¶€ μΌ€μ΄μ¤μ— λ€ν•΄ κ²€μ¦λμ§€ μ•μ€ λΉ„μ¦λ‹μ¤ λ΅μ§μ— ν•΄λ‹Ήλ©λ‹λ‹¤. <strong>κ·Έλλ„ μ›μΈμ΄ λ…ν™•ν•μ§€ μ•λ‹¤λ©΄</strong> λ•λ΅λ” λ™λ£μ™€μ μ»¤λ®¤λ‹μΌ€μ΄μ…μ„ ν•΄λ³΄λ” κ²ƒλ„ λ””λ²„κ·Έ λ°©λ²• μ¤‘ ν•λ‚λΌκ³  μƒκ°ν•©λ‹λ‹¤. λ™λ£μ—κ² λ„μ›€μ„ μ”μ²­ν•  λ•μ—λ” μ–΄λ””κΉμ§€ ν™•μΈμ„ ν•΄λ³΄μ•λ”μ§€ μƒμ„Έν•κ² κ³µμ ν•λ” κ²ƒλ„ ν•„μ”ν•κ² μ£ ?</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;κ°λ°μ λλ” μ—”μ§€λ‹μ–΄&lt;/strong&gt;κ°€ μ‹μ¤ν… μ¤λ¥μ— λ€ν• μ›μΈμ„ μ°ΎκΈ° μ„ν• &lt;strong&gt;κ°€μ¥ κ°„λ‹¨ν• λ°©λ²•μ€ System.out.println λλ” console.logμ™€ κ°™μ€ λ©”μ‹μ§€λ¥Ό λ‚¨κ²¨λ³΄λ”&lt;/strong&gt; κ±Έ κ±°μ—μ”. κ·Έλ ‡μ§€</summary>
      
    
    
    
    
    <category term="Debug" scheme="https://kdevkr.github.io/tags/Debug/"/>
    
    <category term="Debugger" scheme="https://kdevkr.github.io/tags/Debugger/"/>
    
  </entry>
  
  <entry>
    <title>E.164</title>
    <link href="https://kdevkr.github.io/e164/"/>
    <id>https://kdevkr.github.io/e164/</id>
    <published>2024-08-15T11:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.419Z</updated>
    
    <content type="html"><![CDATA[<h4 id="What-is-the-E-164-format"><a href="#What-is-the-E-164-format" class="headerlink" title="What is the E.164 format?"></a>What is the E.164 format?</h4><p><strong>E.164</strong>λ” μ „μ„Έκ³„μ μΌλ΅ μ‚¬μ©λλ” κµ­μ μ „ν™”λ²νΈμ— λ€ν• ν‘μ¤€ ν•μ‹μ΄λ‹¤. λ¬Έμ λ©”μ‹μ§€ λλ” μ™“μΈ μ•± κ·Έλ¦¬κ³  μΉ΄μΉ΄μ¤ μ•λ¦Όν†΅μ„ λ³΄λ‚΄κΈ° μ„ν•΄μ„ <a href="https://docs.aws.amazon.com/ko_kr/sns/latest/dg/sms_publish-to-phone.html">λ°μ†΅ μΈν„°νμ΄μ¤ λ¬Έμ„</a>λ¥Ό ν™•μΈν•΄λ³΄λ©΄ ν΄λ€ν° λ²νΈ ν•„λ“μ— E.164 ν•μ‹μ κ°’μ„ μ”κµ¬ν•λ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤. κΈ€λ΅λ² μ„λΉ„μ¤λ‚ μ†”λ£¨μ…μ„ μ¤€λΉ„ν•λ‹¤λ©΄ ν”„λ΅ νΈμ—”λ“μ—μ„λ„ <a href="https://github.com/jackocnr/intl-tel-input">κµ­κ°€λ³„ μ „ν™”λ²νΈλ¥Ό μ…λ ¥ν•  μ μλ” μ»΄ν¬λ„νΈ</a>λ¥Ό μ¤€λΉ„ν•λ” νΈμ΄λ‹¤.</p><p><img data-src="https://file.okky.kr/images/1723708024170.png"></p><h4 id="821012345678"><a href="#821012345678" class="headerlink" title="+821012345678"></a>+821012345678</h4><ul><li>μΌλ°μ μΌλ΅ κ³µλ°±μ„ ν¬ν•¨ν•μ§€ μ•λ” κ²ƒμΌλ΅ ν‘ν„ν•λ‹¤.</li><li>μ „ν™”λ²νΈλ” 0μΌλ΅ μ‹μ‘ν•λ” λ¶€λ¶„μ€ μƒλµν•λ‹¤.</li><li>ν•κµ­μ κµ­κ°€ λ²νΈ(country code)λ” 82 μ΄λ©° μ΄λ™ν†µμ‹ λ§(area code)μ€ 10 μ΄λ‹¤.</li><li>ITU-Tμ E.164λ” μµλ€ 15μλ¦¬μ΄λ‹¤.</li></ul><h4 id="μ°Έκ³ -λ§ν¬"><a href="#μ°Έκ³ -λ§ν¬" class="headerlink" title="μ°Έκ³  λ§ν¬"></a>μ°Έκ³  λ§ν¬</h4><ul><li><a href="https://www.twilio.com/docs/glossary/what-e164">What is E.164? | Twilio Docs</a></li><li><a href="http://www.ktword.co.kr/test/view/view.php?no=1970">E.164 | μ •λ³΄ν†µμ‹ κΈ°μ μ©μ–΄ν•΄μ„¤</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;What-is-the-E-164-format&quot;&gt;&lt;a href=&quot;#What-is-the-E-164-format&quot; class=&quot;headerlink&quot; title=&quot;What is the E.164 format?&quot;&gt;&lt;/a&gt;What is the E</summary>
      
    
    
    
    
    <category term="Phone Number" scheme="https://kdevkr.github.io/tags/Phone-Number/"/>
    
  </entry>
  
  <entry>
    <title>REST Assured</title>
    <link href="https://kdevkr.github.io/rest-assured/"/>
    <id>https://kdevkr.github.io/rest-assured/</id>
    <published>2024-08-09T14:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.423Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://rest-assured.io/">REST Assured</a>λ¥Ό μ‚¬μ©ν•λ©΄ μλ°” μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ <strong>μΈμ ν…μ¤νΈ</strong>λ¥Ό μ„ν• μ½”λ“λ¥Ό μ‘μ„±ν•  μ μλ‹¤. ν„μ¬ μ΅°μ§μ€ ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€λ¥Ό μ²΄ν¬ν•μ§€ μ•κ³  λΉ„μ¦λ‹μ¤ λ μ΄μ–΄λ¥Ό μ„μ£Όλ΅ ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•κΈ°λ΅ ν–μ—λ‹¤. μ¨ν”„λ λ―Έμ¤ ν•νƒμ B2B μ†”λ£¨μ…μ΄ μ•„λ‹ <strong>SaaS μ„λΉ„μ¤</strong>λ¥Ό μ¤€λΉ„ν•λ©΄μ„ <strong>ν…μ¤νΈ μλ™ν™”</strong>λ¥Ό μ„ν•΄ λ§μ€ κ³ λ―Όμ„ ν•κ³  μλ‹¤. μΌλ‹¨ <a href="https://playwright.dev/">Playwright</a>μ™€ <a href="https://allurereport.org/">Allure Report</a>λ¥Ό μ‚¬μ©ν•κ³ μ μ¤€λΉ„μ¤‘μ΄λΌ μ΄μ— λ§μ¶° μ„λΉ„μ¤ κ°λ° μ‹ Allure Reportμ™€ ν†µν•©ν•  μ μλ” <strong>JUnit5 + Rest Assured</strong>λ΅ ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•λ ¤κ³  ν•λ‹¤.</p><h4 id="Gradle-Dependencies"><a href="#Gradle-Dependencies" class="headerlink" title="Gradle Dependencies"></a>Gradle Dependencies</h4><p>Rest Assured μ™€ ν•¨κ» <a href="https://hamcrest.org/JavaHamcrest/">Hamcrest</a>λ¥Ό λ§μ΄ μ‚¬μ©ν•λ” κ²ƒ κ°™μ€λ° μ¤ν”„λ§ λ¶€νΈ μ¤νƒ€ν„°μ ν…μ¤νΈ μμ΅΄μ„±μ—λ” κΈ°λ³Έμ μΌλ΅ Hamcrestλ¥Ό ν¬ν•¨ν•κ³  μλ‹¤. λ‹¨μ„ ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•  λ• Hamcrestλ¥Ό μ‚¬μ©ν•΄λ³Έμ μ€ μ—†μ–΄μ„ μ΄λ² κΈ°νμ— μ ν™μ©ν•΄λ³΄λ„λ΅ ν•΄μ•Όκ² λ‹¤.</p><pre class="language-groovy" data-language="groovy"><div class="caption"><span>build.gradle</span></div><code class="language-groovy">dependencies <span class="token punctuation">&#123;</span>    testImplementation <span class="token string">'org.springframework.boot:spring-boot-starter-test'</span>    testImplementation <span class="token string">'io.rest-assured:rest-assured:5.5.0'</span><span class="token punctuation">&#125;</span></code></pre><h4 id="Behavior-Driven-Development"><a href="#Behavior-Driven-Development" class="headerlink" title="Behavior Driven Development"></a>Behavior Driven Development</h4><p>κ·Έλ™μ•μ€ ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•λ”λΌλ„ TDDλ¥Ό μν–‰ν•μ§€λ” μ•μ•μΌλ©° μ†”λ£¨μ… μ»¤μ¤ν„°λ§μ΄μ§• μ”κµ¬μ‚¬ν•­μ— λ§λ”μ§€λ§ ν™•μΈν•΄μ™”λ‹¤. Rest Assuredλ” BDDλ΅ E2E ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•  μ μλ„λ΅ μ κ³µν•΄μ£ΌκΈ° λ•λ¬Έμ— ν”„λ΅ νΈμ—”λ“λ‚ QA μ—”μ§€λ‹μ–΄κ°€ μ‘μ„±ν•λ” Playwright μ™€λ„ λΉ„μ·ν•κ² μ‘μ„±ν•΄κ° μ μμ„ κ²ƒμΌλ΅ λ³΄μΈλ‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">"End to End Test"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">SpringBootTest<span class="token punctuation">.</span>WebEnvironment</span><span class="token punctuation">.</span><span class="token constant">RANDOM_PORT</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">DemoApplicationTests</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@LocalServerPort</span>    <span class="token keyword">int</span> port<span class="token punctuation">;</span>    <span class="token annotation punctuation">@BeforeEach</span>    <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">RestAssured</span><span class="token punctuation">.</span>port <span class="token operator">=</span> port<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">void</span> <span class="token function">whenGet_thenOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">RestAssured</span>                <span class="token punctuation">.</span><span class="token function">given</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AllureRestAssured</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaders</span><span class="token punctuation">.</span><span class="token constant">USER_AGENT</span><span class="token punctuation">,</span>                        <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ifValidationFails</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">Matchers</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="Allure-REST-Assured"><a href="#Allure-REST-Assured" class="headerlink" title="Allure REST Assured"></a>Allure REST Assured</h4><p>κ·Έλλ“¤ ν”λ¬κ·ΈμΈμ„ μ¶”κ°€ν•κ³  <strong>allureReport</strong> λλ” <strong>allureServe</strong> νƒμ¤ν¬λ¥Ό μ‹¤ν–‰ν•λ©΄ Allure λ¦¬ν¬νΈλ¥Ό ν™•μΈν•  μ μλ‹¤.</p><pre class="language-groovy" data-language="groovy"><div class="caption"><span>build.gradle</span></div><code class="language-groovy">plugins <span class="token punctuation">&#123;</span>    id <span class="token string">'io.qameta.allure'</span> version <span class="token string">'2.12.0'</span><span class="token punctuation">&#125;</span>dependencies <span class="token punctuation">&#123;</span>    testImplementation <span class="token function">platform</span><span class="token punctuation">(</span><span class="token string">'io.qameta.allure:allure-bom:2.28.0'</span><span class="token punctuation">)</span>    testImplementation <span class="token interpolation-string"><span class="token string">"io.qameta.allure:allure-junit5"</span></span>    testImplementation <span class="token interpolation-string"><span class="token string">"io.qameta.allure:allure-rest-assured"</span></span><span class="token punctuation">&#125;</span></code></pre><p><img data-src="/images/posts/rest-assured/01.png" alt="Allure Report"></p><h4 id="μ°Έκ³ -λ§ν¬"><a href="#μ°Έκ³ -λ§ν¬" class="headerlink" title="μ°Έκ³  λ§ν¬"></a>μ°Έκ³  λ§ν¬</h4><ul><li><a href="https://www.baeldung.com/rest-assured-tutorial">A Guide to REST-assured</a></li><li><a href="https://www.baeldung.com/rest-assured-header-cookie-parameter">Headers, Cookies and Parameters with REST-assured</a></li><li><a href="https://www.baeldung.com/rest-assured-response">Getting and Verifying Response Data with REST-assured</a></li><li><a href="https://www.baeldung.com/rest-assured-authentication">REST Assured Authentication</a></li><li><a href="https://allurereport.org/docs/restassured/">Allure REST Assured</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://rest-assured.io/&quot;&gt;REST Assured&lt;/a&gt;λ¥Ό μ‚¬μ©ν•λ©΄ μλ°” μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ &lt;strong&gt;μΈμ ν…μ¤νΈ&lt;/strong&gt;λ¥Ό μ„ν• μ½”λ“λ¥Ό μ‘μ„±ν•  μ μλ‹¤. ν„μ¬ μ΅°μ§μ€ ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€λ¥Ό μ²΄ν¬ν•μ§€ μ•κ³  </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>μ ν¨μ„± κ²€μ¦</title>
    <link href="https://kdevkr.github.io/validation/"/>
    <id>https://kdevkr.github.io/validation/</id>
    <published>2024-08-07T13:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.427Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>μ„λ²„ μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ μΆ‹μ€ REST APIλ¥Ό μ„¤κ³„ν•λ” κ²ƒμ—λ” μλ»λ μ”μ²­μ— λ€ν•΄ μ ν¨μ„± κ²€μ‚¬λ¥Ό ν¬ν•¨ν•μ—¬ μ¬λ°”λ¥΄κ² μμ™Έλ¥Ό μ²λ¦¬ν•λ” κ²ƒλ„ ν¬ν•¨λ©λ‹λ‹¤.</p></blockquote><p>μλ°” μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ <strong>μ ν¨μ„± κ²€μ¦(Validation)</strong> μ€ JSR-303 κ³Ό μ¤ν”„λ§ ν”„λ μ„μ›ν¬μ—μ„ μ κ³µν•λ” μ¶”μƒν™”λ¥Ό ν†µν•΄ μ‰½κ³  μ μ—°ν•κ² μ ν¨μ„± κ²€μ¦μ„ μν–‰ν•  μ μλ‹¤. μ•„λμ μ¤ν”„λ§ λ¶€νΈ μ¤νƒ€ν„°λ¥Ό μ¶”κ°€ν•λ©΄ <strong>hibernate-validator</strong> κ°€ ν¬ν•¨λμ–΄μλ‹¤.</p><pre class="language-groovy" data-language="groovy"><div class="caption"><span>build.gradle</span></div><code class="language-groovy">implementation <span class="token string">'org.springframework.boot:spring-boot-starter-validation'</span></code></pre><h4 id="μ¬λ°”λ¥΄μ§€-μ•μ€-μ”μ²­μ—-λ€ν•-μμ™Έ-λ©λ΅"><a href="#μ¬λ°”λ¥΄μ§€-μ•μ€-μ”μ²­μ—-λ€ν•-μμ™Έ-λ©λ΅" class="headerlink" title="μ¬λ°”λ¥΄μ§€ μ•μ€ μ”μ²­μ— λ€ν• μμ™Έ λ©λ΅"></a>μ¬λ°”λ¥΄μ§€ μ•μ€ μ”μ²­μ— λ€ν• μμ™Έ λ©λ΅</h4><p>μ ν¨μ„± κ²€μ‚¬λ¥Ό ν¬ν•¨ν•μ—¬ μλ»λ μ”μ²­μ— λ€ν•΄μ„ λ°μƒν•λ” μμ™Έλ” μ•„λμ™€ κ°™λ‹¤.</p><ul><li>MissingPathVariableException - κ²½λ΅ λ³€μκ°€ μ§€μ •λ νλΌλ―Έν„°κ°€ μ—†κ±°λ‚ κ²½λ΅ λ³€μμ— λΉ κ°’μ΄ μ£Όμ–΄μ§„ κ²½μ°</li><li>MethodArgumentTypeMismatchException - λ°”μΈλ”© λ°μ΄ν„°λ¥Ό νλΌλ―Έν„°λ΅ λ³€ν™ν•  μ μ—†λ” κ²½μ°</li><li>HttpMessageNotReadableException - μ”μ²­ λ°”λ””λ¥Ό μ¬λ°”λ¥΄κ² μ²λ¦¬ν•  μ μ—†λ” κ²½μ°</li><li>MissingServletRequestParameterException - ν•„μ νλΌλ―Έν„°κ°€ ν¬ν•¨λμ§€ μ•μ€ κ²½μ°</li><li>MethodArgumentNotValidException - νΌ λ°μ΄ν„° λλ” μ”μ²­ λ°”λ””κ°€ μ ν¨μ„± κ²€μ‚¬μ— ν†µκ³Όν•μ§€ λ»ν• κ²½μ°</li><li>ConstraintViolationException - κ²½λ΅ λ³€μ λλ” μ”μ²­ νλΌλ―Έν„°κ°€ μ ν¨μ„± κ²€μ‚¬μ— ν†µκ³Όν•μ§€ λ»ν• κ²½μ°</li><li>HttpRequestMethodNotSupportedException - μ§€μ›ν•μ§€ μ•λ” HTTP ν•¨μλ΅ μ”μ²­ν• κ²½μ°</li></ul><blockquote><p>UnexpectedTypeExceptionλ” μ ν¨μ„± κ²€μ‚¬λ¥Ό μ„ν•΄ μλ»λ μ ν•μ„ μ§€μ •ν•μ€μ„ κ²½μ°μ— λ°μƒν•λ―€λ΅ μλ»λ μ”μ²­μ΄ μ•„λ‹ μ„λ²„ μ¤λ¥μ— ν•΄λ‹Ήλ©λ‹λ‹¤.<br>μλ¥Ό λ“¤μ–΄, Integer λλ” Longκ³Ό κ°™μ€ νλΌλ―Έν„°μ— @NotBlankλ¥Ό μ„ μ–Έν–μ„λ• ν™•μΈν•  μ μμµλ‹λ‹¤.</p></blockquote><h4 id="μ ν¨μ„±-κ²€μ‚¬-μμ™Έ-λ©”μ‹μ§€λ¥Ό-ν™•μΈν•λ”-μ†μ„±"><a href="#μ ν¨μ„±-κ²€μ‚¬-μμ™Έ-λ©”μ‹μ§€λ¥Ό-ν™•μΈν•λ”-μ†μ„±" class="headerlink" title="μ ν¨μ„± κ²€μ‚¬ μμ™Έ λ©”μ‹μ§€λ¥Ό ν™•μΈν•λ” μ†μ„±"></a>μ ν¨μ„± κ²€μ‚¬ μμ™Έ λ©”μ‹μ§€λ¥Ό ν™•μΈν•λ” μ†μ„±</h4><p>μ¤ν”„λ§ λ¶€νΈ μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ κΈ°λ³Έμ μΈ μ¤λ¥ μ‘λ‹µμ— μ ν¨μ„± κ²€μ‚¬μ— λ€ν• λ©”μ‹μ§€λ¥Ό ν¬ν•¨ν•μ—¬ ν™•μΈν•κ³  μ‹¶λ‹¤λ©΄ μ•„λμ™€ κ°™μ΄ <code>server.error</code> μ†μ„±μ„ μ„¤μ •ν•λ©΄ λλ‹¤.</p><pre class="language-yaml" data-language="yaml"><div class="caption"><span>application.yml</span></div><code class="language-yaml"><span class="token key atrule">server.error</span><span class="token punctuation">:</span>  <span class="token key atrule">include-exception</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">include-binding-errors</span><span class="token punctuation">:</span> always  <span class="token key atrule">include-message</span><span class="token punctuation">:</span> always  <span class="token key atrule">include-stacktrace</span><span class="token punctuation">:</span> never</code></pre><h4 id="Valid-κ·Έλ¦¬κ³ -Validated"><a href="#Valid-κ·Έλ¦¬κ³ -Validated" class="headerlink" title="Valid κ·Έλ¦¬κ³  Validated"></a>Valid κ·Έλ¦¬κ³  Validated</h4><p>κΈ°λ³Έμ μΌλ΅ JSR-303 ν‘μ¤€μ μ ν¨μ„± κ²€μ‚¬λ¥Ό μ„ν• μ–΄λ…Έν…μ΄μ…μ€ @Valid μ΄λ‹¤. REST API λΏλ§ μ•„λ‹λΌ λΉ„μ¦λ‹μ¤ λ μ΄μ–΄μ—μ„λ„ μ ν¨μ„± κ²€μ‚¬λ¥Ό μν–‰ν•κ³  μ‹¶μ€ κ²½μ°μ—λ” @Validatedλ¥Ό ν™μ©ν•μ—¬μ•Ό ν•λ‹¤. λν•, <strong>@Validated</strong>λ” groups μ†μ„±μ„ ν†µν•΄ λ™μΌν• λ¨λΈμ— λ€ν•΄μ„ μƒν™©μ— λ”°λΌ μ ν¨μ„± κ²€μ¦ μ λ¬΄λ¥Ό μ„ νƒν•  μ μμ–΄ λ” μ μ—°ν•κ² μ²λ¦¬ν•  μ μλ‹¤. <strong>PathVariable</strong> κ³Ό <strong>RequestParam</strong> μ— λ€ν•΄μ„ μ ν¨μ„± κ²€μ‚¬λ¥Ό μν–‰ν•κ³ μ ν•λ” κ²½μ°μ—λ” @Validatedλ¥Ό μ»¨νΈλ΅¤λ¬ ν΄λμ¤μ— μ¶”κ°€ν•΄μ•Όν•λ‹¤.</p><h4 id="Cascaded-Validation"><a href="#Cascaded-Validation" class="headerlink" title="Cascaded Validation"></a>Cascaded Validation</h4><p>λ¨λΈ λΉ ν΄λμ¤μ— ν•μ„ κ°μ²΄λ΅ κµ¬μ„±λ ν•„λ“μ— λ€ν•΄μ„ μ ν¨μ„± κ²€μ¦μ„ μ μ©ν•κ³ μν•λ” κ²½μ°μ—λ” ν•„λ“μ— <strong>@Valid</strong>λ¥Ό μ„ μ–Έν•λ©΄ λλ‹¤. κ·Έλ ‡μ§€ μ•μ€ κ²½μ° ν•μ„ λ¨λΈμ— λ€ν•΄μ„λ” κΈ°λ³Έμ μΌλ΅ μ ν¨μ„± κ²€μ‚¬λ¥Ό μλ™μΌλ΅ μν–‰ν•μ§€ μ•λ”λ‹¤. λ‹¤μμ€ λ¦¬μ¤νΈλ΅ κµ¬μ„±λ ν•„λ“μ— κ°λ³„ μ ν¨μ„± κ²€μ‚¬λ¥Ό μν–‰ν•λ” μΌ€μ΄μ¤λ¥Ό λ³΄μ—¬μ¤€λ‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@NotBlank</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>    <span class="token annotation punctuation">@NotBlank</span>    <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token annotation punctuation">@Valid</span> <span class="token class-name">Contact</span><span class="token operator">></span> contacts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@Data</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Contact</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>max <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">)</span>        <span class="token annotation punctuation">@NotEmpty</span>        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>        <span class="token annotation punctuation">@Email</span>        <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>        <span class="token annotation punctuation">@Pattern</span><span class="token punctuation">(</span>regexp <span class="token operator">=</span> <span class="token string">"^\\+?[1-9]\\d&#123;0,2&#125;[\\s\\d]&#123;1,14&#125;$"</span><span class="token punctuation">)</span> <span class="token comment">// NOTE: E.164</span>        <span class="token keyword">private</span> <span class="token class-name">String</span> phone<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="ConstraintValidator"><a href="#ConstraintValidator" class="headerlink" title="ConstraintValidator"></a>ConstraintValidator</h4><p>JSR-303 λλ” JSR-380 ν‘μ¤€μ μ–΄λ…Έν…μ΄μ…μΌλ΅ μ»¤λ²„ν•μ§€ λ»ν•λ” μ…λ ¥κ°’μ— λ€ν• μ ν¨μ„± κ²€μ¦μ„ μ„ν•΄μ„ <strong>ConstraintValidator</strong> μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•μ—¬ μ‹μ¤ν… μ”κµ¬μ‚¬ν•­μ— λ§λ” μ ν¨μ„± κ²€μ¦μ„ μν–‰ν•  μ μλ„λ΅ κµ¬ν„ν•  μ μλ‹¤. μλ¥Ό λ“¤μ–΄, μ•μ„  μμ‹μ—μ„λ” μ „ν™”λ²νΈ μ…λ ¥ ν•„λ“μ— λ€ν•΄μ„ E.164λ¥Ό κ²€μ¦ν•κΈ° μ„ν•΄μ„ μ •κ·μ‹μ„ μ‚¬μ©ν–μ§€λ§ λ” μ μ—°ν•κ² μ…λ ¥ν•  μ μλ„λ΅ μ§€μ›ν•κΈ° μ„ν•΄μ„ <a href="https://github.com/google/libphonenumber">google&#x2F;libphonenumber</a>μ—μ„ μ κ³µν•λ” μ ν‹Έμ„ μ‚¬μ©ν• μ ν¨μ„± κ²€μ¦μ„ κµ¬ν„ν•  μ μλ‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Documented</span><span class="token annotation punctuation">@Constraint</span><span class="token punctuation">(</span>validatedBy <span class="token operator">=</span> <span class="token class-name">PhoneConstraintValidator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">FIELD</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">ANNOTATION_TYPE</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">CONSTRUCTOR</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">PARAMETER</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE_USE</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Phone</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"Invalid E.164 format: '$&#123;validatedValue&#125;'"</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Payload</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhoneConstraintValidator</span> <span class="token keyword">implements</span> <span class="token class-name">ConstraintValidator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">Phone</span> constraintAnnotation<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ConstraintValidator</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>constraintAnnotation<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token class-name">ConstraintValidatorContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">PhoneNumberUtil</span> phoneUtil <span class="token operator">=</span> <span class="token class-name">PhoneNumberUtil</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Phonenumber<span class="token punctuation">.</span>PhoneNumber</span> number <span class="token operator">=</span> phoneUtil<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token class-name">Phonenumber<span class="token punctuation">.</span>PhoneNumber<span class="token punctuation">.</span>CountryCodeSource</span><span class="token punctuation">.</span><span class="token constant">UNSPECIFIED</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> phoneUtil<span class="token punctuation">.</span><span class="token function">isPossibleNumber</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NumberParseException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="μ ν¨μ„±-κ²€μ¦-μμ™Έμ—-λ€ν•-μ¤λ¥-μ²λ¦¬"><a href="#μ ν¨μ„±-κ²€μ¦-μμ™Έμ—-λ€ν•-μ¤λ¥-μ²λ¦¬" class="headerlink" title="μ ν¨μ„± κ²€μ¦ μμ™Έμ— λ€ν• μ¤λ¥ μ²λ¦¬"></a>μ ν¨μ„± κ²€μ¦ μμ™Έμ— λ€ν• μ¤λ¥ μ²λ¦¬</h4><p>μ ν¨μ„± κ²€μ¦ μ‹¤ν¨ μ‹ λ°μ΄ν„° λ°”μΈλ”© λ°©μ‹κ³Ό μ ν¨μ„± κ²€μ¦ μ–΄λ…Έν…μ΄μ…μ— λ”°λΌ μμ™Έκ°€ λ°μƒν•λ‹¤. <strong>ExceptionHandler</strong>λ¥Ό ν†µν•΄ κ³µν†µ μ¤λ¥ μ‘λ‹µμ„ κµ¬ν„ν•κ³ μ ν•λ‹¤λ©΄ μµμ†ν• <strong>ConstraintViolationException</strong>κ³Ό <strong>MethodArgumentNotValidException</strong> μ— λ€ν•΄μ„λ” μ ν¨μ„± κ²€μ‚¬μ— λ€ν• λ©”μ‹μ§€κ°€ μ¬λ°”λ¥΄κ² ν¬ν•¨λλ„λ΅ μ‘μ„±ν•λ„λ΅ ν•μ.</p><ul><li>PathVariable, RequestParam + Validated β†’ ConstraintViolationException</li><li>RequestBody + Validated β†’ MethodArgumentNotValidException</li></ul><h4 id="μ°Έκ³ -λ§ν¬"><a href="#μ°Έκ³ -λ§ν¬" class="headerlink" title="μ°Έκ³  λ§ν¬"></a>μ°Έκ³  λ§ν¬</h4><ul><li><a href="https://jakarta.ee/specifications/bean-validation/3.0/jakarta-bean-validation-spec-3.0.html">Jakarta Bean Validation specification</a></li><li><a href="https://meetup.nhncloud.com/posts/223">Validation μ–΄λ””κΉμ§€ ν•΄λ΄¤λ‹?</a></li><li><a href="https://www.baeldung.com/spring-valid-vs-validated">Differences in @Valid and @Validated Annotations in Spring</a></li><li><a href="https://www.youtube.com/watch?v=GdKuxmtA65I">Bean Validation 2.0 - youβ€™ve put your annotations everywhere! by Gunnar Morling</a></li><li><a href="https://www.baeldung.com/java-validation">Java Bean Validation Basics</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;μ„λ²„ μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ μΆ‹μ€ REST APIλ¥Ό μ„¤κ³„ν•λ” κ²ƒμ—λ” μλ»λ μ”μ²­μ— λ€ν•΄ μ ν¨μ„± κ²€μ‚¬λ¥Ό ν¬ν•¨ν•μ—¬ μ¬λ°”λ¥΄κ² μμ™Έλ¥Ό μ²λ¦¬ν•λ” κ²ƒλ„ ν¬ν•¨λ©λ‹λ‹¤.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;μλ°” μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ &lt;strong&gt;μ </summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>λ‰΄λ λ¦­ μΈν”„λΌ μ—μ΄μ „νΈ μ„¤μΉκ°€ λμ§€ μ•μ„λ•</title>
    <link href="https://kdevkr.github.io/install-newrelic-infra-agent/"/>
    <id>https://kdevkr.github.io/install-newrelic-infra-agent/</id>
    <published>2024-08-01T13:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.419Z</updated>
    
    <content type="html"><![CDATA[<p><img data-src="/images/posts/install-newrelic-infra-agent/01.png"></p><p>λ‰΄λ λ¦­μ€ λ¬΄λ£ ν”λμ„ μ κ³µν•λ” SaaS APM μ†”λ£¨μ…μΌλ΅ μ›Ή UIμ—μ„ μ›ν•λ” μ—μ΄μ „νΈλ¥Ό μ‰½κ² μ„¤μΉν•  μ μλ„λ΅ λ…λ Ήμ–΄λ¥Ό μ κ³µν•κ³  μλ‹¤. κ·Έλ°λ°, μ•„λμ™€ κ°™μ΄ gzip κ΄€λ ¨ λ…λ Ήμ–΄κ°€ μν–‰λ  λ• μ¤λ¥κ°€ λ°μƒν•λ” κ²ƒμ„ κ²½ν—ν•  μ μλ‹¤.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-Ls</span> https://download.newrelic.com/install/newrelic-cli/scripts/install.sh <span class="token operator">|</span> <span class="token function">bash</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token assign-left variable">NEW_RELIC_API_KEY</span><span class="token operator">=</span>NRAK-XXXX <span class="token assign-left variable">NEW_RELIC_ACCOUNT_ID</span><span class="token operator">=</span>45XXXXX /usr/local/bin/newrelic <span class="token function">install</span>Installing New Relic CLI v0.92.0gzip: stdin: unexpected end of <span class="token function">file</span>tar: Child returned status <span class="token number">1</span>tar: Error is not recoverable: exiting nowAn error occurred installing the tool.The contents of the directory /tmp/tmp.ROXuwOdosK have been left <span class="token keyword">in</span> place to <span class="token builtin class-name">help</span> to debug the issue.</code></pre><p>μ„μ™€ κ°™μ€ μ¤λ¥κ°€ λ°μƒν•λ” κ²½μ°μ μ›μΈμ€ λ£¨νΈ κ¶ν•μΌλ΅ μν–‰ν•μ§€ μ•μ•κΈ° λ•λ¬Έμ΄λ©° λ£¨νΈ κ³„μ •μΌλ΅ μ‚¬μ©μλ¥Ό μ „ν™ν•μ—¬ μ„¤μΉν•λ„λ΅ ν•μ.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">su</span> -<span class="token function">curl</span> <span class="token parameter variable">-Ls</span> https://download.newrelic.com/install/newrelic-cli/scripts/install.sh <span class="token operator">|</span> <span class="token function">bash</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token assign-left variable">NEW_RELIC_API_KEY</span><span class="token operator">=</span>NRAK-XXXX <span class="token assign-left variable">NEW_RELIC_ACCOUNT_ID</span><span class="token operator">=</span>45XXXXX /usr/local/bin/newrelic <span class="token function">install</span>Installing New Relic CLI v0.92.0Installing to /usr/local/bin<span class="token punctuation">..</span>.</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img data-src=&quot;/images/posts/install-newrelic-infra-agent/01.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;λ‰΄λ λ¦­μ€ λ¬΄λ£ ν”λμ„ μ κ³µν•λ” SaaS APM μ†”λ£¨μ…μΌλ΅ μ›Ή UIμ—μ„ μ›ν•λ” μ—μ΄μ „νΈλ¥Ό μ‰½κ² μ„¤μΉν•  μ μλ„λ΅ λ…</summary>
      
    
    
    
    
    <category term="Newrelic CLI" scheme="https://kdevkr.github.io/tags/Newrelic-CLI/"/>
    
    <category term="Infrastructure Agent" scheme="https://kdevkr.github.io/tags/Infrastructure-Agent/"/>
    
  </entry>
  
  <entry>
    <title>2μ°¨ μΈμ¦ μ„¤μ •μ„ μ„ν• QR μ½”λ“</title>
    <link href="https://kdevkr.github.io/mfa-qrcode/"/>
    <id>https://kdevkr.github.io/mfa-qrcode/</id>
    <published>2024-07-20T03:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.423Z</updated>
    
    <content type="html"><![CDATA[<p>μ¤λμ€ 2μ°¨ μΈμ¦ μ„¤μ • κ³Όμ •μ—μ„ OTP μ•±μΌλ΅ μ¤μΊ”ν•  μ μλ„λ΅ μ½”λ“ λ€μ‹ μ— μ κ³µν•λ” QR μ½”λ“μ— λ€ν•΄μ„ μ•μ•„λ³΄λ ¤κ³  ν•λ‹¤.</p><h4 id="RFC-6238"><a href="#RFC-6238" class="headerlink" title="RFC 6238"></a>RFC 6238</h4><p>Google Authenticator, Microsoft Authenticator κ·Έλ¦¬κ³  Authyμ™€ κ°™μ€ OTP μΈμ¦ μ•±λ“¤μ€ <a href="https://datatracker.ietf.org/doc/html/rfc6238">RFC6238</a>λ΅ μ •μλ TOTP ν‘μ¤€μ— λ”°λΌ κµ¬ν„λμ–΄μκ³  QR μ½”λ“μ— ν¬ν•¨λλ” ν…μ¤νΈλ” <a href="https://github.com/google/google-authenticator/wiki/Key-Uri-Format">Key Uri Format</a>λ΅ κµ¬μ„±λμ–΄μ•Ό μ½μ„ μ μλ‹¤.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># otpauth://TYPE/LABEL?PARAMETERS</span>otpauth://totp/Mambo:kdevkr@email.com?secret<span class="token operator">=</span>HXDMVJECJJWSRB3HWIZR4IFUGFTMXBOZ<span class="token operator">&amp;</span><span class="token assign-left variable">issuer</span><span class="token operator">=</span>Mambo<span class="token operator">&amp;</span><span class="token assign-left variable">algorithm</span><span class="token operator">=</span>SHA1<span class="token operator">&amp;</span><span class="token assign-left variable">digits</span><span class="token operator">=</span><span class="token number">6</span><span class="token operator">&amp;</span><span class="token assign-left variable">period</span><span class="token operator">=</span><span class="token number">30</span></code></pre><h4 id="TOTP-QR-μ½”λ“-μ΄λ―Έμ§€-λ§λ“¤κΈ°"><a href="#TOTP-QR-μ½”λ“-μ΄λ―Έμ§€-λ§λ“¤κΈ°" class="headerlink" title="TOTP QR μ½”λ“ μ΄λ―Έμ§€ λ§λ“¤κΈ°"></a>TOTP QR μ½”λ“ μ΄λ―Έμ§€ λ§λ“¤κΈ°</h4><p>QR μ½”λ“ μ΄λ―Έμ§€λ¥Ό λ§λ“¤κΈ° μ„ν•΄μ„ <a href="https://github.com/samdjstevens/java-totp">java-totp</a> λΌμ΄λΈλ¬λ¦¬λ¥Ό μ‚¬μ©ν•λ ¤κ³  ν•λ‹¤. μ΄ λΌμ΄λΈλ¬λ¦¬λ” λΉ„λ°€ν‚¤ λ°κΈ‰λ¶€ν„° QR μ½”λ“λ¥Ό HTMLμ—μ„ μ‚¬μ©ν•κΈ° μ„ν• <a href="https://developer.mozilla.org/ko/docs/Web/HTTP/Basics_of_HTTP/Data_URLs">Data URI</a>λ΅ λ³€ν™ν•λ” <strong>Utils.getDataUriForImage</strong> ν•¨μλ„ μ κ³µν•΄μ£Όκ³  μλ‹¤.</p><pre class="language-groovy" data-language="groovy"><code class="language-groovy">dependencies <span class="token punctuation">&#123;</span>    implementation <span class="token string">'dev.samstevens.totp:totp:1.7.1'</span>    implementation <span class="token string">'com.google.zxing:javase:3.5.3'</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">SecretGenerator</span> secretGenerator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultSecretGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> secret <span class="token operator">=</span> secretGenerator<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">QrData</span> qrData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QrData<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">label</span><span class="token punctuation">(</span><span class="token string">"kdevkr@gmail.com"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">secret</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">issuer</span><span class="token punctuation">(</span><span class="token string">"Mambo"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">algorithm</span><span class="token punctuation">(</span><span class="token class-name">HashingAlgorithm</span><span class="token punctuation">.</span><span class="token constant">SHA1</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">digits</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">period</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">ZxingPngQrGenerator</span> qrGenerator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZxingPngQrGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>qrGenerator<span class="token punctuation">.</span><span class="token function">setImageSize</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> qrImageBytes <span class="token operator">=</span> qrGenerator<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>qrData<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> qrDataUri <span class="token operator">=</span> <span class="token class-name">Utils</span><span class="token punctuation">.</span><span class="token function">getDataUriForImage</span><span class="token punctuation">(</span>qrImageBytes<span class="token punctuation">,</span> qrGenerator<span class="token punctuation">.</span><span class="token function">getImageMimeType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>qrDataUri<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p><a href="https://zxing.org/w/decode.jspx">Zxing Decoder Online</a>μ„ μ‚¬μ©ν•μ—¬ μ¬λ°”λ¥΄κ² μ΄λ―Έμ§€κ°€ λ§λ“¤μ–΄μ΅λ”μ§€ <a href="https://zxing.org/w/decode?u=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAAD6AQAAAACgl2eQAAACoUlEQVR4Xu2YTW6rUAyFHWXAMEtgJ2VjSInExmAnLIEhA4Tf+Wzy01bqNNZT7oCSm68Sdo6PfTH/e432c+fH+gC5PkCuKsBmWn1r3WLWTD7MPl5uLZttIUB/l6sLuHrjPrhPeccXdQA7LX27fumxAeZmWnQ3KrJygJ3c57VbevPdFEVFAClsFsBql6EegB7m9eQ302UzfXf+LZg3A1lZUsHr5XfpvRU4lhFFArvK/9itAiiK7v7Y+m5rV7OzjOqphxJAM17c49mRwuyUv4IaHlEUAMLoW98vnvYkQB4wLedSQIPHW6fPbIuSMpDHPdUFAPSq8pcHqG86yvhS5uVW9yhqAOth9NE8e4xqwKOeUbwf2BCAcbnOyrcyrwlEqWavEKDcantCFNyF5Tsf6wCuZ9dvv3YYAeUVyojmWQjgt48x04/mia96Wn4VQG5/H+NU/sj3tDDaXfjfMkDLrG7olfKXVEd1J/82JpUATGOS9CoV6E5B6fKt9AoAWVm7nl1ZPmP56pumvUqASkktfY9SypYUHVRoGSBWDkf4vkQxUWih4TLAlueLzK2kKqPSIUhBvfwWFYBOzytAJ0ltM3wModxnFG8HnAmz51Sh8uqUatyeDnU30hqAKn8gt7c8nVNZNKdKQNonwxF6yPIy7h56KADQgzzOFzGGKBTyrQurCrCR2z67OVNxNCdmpUpABDAwK13x0A1RXOVWGpILATPdkntewfAeYcQDYq8OwNrIMlKV5TuhHPKtAuQTZ6p9j6kuPOrZWCsArfNGS41IY2aHPTGBMHqWAjjzkuDjjZGOFvSlh2jLAL0uhzPNAegrhVINUF+6GaMn5s9oVwzwtE9CifJXm/fmpbIqABbb0kO8wDTGpBtttBLw5/oAuT5Arv8E+AcOAIqU2Few9gAAAABJRU5ErkJggg==">ν™•μΈ</a>ν•΄λ³Ό μ μμµλ‹λ‹¤.</p></blockquote><h4 id="λ³΄μ•-μ΄μ"><a href="#λ³΄μ•-μ΄μ" class="headerlink" title="λ³΄μ• μ΄μ"></a>λ³΄μ• μ΄μ</h4><p>2μ°¨ μΈμ¦ μ„¤μ •μ„ μ„ν•΄μ„ μ κ³µν•λ” QR μ½”λ“μ—λ” μ•”νΈν™”λμ§€ μ•μ€ μƒνƒμ λ³΄μ•ν‚¤κ°€ ν¬ν•¨λμ–΄μλ‹¤. μ„λ“ νν‹°μΈ OTP μ•±μ€ QR μ½”λ“λ¥Ό μ¤μΊ”ν•μ—¬ ν¬ν•¨λ ν…μ¤νΈμ—μ„ μ •λ³΄λ¥Ό μ¶”μ¶ν•΄μ•Όν•λ―€λ΅ λ³΄μ•ν‚¤λ¥Ό μ•”νΈν™” ν• μλ” μ—†λ‹¤. μ•„λμ™€ κ°™μ΄ <a href="https://github.com/j256/two-factor-auth/blob/d28c4da7cbe593774a7420a86257b803b67c8f5a/src/main/java/com/j256/twofactorauth/TimeBasedOneTimePasswordUtil.java#L474-L480">two-factor-auth</a>μ²λΌ QR μ½”λ“ μ΄λ―Έμ§€ μƒμ„±μ„ μ„ν•΄μ„ μ™Έλ¶€ μ£Όμ†μ— μμ΅΄ν•λ” κ²ƒμ€ μΆ‹μ§€ μ•λ‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">qrImageUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyId<span class="token punctuation">,</span> <span class="token class-name">String</span> secret<span class="token punctuation">,</span> <span class="token keyword">int</span> numDigits<span class="token punctuation">,</span> <span class="token keyword">int</span> imageDimension<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"https://chart.googleapis.com/chart?chs="</span> <span class="token operator">+</span> imageDimension <span class="token operator">+</span> <span class="token string">"x"</span> <span class="token operator">+</span> imageDimension <span class="token operator">+</span> <span class="token string">"&amp;cht=qr&amp;chl="</span>            <span class="token operator">+</span> imageDimension <span class="token operator">+</span> <span class="token string">"x"</span> <span class="token operator">+</span> imageDimension <span class="token operator">+</span> <span class="token string">"&amp;chld=M|0&amp;cht=qr&amp;chl="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">addOtpAuthPart</span><span class="token punctuation">(</span>keyId<span class="token punctuation">,</span> secret<span class="token punctuation">,</span> sb<span class="token punctuation">,</span> numDigits<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>κµ¬κΈ€μ—μ„ QR μ΄λ―Έμ§€ μƒμ„±μ„ μ κ³µν–λ μ£Όμ†λ” μ κ±°λμ—κ³  λ€μ²΄ν•  μ μλ” μ£Όμ†κ°€ μμ§€λ§ μ™Έλ¶€ μ£Όμ†μ— λ³΄μ•ν‚¤λ¥Ό μ „λ‹¬ν•λ” κ²ƒμ€ κ¶μ¥ν•μ§€ μ•μµλ‹λ‹¤.</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;μ¤λμ€ 2μ°¨ μΈμ¦ μ„¤μ • κ³Όμ •μ—μ„ OTP μ•±μΌλ΅ μ¤μΊ”ν•  μ μλ„λ΅ μ½”λ“ λ€μ‹ μ— μ κ³µν•λ” QR μ½”λ“μ— λ€ν•΄μ„ μ•μ•„λ³΄λ ¤κ³  ν•λ‹¤.&lt;/p&gt;
&lt;h4 id=&quot;RFC-6238&quot;&gt;&lt;a href=&quot;#RFC-6238&quot; class=&quot;headerlink&quot; title=&quot;</summary>
      
    
    
    
    
    <category term="2FA" scheme="https://kdevkr.github.io/tags/2FA/"/>
    
    <category term="TOTP" scheme="https://kdevkr.github.io/tags/TOTP/"/>
    
    <category term="QRCode" scheme="https://kdevkr.github.io/tags/QRCode/"/>
    
  </entry>
  
  <entry>
    <title>ν¨μ¤ν‚¤ λ΅κ·ΈμΈ κ³ λ„ν™”</title>
    <link href="https://kdevkr.github.io/passkey-login-advanced/"/>
    <id>https://kdevkr.github.io/passkey-login-advanced/</id>
    <published>2024-07-15T14:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.423Z</updated>
    
    <content type="html"><![CDATA[<h4 id="ν¨μ¤ν‚¤-μƒμ„±-μ•κ³ λ¦¬μ¦"><a href="#ν¨μ¤ν‚¤-μƒμ„±-μ•κ³ λ¦¬μ¦" class="headerlink" title="ν¨μ¤ν‚¤ μƒμ„± μ•κ³ λ¦¬μ¦"></a>ν¨μ¤ν‚¤ μƒμ„± μ•κ³ λ¦¬μ¦</h4><p>ν¨μ¤ν‚¤ λ“±λ΅ μ‹ PublicKeyCredentialCreationOptionsμ pubKeyCredParams λ¥Ό ν†µν•΄ RP μ„λ²„μ—μ„ μ„ νΈν•λ” κ³µκ°ν‚¤ μ•κ³ λ¦¬μ¦ λ©λ΅μ„ μ κ³µν•  μ μλ”λ°μ”. μ΄λ• κ³µκ°ν‚¤ μ•κ³ λ¦¬μ¦ λ©λ΅μ—λ” ES256κ³Ό RS256μ€ λ°λ“μ‹ ν¬ν•¨ν•λ”κ² μΆ‹μµλ‹λ‹¤. κ·Έ μ΄μ λ” <a href="https://github.com/w3c/webauthn/issues/1757#issuecomment-1169035781">λ€λ¶€λ¶„ ES256λ¥Ό μ§€μ›ν•κ³  μΌλ¶€λ” RS256λ¥Ό μ§€μ›</a>ν•λ‹¤κ³  ν•κΈ° λ•λ¬Έμ…λ‹λ‹¤.</p><h4 id="ν¨μ¤ν‚¤-μ κ³µμ—…μ²΄-ν‘μ‹"><a href="#ν¨μ¤ν‚¤-μ κ³µμ—…μ²΄-ν‘μ‹" class="headerlink" title="ν¨μ¤ν‚¤ μ κ³µμ—…μ²΄ ν‘μ‹"></a>ν¨μ¤ν‚¤ μ κ³µμ—…μ²΄ ν‘μ‹</h4><p><a href="https://web.dev/articles/webauthn-aaguid?hl=ko">Determine the passkey provider with AAGUID</a>μ—μ„ μ†κ°ν•λ” <a href="https://github.com/passkeydeveloper/passkey-authenticator-aaguids">Passkey Provider AAGUIDs</a>μ—λ” μΌλ¶€ μΈμ¦ κΈ°κΈ°μ— λ€ν• μ΄λ¦„κ³Ό μ•„μ΄μ½ μ •λ³΄λ¥Ό ν¬ν•¨ν•κ³  μμµλ‹λ‹¤. <a href="https://passkeydeveloper.github.io/passkey-authenticator-aaguids/explorer/">Passkeys Authenticator AAGUID Explorer</a>λ¥Ό μ‚΄ν΄λ³΄λ©΄ λ€λ¶€λ¶„μ μ‚¬μ©μλ” μ£Όλ΅ μ•„λμ μΈμ¦ κΈ°κΈ°λ¥Ό μ‚¬μ©ν•  κ²ƒ κ°™μµλ‹λ‹¤.</p><table><thead><tr><th>Authenticator</th><th>AAGUID</th></tr></thead><tbody><tr><td>Google Password Manager</td><td>ea9b8d66-4d01-1d21-3ce4-b6b48cb575d4</td></tr><tr><td>Chrome on Mac</td><td>adce0002-35bc-c60a-648b-0b25f1f05503</td></tr><tr><td>iCloud Keychain</td><td>fbfc3007-154e-4ecc-8c0b-6e020557d7bd</td></tr><tr><td>Samsung Pass</td><td>53414d53-554e-4700-0000-000000000000</td></tr></tbody></table><h5 id="AAGUID-UUID-λ¬Έμμ—΄"><a href="#AAGUID-UUID-λ¬Έμμ—΄" class="headerlink" title="AAGUID UUID λ¬Έμμ—΄"></a>AAGUID UUID λ¬Έμμ—΄</h5><p><a href="https://github.com/Yubico/java-webauthn-server">java-webauthn-server</a> λΌμ΄λΈλ¬λ¦¬μ AAGUID ν΄λμ¤λ¥Ό ν†µν•΄ ByteArrayλ΅ κµ¬μ„±λ aaguidλ¥Ό RFC4122 ν‘μ¤€μ UUID ν•μ‹μ λ¬Έμμ—΄λ΅ λ³€ν™ν•μ—¬ μ €μ¥ν•  μ μμµλ‹λ‹¤. ν¨μ¤ν‚¤ λ“±λ΅ μ΄ν›„μ— λ³€ν•μ§€ μ•λ” ν•­λ©μ΄λ―€λ΅ ν¨μ¤ν‚¤ λ“±λ΅ κ³Όμ •μ—μ„ Base64URL λ³΄λ‹¤λ” UUID ν•νƒλ΅ μ €μ¥ν•΄λ‘λ”κ² ν”„λ΅ νΈμ—”λ“μ—μ„ μ‚¬μ©ν•κΈ°μ—λ” λ” νΈν•  κ²ƒ κ°™λ„¤μ”. μ•„λμ™€ κ°™μ΄ AAGUIDμ asGuidString ν•¨μλ¥Ό νΈμ¶ν•΄μ„ κ°€μ Έμ¬ μ μμµλ‹λ‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">RegistrationResult</span> result <span class="token operator">=</span> relyingParty<span class="token punctuation">.</span><span class="token function">finishRegistration</span><span class="token punctuation">(</span>        <span class="token class-name">FinishRegistrationOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>publicKeyCredentialCreationOptions<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span>publicKeyCredential<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> aaguid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AAGUID</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getAaguid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asGuidString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="ν¨μ¤ν‚¤-μ‹λ³„-κ°€λ¥ν•-μ΄λ¦„-μ„¤μ •"><a href="#ν¨μ¤ν‚¤-μ‹λ³„-κ°€λ¥ν•-μ΄λ¦„-μ„¤μ •" class="headerlink" title="ν¨μ¤ν‚¤ μ‹λ³„ κ°€λ¥ν• μ΄λ¦„ μ„¤μ •"></a>ν¨μ¤ν‚¤ μ‹λ³„ κ°€λ¥ν• μ΄λ¦„ μ„¤μ •</h4><p><img data-src="/images/posts/passkey-login/02.png"></p><p>μ„ ν™”λ©΄μ€ κΉƒν—λΈμ—μ„ ν¨μ¤ν‚¤ λ“±λ΅ μ‹ ν¨μ¤ν‚¤μ— λ€ν• μ΄λ¦„μ„ μ…λ ¥ν•λ„λ΅ μ”κµ¬ν•λ” λ‹¨κ³„μ…λ‹λ‹¤. μ΄μ™€ κ°™μ΄ ν¨μ¤ν‚¤ λ“±λ΅ μ‹ μ‚¬μ©μμ—κ² λ“±λ΅ν•λ ¤λ” μΈμ¦ κΈ°κΈ°μ— λ€ν• μ΄λ¦„μ„ μ…λ ¥ν•λ„λ΅ μ”κµ¬ν•κ±°λ‚ μ‚¬μ©μμ—κ² κΈ°κΈ°μ— λ€ν• μ΄λ¦„μ„ λ³„λ„λ΅ μ…λ ¥ν•μ§€ μ•κ³  <strong>Authenticator 1</strong> κ³Ό κ°™μ΄ ν„μ¬ λ“±λ΅λ κΈ°κΈ°μ μλ¥Ό ν† λ€λ΅ κΈ°λ³Έκ°’μ„ μ κ³µν•κ³  μ‚¬μ©μκ°€ λ³„λ„λ΅ μ΄λ¦„μ„ μμ •ν•  μ μλ„λ΅ ν•λ”κ² μΆ‹μµλ‹λ‹¤.</p><h4 id="ν¨μ¤ν‚¤-λ“±λ΅-μ-μ ν•"><a href="#ν¨μ¤ν‚¤-λ“±λ΅-μ-μ ν•" class="headerlink" title="ν¨μ¤ν‚¤ λ“±λ΅ μ μ ν•"></a>ν¨μ¤ν‚¤ λ“±λ΅ μ μ ν•</h4><p>μΌλ°μ μΌλ΅ ν¨μ¤ν‚¤λ΅ λ“±λ΅ν•  μ μλ” κΈ°κΈ°μ— λ€ν• μ μ•½μ€ ν•„μ”ν•μ§€ μ•μµλ‹λ‹¤λ§ μ‚¬μ©μκ°€ λ„λ¬΄ λ§μ€ ν¨μ¤ν‚¤λ¥Ό λ“±λ΅ν•λ” κ²ƒμ€ μ¤νλ ¤ λ³΄μ• μƒ μΆ‹μ§€ μ•μ„ μ μμµλ‹λ‹¤. κΈ°λ³Έμ μΌλ΅ μ‚¬μ©μμ— λ€ν• ν¨μ¤ν‚¤λ” 10κ° μ΄λ‚΄λ΅ μ ν•ν•κ³  μ •λ§λ΅ μ‚¬μ©μκ°€ μ”κµ¬ν•  λ• ν™•μ¥ν•λ” κ²ƒμ„ κ¶μ¥ν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, μ €μ™€ κ°™μ€ μ‚¬μ©μλ” μ‚Όμ„± κ°¤λ­μ‹ μ¤λ§νΈν°μ μ‚Όμ„± ν¨μ¤λ§ μ‚¬μ©ν•μ—¬ ν¨μ¤ν‚¤λ¥Ό λ“±λ΅ν•  μ μμµλ‹λ‹¤.</p><p><a href="https://www.corbado.com/assets/Passkeys-Developer-Cheatsheet.pdf">Passkeys Cheat Sheet for Developers</a>μ—μ„ μ‚¬μ©μμ—κ² λ” λ‚μ€ ν¨μ¤ν‚¤λ¥Ό μ κ³µν•κΈ° μ„ν• λ°©λ²•μ— λ€ν•΄μ„ μ°Ύμ•„λ³΄μ„Έμ”.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;ν¨μ¤ν‚¤-μƒμ„±-μ•κ³ λ¦¬μ¦&quot;&gt;&lt;a href=&quot;#ν¨μ¤ν‚¤-μƒμ„±-μ•κ³ λ¦¬μ¦&quot; class=&quot;headerlink&quot; title=&quot;ν¨μ¤ν‚¤ μƒμ„± μ•κ³ λ¦¬μ¦&quot;&gt;&lt;/a&gt;ν¨μ¤ν‚¤ μƒμ„± μ•κ³ λ¦¬μ¦&lt;/h4&gt;&lt;p&gt;ν¨μ¤ν‚¤ λ“±λ΅ μ‹ PublicKeyCredentialCreati</summary>
      
    
    
    
    
    <category term="Passkey" scheme="https://kdevkr.github.io/tags/Passkey/"/>
    
    <category term="WebAuthn" scheme="https://kdevkr.github.io/tags/WebAuthn/"/>
    
  </entry>
  
  <entry>
    <title>ν¨μ¤ν‚¤ λ΅κ·ΈμΈ</title>
    <link href="https://kdevkr.github.io/passkey-login/"/>
    <id>https://kdevkr.github.io/passkey-login/</id>
    <published>2024-07-14T03:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.423Z</updated>
    
    <content type="html"><![CDATA[<p>ν¨μ¤ν‚¤ λ΅κ·ΈμΈμ€ μ‚¬μ©μ κ³„μ •μ— λ€ν• λΉ„λ°€λ²νΈλ¥Ό μ…λ ¥ν•μ§€ μ•κ³  μ‚¬μ©μ κ³„μ •μ— λ€ν•΄ μ§€λ¬Έμ΄λ‚ μ–Όκµ΄ μΈμ‹ κ·Έλ¦¬κ³  λ³΄μ•ν‚¤ λ“±μ„ μ‚¬μ©ν•΄μ„ λ―Έλ¦¬ μΈμ¦ μ •λ³΄λ¥Ό λ“±λ΅ν•΄λ†“κ³  μ‚¬μ©μμ μΈμ¦ κΈ°κΈ°λ¥Ό μ‚¬μ©ν•΄μ„ λ΅κ·ΈμΈμ„ μν–‰ν•λ„λ΅ μ κ³µν•λ” κ±Έ λ§ν•©λ‹λ‹¤. ν¨μ¤ν‚¤λ” λ΅κ·ΈμΈ λΏλ§ μ•„λ‹λΌ <a href="https://aws.amazon.com/ko/about-aws/whats-new/2024/06/aws-identity-access-management-passkey-authentication-factor/?nc1=h_ls">μ•„λ§μ΅΄ μ›Ή μ„λΉ„μ¤</a>μ™€ <a href="https://docs.github.com/ko/authentication/authenticating-with-a-passkey/signing-in-with-a-passkey">κΉƒν—λΈ</a>μ²λΌ 2μ°¨ μΈμ¦μ„ μ„ν•΄μ„λ„ λ„μ…λ  μ μμµλ‹λ‹¤. μ΄ κΈ€μ„ μ‘μ„±ν•΄λ³΄λ” μ΄μ λ” ν¨μ¤ν‚¤ λ΅κ·ΈμΈμ— λ€ν• νλ¦„μ€ μƒκ°λ³΄λ‹¤ κ°„λ‹¨ν•λ° ν¨μ¤ν‚¤μ— λ€ν• ν‘μ¤€μ—μ„ μ‚¬μ©λλ” μ©μ–΄μ™€ κµ¬ν„ κ³Όμ •μ—μ„μ μ—¬λ¬κ°€μ§€ μ΄μλ“¤μ΄ λ§μ•„λ³΄μ΄κΈ° λ•λ¬Έμ…λ‹λ‹¤. μ΄μ  ν¨μ¤ν‚¤ λ΅κ·ΈμΈμ— λ€ν•΄μ„ μ •λ¦¬ν•΄λ³΄λ„λ΅ ν•μ£ .</p><h4 id="ν¨μ¤ν‚¤-λ΅κ·ΈμΈμ—μ„-λ“±λ΅κ³Ό-μΈμ¦μ-νλ¦„"><a href="#ν¨μ¤ν‚¤-λ΅κ·ΈμΈμ—μ„-λ“±λ΅κ³Ό-μΈμ¦μ-νλ¦„" class="headerlink" title="ν¨μ¤ν‚¤ λ΅κ·ΈμΈμ—μ„ λ“±λ΅κ³Ό μΈμ¦μ νλ¦„"></a>ν¨μ¤ν‚¤ λ΅κ·ΈμΈμ—μ„ λ“±λ΅κ³Ό μΈμ¦μ νλ¦„</h4><p>ν¨μ¤ν‚¤ λ΅κ·ΈμΈ μ‹ λ“±λ΅κ³Ό μΈμ¦ κ³Όμ •μ€ μƒκ°λ³΄λ‹¤ κ°„λ‹¨ν•©λ‹λ‹¤. μ‚¬μ©μλ” λ³ΈμΈμ΄ μ‚¬μ©ν•  μ μλ” μΈμ¦ κΈ°κΈ°μ— λ°κΈ‰ν• ν¨μ¤ν‚¤ μ •λ³΄λ¥Ό RP λ„λ©”μΈμ— λ€ν• ν¨μ¤ν‚¤λ¥Ό λ“±λ΅ν•κ³  λ΅κ·ΈμΈ ν™”λ©΄μ—μ„ μ‹μ¤ν…μ—μ„ μ κ³µν•λ” ν¨μ¤ν‚¤ λ΅κ·ΈμΈμ„ μ‚¬μ©ν•΄ μΈμ¦ κΈ°κΈ°μ— μ΅΄μ¬ν•λ” ν¨μ¤ν‚¤λ¥Ό μ„ νƒν•μ—¬ μ‚¬μ©μ κ³„μ •μ— λ€ν• μΈμ¦μ„ μ”μ²­ν•κ³  μΉμΈλ°›μ•„ λ΅κ·ΈμΈμ„ μ™„λ£ν•©λ‹λ‹¤. ν¨μ¤ν‚¤λ¥Ό λ“±λ΅ν•κ³  μΈμ¦ν•λ” κ³Όμ •μ—μ„ μ„λ²„μ—μ„ μ κ³µλ°›μ€ μ±λ¦°μ§€μ™€ κ³µκ°ν‚¤μ— λ€ν• μ„λ… μ •λ³΄λ¥Ό μ κ³µν•¨μΌλ΅μ¨ ν¨μ¤ν‚¤λ¥Ό μ‚¬μ©ν•μ—¬ λ΅κ·ΈμΈμ„ μ§€μ›ν•λ” μ„λ²„μ—μ„λ” μ‚¬μ©μμ— λ€ν• μ‹ μ›μ„ μ•μ „ν•κ² μ¦λ…(Attestation) λλ” κ²€μ¦(Assertion)ν•  μ μμµλ‹λ‹¤. </p><blockquote><p>ν¨μ¤ν‚¤ κ΄€λ ¨ ν‘μ¤€μ—μ„ λ“±λ΅(Registration)κ³Ό μΈμ¦(Authentication)μ— λ€ν• κ³Όμ •μ€ λ‹¨μν• μΈμ¦ κ³Όμ •μ΄ μ•„λ‹λΌ ν•λ‚μ μ¤‘μ”ν• μμ‹μ΄λΌλ” κ΄€μ μΌλ΅ <strong>μ„Έλ λ¨λ‹(Ceremony)</strong> λΌκ³  ν‘ν„ν•©λ‹λ‹¤. λ”°λΌμ„, ν¨μ¤ν‚¤μ— λ€ν• μ—¬λ¬κ°€μ§€ μ •λ³΄λ¥Ό μ°Έκ³ ν•  λ• μ„Έλ λ¨λ‹λΌλ” λ‹¨μ–΄κ°€ λ‚μ¤λ©΄ κ³Όμ •μ΄λΌκ³  μ΄ν•΄ν•μ‹λ©΄ λ©λ‹λ‹¤.</p></blockquote><h4 id="ν¨μ¤ν‚¤-λ“±λ΅μ„-μ„ν•-μ„λΉ„μ¤-μ κ³µμ"><a href="#ν¨μ¤ν‚¤-λ“±λ΅μ„-μ„ν•-μ„λΉ„μ¤-μ κ³µμ" class="headerlink" title="ν¨μ¤ν‚¤ λ“±λ΅μ„ μ„ν• μ„λΉ„μ¤ μ κ³µμ"></a>ν¨μ¤ν‚¤ λ“±λ΅μ„ μ„ν• μ„λΉ„μ¤ μ κ³µμ</h4><p>ν¨μ¤ν‚¤λ¥Ό ν†µν•΄ μ‹ μ›μ„ κ΄€λ¦¬ν•κ³  κ²€μ¦ν•λ” μ£Όμ²΄μΈ μ„λΉ„μ¤ μ κ³µμλ” μ‹ λΆ°λ‹Ήμ‚¬μ(Relyting Party)λΌκ³  ν•©λ‹λ‹¤. RPλ” λ„λ©”μΈμ„ μλ―Έν•λ©° ν¨μ¤ν‚¤ λ“±λ΅κ³Ό μΈμ¦μ„ μ”μ²­ν• λ•λ§λ‹¤ μ±λ¦°μ§€(Challenge)λ¥Ό λ°›μ•„κ°€λ„λ΅ μ”κµ¬ν•©λ‹λ‹¤. RPμ—μ„ μ‘λ‹µν•λ” μ±λ¦°μ§€λ” λ‚μλ΅ μ΄λ£¨μ–΄μ§„ λ°”μ΄νΈ λ°°μ—΄λ΅ μ•μμ—†λ” μ‹λ³„μλ΅ CSRF ν† ν°κ³Ό λΉ„μ·ν• μ©λ„λ΅ μ‚¬μ©λ©λ‹λ‹¤. λν•, RPμ— λ€ν• μ•„μ΄λ””λ” λ„λ©”μΈμΌλ΅ κµ¬μ„±λκΈ° λ•λ¬Έμ— ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° μ „λ‹¬λλ” ν¨μ¤ν‚¤μ— λ€ν• κ³µκ°ν‚¤ μΈμ¦ μ •λ³΄κ°€ μ¬λ°”λ¥Έ μ¶μ²μ— μμμ„ μ‰½κ² ν™•μΈν•  μ μκ² λ©λ‹λ‹¤. κ·Έλ¬λ©΄ μλ°” μ• ν”λ¦¬μΌ€μ΄μ… μ„λ²„μ—μ„ RPλ¥Ό κµ¬μ„±ν•΄λ³΄λ„λ΅ ν• κΉμ”?</p><pre class="language-groovy" data-language="groovy"><div class="caption"><span>build.gradle</span></div><code class="language-groovy">dependencies <span class="token punctuation">&#123;</span>    implementation <span class="token string">'com.yubico:webauthn-server-core:2.5.2'</span>    implementation <span class="token string">'com.yubico:webauthn-server-attestation:2.5.2'</span>    implementation <span class="token string">'com.yubico:yubico-util:2.5.2'</span><span class="token punctuation">&#125;</span></code></pre><p>λ¨Όμ €, μλ°” μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ WebAuthnμ— λ€ν• Relyting Partyλ¥Ό κµ¬μ„±ν•κΈ° μ„ν•΄μ„ <a href="https://developers.yubico.com/java-webauthn-server/">java-webauthn-server</a> λΌμ΄λΈλ¬λ¦¬λ¥Ό μμ΅΄μ„±μ— μ¶”κ°€ν•΄μ•Όν•©λ‹λ‹¤. κ·Έλ¦¬κ³  μ•„λμ™€ κ°™μ΄ RelyingPartyIdentityλ΅ RP λ„λ©”μΈμ— λ€ν• μ‹ μ›μ„ μ •μν•κ³  RelyingPartyλ¥Ό μ΄κΈ°ν™”ν•λ©΄ λ©λ‹λ‹¤. CredentialRepository λ” ν¨μ¤ν‚¤ λ“±λ΅κ³Ό μΈμ¦ κ³Όμ •μ—μ„ μ΄λ―Έ λ“±λ΅λ ν¨μ¤ν‚¤ μ •λ³΄λ¥Ό μ κ³µν•κΈ° μ„ν• μ©λ„λ΅ μ‚¬μ©λ©λ‹λ‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">RelyingParty</span> <span class="token function">generateRelyingParty</span><span class="token punctuation">(</span><span class="token class-name">PasskeyCredentialRepository</span> passkeyCredentialRepository<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">RelyingPartyIdentity</span> rpID <span class="token operator">=</span> <span class="token class-name">RelyingPartyIdentity</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">"kdev.ing"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"Mambo App"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">RelyingParty</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">identity</span><span class="token punctuation">(</span>rpID<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">credentialRepository</span><span class="token punctuation">(</span>passkeyCredentialRepository<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">allowOriginSubdomain</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">origins</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"https://kdev.ing"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h5 id="π”¥-SecurityError-The-RP-ID-β€mamboβ€-is-invalid-for-this-domain"><a href="#π”¥-SecurityError-The-RP-ID-β€mamboβ€-is-invalid-for-this-domain" class="headerlink" title="π”¥ SecurityError: The RP ID β€mamboβ€ is invalid for this domain"></a>π”¥ SecurityError: The RP ID β€mamboβ€ is invalid for this domain</h5><pre class="language-bash" data-language="bash"><code class="language-bash">SecurityError: The RP ID <span class="token string">"mambo"</span> is invalid <span class="token keyword">for</span> this domain    at identifyAuthenticationError <span class="token punctuation">(</span>@simplewebauthn_browser.js?v<span class="token operator">=</span>db6ca826:278:14<span class="token punctuation">)</span>    at startAuthentication <span class="token punctuation">(</span>@simplewebauthn_browser.js?v<span class="token operator">=</span>db6ca826:325:11<span class="token punctuation">)</span>    Caused by: DOMException: The relying party ID is not a registrable domain suffix of, nor equal to the current domain.</code></pre><p>RP μ„λ²„μ— λ€ν• μ•„μ΄λ””λ” WebAuthn ν‘μ¤€μ— λ”°λΌ λ°λ“μ‹ λ„λ©”μΈμΌλ΅ κµ¬μ„±λμ–΄μ•Όν•©λ‹λ‹¤. κ·Έλ ‡μ§€ μ•μ€ κ²½μ° μ„μ™€ κ°™μ΄ ν΄λΌμ΄μ–ΈνΈ μ¤λ¥κ°€ λ°μƒν•  μ μμµλ‹λ‹¤.</p><h5 id="RelyingParty-generateChallenge"><a href="#RelyingParty-generateChallenge" class="headerlink" title="RelyingParty.generateChallenge"></a>RelyingParty.generateChallenge</h5><p>RelyingPartyμ startRegistartion λ¥Ό ν†µν•΄ ν¨μ¤ν‚¤ λ“±λ΅μ— λ€ν• μ±λ¦°μ§€μ™€ κ³µκ°ν‚¤ μƒμ„± μµμ…μ„ ν΄λΌμ΄μ–ΈνΈμ—κ² μ κ³µν•  μ μλ”λ° μ΄λ• ν¬ν•¨λλ” μ±λ¦°μ§€λ” RelyingPartyμ— 32λ°”μ΄νΈλ΅ κµ¬μ„±λ λ‚μλ΅ μ΄λ£¨μ–΄μ§„ λ°”μ΄νΈ λ°°μ—΄λ΅ κµ¬ν„λμ–΄μμµλ‹λ‹¤.</p><pre class="language-java" data-language="java"><div class="caption"><span>RelyingParty.java</span></div><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">SecureRandom</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ByteArray</span> <span class="token function">generateChallenge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    random<span class="token punctuation">.</span><span class="token function">nextBytes</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ByteArray</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="ν¨μ¤ν‚¤-λ“±λ΅μ„-μ„ν•-μƒμ„±-μµμ…-λ°κΈ‰"><a href="#ν¨μ¤ν‚¤-λ“±λ΅μ„-μ„ν•-μƒμ„±-μµμ…-λ°κΈ‰" class="headerlink" title="ν¨μ¤ν‚¤ λ“±λ΅μ„ μ„ν• μƒμ„± μµμ… λ°κΈ‰"></a>ν¨μ¤ν‚¤ λ“±λ΅μ„ μ„ν• μƒμ„± μµμ… λ°κΈ‰</h4><p>RelyingPartyμ startRegistration λ§¤κ°λ³€μμ— StartRegistrationOptionsλ¥Ό μ „λ‹¬ν•¨μΌλ΅μ¨ ν¨μ¤ν‚¤ λ“±λ΅ μ‹ μ‚¬μ©λ  μ±λ¦°μ§€μ™€ μƒμ„± μµμ…μΈ PublicKeyCredentialCreationOptionsλ¥Ό λ§λ“¤ μ μμµλ‹λ‹¤. PublicKeyCredentialCreationOptionsμ toCredentialsCreateJson ν•¨μλ” RP μ„λ²„μ—μ„ ν΄λΌμ΄μ–ΈνΈλ΅ μ‘λ‹µν•  λ• λ°”μ΄νΈ λ°°μ—΄λ΅ μ΄λ£¨μ–΄μ Έμ•Όν•λ” ν•­λ©μ— λ€ν•΄ Base64URLμ„ μ μ©ν• JSONμΌλ΅ κµ¬μ„±λλ„λ΅ κµ¬ν„λμ–΄μμΌλ―€λ΅ μ‰½κ² μ‘λ‹µν•  μ μμµλ‹λ‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">createUserHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchAlgorithmException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> userHandle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token class-name">SecureRandom</span><span class="token punctuation">.</span><span class="token function">getInstanceStrong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextBytes</span><span class="token punctuation">(</span>userHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> userHandle<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/registration/challenge"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">startRegistration</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> httpSession<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">UserIdentity</span> userIdentity <span class="token operator">=</span> <span class="token class-name">UserIdentity</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"mambo"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token string">"Mambo"</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArray</span><span class="token punctuation">(</span><span class="token function">createUserHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">PublicKeyCredentialCreationOptions</span> publicKeyCredentialCreationOptions <span class="token operator">=</span> rp<span class="token punctuation">.</span><span class="token function">startRegistration</span><span class="token punctuation">(</span>                <span class="token class-name">StartRegistrationOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">user</span><span class="token punctuation">(</span>userIdentity<span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">authenticatorSelection</span><span class="token punctuation">(</span><span class="token class-name">AuthenticatorSelectionCriteria</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                <span class="token punctuation">.</span><span class="token function">residentKey</span><span class="token punctuation">(</span><span class="token class-name">ResidentKeyRequirement</span><span class="token punctuation">.</span><span class="token constant">REQUIRED</span><span class="token punctuation">)</span>                                <span class="token punctuation">.</span><span class="token function">authenticatorAttachment</span><span class="token punctuation">(</span><span class="token class-name">AuthenticatorAttachment</span><span class="token punctuation">.</span><span class="token constant">CROSS_PLATFORM</span><span class="token punctuation">)</span>                                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    httpSession<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"publicKeyCredentialCreationOptions"</span><span class="token punctuation">,</span> publicKeyCredentialCreationOptions<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> publicKeyCredentialCreationOptions<span class="token punctuation">.</span><span class="token function">toCredentialsCreateJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>UserIdentityμ idλ” κ³µκ°ν‚¤ μΈμ¦ μ •λ³΄μ— ν¬ν•¨λλ” User Handleκ³Ό λ™μΌν•©λ‹λ‹¤. ν¨μ¤ν‚¤ ν‘μ¤€μ—μ„λ” μ‚¬μ©μ κ³„μ •μ— λ€ν• μ‹λ³„μλ¥Ό κ·Έλ€λ΅ μ΄μ©ν•μ§€ μ•κ³  λ³„λ„λ΅ λ‚μλ΅ μ΄λ£¨μ–΄μ§„ μ‹λ³„μλ¥Ό μ‚¬μ©ν•λ„λ΅ μ”κµ¬ν•κ³  μμµλ‹λ‹¤. μ‚¬μ©μ κ³„μ •μ— λ€ν•΄ μ μΌν• μ‹λ³„μλ΅ μƒμ„±ν•λ” λ΅μ§μ„ κµ¬ν„ν•λ„λ΅ ν•μ„Έμ”.</p></blockquote><h5 id="simplewebauthn-browser-startRegistration"><a href="#simplewebauthn-browser-startRegistration" class="headerlink" title="@simplewebauthn&#x2F;browser.startRegistration"></a>@simplewebauthn&#x2F;browser.startRegistration</h5><p>ν΄λΌμ΄μ–ΈνΈμ—μ„λ” μ•„λμ™€ κ°™μ΄ ν¨μ¤ν‚¤ λ“±λ΅μ„ μ„ν•΄ μ±λ¦°μ§€λ¥Ό μ”μ²­ν•κ³  λ°›μ€ κ²°κ³Όλ¥Ό startRegistartionμ λ§¤κ°λ³€μμ— μ „λ‹¬ν•¨μΌλ΅μ¨ μ‚¬μ©μμ—κ² ν¨μ¤ν‚¤ λ“±λ΅μ— λ€ν• λ€ν™”μƒμλ¥Ό ν‘μ‹ν•΄μ£Όκ³  μ „λ‹¬λ°›μ€ κ²°κ³Όλ¥Ό μ„λ²„μ— μ „λ‹¬ν•¨μΌλ΅μ¨ ν¨μ¤ν‚¤ λ“±λ΅μ„ μ™„λ£ν•λ” λ΅μ§μ„ κµ¬ν„ν•  μ μμµλ‹λ‹¤. μ•„λμ μ½”λ“λ” μ΄λ―Έ λ“±λ΅λ ν¨μ¤ν‚¤μ— λ€ν• μ¤λ¥μ— λ€ν• μμ™Έ μ²λ¦¬κ°€ μ—†μΌλ―€λ΅ μ—¬λ¬κ°€μ§€ μμ™Έ μƒν™©μ„ ν™•μΈν•κ³  μ•λ§κ² μ²λ¦¬ν•λ„λ΅ κµ¬ν„ν•΄μ•Όν•©λ‹λ‹¤.</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">registerPasskey</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> challenge  <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/passkey/registration/challenge'</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> registrationResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">startRegistration</span><span class="token punctuation">(</span>challenge<span class="token punctuation">.</span>data<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span>    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/passkey/registration/verify'</span><span class="token punctuation">,</span> registrationResponse<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></code></pre><h4 id="ν¨μ¤ν‚¤-κ²€μ¦-λ°-λ“±λ΅"><a href="#ν¨μ¤ν‚¤-κ²€μ¦-λ°-λ“±λ΅" class="headerlink" title="ν¨μ¤ν‚¤ κ²€μ¦ λ° λ“±λ΅"></a>ν¨μ¤ν‚¤ κ²€μ¦ λ° λ“±λ΅</h4><p>Relying Partyμ finishRegistartion ν•¨μλ¥Ό ν†µν•΄ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ „λ‹¬ν• ν¨μ¤ν‚¤ μ •λ³΄κ°€ μ¬λ°”λ¥΄κ² μ„λ…λμ–΄μλ”μ§€λ¥Ό κ²€μ¦ν•κ³  μ „λ‹¬λ°›μ€ μ •λ³΄μ—μ„ μΌλ¶€ ν•­λ©μ„ ν¨μ¤ν‚¤μ— λ€ν• λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥ν•λ©΄ λ©λ‹λ‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/registration/verify"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">finishRegistration</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> httpSession<span class="token punctuation">,</span>                                  <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">String</span> credential<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">RegistrationFailedException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> credentialsCreateJson <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> httpSession<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"publicKeyCredentialCreationOptions"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    httpSession<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">"publicKeyCredentialCreationOptions"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">PublicKeyCredentialCreationOptions</span> publicKeyCredentialCreationOptions <span class="token operator">=</span>            <span class="token class-name">PublicKeyCredentialCreationOptions</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>credentialsCreateJson<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">PublicKeyCredential</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AuthenticatorAttestationResponse</span><span class="token punctuation">,</span> <span class="token class-name">ClientRegistrationExtensionOutputs</span><span class="token punctuation">></span></span> publicKeyCredential <span class="token operator">=</span>            <span class="token class-name">PublicKeyCredential</span><span class="token punctuation">.</span><span class="token function">parseRegistrationResponseJson</span><span class="token punctuation">(</span>credential<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">RegistrationResult</span> result <span class="token operator">=</span> relyingParty<span class="token punctuation">.</span><span class="token function">finishRegistration</span><span class="token punctuation">(</span>            <span class="token class-name">FinishRegistrationOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>publicKeyCredentialCreationOptions<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span>publicKeyCredential<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ByteArray</span> aaguid <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getAaguid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ByteArray</span> credentialId <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getKeyId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ByteArray</span> userHandle <span class="token operator">=</span> publicKeyCredentialCreationOptions<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ByteArray</span> publicKey <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getPublicKeyCose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> transports <span class="token operator">=</span> publicKeyCredential<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTransports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">AuthenticatorTransport</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">long</span> signatureCounter <span class="token operator">=</span> publicKeyCredential<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttestation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthenticatorData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSignatureCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Authenticator</span> authenticator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Authenticator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">setCredentialId</span><span class="token punctuation">(</span>credentialId<span class="token punctuation">.</span><span class="token function">getBase64Url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">setUserHandle</span><span class="token punctuation">(</span>userHandle<span class="token punctuation">.</span><span class="token function">getBase64Url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">setAaguid</span><span class="token punctuation">(</span>aaguid<span class="token punctuation">.</span><span class="token function">getBase64Url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">setPublicKey</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">.</span><span class="token function">getBase64Url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">setSignatureCount</span><span class="token punctuation">(</span>signatureCounter<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">setTransports</span><span class="token punctuation">(</span>transports<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">setNickname</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">setLastAccessTime</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">setCreatedAt</span><span class="token punctuation">(</span><span class="token class-name">OffsetDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> authenticatorRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>authenticator<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h5 id="κ³„μ •-μ„¤μ •-λ‚΄-ν¨μ¤ν‚¤-ν‘μ‹"><a href="#κ³„μ •-μ„¤μ •-λ‚΄-ν¨μ¤ν‚¤-ν‘μ‹" class="headerlink" title="κ³„μ • μ„¤μ • λ‚΄ ν¨μ¤ν‚¤ ν‘μ‹"></a>κ³„μ • μ„¤μ • λ‚΄ ν¨μ¤ν‚¤ ν‘μ‹</h5><p>ν¨μ¤ν‚¤ λ“±λ΅ μ‹ μ„λ²„μ— μ €μ¥λ μ •λ³΄μ—λ” μ‚¬μ©μ μΉν™”μ μΌλ΅ ν‘μ‹ν•  μ μλ” μ •λ³΄κ°€ ν¬ν•¨λμ–΄μμ§€ μ•μµλ‹λ‹¤. <a href="https://developers.google.com/identity/passkeys/ux/communicating-passkeys?hl=ko#what_information_to_use_to_create_a_passkey">ν¨μ¤ν‚¤λ¥Ό λ§λ“λ” λ° μ‚¬μ©ν•  μ •λ³΄</a>λ‚ <a href="https://developers.google.com/identity/passkeys/ux/user-interface-design?hl=ko">κ³„μ • μ„¤μ • λ‚΄ ν¨μ¤ν‚¤ μΉ΄λ“ ν‘μ‹</a>μ™€ κ°™μ€ μ •λ³΄λ“¤μ„ μ°Έκ³ ν•μ—¬ ν¨μ¤ν‚¤μ— λ€ν•΄ μ•„λμ™€ κ°™μ€ ν•­λ©μ΄ ν¬ν•¨λλ„λ΅ μ„¤κ³„ν•λ” κ²ƒμ΄ μΆ‹μµλ‹λ‹¤.</p><ul><li>ν¨μ¤ν‚¤μ— λ€ν•΄ ν‘μ‹ν•  μ΄λ¦„ (Nickname)</li><li>ν¨μ¤ν‚¤κ°€ λ§μ§€λ§‰μΌλ΅ μ‚¬μ©λ μ‹κ°„ (Last Access Time)</li><li>ν¨μ¤ν‚¤ μΈμ¦ κΈ°κΈ° μ ν• (AAGUID)</li></ul><p>ν¨μ¤ν‚¤μ— λ€ν•΄ ν‘μ‹ν•  μ΄λ¦„μ„ μ„¤μ •ν•λ” κ±΄ ν•„μ μ‚¬ν•­μ€ μ•„λ‹μ§€λ§ κΉƒν—λΈμ—μ„μ ν¨μ¤ν‚¤ κ΄€λ¦¬ μ‹ μ΄λ¦„μ„ μ„¤μ •ν•  μ μκ² μ κ³µν•λ”λ° μ‚¬μ©μ μ¤μ¤λ΅ κµ¬λ¶„ν•  μ μκ² μ§€μ›ν•΄μ¤„ μ μλ” κ²ƒ κ°™μµλ‹λ‹¤. ν¨μ¤ν‚¤ μΈμ¦ κΈ°κΈ° μ •λ³΄μ κ²½μ° AttestedCredentialDataμ— ν¬ν•¨λ AAGUIDλ¥Ό ν†µν•΄ μΈμ¦ κΈ°κΈ°λ¥Ό μ κ³µν•λ” μ—…μ²΄μ„ μ‹λ³„ν•  μ μλ”λ° AAGUIDλ” μΌλ°μ μΌλ΅ μ‚¬λμ΄ μΈμ§€ν•  μ μλ” λ¬Έμμ—΄μ€ μ•„λ‹λ―€λ΅ AAGUID μ €μ¥μ†μ <a href="https://github.com/passkeydeveloper/passkey-authenticator-aaguids/blob/main/aaguid.json">aaguid.json</a> μΈμ¦ μ¥μΉμ μ ν•μ— λ€ν•΄μ„ μ΄λ¦„μ΄λ‚ μ•„μ΄μ½μ„ ν‘μ‹ν•  μ μκΈ°λ„ ν•©λ‹λ‹¤.</p><h5 id="λ“±λ΅λ-ν¨μ¤ν‚¤-μ‚­μ "><a href="#λ“±λ΅λ-ν¨μ¤ν‚¤-μ‚­μ " class="headerlink" title="λ“±λ΅λ ν¨μ¤ν‚¤ μ‚­μ "></a>λ“±λ΅λ ν¨μ¤ν‚¤ μ‚­μ </h5><p><img data-src="/images/posts/passkey-login/01.png"></p><p>μ„ ν™”λ©΄μ€ κΉƒν—λΈμ—μ„ μ‚¬μ©μ κ³„μ •μ— λ“±λ΅ν–λ ν¨μ¤ν‚¤λ¥Ό μ‚­μ ν•λ ¤κ³  ν–μ„λ• μ κ³µλλ” λ©”μ‹μ§€μ…λ‹λ‹¤. ν¨μ¤ν‚¤ κ΄€λ¦¬ μ‹ λ“±λ΅ν• ν¨μ¤ν‚¤λ¥Ό μ‚­μ ν•λ©΄ λκ² μ§€λ§ κ³ λ ¤ν•΄μ•Όν•  λ¶€λ¶„μ΄ μμµλ‹λ‹¤. μ„λ²„μ— λ“±λ΅λ ν¨μ¤ν‚¤λ¥Ό μ‚­μ ν•λ‹¤κ³ ν•΄μ„ μ‚¬μ©μκ°€ μ‚¬μ©ν–λ μΈμ¦ κΈ°κΈ°μ ν¨μ¤ν‚¤ λ“±λ΅ μ •λ³΄λ” μ‚­μ λμ§€ μ•λ”λ‹¤λ” κ²ƒμ…λ‹λ‹¤. λν•, μ‚¬μ©μκ°€ μΈμ¦ κΈ°κΈ°μ ν¨μ¤ν‚¤λ¥Ό μ‚­μ ν•΄λ²„λ¦¬λ” κ²½μ° μ‚¬μ©μ κ³„μ •μ— λ“±λ΅λ ν¨μ¤ν‚¤λ” λ¬΄μ©μ§€λ¬Όμ΄ λλ©° λ¶ν•„μ”ν•κ² ν¨μ¤ν‚¤ λ“±λ΅ μ •λ³΄λ΅ λ‚¨μ•„μκ² λμ–΄λ²„λ¦½λ‹λ‹¤.</p><p>ν¨μ¤ν‚¤ λ“±λ΅μ„ μ§€μ›ν•λ” μΈμ¦ κΈ°κΈ°λ³„λ΅ μμ„Έν• ν¨μ¤ν‚¤ μ‚­μ  κ°€μ΄λ“λ¥Ό μ κ³µν•  μ μ—†μΌλ―€λ΅ μ‚¬μ©μ κ³„μ •μ—μ„ ν¨μ¤ν‚¤λ¥Ό μ‚­μ ν•λ”λΌλ„ ν¨μ¤ν‚¤ λ΅κ·ΈμΈ μ‹μ—λ” ν¨μ¤ν‚¤ μµμ…μΌλ΅ ν‘μ‹λ  μ μμμ„ μ•λ ¤μ£Όκ³  μλ” κ²ƒ κ°™μµλ‹λ‹¤. λ‹¤μμ€ μμ£Ό μ‚¬μ©λ λ§ν• μΈμ¦ κΈ°κΈ°μ—μ„μ ν¨μ¤ν‚¤ μ‚­μ  λ°©λ²•μ΄λ―€λ΅ μ°Έκ³ ν•΄λ³΄μ„Έμ”.</p><ul><li>Google Passsword Manager: λΈλΌμ°μ € URLμ— <a href="chrome://settings/passkeys">chrome:&#x2F;&#x2F;settings&#x2F;passkeys</a> μ…λ ¥</li><li>iCloud Keychain: <a href="https://support.apple.com/ko-kr/guide/mac-help/mchl77e2cb66/mac">Mac λ° iCloud ν‚¤μ²΄μΈμ—μ„ ν¨μ¤ν‚¤ λλ” μ•”νΈ μ κ±°ν•κΈ°</a></li><li>Chrome Profile: <a href="https://support.google.com/chrome/answer/13168025?hl=ko">Chromeμ—μ„ ν¨μ¤ν‚¤ κ΄€λ¦¬ν•κΈ°</a></li><li>Samsung Pass: Samsung Wallet β†’ Samsung Pass β†’ λ΅κ·ΈμΈ μ •λ³΄ β†’ ν¨μ¤ν‚¤</li></ul><h4 id="ν¨μ¤ν‚¤-μΈμ¦-μ”μ²­μ—-λ€ν•-μµμ…-λ°κΈ‰"><a href="#ν¨μ¤ν‚¤-μΈμ¦-μ”μ²­μ—-λ€ν•-μµμ…-λ°κΈ‰" class="headerlink" title="ν¨μ¤ν‚¤ μΈμ¦ μ”μ²­μ— λ€ν• μµμ… λ°κΈ‰"></a>ν¨μ¤ν‚¤ μΈμ¦ μ”μ²­μ— λ€ν• μµμ… λ°κΈ‰</h4><p>Relying Partyμ startAssertion ν•¨μλ¥Ό ν†µν•΄ μ‚¬μ©μ κ³„μ©΅μ— λ“±λ΅λ ν¨μ¤ν‚¤μ— λ€ν•΄ λ΅κ·ΈμΈν•  μ μλ„λ΅ μ±λ¦°μ§€λ¥Ό λ°κΈ‰ν•  μ μμµλ‹λ‹¤. μ΄λ•, λ§¤κ°λ³€μλ΅ μ „λ‹¬ν•  StartAssertionOptionsμ„ κµ¬μ„±ν•  λ• ν΄λΌμ΄μ–ΈνΈλ” μ‚¬μ©μκ°€ μ…λ ¥ν• μ•„μ΄λ””λ¥Ό μ”μ²­ μ‹ μ κ³µν•λ‹¤λ©΄ νΉμ • μ‚¬μ©μ κ³„μ •μ— λ€ν• κ³µκ°ν‚¤λ§ μ΅°νν•μ—¬ ν¬ν•¨μ‹ν‚¬ μ μμµλ‹λ‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/authentication/challenge"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">startAssertion</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> httpSession<span class="token punctuation">,</span>                             <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">StartAssertionOptions<span class="token punctuation">.</span>StartAssertionOptionsBuilder</span> builder <span class="token operator">=</span> <span class="token class-name">StartAssertionOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>username <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>username<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        builder<span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">AssertionRequest</span> assertionRequest <span class="token operator">=</span> relyingParty<span class="token punctuation">.</span><span class="token function">startAssertion</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    httpSession<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"assertionRequest"</span><span class="token punctuation">,</span> assertionRequest<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> assertionRequest<span class="token punctuation">.</span><span class="token function">toCredentialsGetJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h5 id="ν¨μ¤ν‚¤-κ²€μ¦-λ°-μΈμ¦"><a href="#ν¨μ¤ν‚¤-κ²€μ¦-λ°-μΈμ¦" class="headerlink" title="ν¨μ¤ν‚¤ κ²€μ¦ λ° μΈμ¦"></a>ν¨μ¤ν‚¤ κ²€μ¦ λ° μΈμ¦</h5><p>Relying Partyμ finishAssertion ν•¨μλ¥Ό ν†µν•΄ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ „λ‹¬ν• ν¨μ¤ν‚¤ μΈμ¦ μ •λ³΄λ¥Ό μ‹ λΆ°ν•  μ μλ”μ§€ ν™•μΈν•  μ μμµλ‹λ‹¤. μΈμ¦ μ •λ³΄μ— ν¬ν•¨λ credentailIdμ™€ userHandleμ„ ν† λ€λ΅ μ‚¬μ©μ κ³„μ •μ— λ€ν•΄ λ΅κ·ΈμΈμ„ μ²λ¦¬ν•λ©΄ λ©λ‹λ‹¤.</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> startAuthentication <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@simplewebauthn/browser'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">passkeyLogin</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> challenge  <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/passkey/authentication/challenge'</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> authenticationResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">startAuthentication</span><span class="token punctuation">(</span>challenge<span class="token punctuation">.</span>data<span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span>    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/passkey/authentication/verify'</span><span class="token punctuation">,</span> authenticationResponse<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/authentication/verify"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">finishAssertion</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> httpSession<span class="token punctuation">,</span>                              <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">String</span> credential<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">AssertionFailedException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> assertionRequestJson <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> httpSession<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"assertionRequest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">AssertionRequest</span> assertionRequest <span class="token operator">=</span> <span class="token class-name">AssertionRequest</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>assertionRequestJson<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">PublicKeyCredential</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AuthenticatorAssertionResponse</span><span class="token punctuation">,</span> <span class="token class-name">ClientAssertionExtensionOutputs</span><span class="token punctuation">></span></span> publicKeyCredential            <span class="token operator">=</span> <span class="token class-name">PublicKeyCredential</span><span class="token punctuation">.</span><span class="token function">parseAssertionResponseJson</span><span class="token punctuation">(</span>credential<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">AssertionResult</span> result <span class="token operator">=</span> relyingParty<span class="token punctuation">.</span><span class="token function">finishAssertion</span><span class="token punctuation">(</span><span class="token class-name">FinishAssertionOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>assertionRequest<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">response</span><span class="token punctuation">(</span>publicKeyCredential<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// todo: process authenticate</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ByteArray</span> credentialId <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getCredential</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCredentialId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ByteArray</span> userHandle <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getCredential</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUserHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h5 id="μ‚¬μ©μ-μ•„μ΄λ””-ν•„λ“μ—-μλ™-μ™„μ„±-UI-ν‘μ‹"><a href="#μ‚¬μ©μ-μ•„μ΄λ””-ν•„λ“μ—-μλ™-μ™„μ„±-UI-ν‘μ‹" class="headerlink" title="μ‚¬μ©μ μ•„μ΄λ”” ν•„λ“μ— μλ™ μ™„μ„± UI ν‘μ‹"></a>μ‚¬μ©μ μ•„μ΄λ”” ν•„λ“μ— μλ™ μ™„μ„± UI ν‘μ‹</h5><p>ν¨μ¤ν‚¤ μΈμ¦μ„ μ„ν•΄ startAuthenticationλ¥Ό νΈμ¶ν•  λ• useBrowserAutofill λ§¤κ°λ³€μλ¥Ό μ„¤μ •ν•λ” κ²½μ° mediation μµμ…μ΄ conditionalλ΅ μ§€μ •λλ©΄μ„ μ‚¬μ©μμ—κ² λ°”λ΅ ν¨μ¤ν‚¤ μ„ νƒμ„ μ”κµ¬ν•λ” λ€ν™”μƒμλ¥Ό ν‘μ‹ν•μ§€ μ•κ³  λΈλΌμ°μ €λ§λ‹¤ κµ¬ν„λ λ°©μ‹μΌλ΅ μλ™ μ™„μ„±(μ΅°κ±΄λ¶€ UI)μ΄ ν‘μ‹λ©λ‹λ‹¤. ν¨μ¤ν‚¤ μλ™ μ™„μ„±μ„ μ„ν•΄ νΈμ¶ν–λ‹¤λ©΄ μ‚¬μ©μ κ³„μ •μ„ μ…λ ¥ν•λ” ν•„λ“μ autocomplete μ†μ„±μ— webauthn μ„ ν¬ν•¨μ‹ν‚¤λ©΄ λ©λ‹λ‹¤.</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Login.vue</span><span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">await</span> <span class="token function">processAutofill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// passkey.js</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>browserSupportsWebAuthnAutofill<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@simplewebauthn/browser'</span><span class="token punctuation">;</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">processAutofill</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">browserSupportsWebAuthnAutofill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> challenge <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/passkey/authentication/challenge'</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> authenticationResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">startAuthentication</span><span class="token punctuation">(</span>challenge<span class="token punctuation">.</span>data<span class="token punctuation">.</span>publicKey<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/passkey/authentication/verify'</span><span class="token punctuation">,</span> authenticationResponse<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>μ΅°κ±΄λ¶€ UIλ΅ μ‚¬μ©μμ—κ² μλ™ μ™„μ„±μ„ μ κ³µν•  λ• ν¨μ¤ν‚¤μ— λ€ν• ν”„λ΅λ―Έμ¤κ°€ κ³„μ† λ€κΈ°ν•λ” μƒνƒλ΅ μ§„ν–‰ν•κ³  μλ”λ°μ”. κΈ°μ΅΄μ— μ§„ν–‰μ¤‘μΈ ν¨μ¤ν‚¤λ¥Ό μ·¨μ†ν•  μ μλ„λ΅ SimpleWebAuthnμ startAuthenticationμ€ λ‚΄λ¶€μ μΌλ΅ κµ¬ν„λμ–΄μμΌλ―€λ΅ μ‹ κ²½ μ“Έ ν•„μ”λ” μ—†μµλ‹λ‹¤.</p></blockquote><hr><p>λ³Έ κΈ€μ„ μ‘μ„±ν•κΈ° μ„ν•΄μ„ μ•„λμ™€ κ°™μ€ μ •λ³΄λ“¤μ„ μ°Έκ³ ν–μµλ‹λ‹¤.</p><ul><li><a href="https://webauthn.io/">WebAuthn.io λ°λ¨ μ‚¬μ΄νΈ</a></li><li><a href="https://webauthn.guide/">WebAuthn κ°€μ΄λ“</a></li><li><a href="https://passkeys.dev/device-support/">Passkeys Device Support</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API">WebAuthn: Web Authentication API</a></li><li><a href="https://webauthn.wtf/">What is WebAuthn?</a></li><li><a href="https://passkeys.dev/docs/intro/what-are-passkeys/">What are passkeys?</a></li><li><a href="https://webauthn.me/passkeys">Web Authentication and Passkeys</a></li><li><a href="https://www.corbado.com/assets/Passkeys-Developer-Cheatsheet.pdf">Passkeys Cheet Sheet</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ν¨μ¤ν‚¤ λ΅κ·ΈμΈμ€ μ‚¬μ©μ κ³„μ •μ— λ€ν• λΉ„λ°€λ²νΈλ¥Ό μ…λ ¥ν•μ§€ μ•κ³  μ‚¬μ©μ κ³„μ •μ— λ€ν•΄ μ§€λ¬Έμ΄λ‚ μ–Όκµ΄ μΈμ‹ κ·Έλ¦¬κ³  λ³΄μ•ν‚¤ λ“±μ„ μ‚¬μ©ν•΄μ„ λ―Έλ¦¬ μΈμ¦ μ •λ³΄λ¥Ό λ“±λ΅ν•΄λ†“κ³  μ‚¬μ©μμ μΈμ¦ κΈ°κΈ°λ¥Ό μ‚¬μ©ν•΄μ„ λ΅κ·ΈμΈμ„ μν–‰ν•λ„λ΅ μ κ³µν•λ” κ±Έ λ§ν•©λ‹λ‹¤. ν¨μ¤ν‚¤λ” λ΅κ·ΈμΈ</summary>
      
    
    
    
    
    <category term="Passkey" scheme="https://kdevkr.github.io/tags/Passkey/"/>
    
    <category term="WebAuthn" scheme="https://kdevkr.github.io/tags/WebAuthn/"/>
    
  </entry>
  
  <entry>
    <title>Amazon SNS - FCM λ¨λ°”μΌ ν‘Έμ‹</title>
    <link href="https://kdevkr.github.io/amazon-sns-fcm-mobile-push/"/>
    <id>https://kdevkr.github.io/amazon-sns-fcm-mobile-push/</id>
    <published>2024-07-07T09:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.419Z</updated>
    
    <content type="html"><![CDATA[<p>PWA μ•±μ—μ„ ν‘Έμ‹ μ•λ¦Όμ„ μ„ν•΄ FCM(Firebse Cloud Messaging)μ„ λ„μ…ν–λ‹¤λ©΄ Amazon SNSμ λ¨λ°”μΌ ν‘Έμ‹ μ•λ¦ΌμΌλ΅ ν†µν•©ν•  μ μλ‹¤. Firebase Admin SDK λ΅λ„ μ‰½κ² ν‘Έμ‹ μ•λ¦Όμ„ μ„ν• λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•  μ μμ§€λ§ Amazon SNSμ— λ“±λ΅λ ν”λ«νΌ μ• ν”λ¦¬μΌ€μ΄μ…μ„ ν†µν•΄ μ‚¬μ©μ λ””λ°”μ΄μ¤λ¥Ό μ• ν”λ¦¬μΌ€μ΄μ… μ•¤λ“ν¬μΈνΈλ΅ κ΄€λ¦¬ν•κ³  μ°λ¦¬λ” Amazon SNSμ— λ“±λ΅λ ν”λ«νΌ μ—”λ“ν¬μΈνΈλ¥Ό ν†µν•΄ λ””λ°”μ΄μ¤λ΅ ν‘Έμ‹ μ•λ¦Όμ„ μ „λ‹¬ν•΄λ³΄λ„λ΅ ν•μ.</p><h4 id="ν”λ«νΌ-μ• ν”λ¦¬μΌ€μ΄μ…-μƒμ„±-μ‹-FCM-μκ²©-μ¦λ…-λ“±λ΅"><a href="#ν”λ«νΌ-μ• ν”λ¦¬μΌ€μ΄μ…-μƒμ„±-μ‹-FCM-μκ²©-μ¦λ…-λ“±λ΅" class="headerlink" title="ν”λ«νΌ μ• ν”λ¦¬μΌ€μ΄μ… μƒμ„± μ‹ FCM μκ²© μ¦λ… λ“±λ΅"></a>ν”λ«νΌ μ• ν”λ¦¬μΌ€μ΄μ… μƒμ„± μ‹ FCM μκ²© μ¦λ… λ“±λ΅</h4><p><img data-src="/images/posts/amazon-sns-fcm-mobile-push/01.png"></p><p>FCM ν‘Έμ‹ μ•λ¦Ό ν”λ«ν””μ„ μ‚¬μ©ν•λ” μ• ν”λ¦¬μΌ€μ΄μ… μƒμ„± μ‹ FCM μ½μ†”μ μ„λΉ„μ¤ κ³„μ •μ—μ„ λ°κΈ‰λ°›μ€ Firebase μ„λΉ„μ¤ κ³„μ •μ λΉ„κ³µκ° ν‚¤ μ •λ³΄λ¥Ό λ“±λ΅ν•΄μ•Ό ν•λ‹¤. Firebase Admin SDK μ—μ„ μ‚¬μ©μ¤‘μ΄μ—λ μ„λΉ„μ¤ κ³„μ •μ JSON νμΌμ„ κ·Έλ€λ΅ μ„¤μ •ν–λ‹¤.</p><h4 id="μ• ν”λ¦¬μΌ€μ΄μ…-μ•¤λ“ν¬μΈνΈ-μƒμ„±-μ‹-FCM-λ””λ°”μ΄μ¤-ν† ν°-λ“±λ΅"><a href="#μ• ν”λ¦¬μΌ€μ΄μ…-μ•¤λ“ν¬μΈνΈ-μƒμ„±-μ‹-FCM-λ””λ°”μ΄μ¤-ν† ν°-λ“±λ΅" class="headerlink" title="μ• ν”λ¦¬μΌ€μ΄μ… μ•¤λ“ν¬μΈνΈ μƒμ„± μ‹ FCM λ””λ°”μ΄μ¤ ν† ν° λ“±λ΅"></a>μ• ν”λ¦¬μΌ€μ΄μ… μ•¤λ“ν¬μΈνΈ μƒμ„± μ‹ FCM λ””λ°”μ΄μ¤ ν† ν° λ“±λ΅</h4><p>ν”λ«νΌ μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ λ©”μ‹μ§€λ¥Ό μ „λ‹¬ν•  μ—”λ“ν¬μΈνΈλ” ν•λ‚μ μ‹λ³„ν•  μ μλ” λ””λ°”μ΄μ¤λΌκ³  μƒκ°ν•λ©΄ λλ‹¤. λ””λ°”μ΄μ¤ ν† ν°μ€ <a href="https://firebase.google.com/docs/cloud-messaging/js/client?hl=ko#access_the_registration_token">FCM ν΄λΌμ΄μ–ΈνΈ SDKλ΅λ¶€ν„° λ””λ°”μ΄μ¤ λ‚΄μ—μ„ λ°κΈ‰λ°›μ€ ν† ν°</a>μ„ μ…λ ¥ν•λ©΄ λλ‹¤. μ• ν”λ¦¬μΌ€μ΄μ… μ—”λ“ν¬μΈνΈ μƒμ„± ν›„ λ©”μ‹μ§€ κ²μ‹λ¥Ό ν†µν•΄ μƒν” λ©”μ‹μ§€λ¥Ό μ „λ‹¬ν•΄λ³Ό μ μλ‹¤.</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"GCM"</span><span class="token operator">:</span> <span class="token string">"&#123; \"data\": &#123; \"title\": \"Hi!\", \"body\": \"Mambo?!\" &#125; &#125;"</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>Amazon SNSμ λ¨λ°”μΌ ν‘Έμ‹ μ•λ¦Όμ—μ„ FCMμ„ μ„ν• λ©”μ‹μ§€λ” GCM μ΄λΌλ” ν‚¤λ΅ μ‚¬μ©ν•©λ‹λ‹¤.</p></blockquote><p><img data-src="/images/posts/amazon-sns-fcm-mobile-push/02.png"></p><h4 id="Amazon-SNS-SDK-for-Java-V2λ΅-λ©”μ‹μ§€-κ²μ‹"><a href="#Amazon-SNS-SDK-for-Java-V2λ΅-λ©”μ‹μ§€-κ²μ‹" class="headerlink" title="Amazon SNS SDK for Java V2λ΅ λ©”μ‹μ§€ κ²μ‹"></a>Amazon SNS SDK for Java V2λ΅ λ©”μ‹μ§€ κ²μ‹</h4><p>μ›Ή μ½μ†”μ„ ν†µν•΄ FCM λ©”μ‹μ§€κ°€ λ””λ°”μ΄μ¤λ΅ ν‘Έμ‹ μ•λ¦Όμ΄ λμ—μμ„ ν™•μΈν–λ‹¤λ©΄ Amazon SDK for Java v2λ¥Ό μ‚¬μ©ν•΄μ„ ν”„λ΅κ·Έλλ° λ°©μ‹μΌλ΅ λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•΄λ³΄λ„λ΅ ν•μ. λ¨Όμ €, μ•„λμ™€ κ°™μ΄ λ¨λ°”μΌ ν‘Έμ‹ APIλ¥Ό μ‚¬μ©ν•κΈ° μ„ν• Amazon SDK for Java v2 μμ΅΄μ„±μ„ μ¶”κ°€ν•λ„λ΅ ν•μ.</p><pre class="language-groovy" data-language="groovy"><code class="language-groovy">dependencies <span class="token punctuation">&#123;</span>    implementation <span class="token function">platform</span><span class="token punctuation">(</span><span class="token string">'software.amazon.awssdk:bom:2.26.16'</span><span class="token punctuation">)</span>    implementation <span class="token string">'software.amazon.awssdk:sns'</span><span class="token punctuation">&#125;</span></code></pre><p>μμ΅΄μ„±μ„ μ¶”κ°€ν–λ‹¤λ©΄ <a href="https://docs.aws.amazon.com/ko_kr/sns/latest/dg/mobile-push-api.html">λ¨λ°”μΌ ν‘Έμ‹ API</a> μ¤‘ CreatePlatformEndpointμ™€ Publishλ¥Ό μ‚¬μ©ν•΄μ„ λ©”μ‹μ§€λ¥Ό κ²μ‹ν•λ” μƒν” μ½”λ“λ¥Ό λ§λ“¤μ–΄λ³Ό μ μλ‹¤. </p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">SnsClient</span> snsClient <span class="token operator">=</span> <span class="token class-name">SnsClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">credentialsProvider</span><span class="token punctuation">(</span><span class="token class-name">ProfileCredentialsProvider</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">region</span><span class="token punctuation">(</span><span class="token class-name">Region</span><span class="token punctuation">.</span><span class="token constant">AP_NORTHEAST_2</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertDoesNotThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> platformApplicationArn <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> fcmDeviceToken <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> endpointArn <span class="token operator">=</span> snsClient<span class="token punctuation">.</span><span class="token function">createPlatformEndpoint</span><span class="token punctuation">(</span><span class="token class-name">CreatePlatformEndpointRequest</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">platformApplicationArn</span><span class="token punctuation">(</span>platformApplicationArn<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">token</span><span class="token punctuation">(</span>fcmDeviceToken<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endpointArn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Gson</span> gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GsonBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> fcmMessage <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span> <span class="token string">"Hi!"</span><span class="token punctuation">,</span> <span class="token string">"body"</span><span class="token punctuation">,</span> <span class="token string">"Mambo?!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> messageId <span class="token operator">=</span> snsClient<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token class-name">PublishRequest</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">messageStructure</span><span class="token punctuation">(</span><span class="token string">"json"</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span>gson<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"GCM"</span><span class="token punctuation">,</span> fcmMessage<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">targetArn</span><span class="token punctuation">(</span>endpointArn<span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">messageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"messageId: &#123;&#125;"</span><span class="token punctuation">,</span> messageId<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>messageId<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>μ„ μμ μ½”λ“μ—μ„ λ©”μ‹μ§€μ GCM μ΄ μ΄μ¤μΌ€μ΄ν”„λ JSON λ¬Έμμ—΄λ΅ κµ¬μ„±λμ–΄μ•Όν•¨μ„ μ£Όμν•΄μ•Όν•©λ‹λ‹¤.</p></blockquote><p><img data-src="/images/posts/amazon-sns-fcm-mobile-push/03.png" alt="PWA μ•±μ—μ„μ ν‘Έμ‹ μ•λ¦Ό μμ‹"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;PWA μ•±μ—μ„ ν‘Έμ‹ μ•λ¦Όμ„ μ„ν•΄ FCM(Firebse Cloud Messaging)μ„ λ„μ…ν–λ‹¤λ©΄ Amazon SNSμ λ¨λ°”μΌ ν‘Έμ‹ μ•λ¦ΌμΌλ΅ ν†µν•©ν•  μ μλ‹¤. Firebase Admin SDK λ΅λ„ μ‰½κ² ν‘Έμ‹ μ•λ¦Όμ„ μ„ν• λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•  μ μμ§€λ§</summary>
      
    
    
    
    
    <category term="FCM" scheme="https://kdevkr.github.io/tags/FCM/"/>
    
    <category term="SNS Mobile Push" scheme="https://kdevkr.github.io/tags/SNS-Mobile-Push/"/>
    
  </entry>
  
  <entry>
    <title>PWA μ™€ FCM ν‘Έμ‹ μ•λ¦Ό</title>
    <link href="https://kdevkr.github.io/pwa-fcm-web-push/"/>
    <id>https://kdevkr.github.io/pwa-fcm-web-push/</id>
    <published>2024-07-06T04:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.423Z</updated>
    
    <content type="html"><![CDATA[<h4 id="PWAμ-μ„λΉ„μ¤-μ›μ»¤λ”-HTTPSλ¥Ό-μ”κµ¬"><a href="#PWAμ-μ„λΉ„μ¤-μ›μ»¤λ”-HTTPSλ¥Ό-μ”κµ¬" class="headerlink" title="PWAμ μ„λΉ„μ¤ μ›μ»¤λ” HTTPSλ¥Ό μ”κµ¬"></a>PWAμ μ„λΉ„μ¤ μ›μ»¤λ” HTTPSλ¥Ό μ”κµ¬</h4><p>PWA μ•±μ—μ„ ν‘Έμ‹ μ•λ¦Όμ„ λ³΄λ‚΄κΈ° μ„ν•΄μ„λ” μ‚¬μ©μκ°€ μ‚¬μ΄νΈ λλ” μ•±μ— λ€ν• μ•λ¦Ό κ¶ν•μ„ ν—μ©ν•΄μ•Όν•λ©° PWA μ•±μ΄ μΆ…λ£λμ–΄μμ–΄λ„ λ°±κ·ΈλΌμ΄λ“ μƒνƒμ—μ„ λ™μ‘ν•λ” μ„λΉ„μ¤ μ›μ»¤κ°€ ν•„μ”ν•λ‹¤. Vite κΈ°λ°μΌλ΅ κµ¬μ„±λμ–΄μλ” ν”„λ΅μ νΈμ—μ„λ” <a href="https://vite-pwa-org.netlify.app/">PWA Plugin for Vite</a>λ΅ μ‰½κ² PWA μ„¤μΉ μ§€μ›κ³Ό ν•¨κ» μ„λΉ„μ¤ μ›μ»¤λ¥Ό λ“±λ΅ν•  μ μκ² μ„¤μ •ν•  μ μλ‹¤. μ„λΉ„μ¤ μ›μ»¤λ” HTTPS μ—μ„ λ™μ‘ν•΄μ•Όν•λ―€λ΅ κ°λ° ν™κ²½μ—μ„λ” <a href="https://github.com/liuweiGL/vite-plugin-mkcert">vite-plugin-mkcert</a>κ°€ λ„μ›€μ΄ λ  μ μλ‹¤.</p><h4 id="μ„λΉ„μ¤-μ›μ»¤μ-μƒνƒ-λ³€κ²½μ„-κ³ λ ¤ν•κΈ°"><a href="#μ„λΉ„μ¤-μ›μ»¤μ-μƒνƒ-λ³€κ²½μ„-κ³ λ ¤ν•κΈ°" class="headerlink" title="μ„λΉ„μ¤ μ›μ»¤μ μƒνƒ λ³€κ²½μ„ κ³ λ ¤ν•κΈ°"></a>μ„λΉ„μ¤ μ›μ»¤μ μƒνƒ λ³€κ²½μ„ κ³ λ ¤ν•κΈ°</h4><p>μ„λΉ„μ¤ μ›μ»¤μ μƒλ… μ£ΌκΈ°λ¥Ό μ΄ν•΄ν•κ³  μƒλ΅ μ„¤μΉλκ±°λ‚ μ—…λ°μ΄νΈλλ” μ„λΉ„μ¤ μ›μ»¤λ΅ μΈν•΄ λ©”μ‹μ§€ μμ‹ μ΄ μ›ν™ν•μ§€ μ•μ„ μ μλ‹¤λ” μ μ„ μΈμ§€ν•΄μ•Όν•λ‹¤. <a href="https://developer.mozilla.org/ko/docs/Web/API/ServiceWorkerGlobalScope/skipWaiting">ServiceWorkerGlobalScope.skipWaiting</a> μ΄λ‚ <a href="https://developer.mozilla.org/ko/docs/Web/API/Clients/claim">Clients::claim()</a>μ΄ λ„μ›€μ΄ λ  μλ„ μλ‹¤.</p><h5 id="μ„λΉ„μ¤-μ›μ»¤-νμΌμ΄-firebase-messaging-sw-js-μΌ-ν•„μ”λ”-μ—†λ‹¤"><a href="#μ„λΉ„μ¤-μ›μ»¤-νμΌμ΄-firebase-messaging-sw-js-μΌ-ν•„μ”λ”-μ—†λ‹¤" class="headerlink" title="μ„λΉ„μ¤ μ›μ»¤ νμΌμ΄ firebase-messaging-sw.js μΌ ν•„μ”λ” μ—†λ‹¤"></a>μ„λΉ„μ¤ μ›μ»¤ νμΌμ΄ firebase-messaging-sw.js μΌ ν•„μ”λ” μ—†λ‹¤</h5><pre class="language-javascript" data-language="javascript"><div class="caption"><span>main.js</span></div><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>        <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MODE</span> <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">?</span> <span class="token string">'/sw.js'</span> <span class="token operator">:</span> <span class="token string">'/dev-sw.js?dev-sw'</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MODE</span> <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">?</span> <span class="token string">'classic'</span> <span class="token operator">:</span> <span class="token string">'module'</span><span class="token punctuation">&#125;</span>    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">registration</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'register service worker'</span><span class="token punctuation">,</span> registration<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></code></pre><p>FCM κ΄€λ ¨ μΌλ¶€ κΈ€μ—μ„ μ„λΉ„μ¤ μ›μ»¤μ νμΌμ΄ λ°λ“μ‹ <code>firebase-messaing-sw.js</code> μ΄μ–΄μ•Ό ν•λ‹¤κ³  μ–ΈκΈ‰ν•λ”λ° μλ»λ μ •λ³΄μ— ν•΄λ‹Ήλλ©° FCM λ©”μ‹μ§€ μμ‹ μ„ μ„ν•΄μ„ PWA μ•±μ—μ„ μ‚¬μ©μ¤‘μΈ <code>μ„λΉ„μ¤ μ›μ»¤ λ‚΄μ— Firebase SDKλ¥Ό μ΄κΈ°ν™”</code>ν•λ”κ² μ¤‘μ”ν• λ¶€λ¶„μ΄λ‹¤. μ„ μ½”λ“μ™€ κ°™μ΄ κ°λ° ν™κ²½μ—μ„λ” <a href="https://vite-pwa-org.netlify.app/guide/development#injectmanifest-strategy">dev-sw.js</a>λ¥Ό μ„λΉ„μ¤ μ›μ»¤λ΅ λ“±λ΅ν•μ—¬ μ‚¬μ©ν•  μ μμμ„ λ³΄μ—¬μ¤€λ‹¤.</p><h4 id="FCM-ν‘Έμ‹-μ•λ¦Όμ΄-μ—¬λ¬λ²-ν‘μ‹λλ”-λ¬Έμ -π”¥"><a href="#FCM-ν‘Έμ‹-μ•λ¦Όμ΄-μ—¬λ¬λ²-ν‘μ‹λλ”-λ¬Έμ -π”¥" class="headerlink" title="FCM ν‘Έμ‹ μ•λ¦Όμ΄ μ—¬λ¬λ² ν‘μ‹λλ” λ¬Έμ  π”¥"></a>FCM ν‘Έμ‹ μ•λ¦Όμ΄ μ—¬λ¬λ² ν‘μ‹λλ” λ¬Έμ  π”¥</h4><p><a href="https://github.com/kdevkr/mambo-box/blob/main/errors/2024-07-06.md">PWA μ•±μ ν‘Έμ‹ μ•λ¦Όμ—μ„ FCM λ©”μ‹μ§€κ°€ μ—¬λ¬λ² ν‘μ‹λλ” λ¬Έμ </a>μ™€ κ°™μ΄ λ°±κ·ΈλΌμ΄λ“ μƒνƒμ— μλ” PWA μ•±μ—μ„ ν‘Έμ‹ μ•λ¦Όμ΄ μ—¬λ¬λ² ν‘μ‹λλ” μ΄μ λ” <a href="https://firebase.google.com/docs/cloud-messaging/js/receive?hl=ko">μλ°”μ¤ν¬λ¦½νΈ ν΄λΌμ΄μ–ΈνΈμ—μ„ λ©”μ‹μ§€ μμ‹ </a>μ‹ μ•λ¦Ό λ©”μ‹μ§€μ— μν• κΈ°λ³Έ ν™”λ©΄ ν‘μ‹μ— λ€ν•΄ κ³ λ ¤ν•μ§€ μ•μ€ λ¬Έμ μ— ν•΄λ‹Ήλλ‹¤. μλ°”μ¤ν¬λ¦½νΈ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ»¤μ¤ν…€ λ©”μ‹μ§€λ΅ ν‘Έμ‹ μ•λ¦Όμ„ μ κ³µν•κ³  μ‹¶λ‹¤λ©΄ μ„λ²„μ—μ„λ” μ•λ¦Ό λ©”μ‹μ§€κ°€ ν¬ν•¨λμ§€ μ•μ€ λ°μ΄ν„° λ©”μ‹μ§€λ΅ κµ¬μ„±ν•μ—¬ μ „λ‹¬ν•΄μ•Όν•λ‹¤.</p><h4 id="μλ°”μ¤ν¬λ¦½νΈ-ν΄λΌμ΄μ–ΈνΈ-API-ν‚¤λ”-μ•μ „ν•λ‹¤"><a href="#μλ°”μ¤ν¬λ¦½νΈ-ν΄λΌμ΄μ–ΈνΈ-API-ν‚¤λ”-μ•μ „ν•λ‹¤" class="headerlink" title="μλ°”μ¤ν¬λ¦½νΈ ν΄λΌμ΄μ–ΈνΈ API ν‚¤λ” μ•μ „ν•λ‹¤"></a>μλ°”μ¤ν¬λ¦½νΈ ν΄λΌμ΄μ–ΈνΈ API ν‚¤λ” μ•μ „ν•λ‹¤</h4><p>μΌλ°μ μΌλ΅ μλ°”μ¤ν¬λ¦½νΈλ΅ λ™μ‘ν•λ” SDKμ— λ€ν• ν‚¤λ” μ™Έλ¶€μ— λ…Έμ¶λ  μ λ°–μ— μ—†μΌλ―€λ΅ FCM λ©”μ‹μ§€λ¥Ό μμ‹ ν•  μ μλ” μµμ†ν•μ κ¶ν•μ„ λ³΄μ ν•λ‹¤. FCM μ½μ†”μ—μ„ <a href="https://developer.chrome.com/blog/web-push-interop-wins?hl=ko#introducing_vapid_for_server_identification">μ›Ή ν‘Έμ‹ μΈμ¦μ„</a>λ” <code>μµλ€ 2κ°κΉμ§€ λ°κΈ‰</code>ν•  μ μμΌλ―€λ΅ <code>VAPID</code>λ¥Ό ν™κ²½λ³„λ΅ λ‚λ„μ–΄μ„ μ‚¬μ©ν•λ” κ²ƒλ„ μΆ‹μ•„λ³΄μΈλ‹¤. λ” μμ„Έν• λ‚΄μ©μ€ <a href="https://firebase.google.com/docs/projects/api-keys?hl=ko">Firebaseμ© API ν‚¤ μ‚¬μ© λ° κ΄€λ¦¬μ— λ€ν•΄ μ•μ•„λ³΄κΈ°</a>λ¥Ό μ°Έκ³ ν•μ—¬ κ³ λ ¤ν•΄λ³΄λ„λ΅ ν•μ.</p><h4 id="μ‹μ¤ν…-κ·λ¨μ—-λ”°λ¥Έ-ν† ν°-κ΄€λ¦¬-μ „λµ"><a href="#μ‹μ¤ν…-κ·λ¨μ—-λ”°λ¥Έ-ν† ν°-κ΄€λ¦¬-μ „λµ" class="headerlink" title="μ‹μ¤ν… κ·λ¨μ— λ”°λ¥Έ ν† ν° κ΄€λ¦¬ μ „λµ"></a>μ‹μ¤ν… κ·λ¨μ— λ”°λ¥Έ ν† ν° κ΄€λ¦¬ μ „λµ</h4><p><a href="https://firebase.google.com/docs/cloud-messaging/manage-tokens?hl=ko">FCM λ“±λ΅ ν† ν° κ΄€λ¦¬λ¥Ό μ„ν• κ¶μ¥μ‚¬ν•­</a>κ³Ό <a href="https://firebase.google.com/docs/cloud-messaging/scale-fcm?hl=ko">FCM λ©”μ‹μ§€λ¥Ό λ€κ·λ¨λ΅ μ „μ†΅ν•  λ•μ κ¶μ¥μ‚¬ν•­</a>λ¥Ό μ°Έκ³ ν•μ—¬ μ‹μ¤ν…μ— μ €μ¥λμ–΄ λ©”μ‹μ§€ μ „μ†΅ μ‹ μ‚¬μ©λλ” ν† ν°μ μλ¥Ό κ΄€λ¦¬ν•λ”κ² ν•„μ”ν•λ‹¤. μ„λ²„μ—μ„λ” μ‚¬μ©μκ°€ PWA μ•±μ„ μ‚­μ ν•λ”μ§€λ¥Ό κ°μ§€ν•μ—¬ λ”μ΄μƒ ν† ν°μ΄ μ‚¬μ©λμ§€ μ•λ”μ§€ μ• μ μ—†λ‹¤. FCM λ©”μ‹μ§€ μ „μ†΅ μ‹ λ¬΄μ ν•μΌλ΅ λ°μ†΅ν•  μλ” μ—†μΌλ―€λ΅ μ¤λ«λ™μ• μ‚¬μ©λμ§€ μ•κ±°λ‚ λ§λ£λ ν† ν°μ€ μ£ΌκΈ°μ μΌλ΅ μ‚­μ ν•λ” μ‘μ—…μ΄ μμ–΄μ•Όν•λ‹¤.</p><h4 id="iOSμ-PWA-μ•±-μ§€μ›-μ—¬λ¶€"><a href="#iOSμ-PWA-μ•±-μ§€μ›-μ—¬λ¶€" class="headerlink" title="iOSμ PWA μ•± μ§€μ› μ—¬λ¶€"></a>iOSμ PWA μ•± μ§€μ› μ—¬λ¶€</h4><p>μ•λ“λ΅μ΄λ“μ™€ ν¬λ΅¬ λΈλΌμ°μ €μ™€ λ‹¬λ¦¬ iOS λλ” μ‚¬νλ¦¬ λΈλΌμ°μ €μ— λ”°λΌ PWA μ•± μ„¤μΉ λ° ν‘Έμ‹ APIλ¥Ό μ§€μ›ν•λ”μ§€μ μ—¬λ¶€κ°€ λ‹¤λ¦„μ„ μΈμ§€ν•΄μ•Όν•λ‹¤. λν•, ν™ ν™”λ©΄μΌλ΅ μ¶”κ°€λλ” μ•±μ€ λ°λ“μ‹ κΈ°λ³ΈμΌλ΅ μ κ³µλλ” μ‚¬νλ¦¬ λΈλΌμ°μ €λ΅ μ‹¤ν–‰λλ” κ²ƒλ„ μ¤‘μ”ν• λ¶€λ¶„μ— ν•΄λ‹Ήλλ‹¤.</p><ul><li><a href="https://developer.apple.com/documentation/usernotifications/sending-web-push-notifications-in-web-apps-and-browsers">Safari 16.1 and macOS 16.4 iOS &amp; iPadOS λ¶€ν„° Push API μ§€μ›</a></li><li><a href="https://developer.apple.com/support/dma-and-apps-in-the-eu/">μ λ½ μ—°ν•©μ κµ­κ°€μ—μ„ iOS 17.4 μ΄μƒμ—μ„ PWA μ§€μ› μΆ…λ£</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;PWAμ-μ„λΉ„μ¤-μ›μ»¤λ”-HTTPSλ¥Ό-μ”κµ¬&quot;&gt;&lt;a href=&quot;#PWAμ-μ„λΉ„μ¤-μ›μ»¤λ”-HTTPSλ¥Ό-μ”κµ¬&quot; class=&quot;headerlink&quot; title=&quot;PWAμ μ„λΉ„μ¤ μ›μ»¤λ” HTTPSλ¥Ό μ”κµ¬&quot;&gt;&lt;/a&gt;PWAμ μ„λΉ„μ¤ μ›μ»¤λ” HTTPSλ¥Ό </summary>
      
    
    
    
    
    <category term="FCM" scheme="https://kdevkr.github.io/tags/FCM/"/>
    
    <category term="PWA" scheme="https://kdevkr.github.io/tags/PWA/"/>
    
  </entry>
  
  <entry>
    <title>HAProxy</title>
    <link href="https://kdevkr.github.io/haproxy/"/>
    <id>https://kdevkr.github.io/haproxy/</id>
    <published>2024-06-29T06:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.419Z</updated>
    
    <content type="html"><![CDATA[<p>μΌλ°μ μΌλ΅ μ• ν”λ¦¬μΌ€μ΄μ… μ„λ²„μ— λ€ν• HTTP ν”„λ΅μ‹λ” μ—”μ§„μ—‘μ¤(Nginx)λ¥Ό λ§μ΄ μ‚¬μ©ν•κ³  μμ§€λ§ L4 λ λ²¨μ <code>TCP ν”„λ΅μ‹</code>κ°€ ν•„μ”ν• κ²½μ° stream λ¨λ“μ„ λ³„λ„λ΅ μ„¤μΉν•΄μ•Όν•λ” κ³Όμ •μ΄ ν•„μ”ν•λ―€λ΅ <code>HAProxy</code>κ°€ λ” μΆ‹μ€ μ„ νƒμΌ μ μλ‹¤. μ‚¬λ‚΄ κ°λ° ν™κ²½μ—μ„ μ—°κ²°ν•  μ μλ” λ°°μ¤μ² νΈμ¤νΈμ— HAProxyλ¥Ό κµ¬μ„±ν•κ³  ν”„λΌμ΄λΉ— λ„¤νΈμ›ν¬ ν™κ²½μΌλ΅ κµ¬μ„±λμ–΄μλ” ν…μ¤νΈ ν™κ²½μ TCP ν†µμ‹ μ΄ ν•„μ”ν• μΈμ¤ν„΄μ¤μ— μ—°κ²°ν•  μ μλ„λ΅ <code>ν¬νΈ ν¬μ›λ”©</code>μ„ κµ¬μ„±ν•΄λ³΄λ„λ΅ ν•μ.</p><h4 id="TCP-ν”„λ΅μ‹"><a href="#TCP-ν”„λ΅μ‹" class="headerlink" title="TCP ν”„λ΅μ‹"></a>TCP ν”„λ΅μ‹</h4><p><a href="https://www.haproxy.com/documentation/haproxy-configuration-tutorials/load-balancing/tcp/">TCP ν”„λ΅μ‹</a>λ” TCP μ—°κ²°μ— λ€ν• λ¦¬λ²„μ¤ ν”„λ΅μ‹μ— ν•΄λ‹Ήλλ‹¤. μΌλ°μ μΌλ΅ TCP μ—°κ²°μ„ μν–‰ν•΄μ•Όν•λ” μΈμ¤ν„΄μ¤μ—λ” Redis λλ” PostgreSQLμ΄ μλ”λ° ν„μ¬ μ΅°μ§μ—μ„ ν™μ©ν•κ³  μλ” μ‹κ³„μ—΄ λ°μ΄ν„°λ² μ΄μ¤μΈ <a href="https://kx.com/products/kdb/">KDB+</a>μ— λ€ν•΄ ν”„λ΅μ‹λ¥Ό κµ¬μ„±ν•΄λ³΄λ ¤κ³  ν•λ‹¤. λ‹¤μμ€ KDBμ—μ„ μ‚¬μ©ν•΄μ•Όν•λ” ν¬νΈ λ²”μ„λ¥Ό μμ‹ ν•λ„λ΅ μ„¤μ •ν• μμ‹μ΄λ‹¤.</p><pre class="language-cfg" data-language="cfg"><div class="caption"><span>haproxy.cfg</span></div><code class="language-cfg">listen kdb_proxy_for_dev    mode tcp    bind *:5010-5013    server kdb_dev 192.168.149.88</code></pre><h4 id="HAProxy-κµ¬μ„±-ν…μ¤νΈ"><a href="#HAProxy-κµ¬μ„±-ν…μ¤νΈ" class="headerlink" title="HAProxy κµ¬μ„± ν…μ¤νΈ"></a>HAProxy κµ¬μ„± ν…μ¤νΈ</h4><p>ν„μ¬ μ„¤μ • νμΌμ— λ¬Έλ²•μ μΈ λ¬Έμ κ°€ μ—†λ”μ§€ <code>check mode(-c)</code> μµμ…μ„ μ‚¬μ©ν•΄μ„ ν„μ¬ μ„¤μ •μ— λ€ν•΄ κ²€μ¦μ„ μν–‰ν•΄λ³Ό μ μλ‹¤.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>ec2-user@ip-192-169-14-62 ~<span class="token punctuation">]</span>$ haproxy <span class="token parameter variable">-c</span> <span class="token parameter variable">-f</span> /etc/haproxy/haproxy.cfgConfiguration <span class="token function">file</span> is valid</code></pre><h4 id="TCP-ν”„λ΅μ‹-ν…μ¤νΈ"><a href="#TCP-ν”„λ΅μ‹-ν…μ¤νΈ" class="headerlink" title="TCP ν”„λ΅μ‹ ν…μ¤νΈ"></a>TCP ν”„λ΅μ‹ ν…μ¤νΈ</h4><p>NetCat(nc) λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•΄μ„ HAProxyμ—μ„ μμ‹ ν•κ³  μλ” ν¬νΈλ¥Ό ν†µν•΄ ν…μ¤νΈ ν™κ²½μ— μ‹¤ν–‰λ μΈμ¤ν„΄μ¤μ— μ—°κ²°ν•  μ μλ”μ§€ ν…μ¤νΈλ¥Ό ν•΄λ³΄μ.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>ec2-user@ip-192-169-14-62 ~<span class="token punctuation">]</span>$ <span class="token function">nc</span> <span class="token parameter variable">-znv</span> <span class="token number">127.0</span>.0.1 <span class="token number">5013</span>Ncat: Version <span class="token number">7.50</span> <span class="token punctuation">(</span> https://nmap.org/ncat <span class="token punctuation">)</span>Ncat: Connected to <span class="token number">127.0</span>.0.1:5013.Ncat: <span class="token number">0</span> bytes sent, <span class="token number">0</span> bytes received <span class="token keyword">in</span> <span class="token number">0.01</span> seconds.</code></pre><blockquote><p>λ°°μ¤μ² νΈμ¤νΈμ— TCP ν”„λ΅μ‹λ¥Ό κµ¬μ„±ν•κΈ° μ „κΉμ§€λ” λ°°μ¤μ² νΈμ¤νΈμ— λ€ν• SSH ν„°λ„λ§μ„ ν•„μ”ν• λ•λ§λ‹¤ μν–‰ν•΄μ•Ό ν–μµλ‹λ‹¤.<br>κΈ°λ³Έμ μΌλ΅ SSH ν„°λ„λ§μ„ κµ¬μ„±ν•λ”κ² μΌλ°μ μ΄μ§€λ§ λ³΄μ• μμ¤€μ„ κ²€ν† ν•κ³  TCP ν”„λ΅μ‹λ¥Ό κµ¬μ„±ν•΄λ³΄λ„λ΅ ν•μ„Έμ”.</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;μΌλ°μ μΌλ΅ μ• ν”λ¦¬μΌ€μ΄μ… μ„λ²„μ— λ€ν• HTTP ν”„λ΅μ‹λ” μ—”μ§„μ—‘μ¤(Nginx)λ¥Ό λ§μ΄ μ‚¬μ©ν•κ³  μμ§€λ§ L4 λ λ²¨μ &lt;code&gt;TCP ν”„λ΅μ‹&lt;/code&gt;κ°€ ν•„μ”ν• κ²½μ° stream λ¨λ“μ„ λ³„λ„λ΅ μ„¤μΉν•΄μ•Όν•λ” κ³Όμ •μ΄ ν•„μ”ν•λ―€λ΅ &lt;code&gt;HAProxy&lt;</summary>
      
    
    
    
    
    <category term="HAProxy" scheme="https://kdevkr.github.io/tags/HAProxy/"/>
    
    <category term="TCP Proxy" scheme="https://kdevkr.github.io/tags/TCP-Proxy/"/>
    
  </entry>
  
  <entry>
    <title>Spring AI + Ollama</title>
    <link href="https://kdevkr.github.io/spring-ai-with-ollama/"/>
    <id>https://kdevkr.github.io/spring-ai-with-ollama/</id>
    <published>2024-06-28T14:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.423Z</updated>
    
    <content type="html"><![CDATA[<p>Spring AI ν”„λ΅μ νΈμ—μ„ OpenAIμ ChatGPT λλ” Anthropicμ Claudeλ¥Ό μ§€μ›ν•μ§€λ§ λ΅μ»¬ λ¨Έμ‹ μ—μ„ μ‹¤ν–‰ν•  μ μλ” Ollamaλ„ μ§€μ›ν•κ³  μλ‹¤.<br>λ‚΄ μ»΄ν“¨ν„°μ— Ollamaλ¥Ό μ„¤μΉν•κ³  νλΌλ―Έν„°κ°€ μ‘μ€ λ¨λΈμ„ μ„ νƒν•΄μ„ κ°„λ‹¨ν•κ² AI μ—”μ§€λ‹μ–΄λ§μ„ ν•΄λ³΄λ„λ΅ ν•λ ¤κ³  ν•λ‹¤. </p><h4 id="μλ„μ°-Ollama-μ„¤μΉ"><a href="#μλ„μ°-Ollama-μ„¤μΉ" class="headerlink" title="μλ„μ° Ollama μ„¤μΉ"></a>μλ„μ° Ollama μ„¤μΉ</h4><p><a href="https://ollama.com/download/windows">Download for Windows (Preview)</a>λ¥Ό ν†µν•΄ μλ„μ° μ»΄ν“¨ν„°μ— Ollamaλ¥Ό μ„¤μΉν•κ³  μ‚¬μ©κ°€λ¥ν• <a href="https://ollama.com/library">λ¨λΈ</a> μ¤‘μ—μ„ νλΌλ―Έν„°κ°€ μ‘μ€ λ¨λΈ μ¤‘ ν•λ‚μΈ <a href="https://ollama.com/library/phi3">phi3</a>λ¥Ό μ„ νƒν•΄λ³΄μ.<br>μΌλ°μ μΈ μμ‹μ—μ„λ” <a href="https://ollama.com/library/mistral">mistral</a>λ¥Ό μ„¤μΉν•΄μ„ μ‚¬μ©ν•΄λ³΄λ” κ²ƒ κ°™λ‹¤. μ•„λ¬΄νΌ, <code>ollama run phi3</code> λ…λ Ήμ–΄λ΅ λ¨λΈμ„ μ„¤μΉν•  μ μλ‹¤.</p><pre class="language-ps" data-language="ps"><code class="language-ps">PS C:\Users\Mambo\ollama&gt; ollama run phi3pulling manifestpulling b26e6713dc74... 100% β–•β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β– 2.4 GBpulling fa8235e5b48f... 100% β–•β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β– 1.1 KBpulling 542b217f179c... 100% β–•β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–  148 Bpulling 8dde1baf1db0... 100% β–•β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–   78 Bpulling f91db7a2deb9... 100% β–•β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–β–  485 Bverifying sha256 digestwriting manifestremoving any unused layerssuccess</code></pre><h4 id="Open-WebUI-μ„¤μΉ"><a href="#Open-WebUI-μ„¤μΉ" class="headerlink" title="Open WebUI μ„¤μΉ"></a>Open WebUI μ„¤μΉ</h4><p>Spring AIμ™€λ” μƒκ΄€μ—†μ§€λ§ ChatGPTμ™€ κ°™μ€ AI μ„λΉ„μ¤μ²λΌ Ollamaμ™€ μ—°λ™μ΄ κ°€λ¥ν• <a href="https://openwebui.com/">Open WebUI</a>λ¥Ό μ„¤μΉν•΄λ³΄μ•λ‹¤. </p><pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">open-webui</span><span class="token punctuation">:</span>    <span class="token key atrule">image</span><span class="token punctuation">:</span> ghcr.io/open<span class="token punctuation">-</span>webui/open<span class="token punctuation">-</span>webui<span class="token punctuation">:</span>main    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> open<span class="token punctuation">-</span>webui    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">"3000:8080"</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token key atrule">OLLAMA_BASE_URL</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//host.docker.internal<span class="token punctuation">:</span><span class="token number">11434</span>      <span class="token key atrule">WEBUI_AUTH</span><span class="token punctuation">:</span> <span class="token boolean important">False</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> open<span class="token punctuation">-</span>webui<span class="token punctuation">:</span>/app/backend/data    <span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> host.docker.internal<span class="token punctuation">:</span>host<span class="token punctuation">-</span>gateway    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped<span class="token key atrule">volumes</span><span class="token punctuation">:</span>  <span class="token key atrule">open-webui</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>μ €λ” μ»΄ν“¨ν„° νΈμ¤νΈμ— Ollamaλ¥Ό μ„¤μΉν•κ³  μ‹¤ν–‰ν•μ€κΈ°μ— host.docker.internalλ΅ μ ‘κ·Όν–μµλ‹λ‹¤.<br>Ollamaλ¥Ό λ„μ»¤ μ»΄ν¬μ¦λ΅ μ‹¤ν–‰ν•κΈ° μ„ν• μ„¤μ •μ€ <a href="https://github.com/open-webui/open-webui/blob/main/docker-compose.yaml">docker-compose.yaml</a>λ¥Ό μ°Έκ³ ν•μ„Έμ”.</p></blockquote><h4 id="Spring-AI-Ollama-Chat"><a href="#Spring-AI-Ollama-Chat" class="headerlink" title="Spring AI Ollama Chat"></a>Spring AI Ollama Chat</h4><p><a href="https://docs.spring.io/spring-ai/reference/api/chat/ollama-chat.html">OllamaChatModel</a></p><pre class="language-groovy" data-language="groovy"><div class="caption"><span>build.gradle</span></div><code class="language-groovy">repositories <span class="token punctuation">&#123;</span>    maven <span class="token punctuation">&#123;</span> url <span class="token string">'https://repo.spring.io/milestone'</span> <span class="token punctuation">&#125;</span>    maven <span class="token punctuation">&#123;</span> url <span class="token string">'https://repo.spring.io/snapshot'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>dependencies <span class="token punctuation">&#123;</span>    implementation <span class="token string">'org.springframework.ai:spring-ai-ollama-spring-boot-starter'</span><span class="token punctuation">&#125;</span>dependencyManagement <span class="token punctuation">&#123;</span>    imports <span class="token punctuation">&#123;</span>        mavenBom <span class="token interpolation-string"><span class="token string">"de.codecentric:spring-boot-admin-dependencies:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">springBootAdminVersion</span></span><span class="token string">"</span></span>        mavenBom <span class="token interpolation-string"><span class="token string">"org.springframework.ai:spring-ai-bom:1.0.0-M1"</span></span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-yaml" data-language="yaml"><div class="caption"><span>application.yml</span></div><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">ai</span><span class="token punctuation">:</span>    <span class="token key atrule">ollama</span><span class="token punctuation">:</span>      <span class="token key atrule">base-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">11434</span>      <span class="token key atrule">chat</span><span class="token punctuation">:</span>        <span class="token key atrule">options</span><span class="token punctuation">:</span>          <span class="token key atrule">model</span><span class="token punctuation">:</span> phi3          <span class="token key atrule">temperature</span><span class="token punctuation">:</span> <span class="token number">0.9</span>    <span class="token key atrule">retry</span><span class="token punctuation">:</span>      <span class="token key atrule">max-attempts</span><span class="token punctuation">:</span> <span class="token number">1</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequiredArgsConstructor</span><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatApi</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TEMPLATE</span> <span class="token operator">=</span> <span class="token triple-quoted-string string">"""            Hello ai, How many hours does &#123;timezone&#125; differ by UTC?.            """</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">OllamaChatModel</span> chatModel<span class="token punctuation">;</span>    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/ai/generate"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">String</span> timezone<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">PromptTemplate</span> promptTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PromptTemplate</span><span class="token punctuation">(</span><span class="token constant">TEMPLATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        promptTemplate<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"timezone"</span><span class="token punctuation">,</span> timezone<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> chatModel<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>promptTemplate<span class="token punctuation">.</span><span class="token function">createMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-txt" data-language="txt"><div class="caption"><span>AI Response</span></div><code class="language-txt">Seoul, South Korea operates on Korea Standard Time (KST), which is 9 hours ahead of Coordinated Universal Time (UTC+9). Therefore, the difference between UTC and KST in Seoul is 9 hours.To calculate this for any specific time:- If you're looking to convert a time from UTC to KST, add 9 hours.- If you're converting a time from KST back to UTC, subtract 9 hours.</code></pre><p>κ²°μ κ°€ ν•„μ”ν• ChatGPTμ™€ Claude API λ€μ‹ μ— λ΅μ»¬ λ¨Έμ‹ μ— Ollamaλ¥Ό μ„¤μΉν•κ³  Spring AIλ¥Ό κ°„λ‹¨ν•κ² λ‹¤λ£¨μ–΄λ³΄μ•λ‹¤.<br>κ°μΈμ μΌλ΅ AIμ— λ€ν• μΈμ‹μ€ μ•„μ§ <strong>μ„¤λ λ°</strong>μ΄λΌκ³  μƒκ°μ΄ λμ§€λ§ AIκ°€ μ„±μ¥ν• μλ΅ <a href="https://www.promptingguide.ai/kr">ν”„λ΅¬ν”„νΈ μ—”μ§€λ‹μ–΄λ§</a>λ„ κ°λ°μμ—κ² ν•„μ”ν• μ—­λ‰μ΄ λμ–΄κ° μ μμ–΄μ„ μ¤€λΉ„κ°€ ν•„μ”ν•λ‹¤.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Spring AI ν”„λ΅μ νΈμ—μ„ OpenAIμ ChatGPT λλ” Anthropicμ Claudeλ¥Ό μ§€μ›ν•μ§€λ§ λ΅μ»¬ λ¨Έμ‹ μ—μ„ μ‹¤ν–‰ν•  μ μλ” Ollamaλ„ μ§€μ›ν•κ³  μλ‹¤.&lt;br&gt;λ‚΄ μ»΄ν“¨ν„°μ— Ollamaλ¥Ό μ„¤μΉν•κ³  νλΌλ―Έν„°κ°€ μ‘μ€ λ¨λΈμ„ μ„ νƒν•΄μ„ κ°„</summary>
      
    
    
    
    
    <category term="spring ai" scheme="https://kdevkr.github.io/tags/spring-ai/"/>
    
    <category term="ollama" scheme="https://kdevkr.github.io/tags/ollama/"/>
    
  </entry>
  
  <entry>
    <title>AWS EC2 μΈμ¤ν„΄μ¤ λ©”νƒ€λ°μ΄ν„°</title>
    <link href="https://kdevkr.github.io/aws-ec2-instance-metadata/"/>
    <id>https://kdevkr.github.io/aws-ec2-instance-metadata/</id>
    <published>2024-06-25T13:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.419Z</updated>
    
    <content type="html"><![CDATA[<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># IMDSv1</span><span class="token function">curl</span> http://169.254.169.254/latest/dynamic/instance-identity/document<span class="token comment"># IMDSv2</span><span class="token assign-left variable">TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">curl</span> <span class="token parameter variable">-H</span> <span class="token string">"X-aws-ec2-metadata-token-ttl-seconds: 21600"</span><span class="token variable">`</span></span> <span class="token parameter variable">-X</span> PUT <span class="token string">"http://169.254.169.254/latest/api/token"</span> <span class="token function">curl</span> <span class="token parameter variable">-H</span> <span class="token string">"X-aws-ec2-metadata-token: <span class="token variable">$TOKEN</span>"</span> http://169.254.169.254/latest/dynamic/instance-identity/document<span class="token punctuation">&#123;</span>    <span class="token string">"accountId"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,    <span class="token string">"architecture"</span><span class="token builtin class-name">:</span> <span class="token string">"arm64"</span>,    <span class="token string">"availabilityZone"</span><span class="token builtin class-name">:</span> <span class="token string">"ap-northeast-2c"</span>,    <span class="token string">"billingProducts"</span><span class="token builtin class-name">:</span> null,    <span class="token string">"devpayProductCodes"</span><span class="token builtin class-name">:</span> null,    <span class="token string">"marketplaceProductCodes"</span><span class="token builtin class-name">:</span> null,    <span class="token string">"imageId"</span><span class="token builtin class-name">:</span> <span class="token string">"ami-0331a5c9d849893dc"</span>,    <span class="token string">"instanceId"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,    <span class="token string">"instanceType"</span><span class="token builtin class-name">:</span> <span class="token string">"c6g.xlarge"</span>,    <span class="token string">"kernelId"</span><span class="token builtin class-name">:</span> null,    <span class="token string">"pendingTime"</span><span class="token builtin class-name">:</span> <span class="token string">"2024-06-23T01:01:23Z"</span>,    <span class="token string">"privateIp"</span><span class="token builtin class-name">:</span> <span class="token string">"192.169.44.196"</span>,    <span class="token string">"ramdiskId"</span><span class="token builtin class-name">:</span> null,    <span class="token string">"region"</span><span class="token builtin class-name">:</span> <span class="token string">"ap-northeast-2"</span>,    <span class="token string">"version"</span><span class="token builtin class-name">:</span> <span class="token string">"2017-09-30"</span><span class="token punctuation">&#125;</span></code></pre><p><a href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/instancedata-data-retrieval.html">μΈμ¤ν„΄μ¤ λ©”νƒ€λ°μ΄ν„° κ²€μƒ‰</a>μ„ ν™μ©ν•΄μ„ λ™μ  λ°μ΄ν„°μ <a href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/instance-identity-documents.html">μΈμ¤ν„΄μ¤ μκ²© μ¦λ… λ¬Έμ„(instance-identity&#x2F;document)</a>λ¥Ό κ°€μ Έμ¤λ” μμ‹μ΄λ‹¤. μ΄λ² κΈ€μ—μ„λ” <code>AWS SDK for Java</code> λΌμ΄λΈλ¬λ¦¬μ—μ„ μ κ³µν•λ” <code>EC2 λ©”νƒ€λ°μ΄ν„° μ ν‹Έλ¦¬ν‹°</code>λ¥Ό ν†µν•΄ AWS EC2 μΈμ¤ν„΄μ¤μ—μ„ μ‹¤ν–‰μ¤‘μΈ μ• ν”λ¦¬μΌ€μ΄μ… μ„λ²„μ—μ„ EC2 μΈμ¤ν„΄μ¤ μ •λ³΄λ¥Ό μ΅°νν•  μ μλ„λ΅ μ‘μ„±ν•΄λ³΄λ ¤κ³  ν•λ‹¤. μ¤ν”„λ§ λ¶€νΈ κΈ°λ°μ μ• ν”λ¦¬μΌ€μ΄μ…μ΄λΌλ©΄ μ¤ν”„λ§ λ¶€νΈ μ•΅μ¶”μ—μ΄ν„°μ <a href="https://docs.spring.io/spring-boot/reference/actuator/endpoints.html#actuator.endpoints.info">InfoContributor</a> μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν• <code>EC2MetadataInfoContributor</code>λ¥Ό λ§λ“¤μ–΄λ³΄μ.</p><h4 id="EC2MetadataInfoContributor-with-SDK-for-Java-1-x"><a href="#EC2MetadataInfoContributor-with-SDK-for-Java-1-x" class="headerlink" title="EC2MetadataInfoContributor with SDK for Java 1.x"></a>EC2MetadataInfoContributor with SDK for Java 1.x</h4><pre class="language-groovy" data-language="groovy"><div class="caption"><span>build.gradle</span></div><code class="language-groovy">dependencies <span class="token punctuation">&#123;</span>    <span class="token comment">// the AWS SDK for Java v1.x will enter maintenance mode on July 31, 2024, and reach end-of-support on December 31, 2025.</span>    implementation <span class="token function">platform</span><span class="token punctuation">(</span><span class="token string">'com.amazonaws:aws-java-sdk-bom:1.12.748'</span><span class="token punctuation">)</span>    implementation <span class="token string">'com.amazonaws:aws-java-sdk-ec2'</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><div class="caption"><span>EC2MetadataInfoContributor.java</span></div><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">EC2MetadataUtils</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>info<span class="token punctuation">.</span></span><span class="token class-name">Info</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>info<span class="token punctuation">.</span></span><span class="token class-name">InfoContributor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EC2MetadataInfoContributor</span> <span class="token keyword">implements</span> <span class="token class-name">InfoContributor</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> isRunningAwsEC2<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">EC2MetadataInfoContributor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        isRunningAwsEC2 <span class="token operator">=</span> <span class="token class-name">EC2MetadataUtils</span><span class="token punctuation">.</span><span class="token function">getInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contribute</span><span class="token punctuation">(</span><span class="token class-name">Info<span class="token punctuation">.</span>Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>isRunningAwsEC2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">EC2MetadataUtils<span class="token punctuation">.</span>InstanceInfo</span> instanceInfo <span class="token operator">=</span> <span class="token class-name">EC2MetadataUtils</span><span class="token punctuation">.</span><span class="token function">getInstanceInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            builder<span class="token punctuation">.</span><span class="token function">withDetail</span><span class="token punctuation">(</span><span class="token string">"ec2"</span><span class="token punctuation">,</span> instanceInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="EC2MetadataInfoContributor-with-SDK-for-Java-2-x"><a href="#EC2MetadataInfoContributor-with-SDK-for-Java-2-x" class="headerlink" title="EC2MetadataInfoContributor with SDK for Java 2.x"></a>EC2MetadataInfoContributor with SDK for Java 2.x</h4><pre class="language-groovy" data-language="groovy"><div class="caption"><span>build.gradle</span></div><code class="language-groovy">dependencies <span class="token punctuation">&#123;</span>    implementation <span class="token function">platform</span><span class="token punctuation">(</span><span class="token string">'software.amazon.awssdk:bom:2.21.4'</span><span class="token punctuation">)</span>    implementation <span class="token string">'software.amazon.awssdk:imds'</span>    implementation <span class="token string">'software.amazon.awssdk:url-connection-client'</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><div class="caption"><span>EC2MetadataInfoContributorV2.java</span></div><code class="language-java">mport <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>info<span class="token punctuation">.</span></span>Info</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>info<span class="token punctuation">.</span></span><span class="token class-name">InfoContributor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">software<span class="token punctuation">.</span>amazon<span class="token punctuation">.</span>awssdk<span class="token punctuation">.</span>core<span class="token punctuation">.</span>document<span class="token punctuation">.</span></span><span class="token class-name">Document</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">software<span class="token punctuation">.</span>amazon<span class="token punctuation">.</span>awssdk<span class="token punctuation">.</span>imds<span class="token punctuation">.</span></span><span class="token class-name">Ec2MetadataClient</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">software<span class="token punctuation">.</span>amazon<span class="token punctuation">.</span>awssdk<span class="token punctuation">.</span>imds<span class="token punctuation">.</span></span><span class="token class-name">Ec2MetadataResponse</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EC2MetadataInfoContributorV2</span> <span class="token keyword">implements</span> <span class="token class-name">InfoContributor</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isRunningAwsEC2<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">EC2MetadataInfoContributorV2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Ec2MetadataClient</span> client <span class="token operator">=</span> <span class="token class-name">Ec2MetadataClient</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            isRunningAwsEC2 <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/latest/meta-data/instance-id"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ignored<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// ignored</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contribute</span><span class="token punctuation">(</span><span class="token class-name">Info<span class="token punctuation">.</span>Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>isRunningAwsEC2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Ec2MetadataClient</span> client <span class="token operator">=</span> <span class="token class-name">Ec2MetadataClient</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Ec2MetadataResponse</span> metadataResponse <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/latest/dynamic/instance-identity/document"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">Document</span> document <span class="token operator">=</span> metadataResponse<span class="token punctuation">.</span><span class="token function">asDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                builder<span class="token punctuation">.</span><span class="token function">withDetail</span><span class="token punctuation">(</span><span class="token string">"ec2"</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">asMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ignored<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// ignored</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="μΈμ¤ν„΄μ¤-λ©”νƒ€λ°μ΄ν„°-κ²€μƒ‰"><a href="#μΈμ¤ν„΄μ¤-λ©”νƒ€λ°μ΄ν„°-κ²€μƒ‰" class="headerlink" title="μΈμ¤ν„΄μ¤ λ©”νƒ€λ°μ΄ν„° κ²€μƒ‰"></a>μΈμ¤ν„΄μ¤ λ©”νƒ€λ°μ΄ν„° κ²€μƒ‰</h4><ol><li>SDK λ²„μ „μ— λ”°λΌ <a href="https://docs.aws.amazon.com/ko_kr/sdk-for-java/latest/developer-guide/migration-imds.html#migration-imds-behavior-endpoint-res">SDKκ°€ μ—”λ“ν¬μΈνΈλ¥Ό IMDSλ΅ ν™•μΈν•κΈ° μ„ν•΄ ν™•μΈν•λ” μ„μΉ</a>κ°€ λ‹¤λ¥΄λ‹¤.</li><li><a href="https://docs.aws.amazon.com/ko_kr/sdk-for-java/latest/developer-guide/migration-imds.html#migration-imds-behavior-imdsv2">Java 2.xλ” IMDSv2λ§ μ§€μ›</a>ν•μ§€λ§ Java 1.xλ” IMDSv2 λ¥Ό μ‚¬μ©ν•  μ μ—†μ„λ• IMDSv1 μΌλ΅λ„ μ΅°νν•λ‹¤.</li><li>Java 2.xλ” <a href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/instancedata-data-categories.html">μΈμ¤ν„΄μ¤ λ©”νƒ€λ°μ΄ν„° μΉ΄ν…κ³ λ¦¬</a>λ¥Ό μ§μ ‘ λ…μ‹ν•΄μ•Όν•λ‹¤.</li><li>Java 1.xλ” 2025λ…„ 12μ›” 31μΌ <a href="https://aws.amazon.com/ko/blogs/developer/announcing-end-of-support-for-aws-sdk-for-java-v1-x-on-december-31-2025/">μ§€μ› μΆ…λ£(End of support)</a>λλ‹¤.</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;pre class=&quot;language-bash&quot; data-language=&quot;bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# IMDSv1&lt;/span&gt;
&lt;span class=&quot;token f</summary>
      
    
    
    
    
    <category term="IMDSv1" scheme="https://kdevkr.github.io/tags/IMDSv1/"/>
    
    <category term="IMDSv2" scheme="https://kdevkr.github.io/tags/IMDSv2/"/>
    
  </entry>
  
  <entry>
    <title>μ¤ν”„λ§ λ¶€νΈ λ©”μΌ ν—¬μ¤μ²΄ν¬ μΊμ‹ν•κΈ°</title>
    <link href="https://kdevkr.github.io/spring-boot-mail-health-check/"/>
    <id>https://kdevkr.github.io/spring-boot-mail-health-check/</id>
    <published>2024-06-23T02:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.423Z</updated>
    
    <content type="html"><![CDATA[<p>ν† μ¤μ <a href="https://toss.tech/article/how-to-work-health-check-in-spring-boot-actuator">Spring Boot Actuatorμ ν—¬μ¤μ²΄ν¬ μ‚΄ν΄λ³΄κΈ°</a>λΌλ” κΈ€μ„ λ³΄κ³  μ¤ν”„λ§ λ¶€νΈ μ•΅μ¶”μ—μ΄ν„°μ—μ„ κΈ°λ³ΈμΌλ΅ μ κ³µν•λ” MailHealthIndiatorμ ν—¬μ¤ μ²΄ν¬ κ²°κ³Όλ¥Ό λ³„λ„λ΅ μ”μ²­ν•λ” κ²½μ° <code>management.endpoint.health.cache-time-to-live</code> μ†μ„±μΌλ΅ μΊμ‹λμ§€ μ•μμ„ ν™•μΈν–λ‹¤. ν•΄λ‹Ή μ†μ„±μ€ μ „μ²΄ ν—¬μ¤ μ²΄ν¬ κ²°κ³Όλ¥Ό λ°ν™ν•λ” ν—¬μ¤ μ—”λ“ν¬μΈνΈ(&#x2F;actuator&#x2F;health)μ— ν•΄λ‹Ήν•λ” μΊμ‹ μµμ…μΌλ΅ λ©”μΌμ— λ€ν• ν—¬μ¤ μ—”λ“ν¬μΈνΈ(&#x2F;actuator&#x2F;health&#x2F;mail)μ— λ€ν•΄μ„λ” μ μ©λμ§€ μ•λ”λ‹¤.</p><p>μ¤ν”„λ§ λ¶€νΈ μ•΅μ¶”μ—μ΄ν„°μ <a href="https://github.com/spring-projects/spring-boot/blob/main/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mail/MailHealthIndicator.java">MailHealthIndicator</a> λ” JavaMailSenderImplμ testConnection ν•¨μλ¥Ό νΈμ¶ν•μ—¬ ν—¬μ¤ μ²΄ν¬ κ²°κ³Όλ¥Ό λ°ν™ν•λ„λ΅ μ‘μ„±λμ–΄μλ‹¤. MailHealthIndicatorλΌλ” μ΄λ¦„μΌλ΅ HealthIIndicatorλ¥Ό κµ¬ν„ν•λ©΄ κΈ°λ³Έμ μΌλ΅ μ κ³µν•λ” MailHealthIndicator λ€μ‹ μ— λ“±λ΅λλ―€λ΅ SMTP μ„λ²„λ΅μ μ—°κ²° μν–‰ κ²°κ³Όλ¥Ό μΊμ‹ν•μ—¬ μ‘λ‹µν•λ„λ΅ μ‘μ„±ν•΄λ³Ό μ μλ‹¤.</p><h4 id="CachableMailHealthIndicator"><a href="#CachableMailHealthIndicator" class="headerlink" title="CachableMailHealthIndicator"></a>CachableMailHealthIndicator</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">Cache</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">CacheBuilder</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token class-name">InitializingBean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>health<span class="token punctuation">.</span></span><span class="token class-name">Health</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>mail<span class="token punctuation">.</span></span><span class="token class-name">MailHealthIndicator</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>mail<span class="token punctuation">.</span>javamail<span class="token punctuation">.</span></span><span class="token class-name">JavaMailSenderImpl</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Instant</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"mailHealthIndicator"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CachableMailHealthIndicator</span> <span class="token keyword">extends</span> <span class="token class-name">MailHealthIndicator</span> <span class="token keyword">implements</span> <span class="token class-name">InitializingBean</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Cache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Health</span><span class="token punctuation">></span></span> cache<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">CachableMailHealthIndicator</span><span class="token punctuation">(</span><span class="token class-name">JavaMailSenderImpl</span> javaMailSender<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>javaMailSender<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doHealthCheck</span><span class="token punctuation">(</span><span class="token class-name">Health<span class="token punctuation">.</span>Builder</span> builder<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Health</span> cached <span class="token operator">=</span> cache <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> cache<span class="token punctuation">.</span><span class="token function">getIfPresent</span><span class="token punctuation">(</span><span class="token string">"mail"</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cached <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            builder<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>cached<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withDetails</span><span class="token punctuation">(</span>cached<span class="token punctuation">.</span><span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">doHealthCheck</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            builder<span class="token punctuation">.</span><span class="token function">down</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cache <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Health</span> health <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">withDetail</span><span class="token punctuation">(</span><span class="token string">"datetime"</span><span class="token punctuation">,</span> <span class="token class-name">Instant</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"mail"</span><span class="token punctuation">,</span> health<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        cache <span class="token operator">=</span> <span class="token class-name">CacheBuilder</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">maximumSize</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">expireAfterWrite</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><img data-src="/images/posts/spring-boot-mail-health-check/01.png" alt="268ms β†’ 4ms"></p><blockquote><p>CacheableMailHealthIndicatorλ” νΈμ¤νΈ μ •λ³΄ λΏλ§ μ•„λ‹λΌ <strong>μΊμ‹λ μ‹κ°„</strong>μ„ ν¬ν•¨ν•μ—¬ μ–Έμ  μΈ΅μ •λ κ²°κ³ΌμΈμ§€λ„ ν™•μΈν•  μ μμµλ‹λ‹¤.</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ν† μ¤μ &lt;a href=&quot;https://toss.tech/article/how-to-work-health-check-in-spring-boot-actuator&quot;&gt;Spring Boot Actuatorμ ν—¬μ¤μ²΄ν¬ μ‚΄ν΄λ³΄κΈ°&lt;/a&gt;λΌλ” κΈ€μ„ λ³΄κ³  μ¤ν”„λ§ </summary>
      
    
    
    
    
    <category term="Spring Boot Actuator" scheme="https://kdevkr.github.io/tags/Spring-Boot-Actuator/"/>
    
    <category term="MailHealthIndicator" scheme="https://kdevkr.github.io/tags/MailHealthIndicator/"/>
    
  </entry>
  
  <entry>
    <title>Redis Stream</title>
    <link href="https://kdevkr.github.io/spring-boot-data-redis-stream/"/>
    <id>https://kdevkr.github.io/spring-boot-data-redis-stream/</id>
    <published>2024-06-22T03:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.423Z</updated>
    
    <content type="html"><![CDATA[<p>μ†κ·λ¨ μ• ν”λ¦¬μΌ€μ΄μ… μ„λ²„μ—μ„ λ λ””μ¤λ¥Ό μ‚¬μ©ν•κ³  μμ„λ• RabbitMQ λλ” Apache Kafkaμ™€ κ°™μ€ λ©”μ‹μ§€ νλ¥Ό ν†µν•΄ λΉ„λ™κΈ° μ΄λ²¤νΈμ— λ€ν• μ”κµ¬κ°€ ν•„μ”ν• κ²½μ° λ³„λ„μ λ©”μ‹μ§€ ν μ†”λ£¨μ…μ„ λ„μ…ν•λ” κ²ƒμ€ μΈν”„λΌ μƒ κ³Όλ„ν•  μλ„ μλ‹¤. μ΄λ¬ν• κ²½μ° λ λ””μ¤μ—μ„ μ κ³µν•λ” μ¤νΈλ¦Όμ„ μ‚¬μ©ν•μ—¬ λ©”μ‹μ§€ κΈ°λ°μ ν”„λ΅κ·Έλλ°μ„ μν–‰ν•  μ μλ”λ° μ¤ν”„λ§ λ¶€νΈ κΈ°λ°μ μ• ν”λ¦¬μΌ€μ΄μ…μΈ κ²½μ° <a href="https://spring.io/projects/spring-data-redis">Spring Data Redis</a>μ— <a href="https://docs.spring.io/spring-data/redis/reference/redis/redis-streams.html">λ λ””μ¤ μ¤νΈλ¦Όμ— λ€ν• κΈ°λ¥</a>μ„ ν¬ν•¨ν•κ³  μμΌλ―€λ΅ μ‰½κ² μ¤νΈλ¦Όμ— λ©”μ‹μ§€λ¥Ό λ“±λ΅ν•κ³  μ»¨μλ¨Έλ¥Ό μ¶”κ°€ν•μ—¬ λ©”μ‹μ§€λ¥Ό μμ‹ ν•λ„λ΅ κµ¬ν„ν•  μ μλ‹¤.</p><h4 id="λ©”μ‹μ§€-μ—†λ”-λΉ-μ¤νΈλ¦Ό-μƒμ„±ν•κΈ°"><a href="#λ©”μ‹μ§€-μ—†λ”-λΉ-μ¤νΈλ¦Ό-μƒμ„±ν•κΈ°" class="headerlink" title="λ©”μ‹μ§€ μ—†λ” λΉ μ¤νΈλ¦Ό μƒμ„±ν•κΈ°"></a>λ©”μ‹μ§€ μ—†λ” λΉ μ¤νΈλ¦Ό μƒμ„±ν•κΈ°</h4><pre class="language-bash" data-language="bash"><code class="language-bash">XGROUP CREATE stream_key group_name $ MKSTREAM</code></pre><p>κΈ°λ³Έμ μΈ λ λ””μ¤ λ…λ Ήμ–΄λ΅λ” μ„μ™€ κ°™μ΄ μ»¨μλ¨Έ κ·Έλ£Ήμ„ μƒμ„±ν•  λ• MKSTREAM μµμ…μ„ μ§€μ •ν•μ—¬ μ¤νΈλ¦Όμ΄ μ΅΄μ¬ν•μ§€ μ•μ€ κ²½μ°μ— μ¤νΈλ¦Όμ΄ μλ™μΌλ΅ μƒμ„±λλ„λ΅ ν•  μ μλ‹¤. Spring Data Redis μ—μ„λ” RedisConnection κ³Ό RedisStreamCommands μΈν„°νμ΄μ¤μ— xGroupCreate λΌλ” ν•¨μλ΅ μ •μλμ–΄ μμΌλ―€λ΅ μ•„λμ™€ κ°™μ΄ κµ¬ν„ν•λ©΄ λλ‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> streamKey <span class="token operator">=</span> <span class="token string">"stream-1"</span><span class="token punctuation">;</span><span class="token class-name">String</span> groupName <span class="token operator">=</span> <span class="token string">"group-1"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span>streamKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    redisTemplate<span class="token punctuation">.</span><span class="token function">opsForStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createGroup</span><span class="token punctuation">(</span>streamKey<span class="token punctuation">,</span> <span class="token class-name">ReadOffset</span><span class="token punctuation">.</span><span class="token function">lastConsumed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> groupName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">RedisConnection</span> connection <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">getConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">RedisStreamCommands</span> streamCommands <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">streamCommands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    streamCommands<span class="token punctuation">.</span><span class="token function">xGroupCreate</span><span class="token punctuation">(</span>streamKey<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> groupName<span class="token punctuation">,</span> <span class="token class-name">ReadOffset</span><span class="token punctuation">.</span><span class="token function">latest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="StreamMessageListenerContainer"><a href="#StreamMessageListenerContainer" class="headerlink" title="StreamMessageListenerContainer"></a>StreamMessageListenerContainer</h4><p>StreamMessageListenerContainer μ™€ StreamListener λ¥Ό ν™μ©ν•λ©΄ RedisTemplate μΌλ΅ μ¤νΈλ¦Όμ„ μ§μ ‘ μ½μ§€ μ•μ•„λ„ λ‹¤μ¤‘ μ¤λ λ“λ¥Ό ν†µν•΄ λ©”μ‹μ§€λ¥Ό μμ‹ ν•μ—¬ μ²λ¦¬ν•  μ μλ‹¤. </p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">StreamMessageListenerContainer</span> messageListenerContainer <span class="token operator">=</span> <span class="token class-name">StreamMessageListenerContainer</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">getConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">StreamMessageListenerContainer<span class="token punctuation">.</span>StreamMessageListenerContainerOptions</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">hashKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">hashValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Consumer</span> consumer <span class="token operator">=</span> <span class="token class-name">Consumer</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>groupName<span class="token punctuation">,</span> consumerName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">StreamOffset</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> streamOffset <span class="token operator">=</span> <span class="token class-name">StreamOffset</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>streamKey<span class="token punctuation">,</span> <span class="token class-name">ReadOffset</span><span class="token punctuation">.</span><span class="token function">lastConsumed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Subscription</span> subscription <span class="token operator">=</span> messageListenerContainer<span class="token punctuation">.</span><span class="token function">receiveAutoAck</span><span class="token punctuation">(</span>consumer<span class="token punctuation">,</span> streamOffset<span class="token punctuation">,</span> record <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>subscription<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>messageListenerContainer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;μ†κ·λ¨ μ• ν”λ¦¬μΌ€μ΄μ… μ„λ²„μ—μ„ λ λ””μ¤λ¥Ό μ‚¬μ©ν•κ³  μμ„λ• RabbitMQ λλ” Apache Kafkaμ™€ κ°™μ€ λ©”μ‹μ§€ νλ¥Ό ν†µν•΄ λΉ„λ™κΈ° μ΄λ²¤νΈμ— λ€ν• μ”κµ¬κ°€ ν•„μ”ν• κ²½μ° λ³„λ„μ λ©”μ‹μ§€ ν μ†”λ£¨μ…μ„ λ„μ…ν•λ” κ²ƒμ€ μΈν”„λΌ μƒ κ³Όλ„ν•  μλ„ μλ‹¤. μ΄λ¬ν• κ²½</summary>
      
    
    
    
    
    <category term="Redis Stream" scheme="https://kdevkr.github.io/tags/Redis-Stream/"/>
    
  </entry>
  
  <entry>
    <title>AWS RDS μ¬λ΅μ° μΏΌλ¦¬ λ΅κ·Έμ μ»¤μ„ μ΄λ¦„ μ΄μ</title>
    <link href="https://kdevkr.github.io/aws-rds-slow-query-with-cursor-name./"/>
    <id>https://kdevkr.github.io/aws-rds-slow-query-with-cursor-name./</id>
    <published>2024-06-20T13:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.419Z</updated>
    
    <content type="html"><![CDATA[<p><img data-src="/images/posts/aws-rds-slow-query-with-cursor-name/01.png"></p><p>μ„ μ¤ν¬λ¦°μƒ·μ 14μ‹μ™€ 15μ‹ μ‚¬μ΄μ— RDS μ DB μΈμ¤ν„΄μ¤μ CPU λ¶€ν•κ°€ 90% μ΄μƒμ„ μ΄κ³Όν–λ‹¤. μ΄λ¬ν• μƒν™©μ κ²½μ° μ–΄λ–¤ νΈμ¤νΈμ—μ„ μν–‰ν• μΏΌλ¦¬κ°€ λ¬Έμ κ°€ λκ³  μλ”μ§€ μ•κΈ° μ„ν•΄μ„ AWS Aurora PostgreSQLμ ν΄λ¬μ¤ν„° λλ” μΈμ¤ν„΄μ¤ νλΌλ―Έν„°λ¥Ό λ³€κ²½ν•μ—¬ <a href="https://docs.aws.amazon.com/ko_kr/AmazonRDS/latest/AuroraUserGuide/USER_LogAccess.Concepts.PostgreSQL.html#USER_LogAccess.Concepts.PostgreSQL.Query_Logging">μΏΌλ¦¬ λ΅κΉ…μ„ ν™μ„±ν™”</a>ν•κ³  <a href="https://docs.aws.amazon.com/ko_kr/prescriptive-guidance/latest/tuning-postgresql-parameters/log-min-duration-statement.html">log_min_duration_statement</a>μ— λ€ν• κ°’μ„ μ§€μ •ν•λ©΄ ν•΄λ‹Ή λ°€λ¦¬μ΄λ¥Ό μ΄κ³Όν•μ—¬ μν–‰ν• μΏΌλ¦¬μ— λ€ν• duration λ΅κ·Έλ¥Ό κΈ°λ΅ν•κ³  CloudWatchμ λ΅κ·Έ μΈμ‚¬μ΄νΈμ—μ„ ν™•μΈν•  μ μλ‹¤.</p><h4 id="FETCH-ALL-IN-rcursor-π¤”"><a href="#FETCH-ALL-IN-rcursor-π¤”" class="headerlink" title="FETCH ALL IN &quot;rcursor&quot; π¤”"></a>FETCH ALL IN &quot;rcursor&quot; π¤”</h4><p><img data-src="/images/posts/aws-rds-slow-query-with-cursor-name/02.png"></p><p>RDS μ½μ†”μ μ„±λ¥ κ°μ„  λ„μ°λ―Έμ—μ„ λ°μ΄ν„°λ² μ΄μ¤ λ΅λ“μ™€ μƒμ„ SQL μ •λ³΄λ¥Ό ν™•μΈν•  μ μλ”λ° μ„μ™€ κ°™μ΄ FETCH ALL IN &quot;rcursor&quot; κ°€ λ€λ¶€λ¶„μ λ΅λ“λ΅ κΈ°λ΅λμ–΄μλ” κ±Έ λ³Ό μ μλ‹¤. μ‹¤μ  SQLλ¥Ό ν™•μΈν•  μ μλ” κ²ƒλ“¤ μ΄μ™Έμ— <code>rcursor</code> λ€ κ²ƒμ€ λ„λ€μ²΄ λ¬΄μ—‡μ„ μλ―Έν•λ” κ²ƒμΈμ§€ μ•μ•„μ•Όν•  κ²ƒ κ°™λ‹¤. PL&#x2F;pgSQL ν•¨μλ¥Ό μ‘μ„±ν•  λ• <a href="https://www.postgresql.org/docs/current/plpgsql-cursors.html">Cursor</a>λ¥Ό μ„ μ–Έν•κ³  μ΅°νν• κ²°κ³Όλ¥Ό λ°ν™ν•  μ μλ‹¤. μΌλ°μ μΌλ΅ μ΄μ•ΌκΈ°ν•λ” ν”„λ΅μ‹μ € ν•¨μλ¥Ό μλ―Έν•λ©° μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ μ‚¬μ©μ¤‘μΈ λ€λ¶€λ¶„μ ν•¨μμ μ»¤μ„ μ΄λ¦„μ„ λ™μΌν•κ² μ§€μ •ν•μ—¬ μ„ μ–Έν–λ‹¤λ” κ²ƒμ„ μλ―Έν•λ‹¤.</p><p>κΈ°λ³Έμ μΌλ΅ μ»¤μ„ μ΄λ¦„μ„ μ§€μ •ν•μ§€ μ•μΌλ©΄ μλ™μΌλ΅ <code>&lt;unnamed cursor 1&gt;</code>μ™€ κ°™μ€ λλ¤ν• μ»¤μ„κ°€ λ§λ“¤μ–΄μ§€κ³  JDBC μ—μ„ SQL ν•¨μλ¥Ό νΈμ¶ν• κ²°κ³Όμ—μ„ μ»¤μ„ μ΄λ¦„μ„ κµ³μ΄ λ™μΌν•κ² μ§€μ •ν•  ν•„μ”λ” μ—†λ‹¤. λ”°λΌμ„, μ• ν”λ¦¬μΌ€μ΄μ…μ€ ν•¨μ μ •μ μ‹ μ–΄λ–¤ μ΄λ¦„μ μ»¤μ„λ¥Ό μ‚¬μ©ν•λ”μ§€μ— λ€ν•΄μ„λ” μƒκ΄€ν•μ§€ μ•μΌλ©° SQL ν•¨μλ¥Ό κ΄€λ¦¬ν•λ” κ°λ°μ νΉμ€ DBAκ°€ κ΄€λ¦¬ν•κΈ° μ„ν• μ΄λ¦„μΌ λΏμ΄λ‹¤. κ·Έλμ„ μ‰½κ² κ΄€λ¦¬ν•μ—¬ μ‚¬μ©ν•κΈ° μ„ν•΄ ν†µμΌν–λ κ²ƒμΌλ΅ μƒκ°λλ‹¤.</p><h4 id="RDS-λ¨λ‹ν„°λ§μ„-μ„ν•-μ»¤μ„-μ΄λ¦„μ„-μ‚¬μ©ν•μ„Έμ”"><a href="#RDS-λ¨λ‹ν„°λ§μ„-μ„ν•-μ»¤μ„-μ΄λ¦„μ„-μ‚¬μ©ν•μ„Έμ”" class="headerlink" title="RDS λ¨λ‹ν„°λ§μ„ μ„ν• μ»¤μ„ μ΄λ¦„μ„ μ‚¬μ©ν•μ„Έμ”."></a>RDS λ¨λ‹ν„°λ§μ„ μ„ν• μ»¤μ„ μ΄λ¦„μ„ μ‚¬μ©ν•μ„Έμ”.</h4><p><img data-src="/images/posts/aws-rds-slow-query-with-cursor-name/03.png"></p><p>RDS λ¨λ‹ν„°λ§ λ° μ¬λ΅μ° μΏΌλ¦¬λ¥Ό ν™•μΈν•  μ μλ„λ΅ λ™μΌν• μ»¤μ„ μ΄λ¦„μ΄ μ•„λ‹ SQL ν•¨μλ³„ λ³„λ„μ μ»¤μ„ μ΄λ¦„μ„ μ •μν•μ—¬ κµ¬λ¶„ν•λ”κ² ν•„μ”ν•λ‹¤. SQL ν•¨μ μ‘μ„± μ‹ μ»¤μ„ μ΄λ¦„μ€ ν•¨μ μ΄λ¦„κ³Ό λ™μΌν•κ² ν•μ—¬ λ…ν™•ν κµ¬λ¶„ν•κΈ°λ΅ ν‘μν–κ³  μ„μ™€ κ°™μ΄ μ¤λ μν–‰λλ” μ¬λ΅μ° μΏΌλ¦¬λ¥Ό μ‰½κ² ν™•μΈν•  μ μλ‹¤. κΈ°μ΅΄μ—λ” κ°λ°μκ°€ μ¬λ΅μ° μΏΌλ¦¬λ¥Ό ν™•μΈν•  μ μλ„λ΅ μ• ν”λ¦¬μΌ€μ΄μ… μ„λ²„μ— λ΅κ·Έκ°€ μ¶λ ¥λλ„λ΅ ν–μ§€λ§ μ΄μ λ” κ°λ°μ λΏλ§ μ•„λ‹λΌ DB νΉμ€ μΈν”„λΌ μ—”μ§€λ‹μ–΄λ„ RDS λ¨λ‹ν„°λ§μΌλ΅ μ¬λ΅μ° μΏΌλ¦¬ κµ¬λ¶„μ΄ κ°€λ¥ν•λ„λ΅ λ³€κ²½ν•κ³  μλ‹¤.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># μ—¬λ¬λ¶„μ€ μ–΄λ–¤ μΏΌλ¦¬κ°€ 2μ΄λ‚ μ†μ”λ¬λ”μ§€ νμ•…ν•  μ μλ‚μ”?</span>LOG:  duration: <span class="token number">2217.321</span> ms  execute <span class="token operator">&lt;</span>unnamed<span class="token operator">></span>: FETCH ALL IN <span class="token string">"rcursor"</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img data-src=&quot;/images/posts/aws-rds-slow-query-with-cursor-name/01.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;μ„ μ¤ν¬λ¦°μƒ·μ 14μ‹μ™€ 15μ‹ μ‚¬μ΄μ— RDS μ DB μΈμ¤ν„΄μ¤μ CPU λ¶€ν•κ°€ 90% μ΄μƒμ„ μ΄κ³Όν–λ‹¤</summary>
      
    
    
    
    
    <category term="AWS RDS" scheme="https://kdevkr.github.io/tags/AWS-RDS/"/>
    
    <category term="PostgreSQL" scheme="https://kdevkr.github.io/tags/PostgreSQL/"/>
    
    <category term="Cursor" scheme="https://kdevkr.github.io/tags/Cursor/"/>
    
  </entry>
  
  <entry>
    <title>μλ°” λ©”μΌ λ°μ†΅ μ‹ μ¥μ•  μ²λ¦¬</title>
    <link href="https://kdevkr.github.io/java-mail-sender-limits/"/>
    <id>https://kdevkr.github.io/java-mail-sender-limits/</id>
    <published>2024-06-16T11:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.419Z</updated>
    
    <content type="html"><![CDATA[<p>μ¤ν”„λ§ ν”„λ μ„μ›ν¬ κΈ°λ°μ μ• ν”λ¦¬μΌ€μ΄μ… μ„λ²„μ—μ„λ” <code>JavaMailSenderImpl</code>μ„ μ‚¬μ©ν•μ—¬ μ‰½κ² <a href="https://docs.spring.io/spring-framework/reference/integration/email.html">μ΄λ©”μΌ</a>μ„ λ³΄λ‚΄λ” κΈ°λ¥μ„ κµ¬ν„ν•  μ μλ‹¤. κ·Έλ¬λ‚, μ΄λ©”μΌ λ°μ†΅μ— λ€ν• μΈν„°νμ΄μ¤μ™€ κµ¬ν„μ„ μ κ³µν•λ―€λ΅ λ©”μΌ λ°μ†΅ μ‹¤ν¨μ— λ”°λ¥Έ μ¥μ•  μ²λ¦¬μ— λ€ν•΄μ„λ” λ³„λ„λ΅ κ³ λ ¤ν•΄μ•Όν•  ν•„μ”κ°€ μλ‹¤. μλ¥Ό λ“¤μ–΄, λ‹¤μμ μ¤λ λ“λ΅ μ΄λ©”μΌ λ€κΈ°μ—΄ νλ¥Ό λΉ λ¥΄κ² μ†μ§„ν•λ‹¤λ©΄ <a href="https://docs.aws.amazon.com/ko_kr/ses/latest/dg/manage-sending-quotas-errors.html">Amazon SES κ³„μ •μ λ°μ‹  ν• λ‹Ήλ‰κ³Ό κ΄€λ ¨λ μ¤λ¥</a> μ¤‘ μ΄λ‹Ή μ΄λ©”μΌ μμ— λ€ν• μ ν•λ‰μ„ λ„μ–΄μ„λ” κ²½μ° 454 Throttling failure: Maximum sending rate exceeded μ¤λ¥κ°€ λ°μƒν•λ‹¤.</p><h4 id="ThreadPoolExecutorλ¥Ό-ν†µν•-λ©”μΌ-λ€κΈ°μ—΄-ν-λ³‘λ ¬-μ²λ¦¬"><a href="#ThreadPoolExecutorλ¥Ό-ν†µν•-λ©”μΌ-λ€κΈ°μ—΄-ν-λ³‘λ ¬-μ²λ¦¬" class="headerlink" title="ThreadPoolExecutorλ¥Ό ν†µν• λ©”μΌ λ€κΈ°μ—΄ ν λ³‘λ ¬ μ²λ¦¬"></a>ThreadPoolExecutorλ¥Ό ν†µν• λ©”μΌ λ€κΈ°μ—΄ ν λ³‘λ ¬ μ²λ¦¬</h4><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MimeMessage</span><span class="token punctuation">></span></span> waitingQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">MimeMessage</span> message <span class="token operator">=</span> waitingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            javaMailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Mail-Thread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>μ„ μ½”λ“λ” κ°„λ‹¨ν•κ² λ©”μΌ λ€κΈ°μ—΄ νλ¥Ό μμ°¨μ μΌλ΅ μ†μ§„ν•λ” λ‹¨μΌ μ¤λ λ“λ΅ μ΄λ©”μΌμ„ λ°μ†΅ν•λ” μ½”λ“λ΅ λ€κΈ°μ—΄ νμ— μ“μ΄λ” λ©”μΌμ μκ°€ λ§μ•„μ§„λ‹¤λ©΄ ThreadPoolExecutorλ¥Ό μ‚¬μ©ν•μ—¬ λ©”μΌ λ°μ†΅μ— λ€ν• μ²λ¦¬λ¥Ό λ³‘λ ¬λ΅ μν–‰ν•  μ μλ‹¤. λ©”μΌ λ°μ†΅ μ²λ¦¬λ¥Ό λ³‘λ ¬λ΅ μν–‰ν•λ‹¤λ©΄ SMTP μ„λ²„μ λ°μ‹  ν•λ„μ— λ€ν•΄μ„ κ³ λ ¤ν•΄μ•Όν•λ‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> coreSize <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">ThreadFactory</span> threadFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setNameFormat</span><span class="token punctuation">(</span><span class="token string">"Mail-Thread-%d"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">ThreadPoolExecutor</span> executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>coreSize<span class="token punctuation">,</span> coreSize<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> threadFactory<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MimeMessage</span><span class="token punctuation">></span></span> waitingQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>waitingQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">MimeMessage</span> message <span class="token operator">=</span> waitingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                javaMailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Mail-Thread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="Spring-Retryλ¥Ό-ν†µν•-λ©”μΌ-λ°μ†΅-μ‹¤ν¨-μ‹-μ¬μ‹λ„-μ „λµ-Guide-to-Spring-Retry"><a href="#Spring-Retryλ¥Ό-ν†µν•-λ©”μΌ-λ°μ†΅-μ‹¤ν¨-μ‹-μ¬μ‹λ„-μ „λµ-Guide-to-Spring-Retry" class="headerlink" title="Spring Retryλ¥Ό ν†µν• λ©”μΌ λ°μ†΅ μ‹¤ν¨ μ‹ μ¬μ‹λ„ μ „λµ - Guide to Spring Retry"></a>Spring Retryλ¥Ό ν†µν• λ©”μΌ λ°μ†΅ μ‹¤ν¨ μ‹ μ¬μ‹λ„ μ „λµ - <a href="https://www.baeldung.com/spring-retry">Guide to Spring Retry</a></h4><p>μ΄λ©”μΌ λ°μ†΅ μ‹¤ν¨ κ±΄μ— λ€ν•΄μ„ Spring Retryλ¥Ό ν†µν•΄ μ¬μ‹λ„ λ΅μ§μ„ μ‰½κ² κµ¬ν„ν•  μ μλ‹¤. λ©”μΌ λ°μ†΅μ„ μ„ν• RetryTemplate κµ¬μ„± μ‹ μ¬μ‹λ„ μ „λµμ„ κµ¬μ„±ν•κ³  λ©”μΌμ„ λ°μ†΅ν•λ” ν•¨μλ¥Ό RetryTemplateλ΅ κ°μ‹Έλ©΄ λλ‹¤. context.getRetryCount() ν•¨μλ¥Ό ν†µν•΄ μ¬μ‹λ„ νμλ¥Ό κ°€μ Έμ¬ μ μλ‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">RetryTemplate</span> retryTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RetryTemplateBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">maxAttempts</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">exponentialBackoff</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10L</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">retryOn</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">MessagingException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">MailException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MimeMessage</span><span class="token punctuation">></span></span> waitingQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>waitingQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        retryTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>context <span class="token operator">-></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">MimeMessage</span> message <span class="token operator">=</span> waitingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                javaMailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Mail-Thread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="Guava-RateLimiterλ¥Ό-ν†µν•-μ΄λ‹Ή-μ΄λ©”μΌ-λ°μ†΅-μ‹λ„-μ ν•-Quick-Guide-to-the-Guava-RateLimiter"><a href="#Guava-RateLimiterλ¥Ό-ν†µν•-μ΄λ‹Ή-μ΄λ©”μΌ-λ°μ†΅-μ‹λ„-μ ν•-Quick-Guide-to-the-Guava-RateLimiter" class="headerlink" title="Guava RateLimiterλ¥Ό ν†µν• μ΄λ‹Ή μ΄λ©”μΌ λ°μ†΅ μ‹λ„ μ ν• - Quick Guide to the Guava RateLimiter"></a>Guava RateLimiterλ¥Ό ν†µν• μ΄λ‹Ή μ΄λ©”μΌ λ°μ†΅ μ‹λ„ μ ν• - <a href="https://www.baeldung.com/guava-rate-limiter">Quick Guide to the Guava RateLimiter</a></h4><p>AWS SESμ λ°μ‹  ν•λ„ μ¤‘μ—λ” μ΄λ‹Ή λ³΄λ‚Ό μ μλ” μ΄λ©”μΌ μμ— λ€ν• μ ν•λ‰μ΄ μμΌλ―€λ΅ Guava RateLimiterλ¥Ό ν†µν•΄ μ΄λ‹Ή μ΄λ©”μΌ λ°μ†΅ μλ¥Ό λ„μ–΄μ„μ§€ μ•λ„λ΅ λ°©μ–΄ν•λ” μ½”λ“λ¥Ό μ‘μ„±ν•  μ μλ‹¤. λ¬Όλ΅ , SMTP μ„λ²„λ¥Ό λ‹¤μμ μ• ν”λ¦¬μΌ€μ΄μ… μ„λ²„μ—μ„λ„ μ—°κ²°ν•  κ°€λ¥μ„±μ΄ μμΌλ―€λ΅ λ°μ‹  ν• λ‹Ήλ‰μ— λ€ν• λ¨λ‹ν„°λ§ λ° λ°μ‹  ν•λ„λ¥Ό λ³„λ„λ΅ κ΄€λ¦¬ν•  ν•„μ”λ” μλ‹¤.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">RateLimiter</span> rateLimiter <span class="token operator">=</span> <span class="token class-name">RateLimiter</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>waitingQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">boolean</span> acquire <span class="token operator">=</span> rateLimiter<span class="token punctuation">.</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>acquire<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">MimeMessage</span> message <span class="token operator">=</span> waitingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    javaMailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Mail-Thread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>Guava RateLimiterλ” μ΄λ‹Ή νΈμ¶μ— λ€ν• μ ν•λ§ κ°€λ¥ν•λ―€λ΅ λ¶„λ‹Ή μ΄λ©”μΌ λ°μ†΅μ„ μ ν•ν•κ³  μ‹¶λ‹¤λ©΄ Resilience4jμ RateLimiterλ¥Ό λ„μ…ν•΄μ•Όν•©λ‹λ‹¤.</p></blockquote><h4 id="Resilience4j-CircuitBreakerλ¥Ό-ν†µν•-λ©”μΌ-λ°μ†΅-μ¤‘λ‹¨-Guide-to-Resilience4j"><a href="#Resilience4j-CircuitBreakerλ¥Ό-ν†µν•-λ©”μΌ-λ°μ†΅-μ¤‘λ‹¨-Guide-to-Resilience4j" class="headerlink" title="Resilience4j CircuitBreakerλ¥Ό ν†µν• λ©”μΌ λ°μ†΅ μ¤‘λ‹¨ - Guide to Resilience4j"></a>Resilience4j CircuitBreakerλ¥Ό ν†µν• λ©”μΌ λ°μ†΅ μ¤‘λ‹¨ - <a href="https://www.baeldung.com/resilience4j">Guide to Resilience4j</a></h4><p>SMTP μ„λ²„μ λ°μ‹  ν•λ„ μ ν•μ„ λ„μ–΄μ„λ” κ²½μ°μ— λ€ν• μ¥μ•  μ²λ¦¬λ¥Ό μ„ν•΄ <a href="https://github.com/resilience4j/resilience4j">Resilience4j</a>λ¥Ό λ„μ…ν•  μ μλ‹¤. ν•λ£¨λ™μ• λ©”μΌμ„ λ³΄λ‚Ό μ μλ” ν• λ‹Ήλ‰μ„ μ΄κ³Όν•κ±°λ‚ μ΄λ‹Ή λ³΄λ‚Ό μ μλ” μ΄λ©”μΌ μμ— μ ν•μ΄ λμ—λ‹¤λ©΄ μΌμ • μ‹κ°„λ™μ• μ΄λ©”μΌ λ°μ†΅μ„ μ‹λ„ν•μ§€ μ•λ„λ΅ <code>CircuitBreaker</code>λ¥Ό μ‚¬μ©ν•μ—¬ μ¥μ•  μ „ν λ°©μ§€λ¥Ό κµ¬ν„ν•  μ μλ‹¤. AWS SESμ λ°μ‹  ν•λ„μΈ μ•„λμ λ‘κ° ν•­λ©μ— λ€ν•΄μ„ μ²λ¦¬λ¥Ό κ³ λ ¤ν•λ„λ΅ ν•μ.</p><ul><li>454 Throttling failure: Maximum sending rate exceeded (1μ΄λ‹Ή μ΄λ©”μΌ λ°μ†΅ μ μ ν•λ‰)</li><li>454 Throttling failure: Daily message quota exceeded (24μ‹κ°„ λ‹Ή μ΄λ©”μΌ λ°μ†΅ ν• λ‹Ήλ‰)</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">CircuitBreaker</span> circuitBreaker <span class="token operator">=</span> <span class="token class-name">CircuitBreaker</span><span class="token punctuation">.</span><span class="token function">ofDefaults</span><span class="token punctuation">(</span><span class="token string">"MailSendingLimitExceeded"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">RateLimiter</span> rateLimiter <span class="token operator">=</span> <span class="token class-name">RateLimiter</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>waitingQueue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">boolean</span> permission <span class="token operator">=</span> circuitBreaker<span class="token punctuation">.</span><span class="token function">tryAcquirePermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        permission <span class="token operator">&amp;=</span> rateLimiter<span class="token punctuation">.</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>permission<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">MimeMessage</span> message <span class="token operator">=</span> waitingQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    javaMailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">String</span> failReason <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>failReason <span class="token operator">!=</span> <span class="token keyword">null</span>                            <span class="token operator">&amp;&amp;</span> failReason<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"454 Throttling failure"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        circuitBreaker<span class="token punctuation">.</span><span class="token function">transitionToClosedState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>failReason<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Mail-Thread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="JavaMailSenderImplμ€-λ§¤λ²-μ—°κ²°ν•λ‹¤"><a href="#JavaMailSenderImplμ€-λ§¤λ²-μ—°κ²°ν•λ‹¤" class="headerlink" title="JavaMailSenderImplμ€ λ§¤λ² μ—°κ²°ν•λ‹¤?!"></a>JavaMailSenderImplμ€ λ§¤λ² μ—°κ²°ν•λ‹¤?!</h4><p>μΌλ¶€ μ‹μ¤ν… ν™κ²½μ—μ„ AWS SESμ SMTP μ„λ²„λ¥Ό λ™μΌν• λ¦¬μ „μ΄ μ•„λ‹ μƒλ‹Ήν λ©€λ¦¬ λ–¨μ–΄μ Έμλ” λ¦¬μ „μ— κµ¬μ„±λ SMTPλ¥Ό ν†µν•΄ λ©”μΌ λ°μ†΅μ„ μ‹λ„ν•λ” κ²½μ° μ»¤λ„¥μ…μ— λ€ν• μ†μ” μ‹κ°„μ΄ ν¬λ‹¤λ” κ²ƒμ„ μ• μ μμ—λ‹¤. μλ¥Ό λ“¤μ–΄, US East (Ohio) λ¦¬μ „μ SMTP μ—”λ“ν¬μΈνΈλ¥Ό Asia Pacific (Seoul) λ¦¬μ „μ—μ„ μ—°κ²°ν•λ” κ²½μ° μ•½ 2μ΄ μ •λ„μ μ‹κ°„μ΄ μ†μ”λλ”λ° λ™μΌν• λ¦¬μ „μ—μ„ μ—°κ²°ν•λ©΄ μ•½ 100ms κ°€ κ±Έλ¦°λ‹¤. </p><p>JavaMailSenderImplμ connectTransport ν•¨μλ¥Ό μ‚¬μ©ν•μ—¬ testConnection λλ” doSend ν•¨μμ—μ„ μ—°κ²°μ„ μν–‰ν•λ” κ²ƒμ„ ν™•μΈν•  μ μλ”λ° MimeMessage λ©λ΅μ„ send ν•¨μ νλΌλ―Έν„°λ΅ μ „λ‹¬ν•  λ• μ—°κ²°μ„ μν–‰ν•κ³  ν•΄μ ν•λ―€λ΅ μ΄λ©”μΌμ„ ν•λ‚μ”© λ³΄λ‚΄λ„λ΅ κµ¬ν„ν–λ‹¤λ©΄ μ΄λ©”μΌμ„ λ³΄λ‚Όλ•λ§λ‹¤ μ—°κ²°μ„ μν–‰ν•λ” κ²ƒμ΄λ‹¤.</p><pre class="language-java" data-language="java"><div class="caption"><span>JavaMailSenderImpl</span></div><code class="language-java"><span class="token keyword">protected</span> <span class="token class-name">Transport</span> <span class="token function">connectTransport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MessagingException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        username <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            password <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Transport</span> transport <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTransport</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    transport<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> transport<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><a href="https://www.simplejavamail.org/configuration.html#section-reusing-connections">SimpleJavaMailμ Batch Module</a>μ€ Transport μ—°κ²°μ— λ€ν• μ»¤λ„¥μ… ν’€μ„ μ‚¬μ©ν•λ‹¤κ³  λμ–΄μμΌλ―€λ΅ SMTP μ„λ²„λ΅μ μ—°κ²° μν–‰μ‹κ°„μ΄ μ¤λκ±Έλ¦°λ‹¤λ©΄ Transport μ— λ€ν• μ»¤λ„¥μ… ν’€μ„ μ΄μ©ν•΄λ³΄λ” κ²ƒλ„ μΆ‹μ€ λ°©λ²•μΌλ΅ μƒκ°λλ‹¤.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;μ¤ν”„λ§ ν”„λ μ„μ›ν¬ κΈ°λ°μ μ• ν”λ¦¬μΌ€μ΄μ… μ„λ²„μ—μ„λ” &lt;code&gt;JavaMailSenderImpl&lt;/code&gt;μ„ μ‚¬μ©ν•μ—¬ μ‰½κ² &lt;a href=&quot;https://docs.spring.io/spring-framework/reference/integratio</summary>
      
    
    
    
    
    <category term="JavaMailSenderImpl" scheme="https://kdevkr.github.io/tags/JavaMailSenderImpl/"/>
    
    <category term="Simple Email Service" scheme="https://kdevkr.github.io/tags/Simple-Email-Service/"/>
    
    <category term="Sending Limits" scheme="https://kdevkr.github.io/tags/Sending-Limits/"/>
    
  </entry>
  
  <entry>
    <title>AWS NLB ECDSA TLS μ¤ν”„λ΅λ“</title>
    <link href="https://kdevkr.github.io/aws-nlb-tls-ecdsa/"/>
    <id>https://kdevkr.github.io/aws-nlb-tls-ecdsa/</id>
    <published>2024-05-25T14:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.419Z</updated>
    
    <content type="html"><![CDATA[<h4 id="AWS-μΈμ¦μ„-κ΄€λ ¨-νμ¤ν† λ¦¬"><a href="#AWS-μΈμ¦μ„-κ΄€λ ¨-νμ¤ν† λ¦¬" class="headerlink" title="AWS μΈμ¦μ„ κ΄€λ ¨ νμ¤ν† λ¦¬"></a>AWS μΈμ¦μ„ κ΄€λ ¨ νμ¤ν† λ¦¬</h4><ul><li><a href="https://aws.amazon.com/ko/about-aws/whats-new/2021/07/aws-certificate-manager-provides-expanded-usage-imported-ecdsa-rsa-certificates/">AWS Certificate Manager, κ°€μ Έμ¨ ECDSA λ° RSA μΈμ¦μ„μ ν™•μ¥λ μ‚¬μ© μ κ³µ</a></li><li><a href="https://aws.amazon.com/ko/about-aws/whats-new/2022/11/aws-certificate-manager-elliptic-curve-digital-signature-algorithm-tls-certificates/">AWS Certificate Manager, μ΄μ  Elliptic Curve Digital Signature Algorithm TLS μΈμ¦μ„ μ§€μ›</a></li><li><a href="https://aws.amazon.com/ko/about-aws/whats-new/2024/01/network-load-balancer-rsa-3072-bit-ecdsa-256-384-521-bit-certificates/">Network Load Balancer, μ΄μ  AWS Certificate Managerλ¥Ό ν†µν• RSA 3072-λΉ„νΈ, ECDSA 256&#x2F;384&#x2F;521-λΉ„νΈ μΈμ¦μ„ μ§€μ›</a></li></ul><p>μ„ κΈ°λ΅μ²λΌ 2021λ…„ 7μ›” λ¶€ν„° AWS Certificate Managerμ—μ„ μ™Έλ¶€μ—μ„ λ°κΈ‰λ ECDSA μΈμ¦μ„λ¥Ό κ°€μ Έμ™€μ„ λ“±λ΅ν•  μ μκ² μ§€μ›ν•μ€κ³  2022λ…„ 11μ›” λ¶€ν„°λ” ACM μμ²΄μ μΌλ΅ ECDSA μΈμ¦μ„ λ°κΈ‰μ„ μ§€μ›ν•λ‹¤. κ·Έλ¦¬κ³  μ‹κ°„μ΄ νλ¬ 2024λ…„ 1μ›”λ¶€ν„°λ” <a href="https://aws.amazon.com/ko/about-aws/whats-new/2024/01/network-load-balancer-rsa-3072-bit-ecdsa-256-384-521-bit-certificates/">Network Load Balancer μ—μ„λ„ ECDSA μΈμ¦μ„ λ“±λ΅μ„ μ§€μ›</a>ν•λ‹¤.</p><p><img data-src="/images/posts/aws-nlb-tls-ecdsa/01.png"></p><blockquote><p>μ„ ν™”λ©΄μ€ ACM μ™Έλ¶€μ—μ„ λ°κΈ‰λ ECDSA μΈμ¦μ„λ¥Ό κ°€μ Έμ¨ μμ‹λ¥Ό λ³΄μ—¬μ¤λ‹λ‹¤.</p></blockquote><h4 id="Network-Load-Balancer-TLS-λ¦¬μ¤λ„-κµ¬μ„±"><a href="#Network-Load-Balancer-TLS-λ¦¬μ¤λ„-κµ¬μ„±" class="headerlink" title="Network Load Balancer TLS λ¦¬μ¤λ„ κµ¬μ„±"></a>Network Load Balancer TLS λ¦¬μ¤λ„ κµ¬μ„±</h4><p>κ·Έλ™μ• ELB μ—μ„ ECDSA μΈμ¦μ„λ΅ TLS μ¤ν”„λ΅λ“λ¥Ό μ²λ¦¬ν•κΈ° μ„ν•΄μ„λ” μ¤μ§ ALB(Application Load Balancer)λ¥Ό κµ¬μ„±ν•΄μ•Όν–λ‹¤. μ΄μ λ” <code>NLB(Network Load Balancer)</code>λ΅ κµ¬μ„±ν•κ³  <a href="https://docs.aws.amazon.com/ko_kr/elasticloadbalancing/latest/network/create-tls-listener.html">TLS λ¦¬μ¤λ„</a>μ—μ„ ACMμ— μ¶”κ°€λμ–΄μλ” <code>ECDSA μΈμ¦μ„</code>λ¥Ό μ„ νƒν•μ—¬ κµ¬μ„±ν•  μ μλ‹¤.</p><p><img data-src="/images/posts/aws-nlb-tls-ecdsa/02.png"></p><blockquote><p>ν•μ§€λ§, NLBκ°€ TLS λ¦¬μ¤λ„λ¥Ό μ‚¬μ©ν•λ” κ²½μ° mTLSλ” μ§€μ›ν•μ§€ λ»ν•λ” κµ¬μ„±μ΄ λλ” κ²ƒμ€ μΌλ¶€ μ‹μ¤ν…μ—μ„ μ¤‘μ”ν• λ¶€λ¶„μΌ μ μμµλ‹λ‹¤.</p></blockquote><h4 id="λ€μƒ-κ·Έλ£Ή-ν”„λ΅μ‹-ν”„λ΅ν† μ½-v2"><a href="#λ€μƒ-κ·Έλ£Ή-ν”„λ΅μ‹-ν”„λ΅ν† μ½-v2" class="headerlink" title="λ€μƒ κ·Έλ£Ή - ν”„λ΅μ‹ ν”„λ΅ν† μ½ v2"></a>λ€μƒ κ·Έλ£Ή - ν”„λ΅μ‹ ν”„λ΅ν† μ½ v2</h4><p>NLB λ” ALBμ™€λ” λ‹¤λ¥΄κ² L4 λ λ²¨λ΅ λ™μ‘ν•λ―€λ΅ HTTP νΈλν”½μ„ HTTPSλ΅ λ¦¬λ‹¤μ΄λ ‰νΈν•λ” κ²ƒμ„ μ§€μ›ν•μ§€ λ»ν•λ‹¤. ChatGPTμ—κ² λ¬Όμ–΄λ³΄λ”λΌλ„ TCP λ¦¬μ¤λ„λ΅ κµ¬μ„±ν•κ³  Nginxμ™€ κ°™μ€ λ³„λ„μ λ΅λ“λ°Έλ°μ„μ—μ„ TLS μ¤ν”„λ΅λ“λ¥Ό μ²λ¦¬ν•¨κ³Ό λ™μ‹μ— <code>Forward http to https</code> λ¥Ό μ μ©ν•λ” μμ‹λ¥Ό μ„¤λ…ν•λ‹¤.</p><p>μ‚¬λ‚΄ μ—”μ§€λ‹μ–΄μ™€ μ‚½μ§μ„ ν•΄λ³Έκ²°κ³Ό λ΅λ“ λ°Έλ°μ„μ— μ—°κ²°λλ” λ€μƒ κ·Έλ£Ήμ—μ„ <code>ν”„λ΅μ‹ ν”„λ΅ν† μ½ v2</code>λ¥Ό ν™μ„±ν™”ν•λ©΄ Elastic Beanstalkμ Nginx ν”λ«νΌμ—μ„ <a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/using-proxy-protocol/">PROXY Protocol</a>μ„ ν†µν•΄ <code>$proxy_protocol_server_port</code> μ†μ„±μ„ μ‚¬μ©ν•  μ μμμ„ ν™•μΈν–λ‹¤. λ” λ‚μ•„κ°€μ„λ” <code>$proxy_protocol_addr</code> μ†μ„±μΌλ΅ μ‹¤μ λ΅ νΈλν”½μ„ μ „λ‹¬ν• <code>ν΄λΌμ΄μ–ΈνΈ IP</code>λ¥Ό μ•΅μ„Έμ¤ λ΅κ·Έμ— μ¶λ ¥ν•κ±°λ‚ <code>X-Forwarded-For</code> ν—¤λ”λ΅ μ• ν”λ¦¬μΌ€μ΄μ…κΉμ§€ μ „λ‹¬ν•  μ μμ–΄λ³΄μΈλ‹¤.</p><p><img data-src="/images/posts/aws-nlb-tls-ecdsa/03.png"></p><pre class="language-conf" data-language="conf"><code class="language-conf">http &#123;    server &#123;        listen 80 proxy_protocol;        if ($proxy_protocol_server_port &#x3D; 80) &#123;            return 301 https:&#x2F;&#x2F;$host$request_uri;        &#125;    &#125;&#125;</code></pre><blockquote><p>NLB μ—μ„ Nginxλ΅ μ „λ‹¬ν•  λ• μ‚¬μ©ν• ν¬νΈκ°€ 80 μ΄λΌλ©΄ HTTP μ”μ²­μΌλ΅ κ°„μ£Όν•κ³  HTTPS μ”μ²­μΌλ΅ μ „λ‹¬λ  μ μλ„λ΅ 301 μ‘λ‹µμ„ μ²λ¦¬ν–μµλ‹λ‹¤.</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;AWS-μΈμ¦μ„-κ΄€λ ¨-νμ¤ν† λ¦¬&quot;&gt;&lt;a href=&quot;#AWS-μΈμ¦μ„-κ΄€λ ¨-νμ¤ν† λ¦¬&quot; class=&quot;headerlink&quot; title=&quot;AWS μΈμ¦μ„ κ΄€λ ¨ νμ¤ν† λ¦¬&quot;&gt;&lt;/a&gt;AWS μΈμ¦μ„ κ΄€λ ¨ νμ¤ν† λ¦¬&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;htt</summary>
      
    
    
    
    
    <category term="AWS NLB" scheme="https://kdevkr.github.io/tags/AWS-NLB/"/>
    
    <category term="ECDSA" scheme="https://kdevkr.github.io/tags/ECDSA/"/>
    
  </entry>
  
  <entry>
    <title>μ  ν‚¨μ¤ λ„μ»¤ λ©€ν‹° ν”λ«νΌ λΉλ“</title>
    <link href="https://kdevkr.github.io/jenkins-docker-buildx/"/>
    <id>https://kdevkr.github.io/jenkins-docker-buildx/</id>
    <published>2024-05-24T11:00:00.000Z</published>
    <updated>2024-08-18T03:32:21.419Z</updated>
    
    <content type="html"><![CDATA[<p>μ  ν‚¨μ¤μ—μ„ Docker Plugin μ„ μ‚¬μ©ν•΄μ„ Dockerfileμ„ ν†µν•΄ μ‰½κ² λ„μ»¤ μ΄λ―Έμ§€λ¥Ό λΉλ“ν•  μ μλ‹¤. μ•„λ§μ΅΄ μ›Ή μ„λΉ„μ¤μ™€ κ°™μ€ ν΄λΌμ°λ“ μ„λΉ„μ¤μ—μ„λ” x86_64(AMD64) μ•„ν‚¤ν…μ² λΏλ§ μ•„λ‹λΌ ARM64 μ•„ν‚¤ν…μ² κΈ°λ°μ λ” μ €λ ΄ν•κ³  μ„±λ¥μ΄ μΆ‹μ€ μ„λ²„λ¥Ό ν™μ©ν•  μ μλ‹¤. κΈ°λ³Έμ μΈ λ„μ»¤ μ΄λ―Έμ§€ λΉλ“ λ…λ Ήμ–΄λ” λΉλ“λ¥Ό μ‹λ„ν•λ” μ„λ²„μ™€ λ™μΌν• μ•„ν‚¤ν…μ²μ— λ€ν• μ΄λ―Έμ§€λ§ λ§λ“¤ μ μμΌλ―€λ΅ <a href="https://docs.docker.com/build/building/multi-platform/">λ©€ν‹° ν”λ«νΌ μ΄λ―Έμ§€</a>λ¥Ό λ§λ“¤κΈ° μ„ν•΄μ„λ” <a href="https://docs.docker.com/reference/cli/docker/buildx/">Buildkit</a>μ„ μ΄μ©ν•΄μ•Όν•λ‹¤.</p><h4 id="Jenkins-μ‚¬μ©μ-λ„μ»¤-κ·Έλ£Ήμ—-μ¶”κ°€"><a href="#Jenkins-μ‚¬μ©μ-λ„μ»¤-κ·Έλ£Ήμ—-μ¶”κ°€" class="headerlink" title="Jenkins μ‚¬μ©μ λ„μ»¤ κ·Έλ£Ήμ— μ¶”κ°€"></a>Jenkins μ‚¬μ©μ λ„μ»¤ κ·Έλ£Ήμ— μ¶”κ°€</h4><p>μ  ν‚¨μ¤κ°€ μ„¤μΉλ μ„λ²„μ— μ‹¤ν–‰λμ–΄μλ” λ„μ»¤ μ—”μ§„μΌλ΅ λΉλ“ν•  μ μλ„λ΅ λ„μ»¤ κ·Έλ£Ήμ— μ  ν‚¨μ¤ μ‚¬μ©μλ¥Ό ν¬ν•¨μ‹μΌμ•Όν•λ‹¤. μ  ν‚¨μ¤ μ‚¬μ©μλ¥Ό λ„μ»¤ κ·Έλ£Ήμ— μ¶”κ°€ν•κ³ λ‚μ„λ” λ„μ»¤μ™€ μ  ν‚¨μ¤ λ¨λ‘ μ¬μ‹¤ν–‰μ„ μν–‰ν•μ—¬μ•Ό ν•λ‹¤.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">usermod</span> <span class="token parameter variable">-aG</span> <span class="token function">docker</span> jenkins<span class="token function">sudo</span> systemctl restart jenkins<span class="token function">sudo</span> systemctl restart <span class="token function">docker</span></code></pre><h4 id="QEMU-μ„¤μΉ"><a href="#QEMU-μ„¤μΉ" class="headerlink" title="QEMU μ„¤μΉ"></a>QEMU μ„¤μΉ</h4><p>μλ„μ°μ™€ λ§¥ ν™κ²½μ—μ„ μ‚¬μ©ν•λ” λ„μ»¤ λ°μ¤ν¬νƒ‘μ—λ” QEMU μ„ ν¬ν•¨ν•κ³  μμ–΄ μ‰½κ² λ©€ν‹° ν”λ«νΌ μ΄λ―Έμ§€λ¥Ό λΉλ“ν•  μ μλ‹¤. ν•μ§€λ§, μΌλ°μ μΌλ΅ μ  ν‚¨μ¤λ¥Ό μ„¤μΉν•λ” λ¦¬λ…μ¤ μ„λ²„μ—μ„λ” <a href="https://docs.docker.com/build/building/multi-platform/#qemu-without-docker-desktop">QEMU</a>μ λ„μ›€μ„ λ°›κΈ° μ„ν•΄μ„ μ§μ ‘ μ„¤μΉν•΄μ•Όν•λ‹¤.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--privileged</span> <span class="token parameter variable">--rm</span> tonistiigi/binfmt <span class="token parameter variable">--install</span> all</code></pre><h4 id="Docker-Build-Cloud-λ¥Ό-λΉλ”λ΅-μ΄μ©ν•κΈ°"><a href="#Docker-Build-Cloud-λ¥Ό-λΉλ”λ΅-μ΄μ©ν•κΈ°" class="headerlink" title="Docker Build Cloud λ¥Ό λΉλ”λ΅ μ΄μ©ν•κΈ°"></a>Docker Build Cloud λ¥Ό λΉλ”λ΅ μ΄μ©ν•κΈ°</h4><p><a href="https://docs.docker.com/build/cloud/">Docker Build Cloud</a>λ¥Ό μ΄μ©ν•μ—¬ λΉλ“ν•κΈ° μ„ν•΄μ„λ” cloud λ“λΌμ΄λ²„λ¥Ό μ§€μ›ν•λ” buildx λ²„μ „μ„ μ„¤μΉν•΄μ•Όν•λ‹¤. <a href="https://github.com/docker/buildx-desktop">buildx-desktop</a> μ—μ„ λ¦¬λ…μ¤ μ„λ²„μ— λ§λ” λ°”μ΄λ„λ¦¬ νμΌμ„ λ‹¤μ΄λ°›μ•„μ„ μ  ν‚¨μ¤ κ³„μ •μ—μ„ λ°”λΌλ³΄λ” λ„μ»¤ κ²½λ΅μ— docker-buildx ν”λ¬κ·ΈμΈμΌλ΅ μ¶”κ°€ν•μ.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># μ  ν‚¨μ¤ μ‚¬μ©μλ΅ μ „ν™</span><span class="token function">sudo</span> <span class="token function">su</span> jenkins <span class="token parameter variable">-s</span> /bin/bash<span class="token comment"># cloud λ“λΌμ΄λ²„λ¥Ό μ§€μ›ν•λ” Buildx μ„¤μΉ</span><span class="token function">wget</span> https://github.com/docker/buildx-desktop/releases/download/v0.14.0-desktop.1/buildx-v0.14.0-desktop.1.linux-amd64<span class="token function">mv</span> buildx-v0.14.0-desktop.1.linux-amd64 ~/docker/cli-plugins/docker-buildx<span class="token function">chmod</span> a+x ~/.docker/cli-plugins/docker-buildx<span class="token comment"># Buildx λ²„μ „ ν™•μΈ</span><span class="token function">docker</span> buildx versiongithub.com/docker/buildx v0.14.0-desktop.1 7b0470cffd54ccbf42976d2f75febc4532c85073<span class="token comment"># Docker Build Cloud λΉλ” μ¶”κ°€</span><span class="token function">docker</span> buildx create <span class="token parameter variable">--driver</span> xxxinc/builder <span class="token parameter variable">--use</span><span class="token function">docker</span> buildx <span class="token function">ls</span>NAME/NODE               DRIVER/ENDPOINT                          STATUS    BUILDKIT       PLATFORMScloud-eipgridinc-ddd*   cloud <span class="token punctuation">\</span>_ linux-amd64          <span class="token punctuation">\</span>_ cloud://xxxinc/builder_linux-amd64   running   v0.13.1        linux/amd64*, linux/amd64/v2, linux/amd64/v3, linux/amd64/v4, linux/386 <span class="token punctuation">\</span>_ linux-arm64          <span class="token punctuation">\</span>_ cloud://xxxinc/builder_linux-arm64   running   v0.13.1        linux/arm64*, linux/arm64/v6, linux/arm64/v7default                 <span class="token function">docker</span> <span class="token punctuation">\</span>_ default              <span class="token punctuation">\</span>_ default                              running   v0.8+unknown   linux/amd64, linux/arm64, linux/riscv64, linux/ppc64le, linux/s390x, linux/386, linux/arm/v7, linux/arm/v6</code></pre><blockquote><p>Docker Build Cloud ν™κ²½μ—μ„ λΉλ“ν•λ―€λ΅ β€“bootstrap μµμ…μΌλ΅ λΉλ” μ΄κΈ°ν™”λ¥Ό μν–‰ν•  ν•„μ”κ°€ μ—†μµλ‹λ‹¤.</p></blockquote><h4 id="Jenkins-μ—μ„-λΉλ“ν•κΈ°"><a href="#Jenkins-μ—μ„-λΉλ“ν•κΈ°" class="headerlink" title="Jenkins μ—μ„ λΉλ“ν•κΈ°"></a>Jenkins μ—μ„ λΉλ“ν•κΈ°</h4><p>Docker Plugin μ—μ„λ” buildx λ…λ Ήμ–΄λ¥Ό μ„ νƒν•  μ μ—†κΈ° λ•λ¬Έμ— Execute Shell μ„ μ„ νƒν•΄μ„ μ§μ ‘ buildx λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•λ” μ¤ν¬λ¦½νΈλ¥Ό μ‘μ„±ν•΄μ•Όν•λ‹¤. μ•„λμ μ¤ν¬λ¦½νΈμ—μ„ λ„μ»¤ κ³„μ •μ— λ΅κ·ΈμΈν•κΈ° μ„ν•΄μ„ μ  ν‚¨μ¤ μ‚¬μ©μμ config.json μ„ μ΄μ©ν•κ² ν–λ‹¤.</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Log in to Docker Hub</span><span class="token builtin class-name">echo</span> <span class="token string">"Logging into Docker Hub..."</span><span class="token function">docker</span> login<span class="token assign-left variable">BUILDER_NAME</span><span class="token operator">=</span><span class="token string">"cloud-xxxinc-builder"</span><span class="token comment"># Check if the builder already exists</span><span class="token assign-left variable">BUILDER_EXISTS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> buildx <span class="token function">ls</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"<span class="token variable">$BUILDER_NAME</span>"</span> <span class="token operator">||</span> <span class="token boolean">true</span><span class="token variable">)</span></span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$BUILDER_EXISTS</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token builtin class-name">echo</span> <span class="token string">"Creating new builder instance..."</span>  <span class="token function">docker</span> buildx create <span class="token parameter variable">--name</span> <span class="token string">"<span class="token variable">$BUILDER_NAME</span>"</span> <span class="token parameter variable">--driver</span> cloud xxxinc/builder <span class="token parameter variable">--use</span><span class="token keyword">else</span>  <span class="token builtin class-name">echo</span> <span class="token string">"Using existing builder instance..."</span>  <span class="token function">docker</span> buildx use <span class="token string">"<span class="token variable">$BUILDER_NAME</span>"</span><span class="token keyword">fi</span><span class="token comment"># List the builder instances</span><span class="token function">docker</span> buildx <span class="token function">ls</span><span class="token comment"># Install QEMU emulators for building multi-architecture images</span><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> <span class="token parameter variable">--privileged</span> tonistiigi/binfmt <span class="token parameter variable">--install</span> all<span class="token comment"># build</span><span class="token builtin class-name">echo</span> <span class="token string">"Building Docker image using Buildx with Docker Build Cloud..."</span><span class="token function">docker</span> buildx build <span class="token parameter variable">--platform</span> linux/amd64,linux/arm64 <span class="token parameter variable">-t</span> xxxinc/testapp:<span class="token variable">$&#123;version&#125;</span>-buildx <span class="token parameter variable">--push</span> <span class="token builtin class-name">.</span></code></pre><h4 id="Optional-HDF5-for-ARM64"><a href="#Optional-HDF5-for-ARM64" class="headerlink" title="(Optional) HDF5 for ARM64"></a>(Optional) HDF5 for ARM64</h4><p>ARM64 μ•„ν‚¤ν…μ²λ΅ λΉλ“ν•λ” κ²½μ°μ—λ§ <code>ValueError: did not find HDF5 headers</code> κ°€ λ°μƒν•λ” κ²ƒμ„ κ²½ν—ν–λ‹¤. κ²€μƒ‰ κ²°κ³Ό μ•„λμ μ„Έκ°μ ν¨ν‚¤μ§€λ¥Ό μ„¤μΉν•λ” κ²ƒμΌλ΅ ν•΄κ²°μ΄ λμ—λ‹¤.</p><ul><li>libhdf5-serial-dev</li><li>netcdf-bin</li><li>libnetcdf-dev</li></ul><pre class="language-docker" data-language="docker"><div class="caption"><span>Dockerfile</span></div><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> python:3.8-slim-buster</span><span class="token instruction"><span class="token keyword">RUN</span> apt-get update &amp;&amp; apt-get install -y <span class="token operator">\</span>    gcc  <span class="token operator">\</span>    libpq-dev <span class="token operator">\</span>    libhdf5-serial-dev <span class="token operator">\</span>    netcdf-bin \ </span>    libnetcdf-dev</code></pre><h4 id="λ¬Έμ -ν•΄κ²°μ—-λ„μ›€μ΄-λ-κΈ€"><a href="#λ¬Έμ -ν•΄κ²°μ—-λ„μ›€μ΄-λ-κΈ€" class="headerlink" title="λ¬Έμ  ν•΄κ²°μ— λ„μ›€μ΄ λ κΈ€"></a>λ¬Έμ  ν•΄κ²°μ— λ„μ›€μ΄ λ κΈ€</h4><ul><li><a href="https://hotfoxy.tistory.com/114">jenkins(image) μ—μ„ docker buildxλ¥Ό μ‚¬μ©ν•κ³  μ‹¶μ–΄μ”!</a></li><li><a href="https://forums.docker.com/t/docker-buildx-failed-to-find-driver-cloud/141238/4">Docker buildx β€failed to find driverβ€</a></li><li><a href="https://stackoverflow.com/a/36165209">https://stackoverflow.com/a/36165209</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;μ  ν‚¨μ¤μ—μ„ Docker Plugin μ„ μ‚¬μ©ν•΄μ„ Dockerfileμ„ ν†µν•΄ μ‰½κ² λ„μ»¤ μ΄λ―Έμ§€λ¥Ό λΉλ“ν•  μ μλ‹¤. μ•„λ§μ΅΄ μ›Ή μ„λΉ„μ¤μ™€ κ°™μ€ ν΄λΌμ°λ“ μ„λΉ„μ¤μ—μ„λ” x86_64(AMD64) μ•„ν‚¤ν…μ² λΏλ§ μ•„λ‹λΌ ARM64 μ•„ν‚¤ν…μ² κΈ°λ°μ λ” μ €λ ΄ν•κ³  </summary>
      
    
    
    
    
    <category term="Jenkins" scheme="https://kdevkr.github.io/tags/Jenkins/"/>
    
    <category term="Docker" scheme="https://kdevkr.github.io/tags/Docker/"/>
    
    <category term="Buildx" scheme="https://kdevkr.github.io/tags/Buildx/"/>
    
  </entry>
  
</feed>
