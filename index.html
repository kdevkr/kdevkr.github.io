<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png"><link rel="mask-icon" href="/images/favicon/favicon.ico" color="#222"><meta name="google-site-verification" content="LMcddVW6xLBS7X1htGQ3duOIEmVp4ljku8sd3UuIcBg"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto+Sans+KR:300,300italic,400,400italic,700,700italic%7CPretendard-Bold:300,300italic,400,400italic,700,700italic%7CPretendard-Medium:300,300italic,400,400italic,700,700italic%7CJetbrains+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-loading-bar.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"kdevkr.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"width":240,"scrollpercent":true,"b2t":true},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script><meta property="og:type" content="website"><meta property="og:title" content="Mambo"><meta property="og:url" content="https://kdevkr.github.io/index.html"><meta property="og:site_name" content="Mambo"><meta property="og:locale" content="en_US"><meta property="article:author" content="Mambo"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://kdevkr.github.io/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Mambo</title><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-93954323-1","only_pageview":true}</script><script src="/js/third-party/analytics/google-analytics.js"></script><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><link rel="alternate" href="/atom.xml" title="Mambo" type="application/atom+xml">
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope itemtype="http://schema.org/WebPage"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">Mambo</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Today I Learned 🔥</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fas fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fas fa-archive fa-fw"></i>Archives<span class="badge">65</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fas fa-user fa-fw"></i>About</a></li></ul></nav></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-overview-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Mambo" src="https://avatars1.githubusercontent.com/u/17937604?s=460&v=4"><p class="site-author-name" itemprop="name">Mambo</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">65</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-tags"><span class="site-state-item-count">116</span> <span class="site-state-item-name">tags</span></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/kdevkr" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;kdevkr" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:kdevkr@gmail.com" title="E-Mail → mailto:kdevkr@gmail.com" rel="noopener" target="_blank"><i class="fas fa-envelope fa-fw"></i>E-Mail</a></span></div><div class="cc-license site-overview-item animated" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ko" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div><div class="back-to-top animated" role="button" aria-label="Back to top"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div class="sidebar-dimmer"></div></header><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner index posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://kdevkr.github.io/access-aws-elasticache/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://avatars1.githubusercontent.com/u/17937604?s=460&v=4"><meta itemprop="name" content="Mambo"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Mambo"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | Mambo"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/access-aws-elasticache/" class="post-title-link" itemprop="url">VPC 외부에서 ElastiCache 접근하기</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2022-10-14 00:00:00" itemprop="dateCreated datePublished" datetime="2022-10-14T00:00:00Z">2022-10-14</time></span></div></div></header><div class="post-body" itemprop="articleBody"><p>현재 조직에서는 작은 EC2 인스턴스 내에 단일 레디스 프로세스를 실행하여 세션 저장소로 사용하고 있었는데 시스템의 요구사항이 점점 늘어나게 되면서 캐시 저장소로 조금씩 활용되고 있어서 더 높은 자원을 가지는 EC2 인스턴스 유형으로 전환 및 고 가용성을 위한 레디스 클러스터룰 구성해야할 요건이 생긴 것 같다. 조직 내에는 다른 회사처럼 인프라 엔지니어로 구성된 인프라 팀이 별도로 존재하지 않기 때문에 인프라 관리 포인트의 문제로 인해서 아마존 웹 서비스에서 제공하는 매니지드 서비스인 Amazon ElastiCache for Redis를 도입하는 것을 검토해야할 필요성이 생겼다.</p><h4 id="클러스터-액세스-제어"><a href="#클러스터-액세스-제어" class="headerlink" title="클러스터 액세스 제어"></a>클러스터 액세스 제어</h4><p>Amazon ElastiCache는 VPC 외부에서 접근이 가능한 엔드포인트를 제공하는 매니지드 관계형 데이터베이스 서비스인 RDS와는 다르게 VPC 서브넷에서 접근하기 위한 앤드포인트 주소를 제공한다. ElastiCache에 대해서 설명하는 많은 글에서는 VPC 내부에서만 접근하므로 비밀번호가 필요없다고 이야기하는데 고급 설정 중 보안 섹션에서 <strong>전송 중 데이터 암호화</strong>를 활성화해야 레디스 클러스터에 대한 액세스 제어 기능이 부여된다.</p><p><img data-src="/images/posts/access-aws-elasticache/01.png"></p><blockquote><p>보안 섹션의 암호화 기능은 아래와 같이 클러스터 생성 후에는 변경할 수 없습니다.</p></blockquote><p><img data-src="/images/posts/access-aws-elasticache/02.png"></p><h4 id="VPC-외부-접근-구성"><a href="#VPC-외부-접근-구성" class="headerlink" title="VPC 외부 접근 구성"></a>VPC 외부 접근 구성</h4><p>Amazon ElastiCache 에서 자체적으로 퍼블릭 인터넷에서 접근할 수 있는 방법을 제공하지 않으므로 VPC 아이피 대역을 경유할 수 있는 방법을 적용해야 외부 접근이 가능하다. 예를 들어, 퍼블릭 액세스가 가능한 서브넷에 실행중인 EC2 인스턴스에서 ElastiCache 클러스터 엔드포인트에 대하여 HAProxy와 같은 TCP 프록시 구성을 통해서 사내 아이피 대역과 같은 개발 환경에서 접근할 수 있도록 포트포워딩을 적용할 수 있다.</p><pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> yum <span class="token function">install</span> haproxy
$ <span class="token function">sudo</span> <span class="token function">vi</span> /etc/haproxy/haproxy.cfg

<span class="token comment">#---------------------------------------------------------------------</span>
<span class="token comment"># main frontend which proxys to the backends</span>
<span class="token comment">#---------------------------------------------------------------------</span>
frontend frontend
        <span class="token builtin class-name">bind</span> <span class="token number">0.0</span>.0.0:6379
        default_backend elasticache

backend elasticache
        mode    tcp
        option  tcplog
        server  upstream elasticache.xxxxx.cache.amazonaws.com:6379

<span class="token comment"># wq</span>

$ haproxy -f /etc/haproxy/haproxy.cfg -c
Configuration <span class="token function">file</span> is valid

$ <span class="token function">sudo</span> systemctl restart haproxy
$ <span class="token function">sudo</span> systemctl status haproxy
● haproxy.service - HAProxy Load Balancer
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/haproxy.service<span class="token punctuation">;</span> disabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Thu <span class="token number">2022</span>-10-13 06:59:01 UTC<span class="token punctuation">;</span> 2h 41min ago
 Main PID: <span class="token number">7091</span> <span class="token punctuation">(</span>haproxy-systemd<span class="token punctuation">)</span>
   CGroup: /system.slice/haproxy.service
           ├─7091 /usr/sbin/haproxy-systemd-wrapper -f /etc/haproxy/haproxy.cfg -p /run/haproxy.pid
           ├─7092 /usr/sbin/haproxy -f /etc/haproxy/haproxy.cfg -p /run/haproxy.pid -Ds
           └─7093 /usr/sbin/haproxy -f /etc/haproxy/haproxy.cfg -p /run/haproxy.pid -Ds

Oct <span class="token number">13</span> 06:59:01 ip-192-169-14-62.ap-northeast-2.compute.internal systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Stopped HAProxy Load Balancer.
Oct <span class="token number">13</span> 06:59:01 ip-192-169-14-62.ap-northeast-2.compute.internal systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Started HAProxy Load Balancer.
Oct <span class="token number">13</span> 06:59:01 ip-192-169-14-62.ap-northeast-2.compute.internal haproxy-systemd-wrapper<span class="token punctuation">[</span><span class="token number">7091</span><span class="token punctuation">]</span>: haproxy-systemd-wrapper: executing /usr/sbin/haproxy -f /etc/haproxy/haproxy.cfg -p /run/haproxy.pid -Ds</code></pre><blockquote><p><a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/ko_kr/AmazonElastiCache/latest/mem-ug/accessing-elasticache.html#access-from-outside-aws">외부 AWS에서 ElastiCache 리소스에 액세스</a>에서 설명하는 것처럼 AWS Client VPN 구성을 통해서 외부에서 VPC 앤드포인트에 접근할 수 있습니다. 다만, <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/ko_kr/vpn/latest/clientvpn-admin/cvpn-working-max-duration.html">VPN 세션 최대 기간</a>이 24시간이므로 지속해서 연결할 수 있는 환경을 만들 수 없으며 개발 및 테스트 목적으로 사용해야 합니다.</p></blockquote><p>사실 ElastiCache 서비스에 대해 외부 접근 구성을 테스트한 이유는 특정 고객의 AWS 클라우드 인프라 구성에 외부 IDC에서 데이터베이스들을 접근해야할 요구사항이 있으므로 인터넷 트래픽에 의해 클러스터 성능이 효율적이지 못하더라도 HAProxy의 TCP 프록시를 통해 특정 IP 대역에서 ElastiCache 서비스에 접근할 수 있도록 할 수 있음을 검증했다.</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><nav class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/65/">65</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a></nav></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Mambo</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a></div></div></footer><script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script src="/js/third-party/fancybox.js"></script><script src="/js/third-party/pace.js"></script><script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script><script>var options={bottom:"unset",right:"15px",left:"unset",time:"0.5s",mixColor:"transparent",backgroundColor:"transparent",buttonColorDark:"#100f2c",buttonColorLight:"#fff",saveInCookies:!0,label:"🌗",autoMatchOsTheme:!0};const darkmode=new Darkmode(options);window.darkmode=darkmode,darkmode.showWidget()</script></body></html>