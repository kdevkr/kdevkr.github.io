<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png"><link rel="mask-icon" href="/images/favicon/favicon.ico" color="#222"><meta name="google-site-verification" content="LMcddVW6xLBS7X1htGQ3duOIEmVp4ljku8sd3UuIcBg"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto+Sans+KR:300,300italic,400,400italic,700,700italic%7CPretendard-Bold:300,300italic,400,400italic,700,700italic%7CPretendard-Medium:300,300italic,400,400italic,700,700italic%7CJetbrains+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-loading-bar.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"kdevkr.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.13.2","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"width":240,"scrollpercent":true,"b2t":true},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script><meta name="description" content="ë³¸ ê¸€ì€ ì—ë„ˆì§€ ë¶„ì•¼ì—ì„œ ìˆ˜ìš” ë°˜ì‘(DR) ì´ë²¤íŠ¸ë¥¼ ì†¡ìˆ˜ì‹ í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©í•˜ëŠ” OpenADR í”„ë¡œí† ì½œì—ì„œ VTNê³¼ VENì´ ì„œë¡œ ìƒí˜¸ ì¸ì¦(Mutual Authentication)ì„ ìˆ˜í–‰í•˜ëŠ” êµ¬ì¡°ë¥¼ ì´í•´í•˜ê¸° ìœ„í•´ ì •ë¦¬í•œ ê²ƒì…ë‹ˆë‹¤.  Mutual AuthenticationClient certificates must be used for HTTP client"><meta property="og:type" content="article"><meta property="og:title" content="Mutual TLS"><meta property="og:url" content="https://kdevkr.github.io/mutual-tls/index.html"><meta property="og:site_name" content="Mambo"><meta property="og:description" content="ë³¸ ê¸€ì€ ì—ë„ˆì§€ ë¶„ì•¼ì—ì„œ ìˆ˜ìš” ë°˜ì‘(DR) ì´ë²¤íŠ¸ë¥¼ ì†¡ìˆ˜ì‹ í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©í•˜ëŠ” OpenADR í”„ë¡œí† ì½œì—ì„œ VTNê³¼ VENì´ ì„œë¡œ ìƒí˜¸ ì¸ì¦(Mutual Authentication)ì„ ìˆ˜í–‰í•˜ëŠ” êµ¬ì¡°ë¥¼ ì´í•´í•˜ê¸° ìœ„í•´ ì •ë¦¬í•œ ê²ƒì…ë‹ˆë‹¤.  Mutual AuthenticationClient certificates must be used for HTTP client"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2022-07-12T15:00:00.000Z"><meta property="article:modified_time" content="2023-03-02T13:59:55.349Z"><meta property="article:author" content="Mambo"><meta property="article:tag" content="X.509"><meta property="article:tag" content="mTLS"><meta property="article:tag" content="X-SSL-CERT"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://kdevkr.github.io/mutual-tls/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://kdevkr.github.io/mutual-tls/","path":"mutual-tls/","title":"Mutual TLS"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Mutual TLS | Mambo</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-V8LF04VMBF"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-V8LF04VMBF","only_pageview":false}</script><script src="/js/third-party/analytics/google-analytics.js"></script><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><link rel="alternate" href="/atom.xml" title="Mambo" type="application/atom+xml">
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope itemtype="http://schema.org/WebPage"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Mambo</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Today I Learned ğŸ”¥</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fas fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fas fa-archive fa-fw"></i>Archives<span class="badge">81</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fas fa-user fa-fw"></i>About</a></li></ul></nav></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Mutual-Authentication"><span class="nav-number">1.</span> <span class="nav-text">Mutual Authentication</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#X-509-Client-Certificate"><span class="nav-number">1.1.</span> <span class="nav-text">X.509 Client Certificate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#X-509-Client-Certificate-Proxy"><span class="nav-number">1.2.</span> <span class="nav-text">X.509 Client Certificate Proxy</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%B0%B8%EA%B3%A0"><span class="nav-number">2.</span> <span class="nav-text">ì°¸ê³ </span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Mambo" src="https://avatars1.githubusercontent.com/u/17937604?s=460&v=4"><p class="site-author-name" itemprop="name">Mambo</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">81</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-tags"><span class="site-state-item-count">133</span> <span class="site-state-item-name">tags</span></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/kdevkr" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;kdevkr" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:kdevkr@gmail.com" title="E-Mail â†’ mailto:kdevkr@gmail.com" rel="noopener" target="_blank"><i class="fas fa-envelope fa-fw"></i>E-Mail</a></span></div><div class="cc-license site-overview-item animated" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ko" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div><div class="back-to-top animated" role="button" aria-label="Back to top"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div class="sidebar-dimmer"></div></header><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://kdevkr.github.io/mutual-tls/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://avatars1.githubusercontent.com/u/17937604?s=460&v=4"><meta itemprop="name" content="Mambo"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Mambo"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Mutual TLS | Mambo"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Mutual TLS</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2022-07-13 00:00:00" itemprop="dateCreated datePublished" datetime="2022-07-13T00:00:00+09:00">2022-07-13</time></span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>ë³¸ ê¸€ì€ ì—ë„ˆì§€ ë¶„ì•¼ì—ì„œ ìˆ˜ìš” ë°˜ì‘(DR) ì´ë²¤íŠ¸ë¥¼ ì†¡ìˆ˜ì‹ í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©í•˜ëŠ” <a target="_blank" rel="noopener" href="https://www.openadr.org/">OpenADR í”„ë¡œí† ì½œ</a>ì—ì„œ VTNê³¼ VENì´ ì„œë¡œ ìƒí˜¸ ì¸ì¦(Mutual Authentication)ì„ ìˆ˜í–‰í•˜ëŠ” êµ¬ì¡°ë¥¼ ì´í•´í•˜ê¸° ìœ„í•´ ì •ë¦¬í•œ ê²ƒì…ë‹ˆë‹¤.</p></blockquote><h2 id="Mutual-Authentication"><a href="#Mutual-Authentication" class="headerlink" title="Mutual Authentication"></a>Mutual Authentication</h2><p><em>Client certificates must be used for HTTP client authentication. The entity initiating the request(the client) must have an X.509 certificate that is validated by the server during the TLS handshake. If no client certificate is supplied, or if the certificate is not valid (e.g., it is not signed by a trusted CA, or it is expired) the server must terminate the connection during the TLS handshake.</em></p><p>OpenADR í”„ë¡œí† ì½œì—ì„œ VTN ì‹œìŠ¤í…œê³¼ VEN ë””ë°”ì´ìŠ¤ ê°„ í†µì‹ ì„ ìœ„í•´ì„œëŠ” HTTP ë˜ëŠ” XMPPë¥¼ ì´ìš©í•´ì•¼í•©ë‹ˆë‹¤. HTTP í´ë¼ì´ì–¸íŠ¸ í†µì‹ ì„ ìœ„í•´ì„œëŠ” VTNê³¼ VENì€ ì„œë¡œë¥¼ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” X.509 ê³µê°œí‚¤ ì¸ì¦ì„œë¥¼ ì œê³µí•´ì•¼í•©ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì— ì„œë²„ê°€ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ê¸°ê´€ìœ¼ë¡œë¶€í„° ì„œëª…ëœ X.509 ì¸ì¦ì„œê°€ í¬í•¨ë˜ì§€ ì•Šìœ¼ë©´ ì„œë²„ ì‹œìŠ¤í…œì—ì„œëŠ” TLS í•¸ë“œì‰ì´í¬ ê³¼ì •ì—ì„œ ì—°ê²°ì„ í•´ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h3 id="X-509-Client-Certificate"><a href="#X-509-Client-Certificate" class="headerlink" title="X.509 Client Certificate"></a>X.509 Client Certificate</h3><p>OpenADR í”„ë¡œí† ì½œì—ì„œì˜ ë³´ì•ˆì€ ê³µê°œí‚¤ ê¸°ë°˜ ì¸í”„ë¼(PKI)ì˜ X.509 ì¸ì¦ì„œë¡œ ìˆ˜í–‰í•˜ë©° ë” ë†’ì€ ë³´ì•ˆ ë ˆë²¨ì„ ìš”êµ¬í•˜ëŠ” ì‹œìŠ¤í…œì„ êµ¬ì„±í•˜ê³  ì‹¶ë‹¤ë©´ XML í˜ì´ë¡œë“œì— ëŒ€í•œ ì„œëª…ì„ ì§€ì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 2048 ë¹„íŠ¸ ì´ìƒì˜ RSA ë˜ëŠ” 256 ë¹„íŠ¸ ì´ìƒì˜ ECC í‚¤ ê¸°ë°˜ì˜ ê³µê°œí‚¤ ì¸ì¦ì„œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ VENì€ ì„ë² ë””ë“œ ë””ë°”ì´ìŠ¤ì´ë¯€ë¡œ RSA ë³´ë‹¤ëŠ” ECC í‚¤ ê¸°ë°˜ì˜ ì¸ì¦ì„œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” íš¨ìœ¨ì ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. OpenADR í”„ë¡œí† ì½œì—ì„œ TLS í•¸ë“œì‰ì´í¬ ê³¼ì •ì—ì„œ ìµœì†Œí•œ TLS 1.2 ë²„ì „ê³¼ í•¨ê»˜ ê·¸ì— ìƒì‘í•˜ëŠ” ì•”í˜¸í™” ìŠ¤ìœ„íŠ¸ë¥¼ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤.</p><ul><li>Transport Layer Security: TLS 1.2+</li><li>Cipher Suites: TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256, TLS_RSA_WITH_AES_128_CBC_SHA256</li></ul><h4 id="cURL"><a href="#cURL" class="headerlink" title="cURL"></a>cURL</h4><p>ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œì—ì„œ ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” HTTP í´ë¼ì´ì–¸íŠ¸ í†µì‹  ë„êµ¬ì¸ <a target="_blank" rel="noopener" href="https://curl.se/">cURL</a>ë¥¼ ì‚¬ìš©í•´ì„œ EiRegisterParty ì„œë¹„ìŠ¤ ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•´ ìš”ì²­í•˜ë©´ VTN ê³¼ì˜ ìƒí˜¸ TLS í•¸ë“œì‰ì´í¬ ê³¼ì •ì„ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ”ì§€ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <a target="_blank" rel="noopener" href="https://downey.io/notes/dev/curl-using-mutual-tls/">how to curl an endpoint protected by mutual tls (mtls)</a>ì—ì„œëŠ” cURLë¡œ í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œë¥¼ í¬í•¨í•˜ëŠ” ë°©ë²•ì„ ì†Œê°œí•˜ê³  ìˆì–´ ë‹¤ìŒê³¼ ê°™ì´ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤.</p><pre class="language-sh" data-language="sh"><code class="language-sh">curl -v --tlsv1.2 --tls-max 1.3 --cert .&#x2F;cert.pem --key .&#x2F;privkey.pem https:&#x2F;&#x2F;Host&#x2F;OpenADR2&#x2F;Simple&#x2F;2.0b&#x2F;EiRegisterParty</code></pre><h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><p>ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ ë¿ë§Œ ì•„ë‹ˆë¼ VEN ë””ë°”ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” ê°€ì¥ ì¼ë°˜ì ì¸ ë°©ë²•ì€ ìë°” ì–¸ì–´ë¡œ êµ¬í˜„í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” KeyStoreë¼ëŠ” ë³„ë„ì˜ í‚¤ ì €ì¥ì†Œ í´ë˜ìŠ¤ë¥¼ ì œê³µí•˜ë¯€ë¡œ HTTP í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ì‹œ X.509 í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œë¥¼ í¬í•¨ì‹œí‚¤ê¸° ìœ„í•´ì„œëŠ” PKI ë° PKCS í‘œì¤€ì— ëŒ€í•œ ì¼ë ¨ì˜ í´ë˜ìŠ¤ë“¤ì„ ì•Œì•„ì•¼í•©ë‹ˆë‹¤. X.509 í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œëŠ” PEM í˜•ì‹ìœ¼ë¡œ êµí™˜ë˜ë¯€ë¡œ KeyStoreë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒì€ <a target="_blank" rel="noopener" href="https://www.bouncycastle.org/java.html">BouncyCastle API</a> ìë°” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ì„œ X.509 ì¸ì¦ì„œì™€ ê°œì¸í‚¤ë¥¼ ë¶ˆëŸ¬ì™€ì„œ HTTP í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì„ ì‹œë„í•˜ëŠ” ì½”ë“œë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.</p><pre class="language-java" data-language="java"><code class="language-java">class MutualTlsTest &#123;
    private final Logger log &#x3D; LoggerFactory.getLogger(MutualTlsTest.class);
    private final ClassLoader classLoader &#x3D; this.getClass().getClassLoader();

    @DisplayName(&quot;Test mutual authentication&quot;)
    @Test
    void testMutualAuthentication() &#123;
        Assertions.assertDoesNotThrow(() -&gt; &#123;
            System.setProperty(&quot;javax.net.debug&quot;, &quot;ssl&quot;);

            String certPemText &#x3D; IOUtils.toString(classLoader.getResourceAsStream(&quot;cert.pem&quot;), StandardCharsets.UTF_8);
            String privateKeyText &#x3D; IOUtils.toString(classLoader.getResourceAsStream(&quot;privkey.pem&quot;), StandardCharsets.UTF_8);

            final byte[] certPem &#x3D; new PemReader(new StringReader(certPemText)).readPemObject().getContent();
            final byte[] privateKey &#x3D; new PemReader(new StringReader(privateKeyText)).readPemObject().getContent();

            KeyStore clientKeyStore &#x3D; KeyStore.getInstance(&quot;jks&quot;);
            clientKeyStore.load(null, null);

            final Collection&lt;? extends Certificate&gt; chain &#x3D; CertificateFactory.getInstance(&quot;X.509&quot;).generateCertificates(new ByteArrayInputStream(certPem));
            final char[] password &#x3D; new SecureRandom().toString().toCharArray();
            final Key key &#x3D; KeyFactory.getInstance(&quot;RSA&quot;).generatePrivate(new PKCS8EncodedKeySpec(privateKey));
            clientKeyStore.setKeyEntry(&quot;client&quot;, key, password, chain.toArray(new Certificate[0]));

            KeyManagerFactory keyManagerFactory &#x3D; KeyManagerFactory.getInstance(&quot;SunX509&quot;);
            keyManagerFactory.init(clientKeyStore, password);

            &#x2F;&#x2F; NOTE: If server generate client certificate from self-signed root CA, you can use trustKeyStore.
            KeyStore trustKeyStore &#x3D; KeyStore.getInstance(&quot;jks&quot;);
            trustKeyStore.load(classLoader.getResourceAsStream(&quot;ca.jks&quot;), &quot;password&quot;.toCharArray());
            TrustManagerFactory trustManagerFactory &#x3D; TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());
            trustManagerFactory.init(trustKeyStore);

            SSLContext sslcontext &#x3D; SSLContexts.custom().loadTrustMaterial(null, new TrustAllStrategy()).build();
            sslcontext.init(keyManagerFactory.getKeyManagers(), trustManagerFactory.getTrustManagers(), null);

            String[] tlsVersions &#x3D; new String[]&#123;&quot;TLSv1.2&quot;,&quot;TLSv1.3&quot;&#125;;
            String[] cipherSuites &#x3D; SSLContext.getDefault().getDefaultSSLParameters().getCipherSuites();
            SSLConnectionSocketFactory sslSocketFactory &#x3D; new SSLConnectionSocketFactory(sslcontext, tlsVersions, cipherSuites, new NoopHostnameVerifier());

            CloseableHttpClient client &#x3D; HttpClientBuilder.create().setSSLSocketFactory(sslSocketFactory).build();

            HttpPost httpPost &#x3D; new HttpPost(&quot;https:&#x2F;&#x2F;Host&#x2F;OpenADR2&#x2F;Simple&#x2F;2.0b&#x2F;EiRegisterParty&quot;);
            httpPost.addHeader(&quot;Content-Type&quot;, &quot;application&#x2F;xml; charset&#x3D;UTF-8&quot;);

            String payload &#x3D; IOUtils.toString(classLoader.getResourceAsStream(&quot;payload.xml&quot;), StandardCharsets.UTF_8);
            httpPost.setEntity(new StringEntity(payload));

            CloseableHttpResponse httpResponse &#x3D; client.execute(httpPost);
            String response &#x3D; EntityUtils.toString(httpResponse.getEntity(), StandardCharsets.UTF_8);
            Assertions.assertNotNull(response);
            Assertions.assertTrue(response.startsWith(&quot;&lt;?xml&quot;));
        &#125;);
    &#125;
&#125;</code></pre><h4 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h4><p>ê°œì¸ì ìœ¼ë¡œ í•™ìŠµì¤‘ì¸ Go ì–¸ì–´ì—ì„œ HTTP í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ê³¼ í•¨ê»˜ X.509 í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œë¥¼ í¬í•¨ì‹œí‚¤ëŠ” ë°©ë²•ì„ ì°¾ì•„ë³´ì•˜ìŠµë‹ˆë‹¤. <a target="_blank" rel="noopener" href="https://venilnoronha.io/a-step-by-step-guide-to-mtls-in-go">A step by step guide to mTLS in Go</a>ì— ì˜ ì„¤ëª…ë˜ì–´ìˆìœ¼ë¯€ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ê°„ë‹¨í•˜ê²Œ í…ŒìŠ¤íŠ¸í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><pre class="language-go" data-language="go"><code class="language-go">package main

import (
	&quot;crypto&#x2F;tls&quot;
	&quot;crypto&#x2F;x509&quot;
	&quot;fmt&quot;
	&quot;io&#x2F;ioutil&quot;
	&quot;log&quot;
	&quot;net&#x2F;http&quot;
	&quot;os&quot;
	&quot;strings&quot;
)

func main() &#123;
	cert, err :&#x3D; tls.LoadX509KeyPair(&quot;cert.pem&quot;, &quot;privkey.pem&quot;)
	if err !&#x3D; nil &#123;
		log.Fatal(err)
	&#125;

	caCert, err :&#x3D; ioutil.ReadFile(&quot;ca.pem&quot;)
	if err !&#x3D; nil &#123;
		log.Fatal(err)
	&#125;
	caCertPool :&#x3D; x509.NewCertPool()
	caCertPool.AppendCertsFromPEM(caCert)

	client :&#x3D; &amp;http.Client&#123;
		Transport: &amp;http.Transport&#123;
			TLSClientConfig: &amp;tls.Config&#123;
				ClientAuth:   tls.RequireAndVerifyClientCert,
				ClientCAs:    caCertPool,
				Certificates: []tls.Certificate&#123;cert&#125;,
				MinVersion:   tls.VersionTLS12,
			&#125;,
		&#125;,
	&#125;

	payloadXml, err :&#x3D; os.Open(&quot;payload.xml&quot;)
	if err !&#x3D; nil &#123;
		log.Fatal(err)
	&#125;
	defer payloadXml.Close()

	payload, _ :&#x3D; ioutil.ReadAll(payloadXml)
	r, err :&#x3D; client.Post(&quot;https:&#x2F;&#x2F;Host&#x2F;OpenADR2&#x2F;Simple&#x2F;2.0b&#x2F;EiRegisterParty&quot;, &quot;application&#x2F;xml&quot;, strings.NewReader(string(payload)))
	if err !&#x3D; nil &#123;
		log.Fatal(err)
	&#125;

	defer r.Body.Close()
	body, err :&#x3D; ioutil.ReadAll(r.Body)
	if err !&#x3D; nil &#123;
		log.Fatal(err)
	&#125;

	fmt.Printf(&quot;%s\n&quot;, body)
&#125;</code></pre><h3 id="X-509-Client-Certificate-Proxy"><a href="#X-509-Client-Certificate-Proxy" class="headerlink" title="X.509 Client Certificate Proxy"></a>X.509 Client Certificate Proxy</h3><p>ì˜¤ëŠ˜ë‚ ì˜ ì¸í”„ë¼ ì‹œìŠ¤í…œì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ ì •ë³´ë¥¼ ê°ì¶”ê³  í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì— ëŒ€í•´ ì „ì²˜ë¦¬ ë™ì‘ì„ ìˆ˜í–‰í•˜ê³  ë„˜ê²¨ì£¼ëŠ” ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œë¥¼ êµ¬ì„±í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì…ë‹ˆë‹¤. ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œëŠ” Nginxì™€ ê°™ì€ ì›¹ ì„œë²„ ë˜ëŠ” ë¡œë“œë°¸ëŸ°ì„œì—ì„œ ì§€ì›í•˜ë©° ì´ëŸ¬í•œ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œë¥¼ ìˆ˜í–‰í•˜ëŠ” ì¸í”„ë¼ êµ¬ì„±ì—ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì— ëŒ€í•œ TLS í•¸ë“œì‰ì´í¬ ê³¼ì •ì—ì„œ ì „ë‹¬ëœ í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œë¥¼ ë³„ë„ì˜ í”„ë¡ì‹œ í—¤ë”ì— í¬í•¨ì‹œì¼œ ë„˜ê²¨ì£¼ì–´ì•¼í•©ë‹ˆë‹¤.</p><h4 id="X-SSL-CERT"><a href="#X-SSL-CERT" class="headerlink" title="X-SSL-CERT"></a>X-SSL-CERT</h4><p>ì¼ë°˜ì ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œì— ëŒ€í•œ í”„ë¡ì‹œ í—¤ë”ì˜ í‘œì¤€ì€ ì—†ìœ¼ë¯€ë¡œ X-SSL-CERTì™€ ê°™ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì—ì„œ ì½ì„ ìˆ˜ ìˆëŠ” í—¤ë”ë¥¼ ì •í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œë¥¼ í¬í•¨ì‹œì¼œ ì „ë‹¬í•˜ë„ë¡ êµ¬ì„±í•˜ë©´ ë©ë‹ˆë‹¤. ë‹¤ìŒì€ Nginxì—ì„œì˜ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ êµ¬ì„± ì‹œ X-SSL-CERT í—¤ë”ì— í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œë¥¼ í¬í•¨ì‹œí‚¤ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.</p><pre class="language-conf" data-language="conf"><code class="language-conf">server &#123;
    ssl_verify_client optional_no_ca;

    location &#x2F; &#123;
        proxy_set_header X-SSL-CERT $ssl_client_escaped_cert;
    &#125;
&#125;</code></pre><blockquote><p>ì¼ë°˜ì ìœ¼ë¡œ mTLSë¥¼ ìˆ˜í–‰í•  ë•Œ ì „ë‹¬ë˜ëŠ” í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œë„ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¸ì¦ ê¸°ê´€ì—ì„œ ë°œê¸‰ëœ ê²ƒì¸ì§€ë¥¼ íŒë‹¨í•©ë‹ˆë‹¤. ì‹œìŠ¤í…œ ìì²´ì ìœ¼ë¡œ ì„œëª…í•œ í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œëŠ” ì‹ ë¢°í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œì˜ ê²€ì¦ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ë¡œ ìœ„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></blockquote><h4 id="Webpack-Certificate-Proxy"><a href="#Webpack-Certificate-Proxy" class="headerlink" title="Webpack Certificate Proxy"></a>Webpack Certificate Proxy</h4><p>ì¼ë°˜ì ìœ¼ë¡œ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì„ ìœ„í•´ì„œ ì‚¬ìš©í•˜ëŠ” Webpackì—ì„œëŠ” ìì²´ì ìœ¼ë¡œ í”„ë¡ì‹œ êµ¬ì„±ì„ ì§€ì›í•˜ëŠ” <a target="_blank" rel="noopener" href="https://github.com/webpack/webpack-dev-server">webpack-dev-server</a>ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ëŠ” ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ êµ¬ì„±ê³¼ ë™ì¼í•˜ë¯€ë¡œ ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ì„œ Webpack í”„ë¡ì‹œ ì„œë²„ë¥¼ ê²½ìœ í•˜ë„ë¡ í•œë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œë¥¼ í¬í•¨í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">server</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'spdy'</span><span class="token punctuation">,</span> <span class="token comment">// https</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token literal-property property">cert</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'cert.pem'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">key</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'privkey.pem'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">requestCert</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">rejectUnauthorized</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">minVersion</span><span class="token operator">:</span> <span class="token string">'TLSv1.2'</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token string-property property">'/'</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'http://127.0.0.1:5000'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">secure</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">xfwd</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">rejectUnauthorized</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token function">onProxyReq</span><span class="token punctuation">(</span><span class="token parameter">proxyReq<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">const</span> cert <span class="token operator">=</span> req<span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">getPeerCertificate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>cert <span class="token operator">&amp;&amp;</span> cert<span class="token punctuation">.</span>raw<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">const</span> pem <span class="token operator">=</span> <span class="token string">'-----BEGIN CERTIFICATE-----'</span> <span class="token operator">+</span> cert<span class="token punctuation">.</span>raw<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'-----END CERTIFICATE-----'</span><span class="token punctuation">;</span>
                        proxyReq<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'X-SSL-CERT'</span><span class="token punctuation">,</span> pem<span class="token punctuation">)</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre><blockquote><p>requestCert ì˜µì…˜ì„ ì¼œì•¼ onProxyReq í•¨ìˆ˜ë‚´ì—ì„œ í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œë¥¼ ê°€ì ¸ì™€ì„œ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></blockquote><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a target="_blank" rel="noopener" href="https://www.cloudflare.com/ko-kr/learning/access-management/what-is-mutual-authentication/">What protocols support mutual authentication?</a></li><li><a target="_blank" rel="noopener" href="https://www.cloudflare.com/ko-kr/learning/access-management/what-is-mutual-tls/">What is mutual TLS (mTLS)?</a></li><li><a target="_blank" rel="noopener" href="https://downey.io/notes/dev/curl-using-mutual-tls/">how to curl an endpoint protected by mutual tls (mtls)</a></li><li><a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_ssl_module.html#var_ssl_client_escaped_cert">Nginx SSL Client Cert</a></li><li><a target="_blank" rel="noopener" href="https://webpack.js.org/configuration/dev-server/#devserverserver">Webpack DevServer.server</a></li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/X-509/" rel="tag"># X.509</a> <a href="/tags/mTLS/" rel="tag"># mTLS</a> <a href="/tags/X-SSL-CERT/" rel="tag"># X-SSL-CERT</a></div><div class="post-nav"><div class="post-nav-item"><a href="/sha-256/" rel="prev" title="SHA-256"><i class="fa fa-chevron-left"></i> SHA-256</a></div><div class="post-nav-item"><a href="/pki/" rel="next" title="PKI(Public Key Infrastructure)">PKI(Public Key Infrastructure) <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments"><script src="https://utteranc.es/client.js" repo="kdevkr/kdevkr.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Mambo</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script src="/js/third-party/fancybox.js"></script><script src="/js/third-party/pace.js"></script><script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script><script>var options={bottom:"unset",right:"15px",left:"unset",time:"0.5s",mixColor:"transparent",backgroundColor:"transparent",buttonColorDark:"#100f2c",buttonColorLight:"#fff",saveInCookies:!0,label:"ğŸŒ—",autoMatchOsTheme:!0};const darkmode=new Darkmode(options);window.darkmode=darkmode,darkmode.showWidget()</script></body></html>