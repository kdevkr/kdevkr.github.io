<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png"><link rel="mask-icon" href="/images/favicon/favicon.ico" color="#222"><meta name="google-site-verification" content="LMcddVW6xLBS7X1htGQ3duOIEmVp4ljku8sd3UuIcBg"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto+Sans+KR:300,300italic,400,400italic,700,700italic%7CPretendard-Bold:300,300italic,400,400italic,700,700italic%7CPretendard-Medium:300,300italic,400,400italic,700,700italic%7CJetbrains+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-loading-bar.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"kdevkr.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.13.2","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"width":240,"scrollpercent":true,"b2t":true},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script><meta property="og:type" content="website"><meta property="og:title" content="Mambo"><meta property="og:url" content="https://kdevkr.github.io/page/16/index.html"><meta property="og:site_name" content="Mambo"><meta property="og:locale" content="en_US"><meta property="article:author" content="Mambo"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://kdevkr.github.io/page/16/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/16/index.html","title":""}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Mambo</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-V8LF04VMBF"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-V8LF04VMBF","only_pageview":false}</script><script src="/js/third-party/analytics/google-analytics.js"></script><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><link rel="alternate" href="/atom.xml" title="Mambo" type="application/atom+xml">
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope itemtype="http://schema.org/WebPage"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">Mambo</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Today I Learned 🔥</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fas fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fas fa-archive fa-fw"></i>Archives<span class="badge">81</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fas fa-user fa-fw"></i>About</a></li></ul></nav></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-overview-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Mambo" src="https://avatars1.githubusercontent.com/u/17937604?s=460&v=4"><p class="site-author-name" itemprop="name">Mambo</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">81</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-tags"><span class="site-state-item-count">133</span> <span class="site-state-item-name">tags</span></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/kdevkr" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;kdevkr" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:kdevkr@gmail.com" title="E-Mail → mailto:kdevkr@gmail.com" rel="noopener" target="_blank"><i class="fas fa-envelope fa-fw"></i>E-Mail</a></span></div><div class="cc-license site-overview-item animated" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ko" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div><div class="back-to-top animated" role="button" aria-label="Back to top"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div class="sidebar-dimmer"></div></header><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner index posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://kdevkr.github.io/quartz/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://avatars1.githubusercontent.com/u/17937604?s=460&v=4"><meta itemprop="name" content="Mambo"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Mambo"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | Mambo"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/quartz/" class="post-title-link" itemprop="url">쿼츠 스케줄러</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2022-11-27 00:00:00" itemprop="dateCreated datePublished" datetime="2022-11-27T00:00:00+09:00">2022-11-27</time></span></div></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>예제 코드 : <a target="_blank" rel="noopener" href="https://github.com/kdevkr/spring-demo-quartz">kdevkr&#x2F;spring-demo-quartz</a></p></blockquote><p>소프트웨어 엔지니어인 개발자는 반복적으로 정해진 시간에 수행되어야할 작업을 예약해두는 스케줄링 기능을 자주 사용하게 되는 편이다. 리눅스 서버에서는 배시 스크립트를 작성하여 크론탭(crontab)에 등록하여 실행될 수 있도록 하며 시스템을 구성하는 애플리케이션에는 스케줄링 기능을 활용해서 애플리케이션에서 필요한 반복적인 작업을 수행하도록 구현하게 된다. 쿼츠 스케줄러는 스프링 부트 애플리케이션에서 쉽게 사용할 수 있도록 지원하는 라이브러리이므로 반복적인 작업을 수행하기 위한 스케줄 기능을 적용할 수 있다.</p><h4 id="인메모리-독립-스케줄러"><a href="#인메모리-독립-스케줄러" class="headerlink" title="인메모리 독립 스케줄러"></a>인메모리 독립 스케줄러</h4><p>QuartzAutoConfiguration에 의해 자동으로 SchedulerFactoryBean가 등록되고 RAMJobStore가 기본값이기에 별다른 설정없이도 쿼츠 스케줄러를 사용할 수 있다.</p><pre class="language-yaml" data-language="yaml"><code class="language-yaml">spring:
  quartz:
    scheduler-name: QuartzScheduler
    job-store-type: memory
    properties:
      org.quartz.scheduler.instanceName: QuartzScheduler
      org.quartz.scheduler.instanceId: AUTO

      org.quartz.threadPool.class: org.quartz.simpl.SimpleThreadPool
      org.quartz.threadPool.threadCount: 100
      
      org.quartz.jobStore.class: org.quartz.simpl.RAMJobStore</code></pre><h4 id="JDBC-분산-스케줄러"><a href="#JDBC-분산-스케줄러" class="headerlink" title="JDBC 분산 스케줄러"></a>JDBC 분산 스케줄러</h4><p>실무에서 쿼츠 스케줄러를 사용하고 있지만 쿼츠 팀에서 제공하는 JDBC 기반의 클러스터링 기능을 사용하고 있지는 않다. 비슷하게 스케줄 상태에 대해서 데이터베이스 락을 이용하여 분산 애플리케이션에서 스케줄이 중복하여 실행되지 않도록 구현된 상태이다. 아무튼 이 글에서는 쿼츠에서 제공하는 JDBC 클러스터링으로 스케줄을 관리해보도록 하자.</p><p><a target="_blank" rel="noopener" href="https://github.com/quartz-scheduler/quartz/wiki/How-to-Setup-Databases#postgresql-database">쿼츠 스케줄러용 데이터베이스 생성</a><br><a target="_blank" rel="noopener" href="https://github.com/quartz-scheduler/quartz/blob/master/quartz-core/src/main/resources/org/quartz/impl/jdbcjobstore/tables_postgres.sql">쿼츠 스케줄러 데이터베이스 스키마 생성</a><br><a target="_blank" rel="noopener" href="http://www.quartz-scheduler.org/documentation/2.4.0-SNAPSHOT/configuration.html#configuration-of-jdbc-jobstoretx-store-jobs-and-triggers-in-a-database-via-jdbc">JDBC 기반 JobStoreTX 구성</a></p><pre class="language-sql" data-language="sql"><code class="language-sql">CREATE USER quartz WITH ENCRYPTED PASSWORD &#39;quartz123&#39; CONNECTION LIMIT 100;
CREATE DATABASE quartz OWNER quartz;</code></pre><pre class="language-sql" data-language="sql"><code class="language-sql">-- Run tables_postgres.sql</code></pre><pre class="language-yaml" data-language="yaml"><code class="language-yaml">spring:
  quartz:
    scheduler-name: QuartzScheduler
    job-store-type: jdbc
    properties:
      org.quartz.scheduler.instanceName: QuartzScheduler
      org.quartz.scheduler.instanceId: AUTO

      org.quartz.threadPool.class: org.quartz.simpl.SimpleThreadPool
      org.quartz.threadPool.threadCount: 100

      org.quartz.jobStore.class: org.quartz.impl.jdbcjobstore.JobStoreTX
      org.quartz.jobStore.driverDelegateClass: org.quartz.impl.jdbcjobstore.PostgreSQLDelegate
      org.quartz.jobStore.dataSource: quartzDS
      org.quartz.jobStore.isClustered: true
      org.quartz.jobStore.clusterCheckinInterval: 20000

      org.quartz.dataSource.quartzDS.provider: hikaricp
      org.quartz.dataSource.quartzDS.driver: org.postgresql.Driver
      org.quartz.dataSource.quartzDS.URL: jdbc:postgresql:&#x2F;&#x2F;localhost:5432&#x2F;quartz
      org.quartz.dataSource.quartzDS.user: quartz
      org.quartz.dataSource.quartzDS.password: quartz123
      org.quartz.dataSource.quartzDS.maxConnections: 10</code></pre><blockquote><p>org.quartz.dataSource.quartzDS.provider를 hikaricp로 지정하지 않으면 c3p0 커넥션 풀을 기본적으로 의존하므로 주의하자.</p></blockquote><h4 id="스케줄-잡-및-트리거-등록"><a href="#스케줄-잡-및-트리거-등록" class="headerlink" title="스케줄 잡 및 트리거 등록"></a>스케줄 잡 및 트리거 등록</h4><p>많은 블로그 글에서 쿼츠 스케줄러로 동작하는 스케줄 정보와 트리거를 등록하는 방법을 어렵게 설명하지만 생각보다 간단하다. 스케줄 잡을 구현할 때에 JobDetail과 Trigger를 함께 빈으로 등록할 수 있도록 아래와 같이 관리하면 편리하게 등록할 수 있다.</p><pre class="language-java" data-language="java"><code class="language-java">package com.example.demo.scheduler;

import lombok.extern.slf4j.Slf4j;
import org.quartz.*;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.context.annotation.Bean;
import org.springframework.scheduling.quartz.QuartzJobBean;
import org.springframework.stereotype.Component;

@Slf4j
@Component
public class SampleJob extends QuartzJobBean &#123;
    public static final String JOB_NAME &#x3D; &quot;SampleJob&quot;;
    public static final String JOB_DETAIL_NAME &#x3D; JOB_NAME + &quot;Detail&quot;;

    @Override
    protected void executeInternal(JobExecutionContext context) throws JobExecutionException &#123;
        log.info(&quot;&#123;&#125;, &#123;&#125;, &#123;&#125;&quot;, context.getTrigger().getKey().toString(), context.getJobInstance().toString(), context.getFireTime());
    &#125;

    @Bean(JOB_DETAIL_NAME)
    public JobDetail jobDetail() &#123;
        return JobBuilder.newJob().ofType(SampleJob.class)
                .storeDurably()
                .withIdentity(&quot;SampleJobDetail&quot;)
                .withDescription(&quot;Invoke Sample Job...&quot;)
                .build();
    &#125;

    @Bean
    public Trigger simpleTrigger(@Qualifier(JOB_DETAIL_NAME) JobDetail job) &#123;
        return TriggerBuilder.newTrigger().forJob(job)
                .withIdentity(&quot;SampleJobTrigger&quot;)
                .withDescription(&quot;Sample trigger with interval&quot;)
                .withSchedule(SimpleScheduleBuilder.simpleSchedule().repeatForever().withIntervalInSeconds(5))
                .build();
    &#125;

    @Bean
    public Trigger cronTrigger(@Qualifier(JOB_DETAIL_NAME) JobDetail job) &#123;
        return TriggerBuilder.newTrigger().forJob(job)
                .withIdentity(&quot;SampleJobTrigger&quot;)
                .withDescription(&quot;Sample trigger with cron&quot;)
                .withSchedule(CronScheduleBuilder.cronSchedule(&quot;* * * * * ?&quot;))
                .build();
    &#125;
&#125;</code></pre><h4 id="스프링-스케줄링-분산-동기화"><a href="#스프링-스케줄링-분산-동기화" class="headerlink" title="스프링 스케줄링 분산 동기화"></a>스프링 스케줄링 분산 동기화</h4><p>쿼츠 스케줄러를 도입하는 이유는 스프링에서 제공하는 @Scheduled를 통한 스케줄링 기능은 클러스터링을 지원하지 않기 때문에 분산된 애플리케이션에서 독립적으로 실행되기 때문이다. 쿼츠 스케줄러와 동일하게 JDBC 기반으로 동기화를 수행할 수 있도록 <a target="_blank" rel="noopener" href="https://github.com/lukas-krecan/ShedLock">ShedLock</a> 라이브러리를 사용하면 동기화된 스케줄이 동작되도록 할 수 있다. 스프링에서 제공하는 스케줄링 기능은 애플리케이션마다 실행해도 상관없는 작업에 간단하게 적용하는 것이 좋다고 생각되므로 동기화된 스케줄이 필요한 경우라면 쿼츠 스케줄러를 사용하는게 좋다고 생각된다.</p><h4 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h4><ul><li><a target="_blank" rel="noopener" href="http://www.quartz-scheduler.org/documentation/2.4.0-SNAPSHOT/configuration.html">Quartz Configuration Reference</a></li><li><a target="_blank" rel="noopener" href="https://www.baeldung.com/spring-quartz-schedule">Scheduling in Spring with Quartz</a></li></ul></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><nav class="pagination"><a class="extend prev" rel="prev" href="/page/15/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/page/81/">81</a><a class="extend next" rel="next" href="/page/17/"><i class="fa fa-angle-right" aria-label="Next page"></i></a></nav></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Mambo</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a></div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script src="/js/third-party/fancybox.js"></script><script src="/js/third-party/pace.js"></script><script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script><script>var options={bottom:"unset",right:"15px",left:"unset",time:"0.5s",mixColor:"transparent",backgroundColor:"transparent",buttonColorDark:"#100f2c",buttonColorLight:"#fff",saveInCookies:!0,label:"🌗",autoMatchOsTheme:!0};const darkmode=new Darkmode(options);window.darkmode=darkmode,darkmode.showWidget()</script></body></html>