---
title: NAT
date: 2021-09-05
tags:
- NAT
- PAT
---

안녕하세요 Mambo 입니다.

오늘은 IT 인프라에서 외부에 공개되는 IP와 내부적으로 사용하는 IP간의 변환을 수행하는 NAT에 대해서 알아봅니다.

## NAT
[NAT(IP Network Address Translator)](https://datatracker.ietf.org/doc/html/rfc1631)는 인터넷 망에서 사용하는 IPv4 주소체계의 한계점으로 인하여 IP 주소가 부족해지는 현상을 해결하기 위하여 사용하는 기술로써 내부망에서 사용하는 IP로 외부 네트워크에 접속할 수 있도록 공인 IP로 변환하는 기능을 수행합니다. 

집에서 공유기를 사용하고 있는 제가 [ipconfig.io](https://ipconfig.io/), [ifconfig.io](https://ifconfig.io/), [ifconfig.me](https://ifconfig.me/) 사이트에 접속해보면 **218.156.X.X**와 같은 아이피 주소를 확인할 수 있습니다. 그런데 윈도우 명령프롬프트에 ipconfig 명령어를 사용하면 **192.168.0.2**이라고 하는 사설망 IP가 표시됩니다. 이렇게 외부에서 확인할 수 있는 IP와 내부에서 확인할 수 있는 IP가 다른 이유는 제가 사용하고 있는 **공유기가 NAT 기능을 수행**하고 있기 때문입니다.

![](../images/posts/nat-01.png)

KT 인터넷 사업자에서 신발장 어딘가에 설치해둔 네트워크 장비에 218.156.190.195를 할당해주고 저는 그 네트워크 선을 공유기에 연결하여 사설 네트워크망을 구성하고 192.168.0.2를 할당한 것입니다. 그리고 인터넷을 사용할 때는 외부망으로 접속할 때 192.168.0.2가 아닌 218.156.190.195로 바꾸어서 전달되게 변환하는 게 바로 NAT 입니다.

### IP 위치 추적
영화에서 자주 나오는 장면 중 하나인 IP 위치 추적은 사실 상 인터넷 사업자가 특정 지역 범위에 어느 IP 대역을 할당할 것인지를 알지 못하면 정확한 추적은 어렵습니다. 국내의 경우 한국인터넷진흥원에서 제공하는 [WHOIS](https://xn--c79as89aj0e29b77z.xn--3e0b707e/)에서는 KT와 같은 인터넷 사업자에서 할당한 정보를 등록하기 때문에 비교적 자세한 지역까지 추적이 가능합니다. 범죄자들이 해외 IP를 사용하면 추적하기 힘들다는 이야기는 경찰이 서비스 회사에 범죄자의 아이디에 대해 저장된 로그를 공조 요청해서 IP 정보까지는 받는 것은 비교적 쉬우나 IP 대역에 대해 인터넷 사업자에게 요청하고 지역을 좁혀가는 것에 한계가 있기 때문입니다. 

간혹, VPN 서버를 거치기 때문에 IP는 숨겨진다는 말을 하는데 특정 범죄를 위한 팀을 꾸리지 않는 이상 경찰이라는 조직에서 일반적으로 발생하는 범죄에 대해 집요하고 끈기있게 추적하기에는 어렵기 때문이지 IP가 완전히 숨겨지지는 않습니다.

### NAT IP
실무 환경에서는 회사에서 사용하는 공인 IP 그리고 네트워크 장비를 관리하는 담당자가 DHCP를 구성해놓고 별도의 요청을 받으면 외부 트래픽이 회사 내부 사설망까지 도달할 수 있도록 NAT를 설정하게 됩니다. 그래서 보통 네트워크 관리자에게 외부에서 접근할 수 있는 아이피를 요청하게 됩니다.

<p style="text-align:center;">"외부에서 접근하기 위한 NAT 아이피가 필요합니다."</p>

그러면 네트워크 담당자분은 요청 사유를 검토하고 아이피를 할당하여 사용하라고 전달해주겠죠.

#### PAT
NAT와 함께 하나의 공인 IP를 사설망을 구성하는 다수의 내부 IP로 전달되도록 연결할 수 있도록 하는 기술이 PAT입니다. 공인 IP의 포트와 NAT IP의 포트를 연결하여 외부에서 접근할 수 있도록 지원할 수 있게 됩니다. 앞서 네트워크 담당자는 NAT 아이피와 함께 외부에서 접근할 수 있는 도메인과 포트를 포함하여 알려줍니다.






