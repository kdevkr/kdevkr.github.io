<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.0.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png"><link rel="mask-icon" href="/images/favicon/favicon.ico" color="#222"><meta name="google-site-verification" content="LMcddVW6xLBS7X1htGQ3duOIEmVp4ljku8sd3UuIcBg"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto+Sans+KR:300,300italic,400,400italic,700,700italic%7CGmarket+Sans:300,300italic,400,400italic,700,700italic%7CRIDIBatang:300,300italic,400,400italic,700,700italic%7CJetbrains+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-loading-bar.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"kdevkr.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"width":240,"scrollpercent":true,"b2t":true},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script><meta name="description" content="안녕하세요 Mambo 입니다. 갑작스럽게 발생하는 시스템 장애는 늘 개발자를 힘겹게 합니다.오늘은 사소한 것으로부터 발생한 시스템 장애에 대한 경험을 공유하고자 합니다. 시스템 장애현재 조직에서는 시계열 데이터에 대한 관리 및 통계를 위해서 컬럼형 시계열 데이터베이스인 KDB+를 사용하고 있습니다. 그리고 분산으로 실행되어있는 애플리케이션에서 RDBMS에서"><meta property="og:type" content="article"><meta property="og:title" content="장애는 사소한 것에서 발생한다"><meta property="og:url" content="https://kdevkr.github.io/system-failure-occurs-from-trivial-things/index.html"><meta property="og:site_name" content="Mambo"><meta property="og:description" content="안녕하세요 Mambo 입니다. 갑작스럽게 발생하는 시스템 장애는 늘 개발자를 힘겹게 합니다.오늘은 사소한 것으로부터 발생한 시스템 장애에 대한 경험을 공유하고자 합니다. 시스템 장애현재 조직에서는 시계열 데이터에 대한 관리 및 통계를 위해서 컬럼형 시계열 데이터베이스인 KDB+를 사용하고 있습니다. 그리고 분산으로 실행되어있는 애플리케이션에서 RDBMS에서"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://kdevkr.github.io/images/posts/system-failure-occurs-from-trivial-things/01.gif"><meta property="og:image" content="https://kdevkr.github.io/images/posts/system-failure-occurs-from-trivial-things/02.gif#compact"><meta property="article:published_time" content="2022-01-08T00:00:00.000Z"><meta property="article:modified_time" content="2022-05-18T14:44:33.728Z"><meta property="article:author" content="Mambo"><meta property="article:tag" content="System Failure"><meta property="article:tag" content="Troubleshooting"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://kdevkr.github.io/images/posts/system-failure-occurs-from-trivial-things/01.gif"><link rel="canonical" href="https://kdevkr.github.io/system-failure-occurs-from-trivial-things/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://kdevkr.github.io/system-failure-occurs-from-trivial-things/","path":"system-failure-occurs-from-trivial-things/","title":"장애는 사소한 것에서 발생한다"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>장애는 사소한 것에서 발생한다 | Mambo</title><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-93954323-1","only_pageview":true}</script><script src="/js/third-party/analytics/google-analytics.js"></script><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><link rel="alternate" href="/atom.xml" title="Mambo" type="application/atom+xml">
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}</style></head><body itemscope itemtype="http://schema.org/WebPage"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Mambo</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Today I Learned 🔥</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fas fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fas fa-archive fa-fw"></i>Archives<span class="badge">56</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fas fa-user fa-fw"></i>About</a></li></ul></nav></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%9E%A5%EC%95%A0"><span class="nav-number">1.</span> <span class="nav-text">시스템 장애</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%9B%90%EC%9D%B8-%EB%B6%84%EC%84%9D"><span class="nav-number">1.1.</span> <span class="nav-text">원인 분석</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0"><span class="nav-number">1.2.</span> <span class="nav-text">문제 해결</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%9E%A5%EC%95%A0-%EB%8C%80%EC%9D%91-%EC%86%8C%EA%B0%90"><span class="nav-number">1.3.</span> <span class="nav-text">장애 대응 소감</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Mambo" src="https://avatars1.githubusercontent.com/u/17937604?s=460&v=4"><p class="site-author-name" itemprop="name">Mambo</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">56</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-tags"><span class="site-state-item-count">91</span> <span class="site-state-item-name">tags</span></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/kdevkr" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;kdevkr" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:kdevkr@gmail.com" title="E-Mail → mailto:kdevkr@gmail.com" rel="noopener" target="_blank"><i class="fas fa-envelope fa-fw"></i>E-Mail</a></span></div><div class="cc-license site-overview-item animated" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ko" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div><div class="back-to-top animated" role="button" aria-label="Back to top"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div class="sidebar-dimmer"></div></header><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en"><link itemprop="mainEntityOfPage" href="https://kdevkr.github.io/system-failure-occurs-from-trivial-things/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://avatars1.githubusercontent.com/u/17937604?s=460&v=4"><meta itemprop="name" content="Mambo"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Mambo"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="장애는 사소한 것에서 발생한다 | Mambo"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">장애는 사소한 것에서 발생한다</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2022-01-08 00:00:00" itemprop="dateCreated datePublished" datetime="2022-01-08T00:00:00Z">2022-01-08</time></span></div></div></header><div class="post-body" itemprop="articleBody"><p>안녕하세요 Mambo 입니다.</p><p>갑작스럽게 발생하는 시스템 장애는 늘 개발자를 힘겹게 합니다.<br>오늘은 사소한 것으로부터 발생한 시스템 장애에 대한 경험을 공유하고자 합니다.</p><h2 id="시스템-장애"><a href="#시스템-장애" class="headerlink" title="시스템 장애"></a>시스템 장애</h2><p>현재 조직에서는 시계열 데이터에 대한 관리 및 통계를 위해서 컬럼형 시계열 데이터베이스인 <a target="_blank" rel="noopener" href="https://kx.com/">KDB+</a>를 사용하고 있습니다. 그리고 분산으로 실행되어있는 애플리케이션에서 RDBMS에서 조회된 일부 데이터를 컬럼형 시계열 데이터베이스로 동기화하는 스케줄이 동작합니다. 그런데 스케줄로 인하여 데이터가 동기화 된 이후에 컬럼형 시계열 데이터베이스에 있는 동기화된 데이터가 조금씩 사라지기 시작하고 동기화된 모든 데이터가 삭제되는 현상이 발생하였습니다.</p><h3 id="원인-분석"><a href="#원인-분석" class="headerlink" title="원인 분석"></a>원인 분석</h3><p>처음에는 동기화된 데이터가 저장되는 테이블에 데이터가 없다는 것을 보고받고 시스템 계정으로 접속하여 수동으로 해당 스케줄을 동작하여 데이터를 복구하였습니다. 그러나 해당 스케줄은 5분마다 동작하고 해당 스케줄이 돌게되면 데이터가 점점 없어지는 것을 확인하였습니다. 해당 스케줄이 동작하고나서 <strong>수동으로 동작시키고 난 후에는</strong> 데이터가 사라지는 현상이 나타나지 않았습니다.</p><p><img data-src="/images/posts/system-failure-occurs-from-trivial-things/01.gif" alt="똑같은 스케줄 동작인데?..."></p><p>결국 시계열 데이터베이스가 설치된 인스턴스로 접속하여 로그를 살펴보니 스케줄이 동작하고 데이터 저장을 완료했다는 로그 이후에 또다른 로그가 기록되더니 무수히 많은 <strong>잘못된 유형(&#96;type)이라는 불친절한 오류 로그</strong>를 확인하게 됩니다. 그리고 이번주 작업으로 특정 컬럼의 유형을 바꾸어야하는 요구사항에 대한 처리를 했다는 것도 인지하게 됩니다. 다만, 이 작업은 개발 환경에서 작업하였고 아직 배포전이므로 실행중인 애플리케이션에는 해당되지 않았습니다.</p><h3 id="문제-해결"><a href="#문제-해결" class="headerlink" title="문제 해결"></a>문제 해결</h3><p>그러던 중 스케줄은 환경별로 독립적으로 실행되도록 구성되어있다는 점을 떠올리게 됩니다. 즉, 로컬 환경 프로파일로 실행하면 로컬 환경에서만 독립적이라는 이야기죠. 그리고 누군가 로컬 소스코드 기준으로 (장애가 발생한) 특정 배포 환경에 연결한게 아닌가 의심하였고 조직에서 사용하는 메신저 채널인 슬랙에 알려보았습니다. 슬쩍 손을 드신분은 마침 휴가를 쓰신 팀장님이었고 원격으로 팀장님 컴퓨터에 실행중인 애플리케이션을 중지해달라고 요청했고 장애는 자연스럽게 해결되었습니다.</p><p><img data-src="/images/posts/system-failure-occurs-from-trivial-things/02.gif#compact" alt="어쨌든 범인 검거..."></p><h3 id="장애-대응-소감"><a href="#장애-대응-소감" class="headerlink" title="장애 대응 소감"></a>장애 대응 소감</h3><p>다행히도 지워지던 데이터는 중요한 데이터가 아니라 프론트엔드에서 통계 표시를 위한 기준 테이블이어서 일부 데이터가 표시되지 않는 사소한 장애였습니다. 그럼에도 불구하고 장애를 판단하고 원인을 분석하여 해결하기까지는 생각보다 쉽지 않았던 것 같습니다. 사실 이 장애는 모니터링 체계를 도입하더라도 검출되지 않는 사소하지 않는 장애이기도 합니다. 그리고 이 장애를 보다보니 유튜브 개발바닥에 공유된 <a target="_blank" rel="noopener" href="https://youtu.be/SWZcrdmmLEU">재난급 서버 장애내고 개발자 인생 끝날뻔 한 썰</a>이 떠오르는 것 같습니다.</p><p>감사합니다.</p></div><footer class="post-footer"><div class="post-tags"><a href="/tags/System-Failure/" rel="tag"># System Failure</a> <a href="/tags/Troubleshooting/" rel="tag"># Troubleshooting</a></div><div class="post-nav"><div class="post-nav-item"><a href="/lombok-annotation-processor/" rel="prev" title="롬복 어노테이션 프로세서"><i class="fa fa-chevron-left"></i> 롬복 어노테이션 프로세서</a></div><div class="post-nav-item"><a href="/improve-webpack5-build-speed/" rel="next" title="Webpack 5 빌드 속도 개선하기">Webpack 5 빌드 속도 개선하기 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments"><script src="https://utteranc.es/client.js" repo="kdevkr/kdevkr.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Mambo</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a></div></div></footer><script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script src="/js/third-party/fancybox.js"></script><script src="/js/third-party/pace.js"></script><script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script><script>var options={bottom:"unset",right:"15px",left:"unset",time:"0.5s",mixColor:"transparent",backgroundColor:"transparent",buttonColorDark:"#100f2c",buttonColorLight:"#fff",saveInCookies:!0,label:"🌗",autoMatchOsTheme:!0};const darkmode=new Darkmode(options);window.darkmode=darkmode,darkmode.showWidget()</script></body></html>